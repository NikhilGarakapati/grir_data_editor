{"ast":null,"code":"import { isNullOrUndefined, extend, isBlazor } from '@syncfusion/ej2-base';\nimport { Query, DataManager, Predicate, Deferred, UrlAdaptor } from '@syncfusion/ej2-data';\nimport { setFormatter, isGroupAdaptive, getColumnByForeignKeyValue, refreshFilteredColsUid } from '../base/util';\nimport * as events from '../base/constant';\nimport { ValueFormatter } from '../services/value-formatter';\nimport { CheckBoxFilterBase } from '../common/checkbox-filter-base';\n/**\n * Grid data module is used to generate query and data source.\n * @hidden\n */\n\nvar Data =\n/** @class */\nfunction () {\n  /**\n   * Constructor for data module.\n   * @hidden\n   */\n  function Data(parent, serviceLocator) {\n    this.dataState = {\n      isPending: false,\n      resolver: null,\n      group: []\n    };\n    this.foreignKeyDataState = {\n      isPending: false,\n      resolver: null\n    };\n    this.parent = parent;\n    this.serviceLocator = serviceLocator;\n    this.initDataManager();\n\n    if (this.parent.isDestroyed || this.getModuleName() === 'foreignKey') {\n      return;\n    }\n\n    this.parent.on(events.rowsAdded, this.addRows, this);\n    this.parent.on(events.rowPositionChanged, this.reorderRows, this);\n    this.parent.on(events.rowsRemoved, this.removeRows, this);\n    this.parent.on(events.dataSourceModified, this.initDataManager, this);\n    this.parent.on(events.destroy, this.destroy, this);\n    this.parent.on(events.updateData, this.crudActions, this);\n    this.parent.on(events.addDeleteAction, this.getData, this);\n    this.parent.on(events.autoCol, this.refreshFilteredCols, this);\n    this.parent.on(events.columnsPrepared, this.refreshFilteredCols, this);\n  }\n\n  Data.prototype.reorderRows = function (e) {\n    this.dataManager.dataSource.json.splice(e.toIndex, 0, this.dataManager.dataSource.json.splice(e.fromIndex, 1)[0]);\n  };\n\n  Data.prototype.getModuleName = function () {\n    return 'data';\n  };\n  /**\n   * The function used to initialize dataManager and external query\n   * @return {void}\n   */\n\n\n  Data.prototype.initDataManager = function () {\n    var gObj = this.parent;\n    this.dataManager = gObj.dataSource instanceof DataManager ? gObj.dataSource : isNullOrUndefined(gObj.dataSource) ? new DataManager() : new DataManager(gObj.dataSource);\n    this.isQueryInvokedFromData = true;\n    gObj.query = gObj.query instanceof Query ? gObj.query : new Query();\n  };\n  /**\n   * The function is used to generate updated Query from Grid model.\n   * @return {Query}\n   * @hidden\n   */\n\n\n  Data.prototype.generateQuery = function (skipPage) {\n    var gObj = this.parent;\n    var query = gObj.getQuery().clone();\n\n    if (this.parent.columnQueryMode === 'ExcludeHidden') {\n      query.select(this.parent.getColumns().filter(function (column) {\n        return !(column.isPrimaryKey !== true && column.visible === false || column.field === undefined);\n      }).map(function (column) {\n        return column.field;\n      }));\n    } else if (this.parent.columnQueryMode === 'Schema') {\n      var selectQueryFields = [];\n      var columns = this.parent.columns;\n\n      for (var i = 0; i < columns.length; i++) {\n        selectQueryFields.push(columns[i].field);\n      }\n\n      query.select(selectQueryFields);\n    }\n\n    this.filterQuery(query);\n    this.searchQuery(query);\n    this.aggregateQuery(query);\n    this.sortQuery(query);\n\n    if (isGroupAdaptive(this.parent)) {\n      this.virtualGroupPageQuery(query);\n    } else {\n      this.pageQuery(query, skipPage);\n    }\n\n    this.groupQuery(query);\n    return query;\n  };\n  /** @hidden */\n\n\n  Data.prototype.aggregateQuery = function (query, isForeign) {\n    var rows = this.parent.aggregates;\n\n    for (var i = 0; i < rows.length; i++) {\n      var row = rows[i];\n\n      for (var j = 0; j < row.columns.length; j++) {\n        var cols = row.columns[j];\n        var types = cols.type instanceof Array ? cols.type : [cols.type];\n\n        for (var k = 0; k < types.length; k++) {\n          query.aggregate(types[k].toLowerCase(), cols.field);\n        }\n      }\n    }\n\n    return query;\n  };\n\n  Data.prototype.virtualGroupPageQuery = function (query) {\n    var gObj = this.parent;\n    var fName = 'fn';\n\n    if (query.queries.length) {\n      for (var i = 0; i < query.queries.length; i++) {\n        if (query.queries[i][fName] === 'onPage') {\n          query.queries.splice(i, 1);\n        }\n      }\n    }\n\n    return query;\n  };\n\n  Data.prototype.pageQuery = function (query, skipPage) {\n    var gObj = this.parent;\n    var fName = 'fn';\n\n    if ((gObj.allowPaging || gObj.enableVirtualization || gObj.enableInfiniteScrolling) && skipPage !== true) {\n      gObj.pageSettings.currentPage = Math.max(1, gObj.pageSettings.currentPage);\n\n      if (gObj.pageSettings.pageCount <= 0) {\n        gObj.pageSettings.pageCount = 8;\n      }\n\n      if (gObj.pageSettings.pageSize <= 0) {\n        gObj.pageSettings.pageSize = 12;\n      }\n\n      if (query.queries.length) {\n        for (var i = 0; i < query.queries.length; i++) {\n          if (query.queries[i][fName] === 'onPage') {\n            query.queries.splice(i, 1);\n          }\n        }\n      }\n\n      if (!isNullOrUndefined(gObj.infiniteScrollModule) && gObj.enableInfiniteScrolling) {\n        this.parent.notify(events.infinitePageQuery, query);\n      } else {\n        query.page(gObj.pageSettings.currentPage, gObj.pageSettings.pageSize);\n      }\n    }\n\n    return query;\n  };\n\n  Data.prototype.groupQuery = function (query) {\n    var gObj = this.parent;\n\n    if (gObj.allowGrouping && gObj.groupSettings.columns.length) {\n      var columns = gObj.groupSettings.columns;\n\n      for (var i = 0, len = columns.length; i < len; i++) {\n        var column = this.getColumnByField(columns[i]);\n\n        if (!column) {\n          this.parent.log('initial_action', {\n            moduleName: 'group',\n            columnName: columns[i]\n          });\n        }\n\n        var isGrpFmt = column.enableGroupByFormat;\n        var format = column.format;\n\n        if (isGrpFmt) {\n          query.group(columns[i], this.formatGroupColumn.bind(this), format);\n        } else {\n          query.group(columns[i], null);\n        }\n      }\n    }\n\n    return query;\n  };\n\n  Data.prototype.sortQuery = function (query) {\n    var gObj = this.parent;\n\n    if ((gObj.allowSorting || gObj.allowGrouping) && gObj.sortSettings.columns.length) {\n      var columns = gObj.sortSettings.columns;\n      var sortGrp = [];\n\n      for (var i = columns.length - 1; i > -1; i--) {\n        var col = this.getColumnByField(columns[i].field);\n\n        if (col) {\n          col.setSortDirection(columns[i].direction);\n        } else {\n          this.parent.log('initial_action', {\n            moduleName: 'sort',\n            columnName: columns[i].field\n          });\n          return query;\n        }\n\n        var fn = columns[i].direction;\n\n        if (col.sortComparer) {\n          this.parent.log('grid_sort_comparer');\n          fn = !this.isRemote() ? col.sortComparer.bind(col) : columns[i].direction;\n        }\n\n        if (gObj.groupSettings.columns.indexOf(columns[i].field) === -1) {\n          query.sortBy(col.field, fn);\n        } else {\n          sortGrp.push({\n            direction: fn,\n            field: col.field\n          });\n        }\n      }\n\n      for (var i = 0, len = sortGrp.length; i < len; i++) {\n        query.sortBy(sortGrp[i].field, sortGrp[i].direction);\n      }\n    }\n\n    return query;\n  };\n\n  Data.prototype.searchQuery = function (query, fcolumn, isForeignKey) {\n    var sSettings = this.parent.searchSettings;\n    var fields = sSettings.fields.length ? sSettings.fields : this.getSearchColumnFieldNames();\n    var predicateList = [];\n    var needForeignKeySearch = false;\n\n    if (this.parent.searchSettings.key.length) {\n      needForeignKeySearch = this.parent.getForeignKeyColumns().some(function (col) {\n        return fields.indexOf(col.field) > -1;\n      });\n      var adaptor = !isForeignKey ? this.dataManager.adaptor : fcolumn.dataSource.adaptor;\n\n      if (needForeignKeySearch || adaptor.getModuleName && adaptor.getModuleName() === 'ODataV4Adaptor') {\n        fields = isForeignKey ? [fcolumn.foreignKeyValue] : fields;\n\n        for (var i = 0; i < fields.length; i++) {\n          var column = isForeignKey ? fcolumn : this.getColumnByField(fields[i]);\n\n          if (column.isForeignColumn() && !isForeignKey) {\n            predicateList = this.fGeneratePredicate(column, predicateList);\n          } else {\n            predicateList.push(new Predicate(fields[i], sSettings.operator, sSettings.key, sSettings.ignoreCase, sSettings.ignoreAccent));\n          }\n        }\n\n        var predList = Predicate.or(predicateList);\n        predList.key = sSettings.key;\n        query.where(predList);\n      } else {\n        query.search(sSettings.key, fields, sSettings.operator, sSettings.ignoreCase, sSettings.ignoreAccent);\n      }\n    }\n\n    return query;\n  };\n\n  Data.prototype.filterQuery = function (query, column, skipFoerign) {\n    var gObj = this.parent;\n    var predicateList = [];\n    var actualFilter = [];\n    var foreignColumn = this.parent.getForeignKeyColumns();\n\n    if (gObj.allowFiltering && gObj.filterSettings.columns.length) {\n      var columns = column ? column : gObj.filterSettings.columns;\n      var colType = {};\n\n      for (var _i = 0, _a = gObj.getColumns(); _i < _a.length; _i++) {\n        var col = _a[_i];\n        colType[col.field] = col.filter.type ? col.filter.type : gObj.filterSettings.type;\n      }\n\n      var foreignCols = [];\n      var defaultFltrCols = [];\n\n      for (var _b = 0, columns_1 = columns; _b < columns_1.length; _b++) {\n        var col = columns_1[_b];\n        var gridColumn = gObj.getColumnByField(col.field);\n\n        if (isNullOrUndefined(col.type) && gridColumn && (gridColumn.type === 'date' || gridColumn.type === 'datetime')) {\n          col.type = gObj.getColumnByField(col.field).type;\n        }\n\n        if (col.isForeignKey) {\n          foreignCols.push(col);\n        } else {\n          defaultFltrCols.push(col);\n        }\n      }\n\n      if (defaultFltrCols.length) {\n        if (gObj.filterSettings.type === 'FilterBar' || gObj.filterSettings.type === 'Menu') {\n          for (var i = 0, len = defaultFltrCols.length; i < len; i++) {\n            defaultFltrCols[i].uid = defaultFltrCols[i].uid || this.parent.grabColumnByFieldFromAllCols(defaultFltrCols[i].field).uid;\n          }\n        }\n\n        var excelPredicate = CheckBoxFilterBase.getPredicate(defaultFltrCols);\n\n        for (var _c = 0, _d = Object.keys(excelPredicate); _c < _d.length; _c++) {\n          var prop = _d[_c];\n          predicateList.push(excelPredicate[prop]);\n        }\n      }\n\n      if (foreignCols.length) {\n        for (var _e = 0, foreignCols_1 = foreignCols; _e < foreignCols_1.length; _e++) {\n          var col = foreignCols_1[_e];\n          col.uid = col.uid || this.parent.grabColumnByFieldFromAllCols(col.field).uid;\n          var column_1 = this.parent.grabColumnByUidFromAllCols(col.uid);\n\n          if (!column_1) {\n            this.parent.log('initial_action', {\n              moduleName: 'filter',\n              columnName: col.field\n            });\n          }\n\n          if (column_1.isForeignColumn() && getColumnByForeignKeyValue(col.field, foreignColumn) && !skipFoerign) {\n            actualFilter.push(col);\n            predicateList = this.fGeneratePredicate(column_1, predicateList);\n          } else {\n            var excelPredicate = CheckBoxFilterBase.getPredicate(columns);\n\n            for (var _f = 0, _g = Object.keys(excelPredicate); _f < _g.length; _f++) {\n              var prop = _g[_f];\n              predicateList.push(excelPredicate[prop]);\n            }\n          }\n        }\n      }\n\n      if (predicateList.length) {\n        query.where(Predicate.and(predicateList));\n      } else {\n        this.parent.notify(events.showEmptyGrid, {});\n      }\n    }\n\n    return query;\n  };\n\n  Data.prototype.fGeneratePredicate = function (col, predicateList) {\n    var fPredicate = {};\n\n    if (col) {\n      this.parent.notify(events.generateQuery, {\n        predicate: fPredicate,\n        column: col\n      });\n\n      if (fPredicate.predicate.predicates.length) {\n        predicateList.push(fPredicate.predicate);\n      }\n    }\n\n    return predicateList;\n  };\n  /**\n   * The function is used to get dataManager promise by executing given Query.\n   * @param  {Query} query - Defines the query which will execute along with data processing.\n   * @return {Promise<Object>}\n   * @hidden\n   */\n\n\n  Data.prototype.getData = function (args, query) {\n    var _this = this;\n\n    if (args === void 0) {\n      args = {\n        requestType: ''\n      };\n    }\n\n    var key = this.getKey(args.foreignKeyData && Object.keys(args.foreignKeyData).length ? args.foreignKeyData : this.parent.getPrimaryKeyFieldNames());\n    this.parent.log('datasource_syntax_mismatch', {\n      dataState: this.parent\n    });\n\n    if (this.parent.dataSource && 'result' in this.parent.dataSource) {\n      var def = this.eventPromise(args, query, key);\n      return def.promise;\n    } else {\n      var crud = void 0;\n\n      switch (args.requestType) {\n        case 'delete':\n          query = query ? query : this.generateQuery();\n          var len = Object.keys(args.data).length;\n\n          if (len === 1) {\n            crud = this.dataManager.remove(key, args.data[0], query.fromTable, query);\n          } else {\n            var changes = {\n              addedRecords: [],\n              deletedRecords: [],\n              changedRecords: []\n            };\n            changes.deletedRecords = args.data;\n            crud = this.dataManager.saveChanges(changes, key, query.fromTable, query.requiresCount());\n          }\n\n          break;\n\n        case 'save':\n          if (isBlazor() && this.parent.isServerRendered) {\n            this.parent.notify('offset', args);\n          }\n\n          query = query ? query : this.generateQuery();\n          args.index = isNullOrUndefined(args.index) ? 0 : args.index;\n          crud = this.dataManager.insert(args.data, query.fromTable, query, args.index);\n          break;\n      }\n\n      var promise = 'promise';\n      args[promise] = crud;\n\n      if (crud && !Array.isArray(crud) && !crud.hasOwnProperty('deletedRecords')) {\n        if (isBlazor()) {\n          return crud.then(function (result) {\n            return _this.insert(query, args);\n          }).catch(function (e) {\n            return null;\n          });\n        } else {\n          return crud.then(function (result) {\n            return _this.insert(query, args);\n          });\n        }\n      } else {\n        return this.insert(query, args);\n      }\n    }\n  };\n\n  Data.prototype.insert = function (query, args) {\n    if (args.requestType === 'save') {\n      this.parent.notify(events.recordAdded, args);\n    }\n\n    return this.executeQuery(query);\n  };\n\n  Data.prototype.executeQuery = function (query) {\n    var _this = this;\n\n    if (this.dataManager.ready) {\n      var deferred_1 = new Deferred();\n      var ready = this.dataManager.ready;\n      ready.then(function (e) {\n        _this.dataManager.executeQuery(query).then(function (result) {\n          deferred_1.resolve(result);\n        });\n      }).catch(function (e) {\n        deferred_1.reject(e);\n      });\n      return deferred_1.promise;\n    } else {\n      return this.dataManager.executeQuery(query);\n    }\n  };\n\n  Data.prototype.formatGroupColumn = function (value, field) {\n    var gObj = this.parent;\n    var serviceLocator = this.serviceLocator;\n    var column = this.getColumnByField(field);\n    var date = value;\n\n    if (!column.type) {\n      column.type = date.getDay ? date.getHours() > 0 || date.getMinutes() > 0 || date.getSeconds() > 0 || date.getMilliseconds() > 0 ? 'datetime' : 'date' : typeof value;\n    }\n\n    if (isNullOrUndefined(column.getFormatter())) {\n      setFormatter(serviceLocator, column);\n    }\n\n    var formatVal = ValueFormatter.prototype.toView(value, column.getFormatter());\n    return formatVal;\n  };\n\n  Data.prototype.crudActions = function (args) {\n    var query = this.generateQuery();\n    var promise = null;\n    var pr = 'promise';\n    var key = this.getKey(args.foreignKeyData && Object.keys(args.foreignKeyData).length ? args.foreignKeyData : this.parent.getPrimaryKeyFieldNames());\n\n    if (this.parent.dataSource && 'result' in this.parent.dataSource) {\n      this.eventPromise(args, query, key);\n    }\n\n    switch (args.requestType) {\n      case 'save':\n        if (isBlazor() && this.parent.isServerRendered) {\n          this.parent.notify('offset', args);\n        }\n\n        promise = this.dataManager.update(key, args.data, query.fromTable, query, args.previousData);\n        break;\n    }\n\n    args[pr] = promise ? promise : args[pr];\n    this.parent.notify(events.crudAction, args);\n  };\n  /** @hidden */\n\n\n  Data.prototype.saveChanges = function (changes, key, original, query) {\n    if (query === void 0) {\n      query = this.generateQuery();\n    }\n\n    query.requiresCount();\n\n    if ('result' in this.parent.dataSource) {\n      var state = void 0;\n      state = this.getStateEventArgument(query);\n      var deff = new Deferred();\n      var args = {\n        requestType: 'batchsave',\n        changes: changes,\n        key: key,\n        query: query,\n        endEdit: deff.resolve\n      };\n      this.setState({\n        isPending: true,\n        resolver: deff.resolve\n      });\n      this.parent.trigger(events.dataSourceChanged, args);\n      return deff.promise;\n    } else {\n      var changedRecords = 'changedRecords';\n      var addedRecords = 'addedRecords';\n      var data = 'data';\n\n      if (isBlazor() && this.parent.isServerRendered) {\n        for (var i = 0; i < changes[changedRecords].length; i++) {\n          var args = {\n            data: changes[changedRecords][i]\n          };\n          this.parent.notify('offset', args);\n          changes[changedRecords][i] = args[data];\n        }\n\n        for (var i = 0; i < changes[addedRecords].length; i++) {\n          var args = {\n            data: changes[addedRecords][i]\n          };\n          this.parent.notify('offset', args);\n          changes[addedRecords][i] = args[data];\n        }\n      }\n\n      var promise = this.dataManager.saveChanges(changes, key, query.fromTable, query, original);\n      return promise;\n    }\n  };\n\n  Data.prototype.getKey = function (keys) {\n    if (keys && keys.length) {\n      return keys[0];\n    }\n\n    return undefined;\n  };\n  /** @hidden */\n\n\n  Data.prototype.isRemote = function () {\n    return this.dataManager.dataSource.offline !== true && this.dataManager.dataSource.url !== undefined && this.dataManager.dataSource.url !== '';\n  };\n\n  Data.prototype.addRows = function (e) {\n    for (var i = e.records.length; i > 0; i--) {\n      this.dataManager.dataSource.json.splice(e.toIndex, 0, e.records[i - 1]);\n    }\n  };\n\n  Data.prototype.removeRows = function (e) {\n    var json = this.dataManager.dataSource.json;\n    this.dataManager.dataSource.json = json.filter(function (value, index) {\n      return e.records.indexOf(value) === -1;\n    });\n  };\n\n  Data.prototype.getColumnByField = function (field) {\n    var col;\n    return this.parent.columnModel.some(function (column) {\n      col = column;\n      return column.field === field;\n    }) && col;\n  };\n\n  Data.prototype.destroy = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.rowsAdded, this.addRows);\n    this.parent.off(events.rowsRemoved, this.removeRows);\n    this.parent.off(events.dataSourceModified, this.initDataManager);\n    this.parent.off(events.destroy, this.destroy);\n    this.parent.off(events.updateData, this.crudActions);\n    this.parent.off(events.addDeleteAction, this.getData);\n    this.parent.off(events.autoCol, this.refreshFilteredCols);\n    this.parent.off(events.columnsPrepared, this.refreshFilteredCols);\n  };\n\n  Data.prototype.getState = function () {\n    return this.dataState;\n  };\n\n  Data.prototype.setState = function (state) {\n    return this.dataState = state;\n  };\n\n  Data.prototype.getForeignKeyDataState = function () {\n    return this.foreignKeyDataState;\n  };\n\n  Data.prototype.setForeignKeyDataState = function (state) {\n    this.foreignKeyDataState = state;\n  };\n\n  Data.prototype.getStateEventArgument = function (query) {\n    var adaptr = new UrlAdaptor();\n    var dm = new DataManager({\n      url: '',\n      adaptor: new UrlAdaptor()\n    });\n    var state = adaptr.processQuery(dm, query);\n    var data = JSON.parse(state.data);\n    return extend(data, state.pvtData);\n  };\n\n  Data.prototype.eventPromise = function (args, query, key) {\n    var _this = this;\n\n    var state;\n    var dataArgs = args;\n    state = this.getStateEventArgument(query);\n    var def = new Deferred();\n    var deff = new Deferred();\n\n    if (args.requestType !== undefined && this.dataState.isDataChanged !== false) {\n      state.action = args;\n\n      if (args.requestType === 'save' || args.requestType === 'delete') {\n        var editArgs_1 = args;\n        editArgs_1.key = key;\n        var promise = 'promise';\n        editArgs_1[promise] = deff.promise;\n        editArgs_1.state = state;\n        this.setState({\n          isPending: true,\n          resolver: deff.resolve\n        });\n        dataArgs.endEdit = deff.resolve;\n        dataArgs.cancelEdit = deff.reject;\n        this.parent.trigger(events.dataSourceChanged, editArgs_1);\n        deff.promise.then(function (e) {\n          _this.setState({\n            isPending: true,\n            resolver: def.resolve,\n            group: state.group,\n            aggregates: state.aggregates\n          });\n\n          if (editArgs_1.requestType === 'save') {\n            _this.parent.notify(events.recordAdded, editArgs_1);\n          }\n\n          _this.parent.trigger(events.dataStateChange, state);\n        }).catch(function () {\n          return void 0;\n        });\n      } else {\n        this.setState({\n          isPending: true,\n          resolver: def.resolve,\n          group: state.group,\n          aggregates: state.aggregates\n        });\n        this.parent.trigger(events.dataStateChange, state);\n      }\n    } else {\n      this.setState({});\n      def.resolve(this.parent.dataSource);\n    }\n\n    return def;\n  };\n  /**\n   * Gets the columns where searching needs to be performed from the Grid.\n   * @return {string[]}\n   */\n\n\n  Data.prototype.getSearchColumnFieldNames = function () {\n    var colFieldNames = [];\n    var columns = this.parent.getColumns();\n\n    for (var _i = 0, columns_2 = columns; _i < columns_2.length; _i++) {\n      var col = columns_2[_i];\n\n      if (col.allowSearching && !isNullOrUndefined(col.field)) {\n        colFieldNames.push(col.field);\n      }\n    }\n\n    return colFieldNames;\n  };\n\n  Data.prototype.refreshFilteredCols = function () {\n    if (this.parent.allowFiltering && this.parent.filterSettings.columns.length) {\n      refreshFilteredColsUid(this.parent, this.parent.filterSettings.columns);\n    }\n  };\n\n  return Data;\n}();\n\nexport { Data };","map":{"version":3,"sources":["/home/nikhil/Desktop/data_grid_editor-master/node_modules/@syncfusion/ej2-grids/src/grid/actions/data.js"],"names":["isNullOrUndefined","extend","isBlazor","Query","DataManager","Predicate","Deferred","UrlAdaptor","setFormatter","isGroupAdaptive","getColumnByForeignKeyValue","refreshFilteredColsUid","events","ValueFormatter","CheckBoxFilterBase","Data","parent","serviceLocator","dataState","isPending","resolver","group","foreignKeyDataState","initDataManager","isDestroyed","getModuleName","on","rowsAdded","addRows","rowPositionChanged","reorderRows","rowsRemoved","removeRows","dataSourceModified","destroy","updateData","crudActions","addDeleteAction","getData","autoCol","refreshFilteredCols","columnsPrepared","prototype","e","dataManager","dataSource","json","splice","toIndex","fromIndex","gObj","isQueryInvokedFromData","query","generateQuery","skipPage","getQuery","clone","columnQueryMode","select","getColumns","filter","column","isPrimaryKey","visible","field","undefined","map","selectQueryFields","columns","i","length","push","filterQuery","searchQuery","aggregateQuery","sortQuery","virtualGroupPageQuery","pageQuery","groupQuery","isForeign","rows","aggregates","row","j","cols","types","type","Array","k","aggregate","toLowerCase","fName","queries","allowPaging","enableVirtualization","enableInfiniteScrolling","pageSettings","currentPage","Math","max","pageCount","pageSize","infiniteScrollModule","notify","infinitePageQuery","page","allowGrouping","groupSettings","len","getColumnByField","log","moduleName","columnName","isGrpFmt","enableGroupByFormat","format","formatGroupColumn","bind","allowSorting","sortSettings","sortGrp","col","setSortDirection","direction","fn","sortComparer","isRemote","indexOf","sortBy","fcolumn","isForeignKey","sSettings","searchSettings","fields","getSearchColumnFieldNames","predicateList","needForeignKeySearch","key","getForeignKeyColumns","some","adaptor","foreignKeyValue","isForeignColumn","fGeneratePredicate","operator","ignoreCase","ignoreAccent","predList","or","where","search","skipFoerign","actualFilter","foreignColumn","allowFiltering","filterSettings","colType","_i","_a","foreignCols","defaultFltrCols","_b","columns_1","gridColumn","uid","grabColumnByFieldFromAllCols","excelPredicate","getPredicate","_c","_d","Object","keys","prop","_e","foreignCols_1","column_1","grabColumnByUidFromAllCols","_f","_g","and","showEmptyGrid","fPredicate","predicate","predicates","args","_this","requestType","getKey","foreignKeyData","getPrimaryKeyFieldNames","def","eventPromise","promise","crud","data","remove","fromTable","changes","addedRecords","deletedRecords","changedRecords","saveChanges","requiresCount","isServerRendered","index","insert","isArray","hasOwnProperty","then","result","catch","recordAdded","executeQuery","ready","deferred_1","resolve","reject","value","date","getDay","getHours","getMinutes","getSeconds","getMilliseconds","getFormatter","formatVal","toView","pr","update","previousData","crudAction","original","state","getStateEventArgument","deff","endEdit","setState","trigger","dataSourceChanged","offline","url","records","columnModel","off","getState","getForeignKeyDataState","setForeignKeyDataState","adaptr","dm","processQuery","JSON","parse","pvtData","dataArgs","isDataChanged","action","editArgs_1","cancelEdit","dataStateChange","colFieldNames","columns_2","allowSearching"],"mappings":"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","sourcesContent":["import { isNullOrUndefined, extend, isBlazor } from '@syncfusion/ej2-base';\nimport { Query, DataManager, Predicate, Deferred, UrlAdaptor } from '@syncfusion/ej2-data';\nimport { setFormatter, isGroupAdaptive, getColumnByForeignKeyValue, refreshFilteredColsUid } from '../base/util';\nimport * as events from '../base/constant';\nimport { ValueFormatter } from '../services/value-formatter';\nimport { CheckBoxFilterBase } from '../common/checkbox-filter-base';\n/**\n * Grid data module is used to generate query and data source.\n * @hidden\n */\nvar Data = /** @class */ (function () {\n    /**\n     * Constructor for data module.\n     * @hidden\n     */\n    function Data(parent, serviceLocator) {\n        this.dataState = { isPending: false, resolver: null, group: [] };\n        this.foreignKeyDataState = { isPending: false, resolver: null };\n        this.parent = parent;\n        this.serviceLocator = serviceLocator;\n        this.initDataManager();\n        if (this.parent.isDestroyed || this.getModuleName() === 'foreignKey') {\n            return;\n        }\n        this.parent.on(events.rowsAdded, this.addRows, this);\n        this.parent.on(events.rowPositionChanged, this.reorderRows, this);\n        this.parent.on(events.rowsRemoved, this.removeRows, this);\n        this.parent.on(events.dataSourceModified, this.initDataManager, this);\n        this.parent.on(events.destroy, this.destroy, this);\n        this.parent.on(events.updateData, this.crudActions, this);\n        this.parent.on(events.addDeleteAction, this.getData, this);\n        this.parent.on(events.autoCol, this.refreshFilteredCols, this);\n        this.parent.on(events.columnsPrepared, this.refreshFilteredCols, this);\n    }\n    Data.prototype.reorderRows = function (e) {\n        this.dataManager.dataSource.json.splice(e.toIndex, 0, this.dataManager.dataSource.json.splice(e.fromIndex, 1)[0]);\n    };\n    Data.prototype.getModuleName = function () {\n        return 'data';\n    };\n    /**\n     * The function used to initialize dataManager and external query\n     * @return {void}\n     */\n    Data.prototype.initDataManager = function () {\n        var gObj = this.parent;\n        this.dataManager = gObj.dataSource instanceof DataManager ? gObj.dataSource :\n            (isNullOrUndefined(gObj.dataSource) ? new DataManager() : new DataManager(gObj.dataSource));\n        this.isQueryInvokedFromData = true;\n        gObj.query = gObj.query instanceof Query ? gObj.query : new Query();\n    };\n    /**\n     * The function is used to generate updated Query from Grid model.\n     * @return {Query}\n     * @hidden\n     */\n    Data.prototype.generateQuery = function (skipPage) {\n        var gObj = this.parent;\n        var query = gObj.getQuery().clone();\n        if (this.parent.columnQueryMode === 'ExcludeHidden') {\n            query.select(this.parent.getColumns().filter(function (column) { return !(column.isPrimaryKey !== true && column.visible === false || column.field === undefined); }).map(function (column) { return column.field; }));\n        }\n        else if (this.parent.columnQueryMode === 'Schema') {\n            var selectQueryFields = [];\n            var columns = this.parent.columns;\n            for (var i = 0; i < columns.length; i++) {\n                selectQueryFields.push(columns[i].field);\n            }\n            query.select(selectQueryFields);\n        }\n        this.filterQuery(query);\n        this.searchQuery(query);\n        this.aggregateQuery(query);\n        this.sortQuery(query);\n        if (isGroupAdaptive(this.parent)) {\n            this.virtualGroupPageQuery(query);\n        }\n        else {\n            this.pageQuery(query, skipPage);\n        }\n        this.groupQuery(query);\n        return query;\n    };\n    /** @hidden */\n    Data.prototype.aggregateQuery = function (query, isForeign) {\n        var rows = this.parent.aggregates;\n        for (var i = 0; i < rows.length; i++) {\n            var row = rows[i];\n            for (var j = 0; j < row.columns.length; j++) {\n                var cols = row.columns[j];\n                var types = cols.type instanceof Array ? cols.type : [cols.type];\n                for (var k = 0; k < types.length; k++) {\n                    query.aggregate(types[k].toLowerCase(), cols.field);\n                }\n            }\n        }\n        return query;\n    };\n    Data.prototype.virtualGroupPageQuery = function (query) {\n        var gObj = this.parent;\n        var fName = 'fn';\n        if (query.queries.length) {\n            for (var i = 0; i < query.queries.length; i++) {\n                if (query.queries[i][fName] === 'onPage') {\n                    query.queries.splice(i, 1);\n                }\n            }\n        }\n        return query;\n    };\n    Data.prototype.pageQuery = function (query, skipPage) {\n        var gObj = this.parent;\n        var fName = 'fn';\n        if ((gObj.allowPaging || gObj.enableVirtualization || gObj.enableInfiniteScrolling) && skipPage !== true) {\n            gObj.pageSettings.currentPage = Math.max(1, gObj.pageSettings.currentPage);\n            if (gObj.pageSettings.pageCount <= 0) {\n                gObj.pageSettings.pageCount = 8;\n            }\n            if (gObj.pageSettings.pageSize <= 0) {\n                gObj.pageSettings.pageSize = 12;\n            }\n            if (query.queries.length) {\n                for (var i = 0; i < query.queries.length; i++) {\n                    if (query.queries[i][fName] === 'onPage') {\n                        query.queries.splice(i, 1);\n                    }\n                }\n            }\n            if (!isNullOrUndefined(gObj.infiniteScrollModule) && gObj.enableInfiniteScrolling) {\n                this.parent.notify(events.infinitePageQuery, query);\n            }\n            else {\n                query.page(gObj.pageSettings.currentPage, gObj.pageSettings.pageSize);\n            }\n        }\n        return query;\n    };\n    Data.prototype.groupQuery = function (query) {\n        var gObj = this.parent;\n        if (gObj.allowGrouping && gObj.groupSettings.columns.length) {\n            var columns = gObj.groupSettings.columns;\n            for (var i = 0, len = columns.length; i < len; i++) {\n                var column = this.getColumnByField(columns[i]);\n                if (!column) {\n                    this.parent.log('initial_action', { moduleName: 'group', columnName: columns[i] });\n                }\n                var isGrpFmt = column.enableGroupByFormat;\n                var format = column.format;\n                if (isGrpFmt) {\n                    query.group(columns[i], this.formatGroupColumn.bind(this), format);\n                }\n                else {\n                    query.group(columns[i], null);\n                }\n            }\n        }\n        return query;\n    };\n    Data.prototype.sortQuery = function (query) {\n        var gObj = this.parent;\n        if ((gObj.allowSorting || gObj.allowGrouping) && gObj.sortSettings.columns.length) {\n            var columns = gObj.sortSettings.columns;\n            var sortGrp = [];\n            for (var i = columns.length - 1; i > -1; i--) {\n                var col = this.getColumnByField(columns[i].field);\n                if (col) {\n                    col.setSortDirection(columns[i].direction);\n                }\n                else {\n                    this.parent.log('initial_action', { moduleName: 'sort', columnName: columns[i].field });\n                    return query;\n                }\n                var fn = columns[i].direction;\n                if (col.sortComparer) {\n                    this.parent.log('grid_sort_comparer');\n                    fn = !this.isRemote() ? col.sortComparer.bind(col) : columns[i].direction;\n                }\n                if (gObj.groupSettings.columns.indexOf(columns[i].field) === -1) {\n                    query.sortBy(col.field, fn);\n                }\n                else {\n                    sortGrp.push({ direction: fn, field: col.field });\n                }\n            }\n            for (var i = 0, len = sortGrp.length; i < len; i++) {\n                query.sortBy(sortGrp[i].field, sortGrp[i].direction);\n            }\n        }\n        return query;\n    };\n    Data.prototype.searchQuery = function (query, fcolumn, isForeignKey) {\n        var sSettings = this.parent.searchSettings;\n        var fields = sSettings.fields.length ? sSettings.fields : this.getSearchColumnFieldNames();\n        var predicateList = [];\n        var needForeignKeySearch = false;\n        if (this.parent.searchSettings.key.length) {\n            needForeignKeySearch = this.parent.getForeignKeyColumns().some(function (col) { return fields.indexOf(col.field) > -1; });\n            var adaptor = !isForeignKey ? this.dataManager.adaptor : fcolumn.dataSource.adaptor;\n            if (needForeignKeySearch || (adaptor.getModuleName &&\n                adaptor.getModuleName() === 'ODataV4Adaptor')) {\n                fields = isForeignKey ? [fcolumn.foreignKeyValue] : fields;\n                for (var i = 0; i < fields.length; i++) {\n                    var column = isForeignKey ? fcolumn : this.getColumnByField(fields[i]);\n                    if (column.isForeignColumn() && !isForeignKey) {\n                        predicateList = this.fGeneratePredicate(column, predicateList);\n                    }\n                    else {\n                        predicateList.push(new Predicate(fields[i], sSettings.operator, sSettings.key, sSettings.ignoreCase, sSettings.ignoreAccent));\n                    }\n                }\n                var predList = Predicate.or(predicateList);\n                predList.key = sSettings.key;\n                query.where(predList);\n            }\n            else {\n                query.search(sSettings.key, fields, sSettings.operator, sSettings.ignoreCase, sSettings.ignoreAccent);\n            }\n        }\n        return query;\n    };\n    Data.prototype.filterQuery = function (query, column, skipFoerign) {\n        var gObj = this.parent;\n        var predicateList = [];\n        var actualFilter = [];\n        var foreignColumn = this.parent.getForeignKeyColumns();\n        if (gObj.allowFiltering && gObj.filterSettings.columns.length) {\n            var columns = column ? column : gObj.filterSettings.columns;\n            var colType = {};\n            for (var _i = 0, _a = gObj.getColumns(); _i < _a.length; _i++) {\n                var col = _a[_i];\n                colType[col.field] = col.filter.type ? col.filter.type : gObj.filterSettings.type;\n            }\n            var foreignCols = [];\n            var defaultFltrCols = [];\n            for (var _b = 0, columns_1 = columns; _b < columns_1.length; _b++) {\n                var col = columns_1[_b];\n                var gridColumn = gObj.getColumnByField(col.field);\n                if (isNullOrUndefined(col.type) && gridColumn && (gridColumn.type === 'date' || gridColumn.type === 'datetime')) {\n                    col.type = gObj.getColumnByField(col.field).type;\n                }\n                if (col.isForeignKey) {\n                    foreignCols.push(col);\n                }\n                else {\n                    defaultFltrCols.push(col);\n                }\n            }\n            if (defaultFltrCols.length) {\n                if (gObj.filterSettings.type === 'FilterBar' || gObj.filterSettings.type === 'Menu') {\n                    for (var i = 0, len = defaultFltrCols.length; i < len; i++) {\n                        defaultFltrCols[i].uid = defaultFltrCols[i].uid ||\n                            this.parent.grabColumnByFieldFromAllCols(defaultFltrCols[i].field).uid;\n                    }\n                }\n                var excelPredicate = CheckBoxFilterBase.getPredicate(defaultFltrCols);\n                for (var _c = 0, _d = Object.keys(excelPredicate); _c < _d.length; _c++) {\n                    var prop = _d[_c];\n                    predicateList.push(excelPredicate[prop]);\n                }\n            }\n            if (foreignCols.length) {\n                for (var _e = 0, foreignCols_1 = foreignCols; _e < foreignCols_1.length; _e++) {\n                    var col = foreignCols_1[_e];\n                    col.uid = col.uid || this.parent.grabColumnByFieldFromAllCols(col.field).uid;\n                    var column_1 = this.parent.grabColumnByUidFromAllCols(col.uid);\n                    if (!column_1) {\n                        this.parent.log('initial_action', { moduleName: 'filter', columnName: col.field });\n                    }\n                    if (column_1.isForeignColumn() && getColumnByForeignKeyValue(col.field, foreignColumn) && !skipFoerign) {\n                        actualFilter.push(col);\n                        predicateList = this.fGeneratePredicate(column_1, predicateList);\n                    }\n                    else {\n                        var excelPredicate = CheckBoxFilterBase.getPredicate(columns);\n                        for (var _f = 0, _g = Object.keys(excelPredicate); _f < _g.length; _f++) {\n                            var prop = _g[_f];\n                            predicateList.push(excelPredicate[prop]);\n                        }\n                    }\n                }\n            }\n            if (predicateList.length) {\n                query.where(Predicate.and(predicateList));\n            }\n            else {\n                this.parent.notify(events.showEmptyGrid, {});\n            }\n        }\n        return query;\n    };\n    Data.prototype.fGeneratePredicate = function (col, predicateList) {\n        var fPredicate = {};\n        if (col) {\n            this.parent.notify(events.generateQuery, { predicate: fPredicate, column: col });\n            if (fPredicate.predicate.predicates.length) {\n                predicateList.push(fPredicate.predicate);\n            }\n        }\n        return predicateList;\n    };\n    /**\n     * The function is used to get dataManager promise by executing given Query.\n     * @param  {Query} query - Defines the query which will execute along with data processing.\n     * @return {Promise<Object>}\n     * @hidden\n     */\n    Data.prototype.getData = function (args, query) {\n        var _this = this;\n        if (args === void 0) { args = { requestType: '' }; }\n        var key = this.getKey(args.foreignKeyData &&\n            Object.keys(args.foreignKeyData).length ?\n            args.foreignKeyData : this.parent.getPrimaryKeyFieldNames());\n        this.parent.log('datasource_syntax_mismatch', { dataState: this.parent });\n        if (this.parent.dataSource && 'result' in this.parent.dataSource) {\n            var def = this.eventPromise(args, query, key);\n            return def.promise;\n        }\n        else {\n            var crud = void 0;\n            switch (args.requestType) {\n                case 'delete':\n                    query = query ? query : this.generateQuery();\n                    var len = Object.keys(args.data).length;\n                    if (len === 1) {\n                        crud = this.dataManager.remove(key, args.data[0], query.fromTable, query);\n                    }\n                    else {\n                        var changes = {\n                            addedRecords: [],\n                            deletedRecords: [],\n                            changedRecords: []\n                        };\n                        changes.deletedRecords = args.data;\n                        crud = this.dataManager.saveChanges(changes, key, query.fromTable, query.requiresCount());\n                    }\n                    break;\n                case 'save':\n                    if (isBlazor() && this.parent.isServerRendered) {\n                        this.parent.notify('offset', args);\n                    }\n                    query = query ? query : this.generateQuery();\n                    args.index = isNullOrUndefined(args.index) ? 0 : args.index;\n                    crud = this.dataManager.insert(args.data, query.fromTable, query, args.index);\n                    break;\n            }\n            var promise = 'promise';\n            args[promise] = crud;\n            if (crud && !Array.isArray(crud) && !crud.hasOwnProperty('deletedRecords')) {\n                if (isBlazor()) {\n                    return crud.then(function (result) {\n                        return _this.insert(query, args);\n                    }).catch(function (e) {\n                        return null;\n                    });\n                }\n                else {\n                    return crud.then(function (result) {\n                        return _this.insert(query, args);\n                    });\n                }\n            }\n            else {\n                return this.insert(query, args);\n            }\n        }\n    };\n    Data.prototype.insert = function (query, args) {\n        if (args.requestType === 'save') {\n            this.parent.notify(events.recordAdded, args);\n        }\n        return this.executeQuery(query);\n    };\n    Data.prototype.executeQuery = function (query) {\n        var _this = this;\n        if (this.dataManager.ready) {\n            var deferred_1 = new Deferred();\n            var ready = this.dataManager.ready;\n            ready.then(function (e) {\n                _this.dataManager.executeQuery(query).then(function (result) {\n                    deferred_1.resolve(result);\n                });\n            }).catch(function (e) {\n                deferred_1.reject(e);\n            });\n            return deferred_1.promise;\n        }\n        else {\n            return this.dataManager.executeQuery(query);\n        }\n    };\n    Data.prototype.formatGroupColumn = function (value, field) {\n        var gObj = this.parent;\n        var serviceLocator = this.serviceLocator;\n        var column = this.getColumnByField(field);\n        var date = value;\n        if (!column.type) {\n            column.type = date.getDay ? (date.getHours() > 0 || date.getMinutes() > 0 ||\n                date.getSeconds() > 0 || date.getMilliseconds() > 0 ? 'datetime' : 'date') : typeof (value);\n        }\n        if (isNullOrUndefined(column.getFormatter())) {\n            setFormatter(serviceLocator, column);\n        }\n        var formatVal = ValueFormatter.prototype.toView(value, column.getFormatter());\n        return formatVal;\n    };\n    Data.prototype.crudActions = function (args) {\n        var query = this.generateQuery();\n        var promise = null;\n        var pr = 'promise';\n        var key = this.getKey(args.foreignKeyData &&\n            Object.keys(args.foreignKeyData).length ? args.foreignKeyData :\n            this.parent.getPrimaryKeyFieldNames());\n        if (this.parent.dataSource && 'result' in this.parent.dataSource) {\n            this.eventPromise(args, query, key);\n        }\n        switch (args.requestType) {\n            case 'save':\n                if (isBlazor() && this.parent.isServerRendered) {\n                    this.parent.notify('offset', args);\n                }\n                promise = this.dataManager.update(key, args.data, query.fromTable, query, args.previousData);\n                break;\n        }\n        args[pr] = promise ? promise : args[pr];\n        this.parent.notify(events.crudAction, args);\n    };\n    /** @hidden */\n    Data.prototype.saveChanges = function (changes, key, original, query) {\n        if (query === void 0) { query = this.generateQuery(); }\n        query.requiresCount();\n        if ('result' in this.parent.dataSource) {\n            var state = void 0;\n            state = this.getStateEventArgument(query);\n            var deff = new Deferred();\n            var args = {\n                requestType: 'batchsave', changes: changes, key: key, query: query,\n                endEdit: deff.resolve\n            };\n            this.setState({ isPending: true, resolver: deff.resolve });\n            this.parent.trigger(events.dataSourceChanged, args);\n            return deff.promise;\n        }\n        else {\n            var changedRecords = 'changedRecords';\n            var addedRecords = 'addedRecords';\n            var data = 'data';\n            if (isBlazor() && this.parent.isServerRendered) {\n                for (var i = 0; i < changes[changedRecords].length; i++) {\n                    var args = { data: changes[changedRecords][i] };\n                    this.parent.notify('offset', args);\n                    changes[changedRecords][i] = args[data];\n                }\n                for (var i = 0; i < changes[addedRecords].length; i++) {\n                    var args = { data: changes[addedRecords][i] };\n                    this.parent.notify('offset', args);\n                    changes[addedRecords][i] = args[data];\n                }\n            }\n            var promise = this.dataManager.saveChanges(changes, key, query.fromTable, query, original);\n            return promise;\n        }\n    };\n    Data.prototype.getKey = function (keys) {\n        if (keys && keys.length) {\n            return keys[0];\n        }\n        return undefined;\n    };\n    /** @hidden */\n    Data.prototype.isRemote = function () {\n        return this.dataManager.dataSource.offline !== true && this.dataManager.dataSource.url !== undefined &&\n            this.dataManager.dataSource.url !== '';\n    };\n    Data.prototype.addRows = function (e) {\n        for (var i = e.records.length; i > 0; i--) {\n            this.dataManager.dataSource.json.splice(e.toIndex, 0, e.records[i - 1]);\n        }\n    };\n    Data.prototype.removeRows = function (e) {\n        var json = this.dataManager.dataSource.json;\n        this.dataManager.dataSource.json = json.filter(function (value, index) { return e.records.indexOf(value) === -1; });\n    };\n    Data.prototype.getColumnByField = function (field) {\n        var col;\n        return (this.parent.columnModel).some(function (column) {\n            col = column;\n            return column.field === field;\n        }) && col;\n    };\n    Data.prototype.destroy = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.rowsAdded, this.addRows);\n        this.parent.off(events.rowsRemoved, this.removeRows);\n        this.parent.off(events.dataSourceModified, this.initDataManager);\n        this.parent.off(events.destroy, this.destroy);\n        this.parent.off(events.updateData, this.crudActions);\n        this.parent.off(events.addDeleteAction, this.getData);\n        this.parent.off(events.autoCol, this.refreshFilteredCols);\n        this.parent.off(events.columnsPrepared, this.refreshFilteredCols);\n    };\n    Data.prototype.getState = function () {\n        return this.dataState;\n    };\n    Data.prototype.setState = function (state) {\n        return this.dataState = state;\n    };\n    Data.prototype.getForeignKeyDataState = function () {\n        return this.foreignKeyDataState;\n    };\n    Data.prototype.setForeignKeyDataState = function (state) {\n        this.foreignKeyDataState = state;\n    };\n    Data.prototype.getStateEventArgument = function (query) {\n        var adaptr = new UrlAdaptor();\n        var dm = new DataManager({ url: '', adaptor: new UrlAdaptor });\n        var state = adaptr.processQuery(dm, query);\n        var data = JSON.parse(state.data);\n        return extend(data, state.pvtData);\n    };\n    Data.prototype.eventPromise = function (args, query, key) {\n        var _this = this;\n        var state;\n        var dataArgs = args;\n        state = this.getStateEventArgument(query);\n        var def = new Deferred();\n        var deff = new Deferred();\n        if (args.requestType !== undefined && this.dataState.isDataChanged !== false) {\n            state.action = args;\n            if (args.requestType === 'save' || args.requestType === 'delete') {\n                var editArgs_1 = args;\n                editArgs_1.key = key;\n                var promise = 'promise';\n                editArgs_1[promise] = deff.promise;\n                editArgs_1.state = state;\n                this.setState({ isPending: true, resolver: deff.resolve });\n                dataArgs.endEdit = deff.resolve;\n                dataArgs.cancelEdit = deff.reject;\n                this.parent.trigger(events.dataSourceChanged, editArgs_1);\n                deff.promise.then(function (e) {\n                    _this.setState({ isPending: true, resolver: def.resolve, group: state.group, aggregates: state.aggregates });\n                    if (editArgs_1.requestType === 'save') {\n                        _this.parent.notify(events.recordAdded, editArgs_1);\n                    }\n                    _this.parent.trigger(events.dataStateChange, state);\n                })\n                    .catch(function () { return void 0; });\n            }\n            else {\n                this.setState({ isPending: true, resolver: def.resolve, group: state.group, aggregates: state.aggregates });\n                this.parent.trigger(events.dataStateChange, state);\n            }\n        }\n        else {\n            this.setState({});\n            def.resolve(this.parent.dataSource);\n        }\n        return def;\n    };\n    /**\n     * Gets the columns where searching needs to be performed from the Grid.\n     * @return {string[]}\n     */\n    Data.prototype.getSearchColumnFieldNames = function () {\n        var colFieldNames = [];\n        var columns = this.parent.getColumns();\n        for (var _i = 0, columns_2 = columns; _i < columns_2.length; _i++) {\n            var col = columns_2[_i];\n            if (col.allowSearching && !isNullOrUndefined(col.field)) {\n                colFieldNames.push(col.field);\n            }\n        }\n        return colFieldNames;\n    };\n    Data.prototype.refreshFilteredCols = function () {\n        if (this.parent.allowFiltering && this.parent.filterSettings.columns.length) {\n            refreshFilteredColsUid(this.parent, this.parent.filterSettings.columns);\n        }\n    };\n    return Data;\n}());\nexport { Data };\n"]},"metadata":{},"sourceType":"module"}