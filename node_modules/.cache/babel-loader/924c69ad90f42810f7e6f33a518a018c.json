{"ast":null,"code":"import { Draggable, isBlazor, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { removeClass } from '@syncfusion/ej2-base';\nimport { remove, closest as closestElement, classList } from '@syncfusion/ej2-base';\nimport { parentsUntil, removeElement, getPosition, addRemoveActiveClasses, isActionPrevent } from '../base/util';\nimport * as events from '../base/constant';\nimport { Scroll } from '../actions/scroll';\nimport { Query } from '@syncfusion/ej2-data';\n/**\n *\n * Reorder module is used to handle row reordering.\n * @hidden\n */\n\nvar RowDD =\n/** @class */\nfunction () {\n  /**\n   * Constructor for the Grid print module\n   * @hidden\n   */\n  function RowDD(parent) {\n    var _this = this;\n\n    this.selectedRows = [];\n    this.isOverflowBorder = true;\n    this.selectedRowColls = [];\n    this.isRefresh = true;\n    /* tslint:disable-next-line:max-line-length */\n    // tslint:disable-next-line:max-func-body-length\n\n    this.helper = function (e) {\n      var gObj = _this.parent;\n      var target = _this.draggable.currentStateTarget;\n\n      var visualElement = _this.parent.createElement('div', {\n        className: 'e-cloneproperties e-draganddrop e-grid e-dragclone',\n        styles: 'height:\"auto\", z-index:2, width:' + gObj.element.offsetWidth\n      });\n\n      var table = _this.parent.createElement('table', {\n        styles: 'width:' + gObj.element.offsetWidth\n      });\n\n      var tbody = _this.parent.createElement('tbody');\n\n      if (document.getElementsByClassName('e-griddragarea').length || gObj.rowDropSettings.targetID && !e.sender.target.classList.contains('e-selectionbackground') && gObj.selectionSettings.type !== 'Single' || !gObj.rowDropSettings.targetID && !parentsUntil(e.sender.target, 'e-rowdragdrop')) {\n        return false;\n      }\n\n      if (gObj.rowDropSettings.targetID && gObj.selectionSettings.mode === 'Row' && gObj.selectionSettings.type === 'Single') {\n        gObj.selectRow(parseInt(_this.draggable.currentStateTarget.parentElement.getAttribute('aria-rowindex'), 10));\n      }\n\n      _this.startedRow = closestElement(target, 'tr').cloneNode(true);\n\n      _this.processArgs(target);\n\n      var args = {\n        selectedRow: _this.rows,\n        dragelement: target,\n        cloneElement: visualElement,\n        cancel: false,\n        data: _this.rowData\n      };\n      var selectedRows = gObj.getSelectedRows();\n      gObj.trigger(events.rowDragStartHelper, args);\n      var cancel = 'cancel';\n      var cloneElement = 'cloneElement';\n\n      if (args[cancel]) {\n        return false;\n      }\n\n      removeElement(_this.startedRow, '.e-indentcell');\n      removeElement(_this.startedRow, '.e-detailrowcollapse');\n      removeElement(_this.startedRow, '.e-detailrowexpand');\n\n      _this.removeCell(_this.startedRow, 'e-gridchkbox');\n\n      var exp = new RegExp('e-active', 'g'); //high contrast issue\n\n      _this.startedRow.innerHTML = _this.startedRow.innerHTML.replace(exp, '');\n      tbody.appendChild(_this.startedRow);\n\n      if (gObj.getSelectedRows().length > 1 && _this.startedRow.hasAttribute('aria-selected')) {\n        var dropCountEle = _this.parent.createElement('span', {\n          className: 'e-dropitemscount',\n          innerHTML: '' + selectedRows.length\n        });\n\n        visualElement.appendChild(dropCountEle);\n      }\n\n      var ele = closestElement(target, 'tr').querySelector('.e-icon-rowdragicon');\n\n      if (ele) {\n        ele.classList.add('e-dragstartrow');\n      }\n\n      table.appendChild(tbody);\n      visualElement.appendChild(table);\n      gObj.element.appendChild(visualElement);\n      return visualElement;\n    };\n\n    this.dragStart = function (e) {\n      var gObj = _this.parent;\n\n      if (document.getElementsByClassName('e-griddragarea').length) {\n        return;\n      }\n\n      var target = e.target;\n\n      var spanCssEle = _this.parent.element.querySelector('.e-dropitemscount');\n\n      if (_this.parent.getSelectedRecords().length > 1 && spanCssEle) {\n        spanCssEle.style.left = _this.parent.element.querySelector('.e-cloneproperties table').offsetWidth - 5 + 'px';\n      }\n\n      _this.processArgs(target);\n\n      gObj.trigger(events.rowDragStart, {\n        rows: isBlazor() ? null : _this.rows,\n        target: isBlazor() ? null : e.target,\n        draggableType: 'rows',\n        fromIndex: parseInt(_this.rows[0].getAttribute('aria-rowindex'), 10),\n        data: Object.keys(_this.rowData[0]).length > 0 ? _this.rowData : _this.currentViewData()\n      });\n\n      if (isBlazor()) {\n        e.bindEvents(e.dragElement);\n      }\n\n      _this.dragStartData = _this.rowData;\n      var dropElem = document.getElementById(gObj.rowDropSettings.targetID);\n\n      if (gObj.rowDropSettings.targetID && dropElem && dropElem.ej2_instances && dropElem.ej2_instances[0].getModuleName() === 'grid') {\n        dropElem.ej2_instances[0].getContent().classList.add('e-allowRowDrop');\n      }\n    };\n\n    this.drag = function (e) {\n      var gObj = _this.parent;\n\n      var cloneElement = _this.parent.element.querySelector('.e-cloneproperties');\n\n      var target = _this.getElementFromPosition(cloneElement, e.event);\n\n      classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur', 'e-movecur']);\n      _this.isOverflowBorder = true;\n      _this.hoverState = gObj.enableHover;\n      var trElement = parentsUntil(target, 'e-grid') ? closestElement(e.target, 'tr') : null;\n      gObj.enableHover = false;\n\n      if (!e.target) {\n        return;\n      }\n\n      _this.processArgs(target);\n\n      var args = {\n        rows: _this.rows,\n        target: target,\n        draggableType: 'rows',\n        data: _this.rowData,\n        originalEvent: e,\n        cancel: false\n      };\n      gObj.trigger(events.rowDrag, args);\n\n      _this.stopTimer();\n\n      if (args.cancel) {\n        return;\n      }\n\n      gObj.element.classList.add('e-rowdrag');\n      _this.dragTarget = trElement && parentsUntil(target, 'e-grid').id === cloneElement.parentElement.id ? trElement.rowIndex : parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10);\n\n      if (gObj.rowDropSettings.targetID) {\n        if (!parentsUntil(target, 'e-gridcontent') || parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(target, 'e-grid').id) {\n          classList(cloneElement, ['e-notallowedcur'], ['e-defaultcur']);\n        } else {\n          classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur']);\n        }\n      } else {\n        var elem = parentsUntil(target, 'e-grid');\n\n        if (elem && elem.id === cloneElement.parentElement.id) {\n          classList(cloneElement, ['e-movecur'], ['e-defaultcur']);\n        } else {\n          classList(cloneElement, ['e-notallowedcur'], ['e-movecur']);\n        }\n      }\n\n      if (!gObj.rowDropSettings.targetID && (!gObj.groupSettings.columns.length || e.target.classList.contains('e-selectionbackground'))) {\n        if (parentsUntil(target, 'e-grid')) {\n          _this.updateScrollPostion(e.event, target);\n        }\n\n        if (_this.isOverflowBorder && parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10) !== _this.dragTarget) {\n          _this.moveDragRows(e, _this.startedRow, trElement);\n        } else {\n          if (trElement && _this.parent.getRowByIndex(_this.parent.getCurrentViewRecords().length - 1).getAttribute('data-uid') === trElement.getAttribute('data-uid')) {\n            var bottomborder = _this.parent.createElement('div', {\n              className: 'e-lastrow-dragborder'\n            });\n\n            var gridcontentEle = _this.parent.getContent();\n\n            bottomborder.style.width = _this.parent.element.offsetWidth - _this.getScrollWidth() + 'px';\n\n            if (!gridcontentEle.querySelectorAll('.e-lastrow-dragborder').length) {\n              gridcontentEle.classList.add('e-grid-relative');\n              gridcontentEle.appendChild(bottomborder);\n              bottomborder.style.bottom = _this.getScrollWidth() + 'px';\n            }\n          }\n\n          _this.removeBorder(trElement);\n        }\n      }\n    };\n\n    this.dragStop = function (e) {\n      if (isActionPrevent(_this.parent)) {\n        _this.parent.notify(events.preventBatch, {\n          instance: _this,\n          handler: _this.processDragStop,\n          arg1: e\n        });\n      } else {\n        _this.processDragStop(e);\n      }\n    };\n\n    this.processDragStop = function (e) {\n      var gObj = _this.parent;\n\n      if (_this.parent.isDestroyed) {\n        return;\n      }\n\n      var targetEle = _this.getElementFromPosition(e.helper, e.event);\n\n      var target = targetEle && !targetEle.classList.contains('e-dlg-overlay') ? targetEle : e.target;\n\n      var cloneElement = _this.parent.element.querySelector('.e-cloneproperties');\n\n      gObj.element.classList.remove('e-rowdrag');\n      var dropElement = document.getElementById(gObj.rowDropSettings.targetID);\n\n      if (gObj.rowDropSettings.targetID && dropElement && dropElement.ej2_instances && dropElement.ej2_instances[0].getModuleName() === 'grid') {\n        dropElement.ej2_instances[0].getContent().classList.remove('e-allowRowDrop');\n      }\n\n      if (gObj.isRowDragable()) {\n        _this.stopTimer();\n\n        gObj.enableHover = _this.hoverState;\n\n        _this.parent.getContent().classList.remove('e-grid-relative');\n\n        _this.removeBorder(targetEle);\n\n        var stRow = gObj.element.querySelector('.e-dragstartrow');\n\n        if (stRow) {\n          stRow.classList.remove('e-dragstartrow');\n        }\n      }\n\n      _this.processArgs(target);\n\n      var args = {\n        target: isBlazor() ? null : target,\n        draggableType: 'rows',\n        cancel: false,\n        fromIndex: parseInt(_this.rows[0].getAttribute('aria-rowindex'), 10),\n        dropIndex: _this.dragTarget,\n        rows: isBlazor() ? null : _this.rows,\n        data: Object.keys(_this.dragStartData[0]).length > 0 ? _this.dragStartData : _this.currentViewData()\n      };\n      gObj.trigger(events.rowDrop, args, function () {\n        if (!parentsUntil(target, 'e-gridcontent') || args.cancel) {\n          _this.dragTarget = null;\n          remove(e.helper);\n          return;\n        }\n\n        _this.isRefresh = false;\n\n        var selectedIndexes = _this.parent.getSelectedRowIndexes();\n\n        if (gObj.isRowDragable()) {\n          if (!isBlazor()) {\n            if (!_this.parent.rowDropSettings.targetID && _this.startedRow.querySelector('td.e-selectionbackground') && selectedIndexes.length > 1 && selectedIndexes.length !== _this.parent.getCurrentViewRecords().length) {\n              _this.reorderRows(selectedIndexes, args.dropIndex);\n            } else {\n              _this.reorderRows([parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10)], _this.dragTarget);\n            }\n          } else {\n            var draggedData = _this.parent.getSelectedRecords().length ? _this.parent.getSelectedRecords() : _this.currentViewData();\n            var changeRecords = {\n              addedRecords: [],\n              deletedRecords: draggedData,\n              changedRecords: []\n            };\n            var toIdx = _this.dragTarget ? _this.dragTarget : args.dropIndex;\n            var dragDropDestinationIndex = 'dragDropDestinationIndex';\n            var query = new Query();\n            query[dragDropDestinationIndex] = toIdx;\n\n            _this.saveChange(changeRecords, query);\n\n            changeRecords.deletedRecords = [];\n            changeRecords.addedRecords = draggedData;\n\n            _this.saveChange(changeRecords, query);\n          }\n\n          _this.dragTarget = null;\n\n          if (!gObj.rowDropSettings.targetID) {\n            remove(e.helper);\n            gObj.refresh();\n          }\n        }\n\n        _this.isRefresh = true;\n      });\n    };\n\n    this.removeCell = function (targetRow, className) {\n      return [].slice.call(targetRow.querySelectorAll('td')).filter(function (cell) {\n        if (cell.classList.contains(className)) {\n          targetRow.deleteCell(cell.cellIndex);\n        }\n      });\n    };\n\n    this.parent = parent;\n\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.initialEnd, this.initializeDrag, this);\n    this.parent.on(events.columnDrop, this.columnDrop, this);\n    this.onDataBoundFn = this.onDataBound.bind(this);\n    this.parent.addEventListener(events.dataBound, this.onDataBoundFn);\n    this.parent.on(events.uiUpdate, this.enableAfterRender, this);\n  }\n\n  RowDD.prototype.currentViewData = function () {\n    var selectedIndexes = this.parent.getSelectedRowIndexes();\n    var currentVdata = [];\n    var fromIdx = parseInt(this.startedRow.getAttribute('aria-rowindex'), 10);\n\n    for (var i = 0, n = selectedIndexes.length; i < n; i++) {\n      var currentV = 'currentViewData';\n      currentVdata[i] = this.parent[currentV][selectedIndexes[i]];\n    }\n\n    if (!this.parent.rowDropSettings.targetID && selectedIndexes.length === 0) {\n      currentVdata[0] = this.parent.currentViewData[fromIdx];\n    }\n\n    return currentVdata;\n  };\n\n  RowDD.prototype.saveChange = function (changeRecords, query) {\n    var _this = this;\n\n    this.parent.getDataModule().saveChanges(changeRecords, this.parent.getPrimaryKeyFieldNames()[0], {}, query).then(function () {\n      _this.parent.notify(events.modelChanged, {\n        type: events.actionBegin,\n        requestType: 'rowdraganddrop'\n      });\n    }).catch(function (e) {\n      var error = 'error';\n      var message = 'message';\n\n      if (!isNullOrUndefined(e[error]) && !isNullOrUndefined(e[error][message])) {\n        e[error] = e[error][message];\n      }\n\n      _this.parent.trigger(events.actionFailure, e);\n    });\n  };\n\n  RowDD.prototype.reorderRows = function (fromIndexes, toIndex) {\n    var selectedIndexes = this.parent.getSelectedRowIndexes();\n    var selectedRecords = [];\n    var draggedRecords = [];\n    var currentViewData = this.parent.renderModule.data.dataManager.dataSource.json;\n    var dropIdx = toIndex;\n    var actualIdx = fromIndexes[0];\n\n    for (var i = 0, len = fromIndexes.length; i < len; i++) {\n      draggedRecords[i] = currentViewData[fromIndexes[i]];\n    }\n\n    for (var i = 0, len = selectedIndexes.length; i < len; i++) {\n      selectedRecords[i] = currentViewData[selectedIndexes[i]];\n    }\n\n    for (var i = 0, len = draggedRecords.length; i < len; i++) {\n      if (i !== 0) {\n        for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n          if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) === JSON.stringify(draggedRecords[i])) {\n            actualIdx = j;\n            break;\n          }\n        }\n\n        for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n          if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) === JSON.stringify(draggedRecords[i - 1])) {\n            if (actualIdx > j) {\n              dropIdx = j + 1;\n            }\n\n            break;\n          }\n        }\n      }\n\n      this.reorderRow(actualIdx, dropIdx);\n    }\n\n    if (this.isRefresh) {\n      this.parent.notify(events.modelChanged, {\n        type: events.actionBegin,\n        requestType: 'rowdraganddrop'\n      });\n    }\n\n    for (var i = 0, len = selectedRecords.length; i < len; i++) {\n      for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n        if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) === JSON.stringify(selectedRecords[i])) {\n          selectedIndexes[i] = j;\n          break;\n        }\n      }\n    }\n\n    this.selectedRowColls = selectedIndexes;\n  };\n\n  RowDD.prototype.stopTimer = function () {\n    window.clearInterval(this.timer);\n  };\n\n  RowDD.prototype.initializeDrag = function () {\n    var gObj = this.parent;\n    this.draggable = new Draggable(gObj.getContent(), {\n      dragTarget: '.e-rowcelldrag, .e-rowdragdrop, .e-rowcell',\n      distance: 5,\n      helper: this.helper,\n      dragStart: this.dragStart,\n      drag: this.drag,\n      dragStop: this.dragStop\n    });\n  };\n\n  RowDD.prototype.updateScrollPostion = function (e, target) {\n    var _this = this;\n\n    var frzCols = this.parent.getFrozenColumns();\n    var y = getPosition(e).y;\n    var cliRect = this.parent.getContent().getBoundingClientRect();\n    var rowHeight = this.parent.getRowHeight() - 15;\n    var scrollElem = frzCols ? this.parent.getContent().querySelector('.e-movablecontent') : this.parent.getContent().firstElementChild;\n\n    if (cliRect.top + rowHeight >= y) {\n      var scrollPixel_1 = -this.parent.getRowHeight();\n      this.isOverflowBorder = false;\n      this.timer = window.setInterval(function () {\n        _this.setScrollDown(scrollElem, scrollPixel_1, true);\n      }, 200);\n    } else if (cliRect.top + this.parent.getContent().clientHeight - rowHeight - 33 <= y) {\n      var scrollPixel_2 = this.parent.getRowHeight();\n      this.isOverflowBorder = false;\n      this.timer = window.setInterval(function () {\n        _this.setScrollDown(scrollElem, scrollPixel_2, true);\n      }, 200);\n    }\n  };\n\n  RowDD.prototype.setScrollDown = function (scrollElem, scrollPixel, isLeft) {\n    scrollElem.scrollTop = scrollElem.scrollTop + scrollPixel;\n  };\n\n  RowDD.prototype.moveDragRows = function (e, startedRow, targetRow) {\n    var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n    var element = closestElement(e.target, 'tr');\n\n    if (parentsUntil(element, 'e-gridcontent') && parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(element, 'e-grid').id) {\n      var targetElement = element ? element : this.startedRow;\n      this.setBorder(targetElement, e.event, startedRow, targetRow);\n    }\n  };\n\n  RowDD.prototype.setBorder = function (element, event, startedRow, targetRow) {\n    var node = this.parent.element;\n    var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n    this.removeFirstRowBorder(element);\n    this.removeLastRowBorder(element);\n\n    if (parentsUntil(element, 'e-gridcontent') && parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(element, 'e-grid').id) {\n      removeClass(node.querySelectorAll('.e-rowcell,.e-rowdragdrop'), ['e-dragborder']);\n      var rowElement = [];\n\n      if (targetRow && targetRow.rowIndex === 0) {\n        var div = this.parent.createElement('div', {\n          className: 'e-firstrow-dragborder'\n        });\n        var gridheaderEle = this.parent.getHeaderContent();\n        gridheaderEle.classList.add('e-grid-relative');\n        div.style.width = node.offsetWidth - this.getScrollWidth() + 'px';\n\n        if (!gridheaderEle.querySelectorAll('.e-firstrow-dragborder').length) {\n          gridheaderEle.appendChild(div);\n        }\n      } else if (targetRow && parseInt(startedRow.getAttribute('aria-rowindex'), 10) > targetRow.rowIndex) {\n        element = this.parent.getRowByIndex(targetRow.rowIndex - 1);\n        rowElement = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n      } else {\n        rowElement = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n      }\n\n      if (rowElement.length > 0) {\n        addRemoveActiveClasses(rowElement, true, 'e-dragborder');\n      }\n    }\n  };\n\n  RowDD.prototype.getScrollWidth = function () {\n    var scrollElem = this.parent.getContent().firstElementChild;\n    return scrollElem.scrollWidth > scrollElem.offsetWidth ? Scroll.getScrollBarWidth() : 0;\n  };\n\n  RowDD.prototype.removeFirstRowBorder = function (element) {\n    if (this.parent.element.getElementsByClassName('e-firstrow-dragborder').length > 0 && element && element.rowIndex !== 0) {\n      this.parent.element.getElementsByClassName('e-firstrow-dragborder')[0].remove();\n    }\n  };\n\n  RowDD.prototype.removeLastRowBorder = function (element) {\n    var islastRowIndex = element && this.parent.getRowByIndex(this.parent.getCurrentViewRecords().length - 1).getAttribute('data-uid') !== element.getAttribute('data-uid');\n\n    if (this.parent.element.getElementsByClassName('e-lastrow-dragborder').length > 0 && element && islastRowIndex) {\n      this.parent.element.getElementsByClassName('e-lastrow-dragborder')[0].remove();\n    }\n  };\n\n  RowDD.prototype.removeBorder = function (element) {\n    this.removeFirstRowBorder(element);\n    this.removeLastRowBorder(element);\n    element = this.parent.getRows().filter(function (row) {\n      return row.querySelector('td.e-dragborder');\n    })[0];\n\n    if (element) {\n      var rowElement = [].slice.call(element.querySelectorAll('.e-dragborder'));\n      addRemoveActiveClasses(rowElement, false, 'e-dragborder');\n    }\n  };\n\n  RowDD.prototype.getElementFromPosition = function (element, event) {\n    var target;\n    var position = getPosition(event);\n    element.style.display = 'none';\n    target = document.elementFromPoint(position.x, position.y);\n    element.style.display = '';\n    return target;\n  };\n\n  RowDD.prototype.onDataBound = function (e) {\n    if (this.selectedRowColls.length > 0) {\n      this.parent.selectRows(this.selectedRowColls);\n      this.selectedRowColls = [];\n    }\n  };\n\n  RowDD.prototype.getTargetIdx = function (targetRow) {\n    return targetRow ? parseInt(targetRow.getAttribute('aria-rowindex'), 10) : 0;\n  };\n\n  RowDD.prototype.singleRowDrop = function (e) {\n    var targetRow = closestElement(e.target, 'tr');\n    var currentIndex;\n    var srcControl;\n    srcControl = e.droppedElement.parentElement.ej2_instances[0];\n    currentIndex = targetRow ? targetRow.rowIndex : srcControl.currentViewData.length - 1;\n    this.reorderRow(this.startedRowIndex, currentIndex);\n  };\n\n  RowDD.prototype.columnDrop = function (e) {\n    var gObj = this.parent;\n    var draggObj = e.droppedElement.parentElement.ej2_instances[0];\n\n    if (e.droppedElement.getAttribute('action') !== 'grouping') {\n      var targetRow = closestElement(e.target, 'tr');\n      var srcControl_1;\n      var currentIndex = void 0;\n\n      if (e.droppedElement.querySelector('tr').getAttribute('single-dragrow') !== 'true' && e.droppedElement.parentElement.id === gObj.element.id || e.droppedElement.querySelector('tr').getAttribute('single-dragrow') === 'true' && e.droppedElement.parentElement.id !== gObj.element.id) {\n        return;\n      }\n\n      if (e.droppedElement.parentElement.id !== gObj.element.id) {\n        srcControl_1 = e.droppedElement.parentElement.ej2_instances[0];\n      } else if (this.isSingleRowDragDrop || e.droppedElement.querySelector('tr').getAttribute('single-dragrow') === 'true') {\n        this.singleRowDrop(e);\n        return;\n      }\n\n      if (srcControl_1.element.id !== gObj.element.id && srcControl_1.rowDropSettings.targetID !== gObj.element.id) {\n        return;\n      }\n\n      var records = srcControl_1.getSelectedRecords();\n      var targetIndex = currentIndex = this.getTargetIdx(targetRow);\n      var count = 0;\n\n      if (isNaN(targetIndex)) {\n        targetIndex = currentIndex = 0;\n      }\n\n      if (gObj.allowPaging) {\n        targetIndex = targetIndex + gObj.pageSettings.currentPage * gObj.pageSettings.pageSize - gObj.pageSettings.pageSize;\n      } //Todo: drag and drop mapper & BatchChanges\n\n\n      if (!isBlazor()) {\n        gObj.notify(events.rowsAdded, {\n          toIndex: targetIndex,\n          records: records\n        });\n        gObj.notify(events.modelChanged, {\n          type: events.actionBegin,\n          requestType: 'rowdraganddrop'\n        });\n        var selectedRows = srcControl_1.getSelectedRowIndexes();\n        var skip = srcControl_1.allowPaging ? srcControl_1.pageSettings.currentPage * srcControl_1.pageSettings.pageSize - srcControl_1.pageSettings.pageSize : 0;\n        this.selectedRows = [];\n\n        for (var i = 0, len = records.length; i < len; i++) {\n          this.selectedRows.push(skip + selectedRows[i]);\n        }\n\n        srcControl_1.notify(events.rowsRemoved, {\n          indexes: this.selectedRows,\n          records: records\n        });\n        srcControl_1.notify(events.modelChanged, {\n          type: events.actionBegin,\n          requestType: 'rowdraganddrop'\n        });\n      } else {\n        var currentVdata = [];\n        var selectedIndex = srcControl_1.getSelectedRowIndexes();\n\n        for (var i = 0; i < selectedIndex.length; i++) {\n          currentVdata[i] = srcControl_1.currentViewData[selectedIndex[i]];\n        }\n\n        records = currentVdata;\n        var changes = {\n          addedRecords: records,\n          deletedRecords: [],\n          changedRecords: []\n        };\n        var dragDropDestinationIndex = 'dragDropDestinationIndex';\n        var query = new Query();\n        query[dragDropDestinationIndex] = targetIndex;\n        gObj.getDataModule().saveChanges(changes, gObj.getPrimaryKeyFieldNames()[0], {}, query).then(function () {\n          gObj.notify(events.modelChanged, {\n            type: events.actionBegin,\n            requestType: 'rowdraganddrop'\n          });\n        }).catch(function (e) {\n          var message = 'message';\n          var error = 'error';\n\n          if (!isNullOrUndefined(e[error]) && !isNullOrUndefined(e[error][message])) {\n            e[error] = e[error][message];\n          }\n\n          gObj.trigger(events.actionFailure, e);\n        });\n        changes.deletedRecords = records;\n        changes.addedRecords = [];\n        srcControl_1.getDataModule().saveChanges(changes, srcControl_1.getPrimaryKeyFieldNames()[0], {}, query).then(function () {\n          srcControl_1.notify(events.modelChanged, {\n            type: events.actionBegin,\n            requestType: 'rowdraganddrop'\n          });\n        }).catch(function (e) {\n          var error = 'error';\n          var msg = 'message';\n\n          if (!isNullOrUndefined(e[error]) && !isNullOrUndefined(e[error][msg])) {\n            e[error] = e[error][msg];\n          }\n\n          srcControl_1.trigger(events.actionFailure, e);\n        });\n      }\n    }\n  };\n\n  RowDD.prototype.reorderRow = function (fromIndexes, toIndex) {\n    var gObj = this.parent;\n\n    if (!gObj.sortSettings.columns.length && !gObj.groupSettings.columns.length && !gObj.filterSettings.columns.length) {\n      //Todo: drag and drop mapper & BatchChanges                 \n      var skip = gObj.allowPaging ? gObj.pageSettings.currentPage * gObj.pageSettings.pageSize - gObj.pageSettings.pageSize : 0;\n      var fromIndex = fromIndexes;\n      toIndex = toIndex + skip;\n      this.selectedRows = gObj.getSelectedRowIndexes();\n      gObj.notify(events.rowPositionChanged, {\n        fromIndex: fromIndexes + skip,\n        toIndex: toIndex\n      });\n    }\n  };\n\n  RowDD.prototype.enableAfterRender = function (e) {\n    if (e.module === this.getModuleName() && e.enable) {\n      this.initializeDrag();\n    }\n  };\n  /**\n   * To destroy the print\n   * @return {void}\n   * @hidden\n   */\n\n\n  RowDD.prototype.destroy = function () {\n    var gridElement = this.parent.element;\n\n    if (this.parent.isDestroyed || !gridElement || !gridElement.querySelector('.e-gridheader') && !gridElement.querySelector('.e-gridcontent')) {\n      return;\n    }\n\n    this.draggable.destroy();\n    this.parent.off(events.initialEnd, this.initializeDrag);\n    this.parent.off(events.columnDrop, this.columnDrop);\n    this.parent.removeEventListener(events.dataBound, this.onDataBoundFn);\n    this.parent.off(events.uiUpdate, this.enableAfterRender); //destory ejdrag and drop\n  };\n  /**\n   * For internal use only - Get the module name.\n   * @private\n   */\n\n\n  RowDD.prototype.getModuleName = function () {\n    return 'rowDragAndDrop';\n  };\n\n  RowDD.prototype.processArgs = function (target) {\n    var gObj = this.parent;\n\n    if (gObj.getSelectedRecords().length > 0 && this.startedRow.cells[0].classList.contains('e-selectionbackground') === false || gObj.getSelectedRecords().length === 0) {\n      this.rows = [this.startedRow];\n      this.rowData = [this.parent.getRowInfo(this.startedRow.querySelector('.e-rowcell')).rowData];\n    } else {\n      this.rows = gObj.getSelectedRows();\n      this.rowData = gObj.getSelectedRecords();\n    }\n  };\n\n  return RowDD;\n}();\n\nexport { RowDD };","map":{"version":3,"sources":["/home/nikhil/Desktop/data_grid_editor-master/node_modules/@syncfusion/ej2-grids/src/grid/actions/row-reorder.js"],"names":["Draggable","isBlazor","isNullOrUndefined","removeClass","remove","closest","closestElement","classList","parentsUntil","removeElement","getPosition","addRemoveActiveClasses","isActionPrevent","events","Scroll","Query","RowDD","parent","_this","selectedRows","isOverflowBorder","selectedRowColls","isRefresh","helper","e","gObj","target","draggable","currentStateTarget","visualElement","createElement","className","styles","element","offsetWidth","table","tbody","document","getElementsByClassName","length","rowDropSettings","targetID","sender","contains","selectionSettings","type","mode","selectRow","parseInt","parentElement","getAttribute","startedRow","cloneNode","processArgs","args","selectedRow","rows","dragelement","cloneElement","cancel","data","rowData","getSelectedRows","trigger","rowDragStartHelper","removeCell","exp","RegExp","innerHTML","replace","appendChild","hasAttribute","dropCountEle","ele","querySelector","add","dragStart","spanCssEle","getSelectedRecords","style","left","rowDragStart","draggableType","fromIndex","Object","keys","currentViewData","bindEvents","dragElement","dragStartData","dropElem","getElementById","ej2_instances","getModuleName","getContent","drag","getElementFromPosition","event","hoverState","enableHover","trElement","originalEvent","rowDrag","stopTimer","dragTarget","id","rowIndex","elem","groupSettings","columns","updateScrollPostion","moveDragRows","getRowByIndex","getCurrentViewRecords","bottomborder","gridcontentEle","width","getScrollWidth","querySelectorAll","bottom","removeBorder","dragStop","notify","preventBatch","instance","handler","processDragStop","arg1","isDestroyed","targetEle","dropElement","isRowDragable","stRow","dropIndex","rowDrop","selectedIndexes","getSelectedRowIndexes","reorderRows","draggedData","changeRecords","addedRecords","deletedRecords","changedRecords","toIdx","dragDropDestinationIndex","query","saveChange","refresh","targetRow","slice","call","filter","cell","deleteCell","cellIndex","on","initialEnd","initializeDrag","columnDrop","onDataBoundFn","onDataBound","bind","addEventListener","dataBound","uiUpdate","enableAfterRender","prototype","currentVdata","fromIdx","i","n","currentV","getDataModule","saveChanges","getPrimaryKeyFieldNames","then","modelChanged","actionBegin","requestType","catch","error","message","actionFailure","fromIndexes","toIndex","selectedRecords","draggedRecords","renderModule","dataManager","dataSource","json","dropIdx","actualIdx","len","j","len1","JSON","stringify","reorderRow","window","clearInterval","timer","distance","frzCols","getFrozenColumns","y","cliRect","getBoundingClientRect","rowHeight","getRowHeight","scrollElem","firstElementChild","top","scrollPixel_1","setInterval","setScrollDown","clientHeight","scrollPixel_2","scrollPixel","isLeft","scrollTop","targetElement","setBorder","node","removeFirstRowBorder","removeLastRowBorder","rowElement","div","gridheaderEle","getHeaderContent","scrollWidth","getScrollBarWidth","islastRowIndex","getRows","row","position","display","elementFromPoint","x","selectRows","getTargetIdx","singleRowDrop","currentIndex","srcControl","droppedElement","startedRowIndex","draggObj","srcControl_1","isSingleRowDragDrop","records","targetIndex","count","isNaN","allowPaging","pageSettings","currentPage","pageSize","rowsAdded","skip","push","rowsRemoved","indexes","selectedIndex","changes","msg","sortSettings","filterSettings","rowPositionChanged","module","enable","destroy","gridElement","off","removeEventListener","cells","getRowInfo"],"mappings":"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","sourcesContent":["import { Draggable, isBlazor, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { removeClass } from '@syncfusion/ej2-base';\nimport { remove, closest as closestElement, classList } from '@syncfusion/ej2-base';\nimport { parentsUntil, removeElement, getPosition, addRemoveActiveClasses, isActionPrevent } from '../base/util';\nimport * as events from '../base/constant';\nimport { Scroll } from '../actions/scroll';\nimport { Query } from '@syncfusion/ej2-data';\n/**\n *\n * Reorder module is used to handle row reordering.\n * @hidden\n */\nvar RowDD = /** @class */ (function () {\n    /**\n     * Constructor for the Grid print module\n     * @hidden\n     */\n    function RowDD(parent) {\n        var _this = this;\n        this.selectedRows = [];\n        this.isOverflowBorder = true;\n        this.selectedRowColls = [];\n        this.isRefresh = true;\n        /* tslint:disable-next-line:max-line-length */\n        // tslint:disable-next-line:max-func-body-length\n        this.helper = function (e) {\n            var gObj = _this.parent;\n            var target = _this.draggable.currentStateTarget;\n            var visualElement = _this.parent.createElement('div', {\n                className: 'e-cloneproperties e-draganddrop e-grid e-dragclone',\n                styles: 'height:\"auto\", z-index:2, width:' + gObj.element.offsetWidth\n            });\n            var table = _this.parent.createElement('table', { styles: 'width:' + gObj.element.offsetWidth });\n            var tbody = _this.parent.createElement('tbody');\n            if (document.getElementsByClassName('e-griddragarea').length ||\n                (gObj.rowDropSettings.targetID && (!e.sender.target.classList.contains('e-selectionbackground')\n                    && gObj.selectionSettings.type !== 'Single')) ||\n                (!gObj.rowDropSettings.targetID && !parentsUntil(e.sender.target, 'e-rowdragdrop'))) {\n                return false;\n            }\n            if (gObj.rowDropSettings.targetID &&\n                gObj.selectionSettings.mode === 'Row' && gObj.selectionSettings.type === 'Single') {\n                gObj.selectRow(parseInt(_this.draggable.currentStateTarget.parentElement.getAttribute('aria-rowindex'), 10));\n            }\n            _this.startedRow = closestElement(target, 'tr').cloneNode(true);\n            _this.processArgs(target);\n            var args = {\n                selectedRow: _this.rows, dragelement: target,\n                cloneElement: visualElement, cancel: false, data: _this.rowData\n            };\n            var selectedRows = gObj.getSelectedRows();\n            gObj.trigger(events.rowDragStartHelper, args);\n            var cancel = 'cancel';\n            var cloneElement = 'cloneElement';\n            if (args[cancel]) {\n                return false;\n            }\n            removeElement(_this.startedRow, '.e-indentcell');\n            removeElement(_this.startedRow, '.e-detailrowcollapse');\n            removeElement(_this.startedRow, '.e-detailrowexpand');\n            _this.removeCell(_this.startedRow, 'e-gridchkbox');\n            var exp = new RegExp('e-active', 'g'); //high contrast issue\n            _this.startedRow.innerHTML = _this.startedRow.innerHTML.replace(exp, '');\n            tbody.appendChild(_this.startedRow);\n            if (gObj.getSelectedRows().length > 1 && _this.startedRow.hasAttribute('aria-selected')) {\n                var dropCountEle = _this.parent.createElement('span', {\n                    className: 'e-dropitemscount', innerHTML: '' + selectedRows.length,\n                });\n                visualElement.appendChild(dropCountEle);\n            }\n            var ele = closestElement(target, 'tr').querySelector('.e-icon-rowdragicon');\n            if (ele) {\n                ele.classList.add('e-dragstartrow');\n            }\n            table.appendChild(tbody);\n            visualElement.appendChild(table);\n            gObj.element.appendChild(visualElement);\n            return visualElement;\n        };\n        this.dragStart = function (e) {\n            var gObj = _this.parent;\n            if (document.getElementsByClassName('e-griddragarea').length) {\n                return;\n            }\n            var target = e.target;\n            var spanCssEle = _this.parent.element.querySelector('.e-dropitemscount');\n            if (_this.parent.getSelectedRecords().length > 1 && spanCssEle) {\n                spanCssEle.style.left = _this.parent.element.querySelector('.e-cloneproperties table')\n                    .offsetWidth - 5 + 'px';\n            }\n            _this.processArgs(target);\n            gObj.trigger(events.rowDragStart, {\n                rows: (isBlazor()) ? null : _this.rows, target: (isBlazor()) ? null : e.target,\n                draggableType: 'rows', fromIndex: parseInt(_this.rows[0].getAttribute('aria-rowindex'), 10),\n                data: (Object.keys(_this.rowData[0]).length > 0) ? _this.rowData : _this.currentViewData()\n            });\n            if (isBlazor()) {\n                e.bindEvents(e.dragElement);\n            }\n            _this.dragStartData = _this.rowData;\n            var dropElem = document.getElementById(gObj.rowDropSettings.targetID);\n            if (gObj.rowDropSettings.targetID && dropElem && dropElem.ej2_instances &&\n                dropElem.ej2_instances[0].getModuleName() === 'grid') {\n                dropElem.ej2_instances[0].getContent().classList.add('e-allowRowDrop');\n            }\n        };\n        this.drag = function (e) {\n            var gObj = _this.parent;\n            var cloneElement = _this.parent.element.querySelector('.e-cloneproperties');\n            var target = _this.getElementFromPosition(cloneElement, e.event);\n            classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur', 'e-movecur']);\n            _this.isOverflowBorder = true;\n            _this.hoverState = gObj.enableHover;\n            var trElement = parentsUntil(target, 'e-grid') ? closestElement(e.target, 'tr') : null;\n            gObj.enableHover = false;\n            if (!e.target) {\n                return;\n            }\n            _this.processArgs(target);\n            var args = {\n                rows: _this.rows, target: target, draggableType: 'rows',\n                data: _this.rowData, originalEvent: e, cancel: false\n            };\n            gObj.trigger(events.rowDrag, args);\n            _this.stopTimer();\n            if (args.cancel) {\n                return;\n            }\n            gObj.element.classList.add('e-rowdrag');\n            _this.dragTarget = trElement && parentsUntil(target, 'e-grid').id === cloneElement.parentElement.id ?\n                trElement.rowIndex : parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10);\n            if (gObj.rowDropSettings.targetID) {\n                if (!parentsUntil(target, 'e-gridcontent') ||\n                    parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(target, 'e-grid').id) {\n                    classList(cloneElement, ['e-notallowedcur'], ['e-defaultcur']);\n                }\n                else {\n                    classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur']);\n                }\n            }\n            else {\n                var elem = parentsUntil(target, 'e-grid');\n                if (elem && elem.id === cloneElement.parentElement.id) {\n                    classList(cloneElement, ['e-movecur'], ['e-defaultcur']);\n                }\n                else {\n                    classList(cloneElement, ['e-notallowedcur'], ['e-movecur']);\n                }\n            }\n            if (!gObj.rowDropSettings.targetID &&\n                (!gObj.groupSettings.columns.length || e.target.classList.contains('e-selectionbackground'))) {\n                if (parentsUntil(target, 'e-grid')) {\n                    _this.updateScrollPostion(e.event, target);\n                }\n                if (_this.isOverflowBorder && parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10) !== _this.dragTarget) {\n                    _this.moveDragRows(e, _this.startedRow, trElement);\n                }\n                else {\n                    if (trElement && _this.parent.getRowByIndex(_this.parent.getCurrentViewRecords().length - 1).getAttribute('data-uid') ===\n                        trElement.getAttribute('data-uid')) {\n                        var bottomborder = _this.parent.createElement('div', { className: 'e-lastrow-dragborder' });\n                        var gridcontentEle = _this.parent.getContent();\n                        bottomborder.style.width = _this.parent.element.offsetWidth - _this.getScrollWidth() + 'px';\n                        if (!gridcontentEle.querySelectorAll('.e-lastrow-dragborder').length) {\n                            gridcontentEle.classList.add('e-grid-relative');\n                            gridcontentEle.appendChild(bottomborder);\n                            bottomborder.style.bottom = _this.getScrollWidth() + 'px';\n                        }\n                    }\n                    _this.removeBorder(trElement);\n                }\n            }\n        };\n        this.dragStop = function (e) {\n            if (isActionPrevent(_this.parent)) {\n                _this.parent.notify(events.preventBatch, {\n                    instance: _this, handler: _this.processDragStop, arg1: e\n                });\n            }\n            else {\n                _this.processDragStop(e);\n            }\n        };\n        this.processDragStop = function (e) {\n            var gObj = _this.parent;\n            if (_this.parent.isDestroyed) {\n                return;\n            }\n            var targetEle = _this.getElementFromPosition(e.helper, e.event);\n            var target = targetEle && !targetEle.classList.contains('e-dlg-overlay') ?\n                targetEle : e.target;\n            var cloneElement = _this.parent.element.querySelector('.e-cloneproperties');\n            gObj.element.classList.remove('e-rowdrag');\n            var dropElement = document.getElementById(gObj.rowDropSettings.targetID);\n            if (gObj.rowDropSettings.targetID && dropElement && dropElement.ej2_instances &&\n                dropElement.ej2_instances[0].getModuleName() === 'grid') {\n                dropElement.ej2_instances[0].getContent().classList.remove('e-allowRowDrop');\n            }\n            if (gObj.isRowDragable()) {\n                _this.stopTimer();\n                gObj.enableHover = _this.hoverState;\n                _this.parent.getContent().classList.remove('e-grid-relative');\n                _this.removeBorder(targetEle);\n                var stRow = gObj.element.querySelector('.e-dragstartrow');\n                if (stRow) {\n                    stRow.classList.remove('e-dragstartrow');\n                }\n            }\n            _this.processArgs(target);\n            var args = {\n                target: (isBlazor()) ? null : target, draggableType: 'rows',\n                cancel: false,\n                fromIndex: parseInt(_this.rows[0].getAttribute('aria-rowindex'), 10),\n                dropIndex: _this.dragTarget, rows: (isBlazor()) ? null : _this.rows,\n                data: (Object.keys(_this.dragStartData[0]).length > 0) ? _this.dragStartData : _this.currentViewData()\n            };\n            gObj.trigger(events.rowDrop, args, function () {\n                if (!parentsUntil(target, 'e-gridcontent') || args.cancel) {\n                    _this.dragTarget = null;\n                    remove(e.helper);\n                    return;\n                }\n                _this.isRefresh = false;\n                var selectedIndexes = _this.parent.getSelectedRowIndexes();\n                if (gObj.isRowDragable()) {\n                    if (!isBlazor()) {\n                        if (!_this.parent.rowDropSettings.targetID &&\n                            _this.startedRow.querySelector('td.e-selectionbackground') && selectedIndexes.length > 1 &&\n                            selectedIndexes.length !== _this.parent.getCurrentViewRecords().length) {\n                            _this.reorderRows(selectedIndexes, args.dropIndex);\n                        }\n                        else {\n                            _this.reorderRows([parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10)], _this.dragTarget);\n                        }\n                    }\n                    else {\n                        var draggedData = _this.parent.getSelectedRecords().length ?\n                            _this.parent.getSelectedRecords() : _this.currentViewData();\n                        var changeRecords = {\n                            addedRecords: [],\n                            deletedRecords: draggedData,\n                            changedRecords: []\n                        };\n                        var toIdx = _this.dragTarget ? _this.dragTarget : args.dropIndex;\n                        var dragDropDestinationIndex = 'dragDropDestinationIndex';\n                        var query = new Query;\n                        query[dragDropDestinationIndex] = toIdx;\n                        _this.saveChange(changeRecords, query);\n                        changeRecords.deletedRecords = [];\n                        changeRecords.addedRecords = draggedData;\n                        _this.saveChange(changeRecords, query);\n                    }\n                    _this.dragTarget = null;\n                    if (!gObj.rowDropSettings.targetID) {\n                        remove(e.helper);\n                        gObj.refresh();\n                    }\n                }\n                _this.isRefresh = true;\n            });\n        };\n        this.removeCell = function (targetRow, className) {\n            return [].slice.call(targetRow.querySelectorAll('td')).filter(function (cell) {\n                if (cell.classList.contains(className)) {\n                    targetRow.deleteCell(cell.cellIndex);\n                }\n            });\n        };\n        this.parent = parent;\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.initialEnd, this.initializeDrag, this);\n        this.parent.on(events.columnDrop, this.columnDrop, this);\n        this.onDataBoundFn = this.onDataBound.bind(this);\n        this.parent.addEventListener(events.dataBound, this.onDataBoundFn);\n        this.parent.on(events.uiUpdate, this.enableAfterRender, this);\n    }\n    RowDD.prototype.currentViewData = function () {\n        var selectedIndexes = this.parent.getSelectedRowIndexes();\n        var currentVdata = [];\n        var fromIdx = parseInt(this.startedRow.getAttribute('aria-rowindex'), 10);\n        for (var i = 0, n = selectedIndexes.length; i < n; i++) {\n            var currentV = 'currentViewData';\n            currentVdata[i] = this.parent[currentV][selectedIndexes[i]];\n        }\n        if (!this.parent.rowDropSettings.targetID && selectedIndexes.length === 0) {\n            currentVdata[0] = this.parent.currentViewData[fromIdx];\n        }\n        return currentVdata;\n    };\n    RowDD.prototype.saveChange = function (changeRecords, query) {\n        var _this = this;\n        this.parent.getDataModule().saveChanges(changeRecords, this.parent.getPrimaryKeyFieldNames()[0], {}, query)\n            .then(function () {\n            _this.parent.notify(events.modelChanged, {\n                type: events.actionBegin, requestType: 'rowdraganddrop'\n            });\n        }).catch(function (e) {\n            var error = 'error';\n            var message = 'message';\n            if (!isNullOrUndefined(e[error]) && !isNullOrUndefined(e[error][message])) {\n                e[error] = e[error][message];\n            }\n            _this.parent.trigger(events.actionFailure, e);\n        });\n    };\n    RowDD.prototype.reorderRows = function (fromIndexes, toIndex) {\n        var selectedIndexes = this.parent.getSelectedRowIndexes();\n        var selectedRecords = [];\n        var draggedRecords = [];\n        var currentViewData = this.parent.renderModule.data.dataManager.dataSource.json;\n        var dropIdx = toIndex;\n        var actualIdx = fromIndexes[0];\n        for (var i = 0, len = fromIndexes.length; i < len; i++) {\n            draggedRecords[i] = currentViewData[fromIndexes[i]];\n        }\n        for (var i = 0, len = selectedIndexes.length; i < len; i++) {\n            selectedRecords[i] = currentViewData[selectedIndexes[i]];\n        }\n        for (var i = 0, len = draggedRecords.length; i < len; i++) {\n            if (i !== 0) {\n                for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n                    if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) ===\n                        JSON.stringify(draggedRecords[i])) {\n                        actualIdx = j;\n                        break;\n                    }\n                }\n                for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n                    if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) === JSON.stringify(draggedRecords[i - 1])) {\n                        if (actualIdx > j) {\n                            dropIdx = j + 1;\n                        }\n                        break;\n                    }\n                }\n            }\n            this.reorderRow(actualIdx, dropIdx);\n        }\n        if (this.isRefresh) {\n            this.parent.notify(events.modelChanged, {\n                type: events.actionBegin, requestType: 'rowdraganddrop'\n            });\n        }\n        for (var i = 0, len = selectedRecords.length; i < len; i++) {\n            for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n                if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) === JSON.stringify(selectedRecords[i])) {\n                    selectedIndexes[i] = j;\n                    break;\n                }\n            }\n        }\n        this.selectedRowColls = selectedIndexes;\n    };\n    RowDD.prototype.stopTimer = function () {\n        window.clearInterval(this.timer);\n    };\n    RowDD.prototype.initializeDrag = function () {\n        var gObj = this.parent;\n        this.draggable = new Draggable(gObj.getContent(), {\n            dragTarget: '.e-rowcelldrag, .e-rowdragdrop, .e-rowcell',\n            distance: 5,\n            helper: this.helper,\n            dragStart: this.dragStart,\n            drag: this.drag,\n            dragStop: this.dragStop\n        });\n    };\n    RowDD.prototype.updateScrollPostion = function (e, target) {\n        var _this = this;\n        var frzCols = this.parent.getFrozenColumns();\n        var y = getPosition(e).y;\n        var cliRect = this.parent.getContent().getBoundingClientRect();\n        var rowHeight = this.parent.getRowHeight() - 15;\n        var scrollElem = frzCols ? this.parent.getContent().querySelector('.e-movablecontent')\n            : this.parent.getContent().firstElementChild;\n        if (cliRect.top + rowHeight >= y) {\n            var scrollPixel_1 = -(this.parent.getRowHeight());\n            this.isOverflowBorder = false;\n            this.timer = window.setInterval(function () { _this.setScrollDown(scrollElem, scrollPixel_1, true); }, 200);\n        }\n        else if (cliRect.top + this.parent.getContent().clientHeight - rowHeight - 33 <= y) {\n            var scrollPixel_2 = (this.parent.getRowHeight());\n            this.isOverflowBorder = false;\n            this.timer = window.setInterval(function () { _this.setScrollDown(scrollElem, scrollPixel_2, true); }, 200);\n        }\n    };\n    RowDD.prototype.setScrollDown = function (scrollElem, scrollPixel, isLeft) {\n        scrollElem.scrollTop = scrollElem.scrollTop + scrollPixel;\n    };\n    RowDD.prototype.moveDragRows = function (e, startedRow, targetRow) {\n        var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n        var element = closestElement(e.target, 'tr');\n        if (parentsUntil(element, 'e-gridcontent') && parentsUntil(cloneElement.parentElement, 'e-grid').id ===\n            parentsUntil(element, 'e-grid').id) {\n            var targetElement = element ?\n                element : this.startedRow;\n            this.setBorder(targetElement, e.event, startedRow, targetRow);\n        }\n    };\n    RowDD.prototype.setBorder = function (element, event, startedRow, targetRow) {\n        var node = this.parent.element;\n        var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n        this.removeFirstRowBorder(element);\n        this.removeLastRowBorder(element);\n        if (parentsUntil(element, 'e-gridcontent') && parentsUntil(cloneElement.parentElement, 'e-grid').id ===\n            parentsUntil(element, 'e-grid').id) {\n            removeClass(node.querySelectorAll('.e-rowcell,.e-rowdragdrop'), ['e-dragborder']);\n            var rowElement = [];\n            if (targetRow && targetRow.rowIndex === 0) {\n                var div = this.parent.createElement('div', { className: 'e-firstrow-dragborder' });\n                var gridheaderEle = this.parent.getHeaderContent();\n                gridheaderEle.classList.add('e-grid-relative');\n                div.style.width = node.offsetWidth - this.getScrollWidth() + 'px';\n                if (!gridheaderEle.querySelectorAll('.e-firstrow-dragborder').length) {\n                    gridheaderEle.appendChild(div);\n                }\n            }\n            else if (targetRow && parseInt(startedRow.getAttribute('aria-rowindex'), 10) > targetRow.rowIndex) {\n                element = this.parent.getRowByIndex(targetRow.rowIndex - 1);\n                rowElement = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n            }\n            else {\n                rowElement = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n            }\n            if (rowElement.length > 0) {\n                addRemoveActiveClasses(rowElement, true, 'e-dragborder');\n            }\n        }\n    };\n    RowDD.prototype.getScrollWidth = function () {\n        var scrollElem = this.parent.getContent().firstElementChild;\n        return scrollElem.scrollWidth > scrollElem.offsetWidth ? Scroll.getScrollBarWidth() : 0;\n    };\n    RowDD.prototype.removeFirstRowBorder = function (element) {\n        if (this.parent.element.getElementsByClassName('e-firstrow-dragborder').length > 0 && element &&\n            element.rowIndex !== 0) {\n            this.parent.element.getElementsByClassName('e-firstrow-dragborder')[0].remove();\n        }\n    };\n    RowDD.prototype.removeLastRowBorder = function (element) {\n        var islastRowIndex = element &&\n            this.parent.getRowByIndex(this.parent.getCurrentViewRecords().length - 1).getAttribute('data-uid') !==\n                element.getAttribute('data-uid');\n        if (this.parent.element.getElementsByClassName('e-lastrow-dragborder').length > 0 && element && islastRowIndex) {\n            this.parent.element.getElementsByClassName('e-lastrow-dragborder')[0].remove();\n        }\n    };\n    RowDD.prototype.removeBorder = function (element) {\n        this.removeFirstRowBorder(element);\n        this.removeLastRowBorder(element);\n        element = this.parent.getRows().filter(function (row) {\n            return row.querySelector('td.e-dragborder');\n        })[0];\n        if (element) {\n            var rowElement = [].slice.call(element.querySelectorAll('.e-dragborder'));\n            addRemoveActiveClasses(rowElement, false, 'e-dragborder');\n        }\n    };\n    RowDD.prototype.getElementFromPosition = function (element, event) {\n        var target;\n        var position = getPosition(event);\n        element.style.display = 'none';\n        target = document.elementFromPoint(position.x, position.y);\n        element.style.display = '';\n        return target;\n    };\n    RowDD.prototype.onDataBound = function (e) {\n        if (this.selectedRowColls.length > 0) {\n            this.parent.selectRows(this.selectedRowColls);\n            this.selectedRowColls = [];\n        }\n    };\n    RowDD.prototype.getTargetIdx = function (targetRow) {\n        return targetRow ? parseInt(targetRow.getAttribute('aria-rowindex'), 10) : 0;\n    };\n    RowDD.prototype.singleRowDrop = function (e) {\n        var targetRow = closestElement(e.target, 'tr');\n        var currentIndex;\n        var srcControl;\n        srcControl = e.droppedElement.parentElement.ej2_instances[0];\n        currentIndex = targetRow ? targetRow.rowIndex : srcControl.currentViewData.length - 1;\n        this.reorderRow(this.startedRowIndex, currentIndex);\n    };\n    RowDD.prototype.columnDrop = function (e) {\n        var gObj = this.parent;\n        var draggObj = e.droppedElement.parentElement.ej2_instances[0];\n        if (e.droppedElement.getAttribute('action') !== 'grouping') {\n            var targetRow = closestElement(e.target, 'tr');\n            var srcControl_1;\n            var currentIndex = void 0;\n            if ((e.droppedElement.querySelector('tr').getAttribute('single-dragrow') !== 'true' &&\n                e.droppedElement.parentElement.id === gObj.element.id)\n                || (e.droppedElement.querySelector('tr').getAttribute('single-dragrow') === 'true' &&\n                    e.droppedElement.parentElement.id !== gObj.element.id)) {\n                return;\n            }\n            if (e.droppedElement.parentElement.id !== gObj.element.id) {\n                srcControl_1 = e.droppedElement.parentElement.ej2_instances[0];\n            }\n            else if (this.isSingleRowDragDrop || e.droppedElement.querySelector('tr').getAttribute('single-dragrow') === 'true') {\n                this.singleRowDrop(e);\n                return;\n            }\n            if (srcControl_1.element.id !== gObj.element.id && srcControl_1.rowDropSettings.targetID !== gObj.element.id) {\n                return;\n            }\n            var records = srcControl_1.getSelectedRecords();\n            var targetIndex = currentIndex = this.getTargetIdx(targetRow);\n            var count = 0;\n            if (isNaN(targetIndex)) {\n                targetIndex = currentIndex = 0;\n            }\n            if (gObj.allowPaging) {\n                targetIndex = targetIndex + (gObj.pageSettings.currentPage * gObj.pageSettings.pageSize) - gObj.pageSettings.pageSize;\n            }\n            //Todo: drag and drop mapper & BatchChanges\n            if (!isBlazor()) {\n                gObj.notify(events.rowsAdded, { toIndex: targetIndex, records: records });\n                gObj.notify(events.modelChanged, {\n                    type: events.actionBegin, requestType: 'rowdraganddrop'\n                });\n                var selectedRows = srcControl_1.getSelectedRowIndexes();\n                var skip = srcControl_1.allowPaging ?\n                    (srcControl_1.pageSettings.currentPage * srcControl_1.pageSettings.pageSize) - srcControl_1.pageSettings.pageSize : 0;\n                this.selectedRows = [];\n                for (var i = 0, len = records.length; i < len; i++) {\n                    this.selectedRows.push(skip + selectedRows[i]);\n                }\n                srcControl_1.notify(events.rowsRemoved, { indexes: this.selectedRows, records: records });\n                srcControl_1.notify(events.modelChanged, {\n                    type: events.actionBegin, requestType: 'rowdraganddrop'\n                });\n            }\n            else {\n                var currentVdata = [];\n                var selectedIndex = srcControl_1.getSelectedRowIndexes();\n                for (var i = 0; i < selectedIndex.length; i++) {\n                    currentVdata[i] = srcControl_1.currentViewData[selectedIndex[i]];\n                }\n                records = currentVdata;\n                var changes = {\n                    addedRecords: records,\n                    deletedRecords: [],\n                    changedRecords: []\n                };\n                var dragDropDestinationIndex = 'dragDropDestinationIndex';\n                var query = new Query;\n                query[dragDropDestinationIndex] = targetIndex;\n                gObj.getDataModule().saveChanges(changes, gObj.getPrimaryKeyFieldNames()[0], {}, query)\n                    .then(function () {\n                    gObj.notify(events.modelChanged, {\n                        type: events.actionBegin, requestType: 'rowdraganddrop'\n                    });\n                }).catch(function (e) {\n                    var message = 'message';\n                    var error = 'error';\n                    if (!isNullOrUndefined(e[error]) && !isNullOrUndefined(e[error][message])) {\n                        e[error] = e[error][message];\n                    }\n                    gObj.trigger(events.actionFailure, e);\n                });\n                changes.deletedRecords = records;\n                changes.addedRecords = [];\n                srcControl_1.getDataModule().saveChanges(changes, srcControl_1.getPrimaryKeyFieldNames()[0], {}, query)\n                    .then(function () {\n                    srcControl_1.notify(events.modelChanged, {\n                        type: events.actionBegin, requestType: 'rowdraganddrop'\n                    });\n                }).catch(function (e) {\n                    var error = 'error';\n                    var msg = 'message';\n                    if (!isNullOrUndefined(e[error]) && !isNullOrUndefined(e[error][msg])) {\n                        e[error] = e[error][msg];\n                    }\n                    srcControl_1.trigger(events.actionFailure, e);\n                });\n            }\n        }\n    };\n    RowDD.prototype.reorderRow = function (fromIndexes, toIndex) {\n        var gObj = this.parent;\n        if (!gObj.sortSettings.columns.length && !gObj.groupSettings.columns.length && !gObj.filterSettings.columns.length) {\n            //Todo: drag and drop mapper & BatchChanges                 \n            var skip = gObj.allowPaging ?\n                (gObj.pageSettings.currentPage * gObj.pageSettings.pageSize) - gObj.pageSettings.pageSize : 0;\n            var fromIndex = fromIndexes;\n            toIndex = toIndex + skip;\n            this.selectedRows = gObj.getSelectedRowIndexes();\n            gObj.notify(events.rowPositionChanged, {\n                fromIndex: fromIndexes + skip,\n                toIndex: toIndex\n            });\n        }\n    };\n    RowDD.prototype.enableAfterRender = function (e) {\n        if (e.module === this.getModuleName() && e.enable) {\n            this.initializeDrag();\n        }\n    };\n    /**\n     * To destroy the print\n     * @return {void}\n     * @hidden\n     */\n    RowDD.prototype.destroy = function () {\n        var gridElement = this.parent.element;\n        if (this.parent.isDestroyed || !gridElement || (!gridElement.querySelector('.e-gridheader') &&\n            !gridElement.querySelector('.e-gridcontent'))) {\n            return;\n        }\n        this.draggable.destroy();\n        this.parent.off(events.initialEnd, this.initializeDrag);\n        this.parent.off(events.columnDrop, this.columnDrop);\n        this.parent.removeEventListener(events.dataBound, this.onDataBoundFn);\n        this.parent.off(events.uiUpdate, this.enableAfterRender);\n        //destory ejdrag and drop\n    };\n    /**\n     * For internal use only - Get the module name.\n     * @private\n     */\n    RowDD.prototype.getModuleName = function () {\n        return 'rowDragAndDrop';\n    };\n    RowDD.prototype.processArgs = function (target) {\n        var gObj = this.parent;\n        if ((gObj.getSelectedRecords().length > 0 && this.startedRow.cells[0].classList.contains('e-selectionbackground') === false)\n            || gObj.getSelectedRecords().length === 0) {\n            this.rows = [this.startedRow];\n            this.rowData = [this.parent.getRowInfo((this.startedRow).querySelector('.e-rowcell')).rowData];\n        }\n        else {\n            this.rows = gObj.getSelectedRows();\n            this.rowData = gObj.getSelectedRecords();\n        }\n    };\n    return RowDD;\n}());\nexport { RowDD };\n"]},"metadata":{},"sourceType":"module"}