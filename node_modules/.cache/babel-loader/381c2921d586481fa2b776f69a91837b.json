{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport { remove, createElement, closest, formatUnit, Browser, extend } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, removeClass } from '@syncfusion/ej2-base';\nimport { DataManager } from '@syncfusion/ej2-data';\nimport { dataReady, modelChanged, refreshVirtualBlock, contentReady } from '../base/constant';\nimport * as events from '../base/constant';\nimport { RenderType } from '../base/enum';\nimport { ContentRender } from './content-renderer';\nimport { HeaderRender } from './header-renderer';\nimport { InterSectionObserver } from '../services/intersection-observer';\nimport { VirtualRowModelGenerator } from '../services/virtual-row-model-generator';\nimport { isGroupAdaptive, getTransformValues, ensureLastRow, ensureFirstRow, getEditedDataIndex, getScrollBarWidth } from '../base/util';\nimport { isBlazor, setStyleAttribute } from '@syncfusion/ej2-base';\n/**\n * VirtualContentRenderer\n * @hidden\n */\n\nvar VirtualContentRenderer =\n/** @class */\nfunction (_super) {\n  __extends(VirtualContentRenderer, _super);\n\n  function VirtualContentRenderer(parent, locator) {\n    var _this = _super.call(this, parent, locator) || this;\n\n    _this.prevHeight = 0;\n    /** @hidden */\n\n    _this.startIndex = 0;\n    _this.preStartIndex = 0;\n    _this.preventEvent = false;\n    _this.actions = ['filtering', 'searching', 'grouping', 'ungrouping'];\n    _this.offsets = {};\n    _this.tmpOffsets = {};\n    /** @hidden */\n\n    _this.virtualEle = new VirtualElementHandler();\n    _this.offsetKeys = [];\n    _this.isFocused = false;\n    _this.isSelection = false;\n    _this.isBottom = false;\n    _this.rndrCount = 0;\n    _this.empty = undefined;\n    _this.isCancel = false;\n    _this.requestTypes = ['beginEdit', 'cancel', 'delete', 'add', 'save'];\n    _this.isNormaledit = _this.parent.editSettings.mode === 'Normal';\n    _this.virtualData = {};\n    _this.emptyRowData = {};\n    _this.vfColIndex = [];\n    _this.locator = locator;\n\n    _this.eventListener('on');\n\n    _this.parent.on(events.columnVisibilityChanged, _this.setVisible, _this);\n\n    _this.vgenerator = _this.generator;\n    return _this;\n  }\n\n  VirtualContentRenderer.prototype.renderTable = function () {\n    this.header = this.locator.getService('rendererFactory').getRenderer(RenderType.Header);\n\n    _super.prototype.renderTable.call(this);\n\n    this.virtualEle.table = this.getTable();\n    this.virtualEle.content = this.content = this.getPanel().querySelector('.e-content');\n    var minHeight = this.parent.height;\n\n    if (this.parent.getFrozenColumns() && this.parent.height.toString().indexOf('%') < 0) {\n      minHeight = parseInt(this.parent.height, 10) - getScrollBarWidth();\n    }\n\n    this.virtualEle.renderWrapper(minHeight);\n    this.virtualEle.renderPlaceHolder();\n\n    if (!this.parent.getFrozenColumns()) {\n      this.virtualEle.wrapper.style.position = 'absolute';\n    }\n\n    var debounceEvent = this.parent.dataSource instanceof DataManager && !this.parent.dataSource.dataSource.offline;\n    var content = this.parent.getFrozenColumns() ? this.parent.getMovableVirtualContent() : this.content;\n    var opt = {\n      container: content,\n      pageHeight: this.getBlockHeight() * 2,\n      debounceEvent: debounceEvent,\n      axes: this.parent.enableColumnVirtualization ? ['X', 'Y'] : ['Y']\n    };\n    this.observer = new InterSectionObserver(this.virtualEle.wrapper, opt);\n  };\n\n  VirtualContentRenderer.prototype.renderEmpty = function (tbody) {\n    this.getTable().appendChild(tbody);\n    this.virtualEle.adjustTable(0, 0);\n  };\n\n  VirtualContentRenderer.prototype.refreshMvTbalTransform = function () {\n    var mCont = this.parent.getMovableVirtualContent();\n    var fCont = this.parent.getFrozenVirtualContent();\n    var mContTV = getTransformValues(mCont.firstElementChild);\n    var fContTV = getTransformValues(fCont.firstElementChild);\n    var top = mCont.scrollTop;\n\n    if (top > 0 && mContTV.height !== fContTV.height) {\n      mCont.firstElementChild.style.transform = \"translate(\" + mContTV.width + \"px, \" + fContTV.height + \"px)\";\n    }\n  };\n\n  VirtualContentRenderer.prototype.scrollListener = function (scrollArgs) {\n    this.scrollAfterEdit();\n\n    if (this.parent.enablePersistence) {\n      this.parent.scrollPosition = scrollArgs.offset;\n    }\n\n    if (this.preventEvent || this.parent.isDestroyed) {\n      this.preventEvent = false;\n      return;\n    }\n\n    if (isNullOrUndefined(document.activeElement)) {\n      this.isFocused = false;\n    } else {\n      this.isFocused = this.content === closest(document.activeElement, '.e-content') || this.content === document.activeElement;\n    }\n\n    if (this.parent.enableColumnVirtualization && this.parent.getFrozenColumns() && scrollArgs.sentinel.axis === 'X') {\n      this.refreshMvTbalTransform();\n    }\n\n    var info = scrollArgs.sentinel;\n    var pStartIndex = this.preStartIndex;\n    var previousColIndexes = this.parent.getColumnIndexesInView();\n    var viewInfo = this.currentInfo = this.getInfoFromView(scrollArgs.direction, info, scrollArgs.offset);\n\n    if (isBlazor() && this.parent.isServerRendered && this.parent.enableColumnVirtualization && JSON.stringify(previousColIndexes) !== JSON.stringify(viewInfo.columnIndexes)) {\n      this.parent.refreshHeader();\n      var translateX = this.getColumnOffset(this.startColIndex - 1);\n      var width = this.getColumnOffset(this.endColIndex - 1) - translateX + '';\n      this.parent.notify('refresh-virtual-indices', {\n        requestType: 'virtualscroll',\n        startColumnIndex: viewInfo.columnIndexes[0],\n        endColumnIndex: viewInfo.columnIndexes[viewInfo.columnIndexes.length - 1],\n        axis: 'X',\n        VTablewidth: width,\n        translateX: this.getColumnOffset(viewInfo.columnIndexes[0] - 1)\n      });\n      this.parent.notify('setcolumnstyles', {});\n    }\n\n    if (isGroupAdaptive(this.parent) && !isBlazor()) {\n      if (info.axis === 'Y' && viewInfo.blockIndexes && this.prevInfo.blockIndexes.toString() === viewInfo.blockIndexes.toString() && scrollArgs.direction === 'up' && viewInfo.blockIndexes[viewInfo.blockIndexes.length - 1] !== 2) {\n        return;\n      } else {\n        viewInfo.event = 'refresh-virtual-block';\n\n        if (!isNullOrUndefined(viewInfo.offsets)) {\n          viewInfo.offsets.top = this.content.scrollTop;\n        }\n\n        this.parent.notify(viewInfo.event, {\n          requestType: 'virtualscroll',\n          virtualInfo: viewInfo,\n          focusElement: scrollArgs.focusElement\n        });\n        return;\n      }\n    }\n\n    if (!isBlazor() || isBlazor() && !this.parent.isServerRendered) {\n      if (this.prevInfo && (info.axis === 'Y' && this.prevInfo.blockIndexes.toString() === viewInfo.blockIndexes.toString() || info.axis === 'X' && this.prevInfo.columnIndexes.toString() === viewInfo.columnIndexes.toString())) {\n        if (Browser.isIE) {\n          this.parent.hideSpinner();\n        }\n\n        this.requestType = this.requestType === 'virtualscroll' ? this.empty : this.requestType;\n        this.restoreEdit();\n        return;\n      }\n    }\n\n    this.parent.setColumnIndexesInView(this.parent.enableColumnVirtualization ? viewInfo.columnIndexes : []);\n\n    if (!isBlazor() || isBlazor() && !this.parent.isServerRendered) {\n      this.parent.pageSettings.currentPage = viewInfo.loadNext && !viewInfo.loadSelf ? viewInfo.nextInfo.page : viewInfo.page;\n    } else if (isBlazor() && this.parent.isServerRendered && this.preStartIndex !== pStartIndex && this.parent.pageSettings.currentPage === viewInfo.currentPage) {\n      this.parent.notify('refresh-virtual-indices', {\n        requestType: 'virtualscroll',\n        virtualStartIndex: viewInfo.startIndex,\n        virtualEndIndex: viewInfo.endIndex,\n        axis: 'Y',\n        RHeight: this.parent.getRowHeight()\n      });\n    }\n\n    if (this.parent.getFrozenColumns() && this.parent.enableColumnVirtualization) {\n      var lastPage = Math.ceil(this.getTotalBlocks() / 2);\n\n      if (this.parent.pageSettings.currentPage === lastPage && scrollArgs.sentinel.axis === 'Y') {\n        this.rndrCount++;\n      }\n\n      if (scrollArgs.sentinel.axis === 'Y') {\n        if (this.parent.pageSettings.currentPage === lastPage && this.rndrCount > 1) {\n          this.rndrCount = 0;\n          return;\n        } else if (this.parent.pageSettings.currentPage !== lastPage && this.parent.pageSettings.currentPage !== lastPage - 1) {\n          this.rndrCount = 0;\n        }\n      }\n    }\n\n    if (!isBlazor() || isBlazor() && !this.parent.isServerRendered) {\n      this.requestType = 'virtualscroll';\n      this.parent.notify(viewInfo.event, {\n        requestType: 'virtualscroll',\n        virtualInfo: viewInfo,\n        focusElement: scrollArgs.focusElement\n      });\n    } else if (this.preStartIndex !== pStartIndex && this.parent.pageSettings.currentPage !== viewInfo.currentPage) {\n      this.parent.pageSettings.currentPage = viewInfo.currentPage;\n      this.parent.notify(viewInfo.event, {\n        requestType: 'virtualscroll',\n        virtualStartIndex: viewInfo.startIndex,\n        virtualEndIndex: viewInfo.endIndex,\n        axis: 'Y',\n        RHeight: this.parent.getRowHeight()\n      });\n    }\n  };\n\n  VirtualContentRenderer.prototype.block = function (blk) {\n    return this.vgenerator.isBlockAvailable(blk);\n  };\n\n  VirtualContentRenderer.prototype.getInfoFromView = function (direction, info, e) {\n    var isBlockAdded = false;\n    var tempBlocks = [];\n    var infoType = {\n      direction: direction,\n      sentinelInfo: info,\n      offsets: e,\n      startIndex: this.preStartIndex,\n      endIndex: this.preEndIndex\n    };\n    var vHeight = this.parent.height.toString().indexOf('%') < 0 ? this.content.getBoundingClientRect().height : this.parent.element.getBoundingClientRect().height;\n    infoType.page = this.getPageFromTop(e.top, infoType);\n    infoType.blockIndexes = tempBlocks = this.vgenerator.getBlockIndexes(infoType.page);\n    infoType.loadSelf = !this.vgenerator.isBlockAvailable(tempBlocks[infoType.block]);\n    var blocks = this.ensureBlocks(infoType);\n\n    if (this.activeKey === 'upArrow' && infoType.blockIndexes.toString() !== blocks.toString()) {\n      // To avoid dupilcate row index problem in key focus support\n      var newBlock = blocks[blocks.length - 1];\n\n      if (infoType.blockIndexes.indexOf(newBlock) === -1) {\n        isBlockAdded = true;\n      }\n    }\n\n    infoType.blockIndexes = blocks;\n    infoType.loadNext = !blocks.filter(function (val) {\n      return tempBlocks.indexOf(val) === -1;\n    }).every(this.block.bind(this));\n    infoType.event = infoType.loadNext || infoType.loadSelf ? modelChanged : refreshVirtualBlock;\n    infoType.nextInfo = infoType.loadNext ? {\n      page: Math.max(1, infoType.page + (direction === 'down' ? 1 : -1))\n    } : {};\n\n    if (isBlockAdded) {\n      infoType.blockIndexes = [infoType.blockIndexes[0] - 1, infoType.blockIndexes[0], infoType.blockIndexes[0] + 1];\n    }\n\n    if (this.activeKey === 'downArrow') {\n      var firstBlock = Math.ceil(this.rowIndex / this.getBlockSize());\n\n      if (firstBlock !== 1 && (infoType.blockIndexes[1] !== firstBlock || infoType.blockIndexes.length < 3)) {\n        infoType.blockIndexes = [firstBlock - 1, firstBlock, firstBlock + 1];\n      }\n    }\n\n    infoType.columnIndexes = info.axis === 'X' ? this.vgenerator.getColumnIndexes() : this.parent.getColumnIndexesInView();\n\n    if (this.parent.enableColumnVirtualization && info.axis === 'X') {\n      infoType.event = refreshVirtualBlock;\n    }\n\n    if (isBlazor() && this.parent.isServerRendered) {\n      var rowHeight = this.parent.getRowHeight();\n      var exactTopIndex = e.top / rowHeight;\n      var noOfInViewIndexes = vHeight / rowHeight;\n      var exactEndIndex = exactTopIndex + noOfInViewIndexes;\n      var pageSizeBy4 = this.parent.pageSettings.pageSize / 4;\n\n      if (infoType.direction === 'down') {\n        var sIndex = Math.round(exactEndIndex) - Math.round(pageSizeBy4);\n\n        if (isNullOrUndefined(infoType.startIndex) || exactEndIndex > infoType.startIndex + Math.round(this.parent.pageSettings.pageSize / 2 + pageSizeBy4) && infoType.endIndex !== this.count) {\n          infoType.startIndex = sIndex >= 0 ? Math.round(sIndex) : 0;\n          infoType.startIndex = infoType.startIndex > exactTopIndex ? Math.floor(exactTopIndex) : infoType.startIndex;\n          var eIndex = infoType.startIndex + this.parent.pageSettings.pageSize;\n          infoType.startIndex = eIndex < exactEndIndex ? Math.ceil(exactEndIndex) - this.parent.pageSettings.pageSize : infoType.startIndex;\n          infoType.endIndex = eIndex < this.count ? eIndex : this.count;\n          infoType.startIndex = eIndex >= this.count ? infoType.endIndex - this.parent.pageSettings.pageSize : infoType.startIndex;\n          infoType.currentPage = Math.ceil(infoType.endIndex / this.parent.pageSettings.pageSize);\n          this.setKeyboardNavIndex();\n        }\n      } else if (infoType.direction === 'up') {\n        if (infoType.startIndex && infoType.endIndex) {\n          var loadAtIndex = Math.round((infoType.startIndex * rowHeight + pageSizeBy4 * rowHeight) / rowHeight);\n\n          if (exactTopIndex < loadAtIndex) {\n            var idxAddedToExactTop = pageSizeBy4 > noOfInViewIndexes ? pageSizeBy4 : noOfInViewIndexes + noOfInViewIndexes / 4;\n            var eIndex = Math.round(exactTopIndex + idxAddedToExactTop);\n            infoType.endIndex = eIndex < this.count ? eIndex : this.count;\n            var sIndex = infoType.endIndex - this.parent.pageSettings.pageSize;\n            infoType.startIndex = sIndex > 0 ? sIndex : 0;\n            infoType.endIndex = sIndex < 0 ? this.parent.pageSettings.pageSize : infoType.endIndex;\n            infoType.currentPage = Math.ceil(infoType.startIndex / this.parent.pageSettings.pageSize);\n            this.setKeyboardNavIndex();\n          }\n        }\n      }\n\n      this.preStartIndex = this.startIndex = infoType.startIndex;\n      this.preEndIndex = infoType.endIndex;\n      infoType.event = infoType.currentPage !== this.parent.pageSettings.currentPage ? modelChanged : refreshVirtualBlock;\n    }\n\n    return infoType;\n  };\n\n  VirtualContentRenderer.prototype.setKeyboardNavIndex = function () {\n    this.blazorDataLoad = true;\n\n    if (this.activeKey === 'downArrow' || this.activeKey === 'upArrow') {\n      this.blzRowIndex = this.activeKey === 'downArrow' ? this.rowIndex + 1 : this.rowIndex - 1;\n      document.activeElement.blur();\n    }\n  };\n\n  VirtualContentRenderer.prototype.ensureBlocks = function (info) {\n    var _this = this;\n\n    var index = info.blockIndexes[info.block];\n    var mIdx;\n    var old = index;\n    var max = Math.max;\n    var indexes = info.direction === 'down' ? [max(index, 1), ++index, ++index] : [max(index - 1, 1), index, index + 1];\n\n    if (this.parent.enableColumnVirtualization && this.parent.getFrozenColumns()) {\n      if (info.sentinelInfo.axis === 'X' || info.sentinelInfo.axis === 'Y' && info.page === this.prevInfo.page) {\n        indexes = this.prevInfo.blockIndexes;\n      }\n    }\n\n    indexes = indexes.filter(function (val, ind) {\n      return indexes.indexOf(val) === ind;\n    });\n\n    if (this.prevInfo.blockIndexes.toString() === indexes.toString()) {\n      return indexes;\n    }\n\n    if (info.loadSelf || info.direction === 'down' && this.isEndBlock(old)) {\n      indexes = this.vgenerator.getBlockIndexes(info.page);\n    }\n\n    indexes.some(function (val, ind) {\n      var result = val === (isGroupAdaptive(_this.parent) ? _this.getGroupedTotalBlocks() : _this.getTotalBlocks());\n\n      if (result) {\n        mIdx = ind;\n      }\n\n      return result;\n    });\n\n    if (mIdx !== undefined) {\n      indexes = indexes.slice(0, mIdx + 1);\n\n      if (info.block === 0 && indexes.length === 1 && this.vgenerator.isBlockAvailable(indexes[0] - 1)) {\n        indexes = [indexes[0] - 1, indexes[0]];\n      }\n    }\n\n    return indexes;\n  };\n  /**\n   * @hidden\n   */\n\n\n  VirtualContentRenderer.prototype.vfTblTransform = function (info, left, top, e, cOffset, translate) {\n    var lastPage = Math.ceil(this.getTotalBlocks() / 2);\n    var isLastPage = lastPage === this.parent.pageSettings.currentPage && this.parent.enableColumnVirtualization;\n    var wrappers = [].slice.call(this.parent.getContent().querySelectorAll('.e-virtualtable'));\n\n    for (var i = 0; i < wrappers.length; i++) {\n      if (i === 0 && e.requestType === 'virtualscroll' && info.sentinelInfo.axis === 'X') {\n        continue;\n      }\n\n      if (lastPage !== this.parent.pageSettings.currentPage && this.parent.enableColumnVirtualization && (left > 0 || top > 0 && left === 0)) {\n        continue;\n      }\n\n      var cOff = isLastPage && i === 0 ? 0 : cOffset;\n      this.virtualEle.wrapper = wrappers[i];\n      this.virtualEle.adjustTable(cOff, translate);\n    }\n  }; // tslint:disable-next-line:max-func-body-length\n\n\n  VirtualContentRenderer.prototype.appendContent = function (target, newChild, e) {\n    var _this = this; // currentInfo value will be used if there are multiple dom updates happened due to mousewheel\n\n\n    var colVFtable = this.parent.enableColumnVirtualization && this.parent.getFrozenColumns() !== 0;\n    this.checkFirstBlockColIndexes(e);\n    var info = e.virtualInfo.sentinelInfo && e.virtualInfo.sentinelInfo.axis === 'Y' && this.currentInfo.page && this.currentInfo.page !== e.virtualInfo.page ? this.currentInfo : e.virtualInfo;\n    this.prevInfo = this.prevInfo || e.virtualInfo;\n    var cBlock = info.columnIndexes[0] - 1;\n\n    if (colVFtable && info.columnIndexes[0] === this.parent.getFrozenColumns()) {\n      cBlock = info.columnIndexes[0] - this.parent.getFrozenColumns() - 1;\n    }\n\n    var cOffset = this.getColumnOffset(cBlock);\n    var width;\n    var blocks = info.blockIndexes;\n\n    if (this.parent.groupSettings.columns.length) {\n      this.refreshOffsets();\n    }\n\n    if (this.parent.height === '100%') {\n      this.parent.element.style.height = '100%';\n    }\n\n    var vHeight = this.parent.height.toString().indexOf('%') < 0 ? this.content.getBoundingClientRect().height : this.parent.element.getBoundingClientRect().height;\n    var translate = 0;\n\n    if (this.parent.getFrozenColumns()) {\n      var mCont = this.parent.getMovableVirtualContent();\n      var left = mCont.scrollLeft;\n      var top_1 = mCont.scrollTop;\n      translate = this.getTranslateY(mCont.scrollTop, vHeight, info);\n      this.vfTblTransform(info, left, top_1, e, cOffset, translate);\n    } else {\n      if (!this.requestTypes.some(function (value) {\n        return value === _this.requestType;\n      })) {\n        translate = this.getTranslateY(this.content.scrollTop, vHeight, info);\n        this.virtualEle.adjustTable(cOffset, translate);\n      }\n    }\n\n    if (this.parent.enableColumnVirtualization && !this.parent.getFrozenColumns()) {\n      this.header.virtualEle.adjustTable(cOffset, 0);\n    }\n\n    if (this.parent.enableColumnVirtualization) {\n      var cIndex = info.columnIndexes;\n      width = this.getColumnOffset(cIndex[cIndex.length - 1]) - this.getColumnOffset(cIndex[0] - 1) + '';\n      this.header.virtualEle.setWrapperWidth(width);\n    }\n\n    this.virtualEle.setWrapperWidth(width, Browser.isIE || Browser.info.name === 'edge');\n\n    if (!isNullOrUndefined(target.parentNode)) {\n      remove(target);\n    }\n\n    var tbody;\n\n    if (this.parent.getFrozenColumns() && !e.renderMovableContent) {\n      tbody = this.parent.getFrozenVirtualContent().querySelector('tbody');\n    } else if (this.parent.getFrozenColumns() && e.renderMovableContent) {\n      tbody = this.parent.getMovableVirtualContent().querySelector('tbody');\n    } else {\n      tbody = this.parent.element.querySelector('.e-content').querySelector('tbody');\n    }\n\n    if (tbody) {\n      remove(tbody);\n      target = null;\n    }\n\n    target = this.parent.createElement('tbody');\n    target.appendChild(newChild);\n\n    if (this.parent.frozenRows && e.requestType === 'virtualscroll' && this.parent.pageSettings.currentPage === 1) {\n      for (var i = 0; i < this.parent.frozenRows; i++) {\n        target.children[0].remove();\n      }\n    }\n\n    if (this.parent.getFrozenColumns()) {\n      if (!e.renderMovableContent) {\n        this.parent.getFrozenVirtualContent().querySelector('.e-table').appendChild(target);\n      } else {\n        this.parent.getMovableVirtualContent().querySelector('.e-table').appendChild(target);\n        this.requestType = this.requestType === 'virtualscroll' ? this.empty : this.requestType;\n      }\n\n      if (this.vfColIndex.length) {\n        e.virtualInfo.columnIndexes = info.columnIndexes = extend([], this.vfColIndex);\n        this.vfColIndex = e.renderMovableContent ? [] : this.vfColIndex;\n      }\n    } else {\n      this.getTable().appendChild(target);\n      this.requestType = this.requestType === 'virtualscroll' ? this.empty : this.requestType;\n    }\n\n    if (this.parent.groupSettings.columns.length) {\n      if (!isGroupAdaptive(this.parent) && info.direction === 'up') {\n        var blk = this.offsets[this.getTotalBlocks()] - this.prevHeight;\n        this.preventEvent = true;\n        var sTop = this.content.scrollTop;\n        this.content.scrollTop = sTop + blk;\n      }\n\n      this.setVirtualHeight();\n      this.observer.setPageHeight(this.getOffset(blocks[blocks.length - 1]) - this.getOffset(blocks[0] - 1));\n    }\n\n    this.prevInfo = info;\n\n    if (this.isFocused && this.activeKey !== 'downArrow' && this.activeKey !== 'upArrow') {\n      this.content.focus();\n    }\n\n    var lastPage = Math.ceil(this.getTotalBlocks() / 2);\n\n    if (this.isBottom) {\n      this.isBottom = false;\n      this.parent.getContent().firstElementChild.scrollTop = this.offsets[this.offsetKeys.length - 1];\n    }\n\n    if (this.parent.pageSettings.currentPage === lastPage && blocks.length === 1) {\n      this.isBottom = true;\n      this.parent.getContent().firstElementChild.scrollTop = this.offsets[this.offsetKeys.length - 2];\n    }\n\n    if (this.parent.enableColumnVirtualization && this.parent.getFrozenColumns() && e.requestType === 'virtualscroll' && e.virtualInfo.sentinelInfo.axis === 'X') {\n      this.refreshMvTbalTransform();\n    }\n\n    if (e.requestType === 'virtualscroll' && e.virtualInfo.sentinelInfo.axis === 'X') {\n      this.parent.notify(events.autoCol, {});\n    }\n\n    this.focusCell(e);\n    this.restoreEdit();\n    this.restoreAdd();\n  };\n\n  VirtualContentRenderer.prototype.checkFirstBlockColIndexes = function (e) {\n    if (this.parent.enableColumnVirtualization && this.parent.getFrozenColumns() && e.virtualInfo.columnIndexes[0] === 0) {\n      var indexes = [];\n\n      if (!e.renderMovableContent && e.virtualInfo.columnIndexes.length > this.parent.getFrozenColumns()) {\n        this.vfColIndex = e.virtualInfo.columnIndexes;\n\n        for (var i = 0; i < this.parent.getFrozenColumns(); i++) {\n          indexes.push(i);\n        }\n\n        e.virtualInfo.columnIndexes = indexes;\n      } else if (e.renderMovableContent) {\n        if (!this.vfColIndex.length) {\n          this.vfColIndex = extend([], e.virtualInfo.columnIndexes);\n        }\n\n        e.virtualInfo.columnIndexes = extend([], this.vfColIndex);\n        e.virtualInfo.columnIndexes.splice(0, this.parent.getFrozenColumns());\n      }\n    }\n  };\n\n  VirtualContentRenderer.prototype.focusCell = function (e) {\n    if (this.activeKey !== 'upArrow' && this.activeKey !== 'downArrow') {\n      return;\n    }\n\n    var row = this.parent.getRowByIndex(this.rowIndex); // tslint:disable-next-line:no-any\n\n    var cell = row.cells[this.cellIndex];\n    cell.focus({\n      preventScroll: true\n    });\n    this.parent.selectRow(parseInt(row.getAttribute('aria-rowindex'), 10));\n    this.activeKey = this.empty;\n  };\n\n  VirtualContentRenderer.prototype.restoreEdit = function () {\n    if (this.isNormaledit) {\n      if (this.parent.editSettings.allowEditing && this.parent.editModule && !isNullOrUndefined(this.editedRowIndex)) {\n        var row = this.getRowByIndex(this.editedRowIndex);\n\n        if (Object.keys(this.virtualData).length && row && !this.content.querySelector('.e-editedrow')) {\n          var top_2 = row.getBoundingClientRect().top;\n\n          if (top_2 < this.content.offsetHeight && top_2 > this.parent.getRowHeight()) {\n            this.parent.isEdit = false;\n            this.parent.editModule.startEdit(row);\n          }\n        }\n\n        if (row && this.content.querySelector('.e-editedrow') && !Object.keys(this.virtualData).length) {\n          var rowData = extend({}, this.getRowObjectByIndex(this.editedRowIndex));\n          this.virtualData = this.getVirtualEditedData(rowData);\n        }\n      }\n\n      this.restoreAdd();\n    }\n  };\n\n  VirtualContentRenderer.prototype.getVirtualEditedData = function (rowData) {\n    var editForm = this.content.querySelector('.e-gridform');\n    return this.parent.editModule.getCurrentEditedData(editForm, rowData);\n  };\n\n  VirtualContentRenderer.prototype.restoreAdd = function () {\n    if (this.isNormaledit && this.isAdd && !this.content.querySelector('.e-addedrow')) {\n      var isTop = this.parent.editSettings.newRowPosition === 'Top' && this.content.scrollTop < this.parent.getRowHeight();\n      var isBottom = this.parent.editSettings.newRowPosition === 'Bottom' && this.parent.pageSettings.currentPage === this.maxPage;\n\n      if (isTop || isBottom) {\n        this.parent.isEdit = false;\n        this.parent.addRecord();\n      }\n    }\n  };\n\n  VirtualContentRenderer.prototype.onDataReady = function (e) {\n    if (!isNullOrUndefined(e.count)) {\n      this.count = e.count;\n      this.maxPage = Math.ceil(e.count / this.parent.pageSettings.pageSize);\n    }\n\n    this.vgenerator.checkAndResetCache(e.requestType);\n\n    if (['refresh', 'filtering', 'searching', 'grouping', 'ungrouping', 'reorder', undefined].some(function (value) {\n      return e.requestType === value;\n    })) {\n      this.refreshOffsets();\n    }\n\n    if (this.parent.getFrozenColumns() && this.parent.enableColumnVirtualization) {\n      var hdrTbls = [].slice.call(this.parent.getHeaderContent().querySelectorAll('.e-table'));\n      this.header.virtualEle.table = hdrTbls[1];\n    }\n\n    this.setVirtualHeight();\n    this.resetScrollPosition(e.requestType);\n  };\n  /** @hidden */\n\n\n  VirtualContentRenderer.prototype.setVirtualHeight = function (height) {\n    var width = this.parent.enableColumnVirtualization ? this.getColumnOffset(this.parent.columns.length + this.parent.groupSettings.columns.length - 1) + 'px' : '100%';\n\n    if (this.parent.getFrozenColumns()) {\n      var virtualHeightTemp = this.parent.pageSettings.currentPage === 1 && Object.keys(this.offsets).length <= 2 ? this.offsets[1] : this.offsets[this.getTotalBlocks() - 2];\n      var scrollableElementHeight = this.parent.getMovableVirtualContent().clientHeight;\n      virtualHeightTemp = virtualHeightTemp > scrollableElementHeight ? virtualHeightTemp : 0;\n      var fTblWidth = this.parent.enableColumnVirtualization ? 'auto' : width;\n      this.virtualEle.placeholder = this.parent.getFrozenVirtualContent().querySelector('.e-virtualtrack'); // To overcome the white space issue in last page (instead of position absolute)\n\n      this.virtualEle.setVirtualHeight(virtualHeightTemp, fTblWidth);\n      this.virtualEle.placeholder = this.parent.getMovableVirtualContent().querySelector('.e-virtualtrack'); // To overcome the white space issue in last page (instead of position absolute)\n\n      this.virtualEle.setVirtualHeight(virtualHeightTemp, width);\n    } else {\n      var virtualHeight = isBlazor() && this.parent.isServerRendered && this.parent.groupSettings.columns.length && height ? height : this.offsets[isGroupAdaptive(this.parent) ? this.getGroupedTotalBlocks() : this.getTotalBlocks()];\n      this.virtualEle.setVirtualHeight(virtualHeight, width);\n    }\n\n    if (this.parent.enableColumnVirtualization) {\n      this.header.virtualEle.setVirtualHeight(1, width);\n    }\n  };\n\n  VirtualContentRenderer.prototype.getPageFromTop = function (sTop, info) {\n    var _this = this;\n\n    var total = isGroupAdaptive(this.parent) ? this.getGroupedTotalBlocks() : this.getTotalBlocks();\n    var page = 0;\n    var extra = this.offsets[total] - this.prevHeight;\n    this.offsetKeys.some(function (offset) {\n      var iOffset = Number(offset);\n      var border = sTop <= _this.offsets[offset] || iOffset === total && sTop > _this.offsets[offset];\n\n      if (border) {\n        if (_this.offsetKeys.length % 2 !== 0 && iOffset.toString() === _this.offsetKeys[_this.offsetKeys.length - 2] && sTop <= _this.offsets[_this.offsetKeys.length - 1]) {\n          iOffset = iOffset + 1;\n        }\n\n        info.block = iOffset % 2 === 0 ? 1 : 0;\n        page = Math.max(1, Math.min(_this.vgenerator.getPage(iOffset), _this.maxPage));\n      }\n\n      return border;\n    });\n    return page;\n  };\n\n  VirtualContentRenderer.prototype.getTranslateY = function (sTop, cHeight, info, isOnenter) {\n    if (info === undefined) {\n      info = {\n        page: this.getPageFromTop(sTop, {})\n      };\n      info.blockIndexes = this.vgenerator.getBlockIndexes(info.page);\n    }\n\n    var block = (info.blockIndexes[0] || 1) - 1;\n    var translate = this.getOffset(block);\n    var endTranslate = this.getOffset(info.blockIndexes[info.blockIndexes.length - 1]);\n\n    if (isOnenter) {\n      info = this.prevInfo;\n    }\n\n    var result = translate > sTop ? this.getOffset(block - 1) : endTranslate < sTop + cHeight ? this.getOffset(block + 1) : translate;\n    var blockHeight = this.offsets[info.blockIndexes[info.blockIndexes.length - 1]] - this.tmpOffsets[info.blockIndexes[0]];\n\n    if (result + blockHeight > this.offsets[isGroupAdaptive(this.parent) ? this.getGroupedTotalBlocks() : this.getTotalBlocks()]) {\n      result -= result + blockHeight - this.offsets[this.getTotalBlocks()];\n    }\n\n    return result;\n  };\n\n  VirtualContentRenderer.prototype.getOffset = function (block) {\n    return Math.min(this.offsets[block] | 0, this.offsets[this.maxBlock] | 0);\n  };\n\n  VirtualContentRenderer.prototype.onEntered = function () {\n    var _this = this;\n\n    return function (element, current, direction, e, isWheel, check) {\n      if (Browser.isIE && !isWheel && check && !_this.preventEvent) {\n        _this.parent.showSpinner();\n      }\n\n      var xAxis = current.axis === 'X';\n      var top = _this.prevInfo.offsets ? _this.prevInfo.offsets.top : null;\n\n      var height = _this.content.getBoundingClientRect().height;\n\n      var x = _this.getColumnOffset(xAxis ? _this.vgenerator.getColumnIndexes()[0] - 1 : _this.prevInfo.columnIndexes[0] - 1);\n\n      var y = _this.getTranslateY(e.top, height, xAxis && top === e.top ? _this.prevInfo : undefined, true);\n\n      if (isBlazor() && _this.parent.isServerRendered && _this.currentInfo && _this.currentInfo.startIndex && xAxis) {\n        y = _this.currentInfo.startIndex * _this.parent.getRowHeight();\n      }\n\n      _this.virtualEle.adjustTable(x, Math.min(y, _this.offsets[_this.maxBlock]));\n\n      if (isBlazor() && _this.parent.isServerRendered && xAxis) {\n        _this.parent.notify('setcolumnstyles', {\n          refresh: true\n        });\n      }\n\n      if (_this.parent.getFrozenColumns() && !xAxis) {\n        var left = _this.parent.getMovableVirtualContent().scrollLeft;\n\n        if (_this.parent.enableColumnVirtualization && left > 0) {\n          var fvTable = _this.parent.getFrozenVirtualContent().querySelector('.e-virtualtable');\n\n          fvTable.style.transform = \"translate(\" + 0 + \"px, \" + Math.min(y, _this.offsets[_this.maxBlock]) + \"px)\";\n        } else {\n          var fvTable = _this.parent.getFrozenVirtualContent().querySelector('.e-virtualtable');\n\n          fvTable.style.transform = \"translate(\" + x + \"px, \" + Math.min(y, _this.offsets[_this.maxBlock]) + \"px)\";\n        }\n      }\n\n      if (_this.parent.enableColumnVirtualization && (!isBlazor() || isBlazor() && !_this.parent.isServerRendered)) {\n        _this.header.virtualEle.adjustTable(x, 0);\n      }\n    };\n  };\n\n  VirtualContentRenderer.prototype.dataBound = function () {\n    if (this.isSelection && this.activeKey !== 'upArrow' && this.activeKey !== 'downArrow') {\n      this.parent.selectRow(this.selectedRowIndex);\n    } else if (!isBlazor()) {\n      this.activeKey = this.empty;\n    }\n  };\n\n  VirtualContentRenderer.prototype.rowSelected = function () {\n    this.isSelection = false;\n  };\n\n  VirtualContentRenderer.prototype.eventListener = function (action) {\n    var _this = this;\n\n    this.parent[action](dataReady, this.onDataReady, this);\n    this.parent.addEventListener(events.dataBound, this.dataBound.bind(this));\n    this.parent.addEventListener(events.actionBegin, this.actionBegin.bind(this));\n    this.parent.addEventListener(events.actionComplete, this.actionComplete.bind(this));\n    this.parent.addEventListener(events.rowSelected, this.rowSelected.bind(this));\n    this.parent[action](refreshVirtualBlock, this.refreshContentRows, this);\n    this.parent[action](events.selectVirtualRow, this.selectVirtualRow, this);\n    this.parent[action](events.virtaulCellFocus, this.virtualCellFocus, this);\n    this.parent[action](events.virtualScrollEditActionBegin, this.editActionBegin, this);\n    this.parent[action](events.virtualScrollAddActionBegin, this.addActionBegin, this);\n    this.parent[action](events.virtualScrollEdit, this.restoreEdit, this);\n    this.parent[action](events.virtualScrollEditSuccess, this.editSuccess, this);\n    this.parent[action](events.refreshVirtualCache, this.refreshCache, this);\n    this.parent[action](events.editReset, this.resetIsedit, this);\n    this.parent[action](events.getVirtualData, this.getVirtualData, this);\n    this.parent[action](events.virtualScrollEditCancel, this.editCancel, this);\n    var event = this.actions;\n\n    for (var i = 0; i < event.length; i++) {\n      this.parent[action](event[i] + \"-begin\", this.onActionBegin, this);\n    }\n\n    var fn = function () {\n      _this.observer.observe(function (scrollArgs) {\n        return _this.scrollListener(scrollArgs);\n      }, _this.onEntered());\n\n      var gObj = _this.parent;\n\n      if (gObj.enablePersistence && gObj.scrollPosition) {\n        _this.content.scrollTop = gObj.scrollPosition.top;\n        var scrollValues = {\n          direction: 'down',\n          sentinel: _this.observer.sentinelInfo.down,\n          offset: gObj.scrollPosition,\n          focusElement: gObj.element\n        };\n\n        _this.scrollListener(scrollValues);\n\n        if (gObj.enableColumnVirtualization) {\n          _this.content.scrollLeft = gObj.scrollPosition.left;\n        }\n      }\n\n      _this.parent.off(contentReady, fn);\n    };\n\n    this.parent.on(contentReady, fn, this);\n  };\n\n  VirtualContentRenderer.prototype.getVirtualData = function (data) {\n    data.virtualData = this.virtualData;\n    data.isAdd = this.isAdd;\n    data.isCancel = this.isCancel;\n  };\n\n  VirtualContentRenderer.prototype.editCancel = function (args) {\n    var dataIndex = getEditedDataIndex(this.parent, args.data);\n\n    if (!isNullOrUndefined(dataIndex)) {\n      args.data = this.parent.getCurrentViewRecords()[dataIndex];\n    }\n  };\n\n  VirtualContentRenderer.prototype.editSuccess = function (args) {\n    if (this.isNormaledit) {\n      if (!this.isAdd && args.data) {\n        this.updateCurrentViewData(args.data);\n      }\n\n      this.isAdd = false;\n    }\n  };\n\n  VirtualContentRenderer.prototype.updateCurrentViewData = function (data) {\n    var dataIndex = getEditedDataIndex(this.parent, data);\n\n    if (!isNullOrUndefined(dataIndex)) {\n      this.parent.getCurrentViewRecords()[dataIndex] = data;\n    }\n  };\n\n  VirtualContentRenderer.prototype.actionBegin = function (args) {\n    if (args.requestType !== 'virtualscroll') {\n      this.requestType = args.requestType;\n    }\n  };\n\n  VirtualContentRenderer.prototype.virtualCellFocus = function (e) {\n    // To decide the action (select or scroll), when using arrow keys for cell focus\n    var ele = document.activeElement;\n\n    if (ele.classList.contains('e-rowcell') && e && (e.action === 'upArrow' || e.action === 'downArrow')) {\n      var rowIndex = parseInt(ele.parentElement.getAttribute('aria-rowindex'), 10);\n\n      if (e && (e.action === 'downArrow' || e.action === 'upArrow')) {\n        var scrollEle = this.parent.getContent().firstElementChild;\n        e.action === 'downArrow' ? rowIndex += 1 : rowIndex -= 1;\n        this.rowIndex = rowIndex;\n        this.cellIndex = parseInt(ele.getAttribute('aria-colindex'), 10);\n        var row = this.parent.getRowByIndex(rowIndex);\n        var page = this.parent.pageSettings.currentPage;\n        var visibleRowCount = Math.floor(scrollEle.offsetHeight / this.parent.getRowHeight()) - 1;\n        var emptyRow = false;\n\n        if (isNullOrUndefined(row)) {\n          emptyRow = true;\n\n          if (e.action === 'downArrow' && page === this.maxPage - 1 || e.action === 'upArrow' && page === 1) {\n            emptyRow = false;\n          }\n        }\n\n        if (emptyRow || ensureLastRow(row, this.parent) && e.action === 'downArrow' || ensureFirstRow(row, this.parent.getRowHeight() * 2) && e.action === 'upArrow') {\n          this.activeKey = e.action;\n          scrollEle.scrollTop = e.action === 'downArrow' ? (rowIndex - visibleRowCount) * this.parent.getRowHeight() : rowIndex * this.parent.getRowHeight();\n        } else {\n          this.activeKey = this.empty;\n        }\n\n        if (!isBlazor() || isBlazor() && !this.blazorDataLoad) {\n          this.parent.selectRow(rowIndex);\n        }\n      }\n    }\n  };\n\n  VirtualContentRenderer.prototype.editActionBegin = function (e) {\n    this.editedRowIndex = e.index;\n    var rowData = extend({}, this.getRowObjectByIndex(e.index));\n    e.data = Object.keys(this.virtualData).length ? this.virtualData : rowData;\n  };\n\n  VirtualContentRenderer.prototype.refreshCache = function (data) {\n    var block = Math.ceil((this.editedRowIndex + 1) / this.getBlockSize());\n    var index = this.editedRowIndex - (block - 1) * this.getBlockSize();\n    this.vgenerator.cache[block][index].data = data;\n  };\n\n  VirtualContentRenderer.prototype.actionComplete = function (args) {\n    if (args.requestType === 'delete' || args.requestType === 'save' || args.requestType === 'cancel') {\n      this.refreshOffsets();\n      this.refreshVirtualElement();\n\n      if (this.isNormaledit) {\n        if (args.requestType === 'cancel') {\n          this.isCancel = true;\n        }\n\n        this.isAdd = false;\n        this.editedRowIndex = this.empty;\n        this.virtualData = {};\n        this.parent.editModule.previousVirtualData = {};\n      }\n    }\n\n    if (this.parent.enableColumnVirtualization && args.requestType === 'filterafteropen' && this.currentInfo.columnIndexes && this.currentInfo.columnIndexes[0] > 0) {\n      this.parent.resetFilterDlgPosition(args.columnName);\n    }\n  };\n\n  VirtualContentRenderer.prototype.resetIsedit = function () {\n    if (this.parent.enableVirtualization && this.isNormaledit) {\n      if (this.parent.editSettings.allowEditing && Object.keys(this.virtualData).length || this.parent.editSettings.allowAdding && this.isAdd) {\n        this.parent.isEdit = true;\n      }\n    }\n  };\n\n  VirtualContentRenderer.prototype.scrollAfterEdit = function () {\n    if (this.parent.editModule && this.parent.editSettings.allowEditing && this.isNormaledit) {\n      if (this.content.querySelector('.e-gridform')) {\n        var editForm = this.content.querySelector('.e-editedrow');\n        var addForm = this.content.querySelector('.e-addedrow');\n\n        if (editForm || addForm) {\n          var rowData = editForm ? extend({}, this.getRowObjectByIndex(this.editedRowIndex)) : extend({}, this.emptyRowData);\n          this.virtualData = this.getVirtualEditedData(rowData);\n        }\n      }\n    }\n  };\n\n  VirtualContentRenderer.prototype.createEmptyRowdata = function () {\n    var _this = this;\n\n    this.parent.getColumns().filter(function (e) {\n      _this.emptyRowData[e.field] = _this.empty;\n    });\n  };\n\n  VirtualContentRenderer.prototype.addActionBegin = function (args) {\n    if (this.isNormaledit) {\n      if (!Object.keys(this.emptyRowData).length) {\n        this.createEmptyRowdata();\n      }\n\n      this.isAdd = true;\n      var page = this.parent.pageSettings.currentPage;\n\n      if (page > 1 && this.parent.editSettings.newRowPosition === 'Top') {\n        this.isAdd = true;\n        this.onActionBegin();\n        args.startEdit = false;\n        this.content.scrollTop = 0;\n      }\n\n      if (page < this.maxPage - 1 && this.parent.editSettings.newRowPosition === 'Bottom') {\n        this.isAdd = true;\n        this.parent.setProperties({\n          pageSettings: {\n            currentPage: this.maxPage - 1\n          }\n        }, true);\n        args.startEdit = false;\n        this.content.scrollTop = this.offsets[this.offsetKeys.length];\n      }\n    }\n  };\n  /** @hidden */\n\n\n  VirtualContentRenderer.prototype.getRowObjectByIndex = function (index) {\n    var data = this.getRowCollection(index, false, true);\n    return data;\n  };\n\n  VirtualContentRenderer.prototype.getBlockSize = function () {\n    return this.parent.pageSettings.pageSize >> 1;\n  };\n\n  VirtualContentRenderer.prototype.getBlockHeight = function () {\n    return this.getBlockSize() * this.parent.getRowHeight();\n  };\n\n  VirtualContentRenderer.prototype.isEndBlock = function (index) {\n    var totalBlocks = this.getTotalBlocks();\n    return index >= totalBlocks || index === totalBlocks - 1;\n  };\n\n  VirtualContentRenderer.prototype.getGroupedTotalBlocks = function () {\n    var rows = this.parent.vcRows;\n    return Math.floor(rows.length / this.getBlockSize() < 1 ? 1 : rows.length / this.getBlockSize());\n  };\n\n  VirtualContentRenderer.prototype.getTotalBlocks = function () {\n    return Math.ceil(this.count / this.getBlockSize());\n  };\n\n  VirtualContentRenderer.prototype.getColumnOffset = function (block) {\n    return this.vgenerator.cOffsets[block] | 0;\n  };\n\n  VirtualContentRenderer.prototype.getModelGenerator = function () {\n    return new VirtualRowModelGenerator(this.parent);\n  };\n\n  VirtualContentRenderer.prototype.resetScrollPosition = function (action) {\n    if (this.actions.some(function (value) {\n      return value === action;\n    })) {\n      var content = this.parent.getFrozenColumns() ? this.parent.getMovableVirtualContent() : this.content;\n      this.preventEvent = content.scrollTop !== 0;\n      content.scrollTop = 0;\n    }\n\n    if (action !== 'virtualscroll') {\n      this.isAdd = false;\n    }\n  };\n\n  VirtualContentRenderer.prototype.onActionBegin = function (e) {\n    //Update property silently..\n    this.parent.setProperties({\n      pageSettings: {\n        currentPage: 1\n      }\n    }, true);\n  };\n\n  VirtualContentRenderer.prototype.getRows = function () {\n    return this.vgenerator.getRows();\n  };\n\n  VirtualContentRenderer.prototype.getRowByIndex = function (index) {\n    if (isGroupAdaptive(this.parent)) {\n      return this.parent.getDataRows()[index];\n    }\n\n    return this.getRowCollection(index, false);\n  };\n\n  VirtualContentRenderer.prototype.getMovableVirtualRowByIndex = function (index) {\n    return this.getRowCollection(index, true);\n  };\n\n  VirtualContentRenderer.prototype.getRowCollection = function (index, isMovable, isRowObject) {\n    var prev = this.prevInfo.blockIndexes;\n    var startIdx = !isBlazor() || isBlazor() && !this.parent.isServerRendered ? (prev[0] - 1) * this.getBlockSize() : this.startIndex;\n    var rowCollection = isMovable ? this.parent.getMovableDataRows() : this.parent.getDataRows();\n    var collection = isRowObject ? this.parent.getCurrentViewRecords() : rowCollection;\n    var selectedRow = collection[index - startIdx];\n\n    if (!isRowObject && this.parent.frozenRows && this.parent.pageSettings.currentPage > 1) {\n      selectedRow = index <= this.parent.frozenRows ? rowCollection[index] : rowCollection[index - startIdx + this.parent.frozenRows];\n    }\n\n    return selectedRow;\n  };\n\n  VirtualContentRenderer.prototype.getVirtualRowIndex = function (index) {\n    var prev = this.prevInfo.blockIndexes;\n    var startIdx = (prev[0] - 1) * this.getBlockSize();\n    return startIdx + index;\n  };\n  /** @hidden */\n\n\n  VirtualContentRenderer.prototype.refreshOffsets = function () {\n    var gObj = this.parent;\n    var row = 0;\n    var bSize = this.getBlockSize();\n    var total = isGroupAdaptive(this.parent) ? this.getGroupedTotalBlocks() : this.getTotalBlocks();\n    this.prevHeight = this.offsets[total];\n    this.maxBlock = total % 2 === 0 ? total - 2 : total - 1;\n    this.offsets = {}; //Row offset update\n\n    var blocks = Array.apply(null, Array(total)).map(function () {\n      return ++row;\n    });\n\n    for (var i = 0; i < blocks.length; i++) {\n      var tmp = (this.vgenerator.cache[blocks[i]] || []).length;\n      var rem = !isGroupAdaptive(this.parent) ? this.count % bSize : gObj.vcRows.length % bSize;\n      var size = !isGroupAdaptive(this.parent) && blocks[i] in this.vgenerator.cache ? tmp * this.parent.getRowHeight() : rem && blocks[i] === total ? rem * this.parent.getRowHeight() : this.getBlockHeight(); // let size: number = this.parent.groupSettings.columns.length && block in this.vgenerator.cache ?\n      // tmp * getRowHeight() : this.getBlockHeight();\n\n      this.offsets[blocks[i]] = (this.offsets[blocks[i] - 1] | 0) + size;\n      this.tmpOffsets[blocks[i]] = this.offsets[blocks[i] - 1] | 0;\n    }\n\n    this.offsetKeys = Object.keys(this.offsets);\n\n    if (isGroupAdaptive(this.parent)) {\n      this.parent.vGroupOffsets = this.offsets;\n    } //Column offset update\n\n\n    if (this.parent.enableColumnVirtualization) {\n      this.vgenerator.refreshColOffsets();\n    }\n  };\n\n  VirtualContentRenderer.prototype.refreshVirtualElement = function () {\n    this.vgenerator.refreshColOffsets();\n    this.setVirtualHeight();\n  };\n\n  VirtualContentRenderer.prototype.setVisible = function (columns) {\n    var gObj = this.parent;\n    var frozenCols = this.parent.getFrozenColumns();\n    var fcntColGrp;\n    var mcntColGrp;\n\n    if (frozenCols) {\n      fcntColGrp = [].slice.call(this.parent.getFrozenVirtualContent().querySelectorAll('col'));\n      mcntColGrp = [].slice.call(this.parent.getMovableVirtualContent().querySelectorAll('col'));\n    }\n\n    if (isBlazor() && gObj.isServerRendered) {\n      this.parent.notify('setvisibility', columns);\n    }\n\n    var rows = [];\n    rows = this.getRows();\n    var testRow;\n    rows.some(function (r) {\n      if (r.isDataRow) {\n        testRow = r;\n      }\n\n      return r.isDataRow;\n    });\n    var needFullRefresh = true;\n\n    if (!gObj.groupSettings.columns.length && testRow) {\n      needFullRefresh = false;\n    }\n\n    var tr = gObj.getDataRows();\n\n    for (var c = 0, clen = columns.length; c < clen; c++) {\n      var column = columns[c];\n      var idx = gObj.getNormalizedColumnIndex(column.uid);\n      var displayVal = column.visible === true ? '' : 'none';\n      var colGrp = void 0;\n\n      if (fcntColGrp && mcntColGrp) {\n        if (idx >= frozenCols) {\n          colGrp = mcntColGrp;\n          tr = this.parent.getMovableRows();\n          idx = idx - frozenCols;\n        } else {\n          colGrp = fcntColGrp;\n        }\n      } else {\n        colGrp = this.getColGroup().children;\n      }\n\n      if (idx !== -1 && testRow && idx < testRow.cells.length) {\n        setStyleAttribute(colGrp[idx], {\n          'display': displayVal\n        });\n      }\n\n      if (!needFullRefresh) {\n        var width = void 0;\n\n        if (column.visible) {\n          width = this.virtualEle.wrapper.offsetWidth + parseInt(column.width.toString(), 10);\n        } else {\n          width = this.virtualEle.wrapper.offsetWidth - parseInt(column.width.toString(), 10);\n        }\n\n        if (width > gObj.width) {\n          this.setDisplayNone(tr, idx, displayVal, rows);\n\n          if (this.parent.enableColumnVirtualization) {\n            this.virtualEle.setWrapperWidth(width + '');\n          }\n\n          this.refreshVirtualElement();\n        } else {\n          needFullRefresh = true;\n        }\n      }\n\n      if (!this.parent.invokedFromMedia && column.hideAtMedia) {\n        this.parent.updateMediaColumns(column);\n      }\n\n      this.parent.invokedFromMedia = false;\n    }\n\n    if (isBlazor() && this.parent.isServerRendered && needFullRefresh) {\n      var inViewIdx = this.parent.inViewIndexes;\n      var translateX = this.getColumnOffset(inViewIdx[0] - 1);\n      var width = this.getColumnOffset(inViewIdx[inViewIdx.length - 1]) - translateX + '';\n      this.parent.notify('refresh-virtual-indices', {\n        requestType: 'virtualScrollRefresh',\n        startColumnIndex: inViewIdx[0],\n        endColumnIndex: inViewIdx[inViewIdx.length - 1],\n        axis: 'X',\n        VTablewidth: width,\n        translateX: translateX\n      });\n      this.parent.notify('setcolumnstyles', {});\n    }\n\n    if (needFullRefresh || frozenCols) {\n      this.refreshContentRows({\n        requestType: 'refresh'\n      });\n    } else {\n      this.parent.notify(events.partialRefresh, {\n        rows: rows,\n        args: {\n          isFrozen: false,\n          rows: rows\n        }\n      });\n    }\n  };\n\n  VirtualContentRenderer.prototype.selectVirtualRow = function (args) {\n    var _this = this;\n\n    if (this.activeKey !== 'upArrow' && this.activeKey !== 'downArrow' && !this.requestTypes.some(function (value) {\n      return value === _this.requestType;\n    }) && !this.parent.selectionModule.isInteracted) {\n      var ele = this.parent.getFrozenColumns() ? this.parent.getMovableVirtualContent() : this.parent.getContent().firstElementChild;\n      var selectedRow = this.parent.getRowByIndex(args.selectedIndex);\n      var rowHeight = this.parent.getRowHeight();\n      var eleOffsHeight = ele.offsetHeight;\n\n      if (!selectedRow || this.isRowInView(args.selectedIndex, selectedRow, ele, eleOffsHeight, rowHeight)) {\n        this.isSelection = true;\n        this.selectedRowIndex = args.selectedIndex;\n        var scrollTop = (args.selectedIndex + 1) * rowHeight;\n\n        if (!isNullOrUndefined(scrollTop)) {\n          ele.scrollTop = scrollTop;\n        }\n      }\n    }\n\n    this.requestType = this.empty;\n  };\n\n  VirtualContentRenderer.prototype.isRowInView = function (index, selectedRow, ele, eleOffsHeight, rowHeight) {\n    if (isBlazor()) {\n      var exactTopIndex = ele.scrollTop / rowHeight;\n      var exactEndIndex = exactTopIndex + eleOffsHeight / rowHeight;\n      return index < exactTopIndex || index > exactEndIndex;\n    } else {\n      if (this.parent.frozenRows && index < this.parent.frozenRows) {\n        return false;\n      }\n\n      var rectTop = selectedRow ? selectedRow.getBoundingClientRect().top : 0;\n      return rectTop < rowHeight || rectTop > eleOffsHeight;\n    }\n  };\n\n  return VirtualContentRenderer;\n}(ContentRender);\n\nexport { VirtualContentRenderer };\n/**\n * @hidden\n */\n\nvar VirtualHeaderRenderer =\n/** @class */\nfunction (_super) {\n  __extends(VirtualHeaderRenderer, _super);\n\n  function VirtualHeaderRenderer(parent, locator) {\n    var _this = _super.call(this, parent, locator) || this;\n\n    _this.virtualEle = new VirtualElementHandler();\n    _this.gen = new VirtualRowModelGenerator(_this.parent);\n\n    _this.parent.on(events.columnVisibilityChanged, _this.setVisible, _this);\n\n    _this.parent.on(refreshVirtualBlock, function (e) {\n      return e.virtualInfo.sentinelInfo.axis === 'X' ? _this.refreshUI() : null;\n    }, _this);\n\n    return _this;\n  }\n\n  VirtualHeaderRenderer.prototype.renderTable = function () {\n    this.gen.refreshColOffsets();\n    this.parent.setColumnIndexesInView(this.gen.getColumnIndexes(this.getPanel().querySelector('.e-headercontent')));\n\n    if (isBlazor() && this.parent.isServerRendered) {\n      this.parent.notify('refresh-virtual-indices', {\n        startColumnIndex: this.parent.contentModule.startColIndex,\n        endColumnIndex: this.parent.contentModule.endColIndex,\n        axis: 'X'\n      });\n    }\n\n    _super.prototype.renderTable.call(this);\n\n    this.virtualEle.table = this.getTable();\n    this.virtualEle.content = this.getPanel().querySelector('.e-headercontent');\n\n    if (!this.parent.getFrozenColumns()) {\n      this.virtualEle.content.style.position = 'relative';\n    }\n\n    this.virtualEle.renderWrapper();\n    this.virtualEle.renderPlaceHolder('absolute');\n  };\n\n  VirtualHeaderRenderer.prototype.appendContent = function (table) {\n    this.virtualEle.wrapper.appendChild(table);\n  };\n\n  VirtualHeaderRenderer.prototype.refreshUI = function () {\n    this.setFrozenTable(this.parent.getMovableVirtualContent());\n    this.gen.refreshColOffsets();\n    this.parent.setColumnIndexesInView(this.gen.getColumnIndexes(this.getPanel().querySelector('.e-headercontent')));\n\n    _super.prototype.refreshUI.call(this);\n\n    this.setFrozenTable(this.parent.getFrozenVirtualContent());\n  };\n\n  VirtualHeaderRenderer.prototype.setVisible = function (columns) {\n    var gObj = this.parent;\n    var displayVal;\n    var idx;\n    var needFullRefresh;\n    var frozenCols = this.parent.getFrozenColumns();\n    var fhdrColGrp;\n    var mhdrColGrp;\n\n    if (frozenCols) {\n      fhdrColGrp = [].slice.call(this.parent.getFrozenVirtualHeader().querySelectorAll('col'));\n      mhdrColGrp = [].slice.call(this.parent.getMovableVirtualHeader().querySelectorAll('col'));\n    }\n\n    for (var c = 0, clen = columns.length; c < clen; c++) {\n      var column = columns[c];\n      idx = gObj.getNormalizedColumnIndex(column.uid);\n      displayVal = column.visible ? '' : 'none';\n      var colGrp = void 0;\n\n      if (fhdrColGrp && mhdrColGrp) {\n        if (idx >= frozenCols) {\n          colGrp = mhdrColGrp;\n          idx = idx - frozenCols;\n        } else {\n          colGrp = fhdrColGrp;\n        }\n      } else {\n        colGrp = this.getColGroup().children;\n      }\n\n      setStyleAttribute(colGrp[idx], {\n        'display': displayVal\n      });\n\n      if (gObj.enableColumnVirtualization && !gObj.groupSettings.columns.length) {\n        var tablewidth = void 0;\n\n        if (column.visible) {\n          tablewidth = this.virtualEle.wrapper.offsetWidth + parseInt(column.width.toString(), 10);\n        } else {\n          tablewidth = this.virtualEle.wrapper.offsetWidth - parseInt(column.width.toString(), 10);\n        }\n\n        if (tablewidth > gObj.width) {\n          this.setDisplayNone(column, displayVal);\n          this.virtualEle.setWrapperWidth(tablewidth + '');\n          this.gen.refreshColOffsets();\n        } else {\n          needFullRefresh = true;\n        }\n      } else {\n        needFullRefresh = true;\n      }\n\n      if (needFullRefresh && !frozenCols) {\n        this.refreshUI();\n      }\n    }\n\n    if (frozenCols) {\n      this.parent.notify(events.columnPositionChanged, {});\n    }\n  };\n\n  VirtualHeaderRenderer.prototype.setFrozenTable = function (content) {\n    if (this.parent.getFrozenColumns() && this.parent.enableColumnVirtualization && this.parent.contentModule.isXaxis()) {\n      this.parent.contentModule.setTable(content.querySelector('.e-table'));\n    }\n  };\n\n  VirtualHeaderRenderer.prototype.setDisplayNone = function (col, displayVal) {\n    var frozenCols = this.parent.getFrozenColumns();\n    var table = this.getTable();\n\n    if (frozenCols && col.index >= frozenCols) {\n      table = this.parent.getMovableVirtualHeader().querySelector('.e-table');\n    }\n\n    for (var _i = 0, _a = [].slice.apply(table.querySelectorAll('th.e-headercell')); _i < _a.length; _i++) {\n      var ele = _a[_i];\n\n      if (ele.querySelector('[e-mappinguid]') && ele.querySelector('[e-mappinguid]').getAttribute('e-mappinguid') === col.uid) {\n        setStyleAttribute(ele, {\n          'display': displayVal\n        });\n\n        if (displayVal === '') {\n          removeClass([ele], 'e-hide');\n        }\n\n        break;\n      }\n    }\n  };\n\n  return VirtualHeaderRenderer;\n}(HeaderRender);\n\nexport { VirtualHeaderRenderer };\n/**\n * @hidden\n */\n\nvar VirtualElementHandler =\n/** @class */\nfunction () {\n  function VirtualElementHandler() {}\n\n  VirtualElementHandler.prototype.renderWrapper = function (height) {\n    if (isBlazor()) {\n      this.wrapper = this.content.querySelector('.e-virtualtable') ? this.content.querySelector('.e-virtualtable') : createElement('div', {\n        className: 'e-virtualtable'\n      });\n      this.wrapper.setAttribute('styles', \"min-height:\" + formatUnit(height));\n    } else {\n      this.wrapper = createElement('div', {\n        className: 'e-virtualtable',\n        styles: \"min-height:\" + formatUnit(height)\n      });\n    }\n\n    this.wrapper.appendChild(this.table);\n    this.content.appendChild(this.wrapper);\n  };\n\n  VirtualElementHandler.prototype.renderPlaceHolder = function (position) {\n    if (position === void 0) {\n      position = 'relative';\n    }\n\n    if (isBlazor()) {\n      this.placeholder = this.content.querySelector('.e-virtualtrack') ? this.content.querySelector('.e-virtualtrack') : createElement('div', {\n        className: 'e-virtualtrack'\n      });\n      this.placeholder.setAttribute('styles', \"position:\" + position);\n    } else {\n      this.placeholder = createElement('div', {\n        className: 'e-virtualtrack',\n        styles: \"position:\" + position\n      });\n    }\n\n    this.content.appendChild(this.placeholder);\n  };\n\n  VirtualElementHandler.prototype.adjustTable = function (xValue, yValue) {\n    this.wrapper.style.transform = \"translate(\" + xValue + \"px, \" + yValue + \"px)\";\n  };\n\n  VirtualElementHandler.prototype.setWrapperWidth = function (width, full) {\n    this.wrapper.style.width = width ? width + \"px\" : full ? '100%' : '';\n  };\n\n  VirtualElementHandler.prototype.setVirtualHeight = function (height, width) {\n    this.placeholder.style.height = height + \"px\";\n    this.placeholder.style.width = width;\n  };\n\n  VirtualElementHandler.prototype.setFreezeWrapperWidth = function (wrapper, width, full) {\n    wrapper.style.width = width ? width + \"px\" : full ? '100%' : '';\n  };\n\n  return VirtualElementHandler;\n}();\n\nexport { VirtualElementHandler };","map":{"version":3,"sources":["/home/nikhil/Desktop/data_grid_editor-master/node_modules/@syncfusion/ej2-grids/src/grid/renderer/virtual-content-renderer.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","remove","createElement","closest","formatUnit","Browser","extend","isNullOrUndefined","removeClass","DataManager","dataReady","modelChanged","refreshVirtualBlock","contentReady","events","RenderType","ContentRender","HeaderRender","InterSectionObserver","VirtualRowModelGenerator","isGroupAdaptive","getTransformValues","ensureLastRow","ensureFirstRow","getEditedDataIndex","getScrollBarWidth","isBlazor","setStyleAttribute","VirtualContentRenderer","_super","parent","locator","_this","call","prevHeight","startIndex","preStartIndex","preventEvent","actions","offsets","tmpOffsets","virtualEle","VirtualElementHandler","offsetKeys","isFocused","isSelection","isBottom","rndrCount","empty","undefined","isCancel","requestTypes","isNormaledit","editSettings","mode","virtualData","emptyRowData","vfColIndex","eventListener","on","columnVisibilityChanged","setVisible","vgenerator","generator","renderTable","header","getService","getRenderer","Header","table","getTable","content","getPanel","querySelector","minHeight","height","getFrozenColumns","toString","indexOf","parseInt","renderWrapper","renderPlaceHolder","wrapper","style","position","debounceEvent","dataSource","offline","getMovableVirtualContent","opt","container","pageHeight","getBlockHeight","axes","enableColumnVirtualization","observer","renderEmpty","tbody","appendChild","adjustTable","refreshMvTbalTransform","mCont","fCont","getFrozenVirtualContent","mContTV","firstElementChild","fContTV","top","scrollTop","transform","width","scrollListener","scrollArgs","scrollAfterEdit","enablePersistence","scrollPosition","offset","isDestroyed","document","activeElement","sentinel","axis","info","pStartIndex","previousColIndexes","getColumnIndexesInView","viewInfo","currentInfo","getInfoFromView","direction","isServerRendered","JSON","stringify","columnIndexes","refreshHeader","translateX","getColumnOffset","startColIndex","endColIndex","notify","requestType","startColumnIndex","endColumnIndex","length","VTablewidth","blockIndexes","prevInfo","event","virtualInfo","focusElement","isIE","hideSpinner","restoreEdit","setColumnIndexesInView","pageSettings","currentPage","loadNext","loadSelf","nextInfo","page","virtualStartIndex","virtualEndIndex","endIndex","RHeight","getRowHeight","lastPage","Math","ceil","getTotalBlocks","block","blk","isBlockAvailable","e","isBlockAdded","tempBlocks","infoType","sentinelInfo","preEndIndex","vHeight","getBoundingClientRect","element","getPageFromTop","getBlockIndexes","blocks","ensureBlocks","activeKey","newBlock","filter","val","every","bind","max","firstBlock","rowIndex","getBlockSize","getColumnIndexes","rowHeight","exactTopIndex","noOfInViewIndexes","exactEndIndex","pageSizeBy4","pageSize","sIndex","round","count","floor","eIndex","setKeyboardNavIndex","loadAtIndex","idxAddedToExactTop","blazorDataLoad","blzRowIndex","blur","index","mIdx","old","indexes","ind","isEndBlock","some","result","getGroupedTotalBlocks","slice","vfTblTransform","left","cOffset","translate","isLastPage","wrappers","getContent","querySelectorAll","i","cOff","appendContent","target","newChild","colVFtable","checkFirstBlockColIndexes","cBlock","groupSettings","columns","refreshOffsets","scrollLeft","top_1","getTranslateY","value","cIndex","setWrapperWidth","name","parentNode","renderMovableContent","frozenRows","children","sTop","setVirtualHeight","setPageHeight","getOffset","focus","autoCol","focusCell","restoreAdd","push","splice","row","getRowByIndex","cell","cells","cellIndex","preventScroll","selectRow","getAttribute","allowEditing","editModule","editedRowIndex","keys","top_2","offsetHeight","isEdit","startEdit","rowData","getRowObjectByIndex","getVirtualEditedData","editForm","getCurrentEditedData","isAdd","isTop","newRowPosition","maxPage","addRecord","onDataReady","checkAndResetCache","hdrTbls","getHeaderContent","resetScrollPosition","virtualHeightTemp","scrollableElementHeight","clientHeight","fTblWidth","placeholder","virtualHeight","total","extra","iOffset","Number","border","min","getPage","cHeight","isOnenter","endTranslate","blockHeight","maxBlock","onEntered","current","isWheel","check","showSpinner","xAxis","x","y","refresh","fvTable","dataBound","selectedRowIndex","rowSelected","action","addEventListener","actionBegin","actionComplete","refreshContentRows","selectVirtualRow","virtaulCellFocus","virtualCellFocus","virtualScrollEditActionBegin","editActionBegin","virtualScrollAddActionBegin","addActionBegin","virtualScrollEdit","virtualScrollEditSuccess","editSuccess","refreshVirtualCache","refreshCache","editReset","resetIsedit","getVirtualData","virtualScrollEditCancel","editCancel","onActionBegin","fn","observe","gObj","scrollValues","down","off","data","args","dataIndex","getCurrentViewRecords","updateCurrentViewData","ele","classList","contains","parentElement","scrollEle","visibleRowCount","emptyRow","cache","refreshVirtualElement","previousVirtualData","resetFilterDlgPosition","columnName","enableVirtualization","allowAdding","addForm","createEmptyRowdata","getColumns","field","setProperties","getRowCollection","totalBlocks","rows","vcRows","cOffsets","getModelGenerator","getRows","getDataRows","getMovableVirtualRowByIndex","isMovable","isRowObject","prev","startIdx","rowCollection","getMovableDataRows","collection","selectedRow","getVirtualRowIndex","bSize","apply","map","tmp","rem","size","vGroupOffsets","refreshColOffsets","frozenCols","fcntColGrp","mcntColGrp","testRow","r","isDataRow","needFullRefresh","tr","c","clen","column","idx","getNormalizedColumnIndex","uid","displayVal","visible","colGrp","getMovableRows","getColGroup","offsetWidth","setDisplayNone","invokedFromMedia","hideAtMedia","updateMediaColumns","inViewIdx","inViewIndexes","partialRefresh","isFrozen","selectionModule","isInteracted","selectedIndex","eleOffsHeight","isRowInView","rectTop","VirtualHeaderRenderer","gen","refreshUI","contentModule","setFrozenTable","fhdrColGrp","mhdrColGrp","getFrozenVirtualHeader","getMovableVirtualHeader","tablewidth","columnPositionChanged","isXaxis","setTable","col","_i","_a","className","setAttribute","styles","xValue","yValue","full","setFreezeWrapperWidth"],"mappings":"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","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { remove, createElement, closest, formatUnit, Browser, extend } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, removeClass } from '@syncfusion/ej2-base';\nimport { DataManager } from '@syncfusion/ej2-data';\nimport { dataReady, modelChanged, refreshVirtualBlock, contentReady } from '../base/constant';\nimport * as events from '../base/constant';\nimport { RenderType } from '../base/enum';\nimport { ContentRender } from './content-renderer';\nimport { HeaderRender } from './header-renderer';\nimport { InterSectionObserver } from '../services/intersection-observer';\nimport { VirtualRowModelGenerator } from '../services/virtual-row-model-generator';\nimport { isGroupAdaptive, getTransformValues, ensureLastRow, ensureFirstRow, getEditedDataIndex, getScrollBarWidth } from '../base/util';\nimport { isBlazor, setStyleAttribute } from '@syncfusion/ej2-base';\n/**\n * VirtualContentRenderer\n * @hidden\n */\nvar VirtualContentRenderer = /** @class */ (function (_super) {\n    __extends(VirtualContentRenderer, _super);\n    function VirtualContentRenderer(parent, locator) {\n        var _this = _super.call(this, parent, locator) || this;\n        _this.prevHeight = 0;\n        /** @hidden */\n        _this.startIndex = 0;\n        _this.preStartIndex = 0;\n        _this.preventEvent = false;\n        _this.actions = ['filtering', 'searching', 'grouping', 'ungrouping'];\n        _this.offsets = {};\n        _this.tmpOffsets = {};\n        /** @hidden */\n        _this.virtualEle = new VirtualElementHandler();\n        _this.offsetKeys = [];\n        _this.isFocused = false;\n        _this.isSelection = false;\n        _this.isBottom = false;\n        _this.rndrCount = 0;\n        _this.empty = undefined;\n        _this.isCancel = false;\n        _this.requestTypes = ['beginEdit', 'cancel', 'delete', 'add', 'save'];\n        _this.isNormaledit = _this.parent.editSettings.mode === 'Normal';\n        _this.virtualData = {};\n        _this.emptyRowData = {};\n        _this.vfColIndex = [];\n        _this.locator = locator;\n        _this.eventListener('on');\n        _this.parent.on(events.columnVisibilityChanged, _this.setVisible, _this);\n        _this.vgenerator = _this.generator;\n        return _this;\n    }\n    VirtualContentRenderer.prototype.renderTable = function () {\n        this.header = this.locator.getService('rendererFactory').getRenderer(RenderType.Header);\n        _super.prototype.renderTable.call(this);\n        this.virtualEle.table = this.getTable();\n        this.virtualEle.content = this.content = this.getPanel().querySelector('.e-content');\n        var minHeight = this.parent.height;\n        if (this.parent.getFrozenColumns() && this.parent.height.toString().indexOf('%') < 0) {\n            minHeight = parseInt(this.parent.height, 10) - getScrollBarWidth();\n        }\n        this.virtualEle.renderWrapper(minHeight);\n        this.virtualEle.renderPlaceHolder();\n        if (!this.parent.getFrozenColumns()) {\n            this.virtualEle.wrapper.style.position = 'absolute';\n        }\n        var debounceEvent = (this.parent.dataSource instanceof DataManager && !this.parent.dataSource.dataSource.offline);\n        var content = this.parent.getFrozenColumns() ? this.parent.getMovableVirtualContent() : this.content;\n        var opt = {\n            container: content, pageHeight: this.getBlockHeight() * 2, debounceEvent: debounceEvent,\n            axes: this.parent.enableColumnVirtualization ? ['X', 'Y'] : ['Y']\n        };\n        this.observer = new InterSectionObserver(this.virtualEle.wrapper, opt);\n    };\n    VirtualContentRenderer.prototype.renderEmpty = function (tbody) {\n        this.getTable().appendChild(tbody);\n        this.virtualEle.adjustTable(0, 0);\n    };\n    VirtualContentRenderer.prototype.refreshMvTbalTransform = function () {\n        var mCont = this.parent.getMovableVirtualContent();\n        var fCont = this.parent.getFrozenVirtualContent();\n        var mContTV = getTransformValues(mCont.firstElementChild);\n        var fContTV = getTransformValues(fCont.firstElementChild);\n        var top = mCont.scrollTop;\n        if (top > 0 && mContTV.height !== fContTV.height) {\n            mCont.firstElementChild.style.transform = \"translate(\" + mContTV.width + \"px, \" + fContTV.height + \"px)\";\n        }\n    };\n    VirtualContentRenderer.prototype.scrollListener = function (scrollArgs) {\n        this.scrollAfterEdit();\n        if (this.parent.enablePersistence) {\n            this.parent.scrollPosition = scrollArgs.offset;\n        }\n        if (this.preventEvent || this.parent.isDestroyed) {\n            this.preventEvent = false;\n            return;\n        }\n        if (isNullOrUndefined(document.activeElement)) {\n            this.isFocused = false;\n        }\n        else {\n            this.isFocused = this.content === closest(document.activeElement, '.e-content') || this.content === document.activeElement;\n        }\n        if (this.parent.enableColumnVirtualization && this.parent.getFrozenColumns() && scrollArgs.sentinel.axis === 'X') {\n            this.refreshMvTbalTransform();\n        }\n        var info = scrollArgs.sentinel;\n        var pStartIndex = this.preStartIndex;\n        var previousColIndexes = this.parent.getColumnIndexesInView();\n        var viewInfo = this.currentInfo = this.getInfoFromView(scrollArgs.direction, info, scrollArgs.offset);\n        if (isBlazor() && this.parent.isServerRendered && this.parent.enableColumnVirtualization &&\n            (JSON.stringify(previousColIndexes) !== JSON.stringify(viewInfo.columnIndexes))) {\n            this.parent.refreshHeader();\n            var translateX = this.getColumnOffset(this.startColIndex - 1);\n            var width = this.getColumnOffset(this.endColIndex - 1) - translateX + '';\n            this.parent.notify('refresh-virtual-indices', { requestType: 'virtualscroll', startColumnIndex: viewInfo.columnIndexes[0],\n                endColumnIndex: viewInfo.columnIndexes[viewInfo.columnIndexes.length - 1], axis: 'X',\n                VTablewidth: width, translateX: this.getColumnOffset(viewInfo.columnIndexes[0] - 1) });\n            this.parent.notify('setcolumnstyles', {});\n        }\n        if (isGroupAdaptive(this.parent) && !isBlazor()) {\n            if ((info.axis === 'Y' && viewInfo.blockIndexes && this.prevInfo.blockIndexes.toString() === viewInfo.blockIndexes.toString())\n                && scrollArgs.direction === 'up' && viewInfo.blockIndexes[viewInfo.blockIndexes.length - 1] !== 2) {\n                return;\n            }\n            else {\n                viewInfo.event = 'refresh-virtual-block';\n                if (!isNullOrUndefined(viewInfo.offsets)) {\n                    viewInfo.offsets.top = this.content.scrollTop;\n                }\n                this.parent.notify(viewInfo.event, { requestType: 'virtualscroll', virtualInfo: viewInfo, focusElement: scrollArgs.focusElement });\n                return;\n            }\n        }\n        if (!isBlazor() || (isBlazor() && !this.parent.isServerRendered)) {\n            if (this.prevInfo && ((info.axis === 'Y' && this.prevInfo.blockIndexes.toString() === viewInfo.blockIndexes.toString())\n                || (info.axis === 'X' && this.prevInfo.columnIndexes.toString() === viewInfo.columnIndexes.toString()))) {\n                if (Browser.isIE) {\n                    this.parent.hideSpinner();\n                }\n                this.requestType = this.requestType === 'virtualscroll' ? this.empty : this.requestType;\n                this.restoreEdit();\n                return;\n            }\n        }\n        this.parent.setColumnIndexesInView(this.parent.enableColumnVirtualization ? viewInfo.columnIndexes : []);\n        if (!isBlazor() || (isBlazor() && !this.parent.isServerRendered)) {\n            this.parent.pageSettings.currentPage = viewInfo.loadNext && !viewInfo.loadSelf ? viewInfo.nextInfo.page : viewInfo.page;\n        }\n        else if (isBlazor() && this.parent.isServerRendered && this.preStartIndex !== pStartIndex &&\n            this.parent.pageSettings.currentPage === viewInfo.currentPage) {\n            this.parent.notify('refresh-virtual-indices', { requestType: 'virtualscroll', virtualStartIndex: viewInfo.startIndex,\n                virtualEndIndex: viewInfo.endIndex, axis: 'Y', RHeight: this.parent.getRowHeight() });\n        }\n        if (this.parent.getFrozenColumns() && this.parent.enableColumnVirtualization) {\n            var lastPage = Math.ceil(this.getTotalBlocks() / 2);\n            if (this.parent.pageSettings.currentPage === lastPage && scrollArgs.sentinel.axis === 'Y') {\n                this.rndrCount++;\n            }\n            if (scrollArgs.sentinel.axis === 'Y') {\n                if (this.parent.pageSettings.currentPage === lastPage && this.rndrCount > 1) {\n                    this.rndrCount = 0;\n                    return;\n                }\n                else if (this.parent.pageSettings.currentPage !== lastPage && this.parent.pageSettings.currentPage !== lastPage - 1) {\n                    this.rndrCount = 0;\n                }\n            }\n        }\n        if (!isBlazor() || (isBlazor() && !this.parent.isServerRendered)) {\n            this.requestType = 'virtualscroll';\n            this.parent.notify(viewInfo.event, { requestType: 'virtualscroll', virtualInfo: viewInfo,\n                focusElement: scrollArgs.focusElement });\n        }\n        else if (this.preStartIndex !== pStartIndex && this.parent.pageSettings.currentPage !== viewInfo.currentPage) {\n            this.parent.pageSettings.currentPage = viewInfo.currentPage;\n            this.parent.notify(viewInfo.event, { requestType: 'virtualscroll', virtualStartIndex: viewInfo.startIndex,\n                virtualEndIndex: viewInfo.endIndex, axis: 'Y', RHeight: this.parent.getRowHeight() });\n        }\n    };\n    VirtualContentRenderer.prototype.block = function (blk) {\n        return this.vgenerator.isBlockAvailable(blk);\n    };\n    VirtualContentRenderer.prototype.getInfoFromView = function (direction, info, e) {\n        var isBlockAdded = false;\n        var tempBlocks = [];\n        var infoType = { direction: direction, sentinelInfo: info, offsets: e,\n            startIndex: this.preStartIndex, endIndex: this.preEndIndex };\n        var vHeight = this.parent.height.toString().indexOf('%') < 0 ? this.content.getBoundingClientRect().height :\n            this.parent.element.getBoundingClientRect().height;\n        infoType.page = this.getPageFromTop(e.top, infoType);\n        infoType.blockIndexes = tempBlocks = this.vgenerator.getBlockIndexes(infoType.page);\n        infoType.loadSelf = !this.vgenerator.isBlockAvailable(tempBlocks[infoType.block]);\n        var blocks = this.ensureBlocks(infoType);\n        if (this.activeKey === 'upArrow' && infoType.blockIndexes.toString() !== blocks.toString()) {\n            // To avoid dupilcate row index problem in key focus support\n            var newBlock = blocks[blocks.length - 1];\n            if (infoType.blockIndexes.indexOf(newBlock) === -1) {\n                isBlockAdded = true;\n            }\n        }\n        infoType.blockIndexes = blocks;\n        infoType.loadNext = !blocks.filter(function (val) { return tempBlocks.indexOf(val) === -1; })\n            .every(this.block.bind(this));\n        infoType.event = (infoType.loadNext || infoType.loadSelf) ? modelChanged : refreshVirtualBlock;\n        infoType.nextInfo = infoType.loadNext ? { page: Math.max(1, infoType.page + (direction === 'down' ? 1 : -1)) } : {};\n        if (isBlockAdded) {\n            infoType.blockIndexes = [infoType.blockIndexes[0] - 1, infoType.blockIndexes[0], infoType.blockIndexes[0] + 1];\n        }\n        if (this.activeKey === 'downArrow') {\n            var firstBlock = Math.ceil(this.rowIndex / this.getBlockSize());\n            if (firstBlock !== 1 && (infoType.blockIndexes[1] !== firstBlock || infoType.blockIndexes.length < 3)) {\n                infoType.blockIndexes = [firstBlock - 1, firstBlock, firstBlock + 1];\n            }\n        }\n        infoType.columnIndexes = info.axis === 'X' ? this.vgenerator.getColumnIndexes() : this.parent.getColumnIndexesInView();\n        if (this.parent.enableColumnVirtualization && info.axis === 'X') {\n            infoType.event = refreshVirtualBlock;\n        }\n        if (isBlazor() && this.parent.isServerRendered) {\n            var rowHeight = this.parent.getRowHeight();\n            var exactTopIndex = e.top / rowHeight;\n            var noOfInViewIndexes = vHeight / rowHeight;\n            var exactEndIndex = exactTopIndex + noOfInViewIndexes;\n            var pageSizeBy4 = this.parent.pageSettings.pageSize / 4;\n            if (infoType.direction === 'down') {\n                var sIndex = Math.round(exactEndIndex) - Math.round((pageSizeBy4));\n                if (isNullOrUndefined(infoType.startIndex) || (exactEndIndex >\n                    (infoType.startIndex + Math.round((this.parent.pageSettings.pageSize / 2 + pageSizeBy4)))\n                    && infoType.endIndex !== this.count)) {\n                    infoType.startIndex = sIndex >= 0 ? Math.round(sIndex) : 0;\n                    infoType.startIndex = infoType.startIndex > exactTopIndex ? Math.floor(exactTopIndex) : infoType.startIndex;\n                    var eIndex = infoType.startIndex + this.parent.pageSettings.pageSize;\n                    infoType.startIndex = eIndex < exactEndIndex ? (Math.ceil(exactEndIndex) - this.parent.pageSettings.pageSize)\n                        : infoType.startIndex;\n                    infoType.endIndex = eIndex < this.count ? eIndex : this.count;\n                    infoType.startIndex = eIndex >= this.count ?\n                        infoType.endIndex - this.parent.pageSettings.pageSize : infoType.startIndex;\n                    infoType.currentPage = Math.ceil(infoType.endIndex / this.parent.pageSettings.pageSize);\n                    this.setKeyboardNavIndex();\n                }\n            }\n            else if (infoType.direction === 'up') {\n                if (infoType.startIndex && infoType.endIndex) {\n                    var loadAtIndex = Math.round(((infoType.startIndex * rowHeight) + (pageSizeBy4 * rowHeight)) / rowHeight);\n                    if (exactTopIndex < loadAtIndex) {\n                        var idxAddedToExactTop = (pageSizeBy4) > noOfInViewIndexes ? pageSizeBy4 :\n                            (noOfInViewIndexes + noOfInViewIndexes / 4);\n                        var eIndex = Math.round(exactTopIndex + idxAddedToExactTop);\n                        infoType.endIndex = eIndex < this.count ? eIndex : this.count;\n                        var sIndex = infoType.endIndex - this.parent.pageSettings.pageSize;\n                        infoType.startIndex = sIndex > 0 ? sIndex : 0;\n                        infoType.endIndex = sIndex < 0 ? this.parent.pageSettings.pageSize : infoType.endIndex;\n                        infoType.currentPage = Math.ceil(infoType.startIndex / this.parent.pageSettings.pageSize);\n                        this.setKeyboardNavIndex();\n                    }\n                }\n            }\n            this.preStartIndex = this.startIndex = infoType.startIndex;\n            this.preEndIndex = infoType.endIndex;\n            infoType.event = (infoType.currentPage !== this.parent.pageSettings.currentPage) ? modelChanged : refreshVirtualBlock;\n        }\n        return infoType;\n    };\n    VirtualContentRenderer.prototype.setKeyboardNavIndex = function () {\n        this.blazorDataLoad = true;\n        if (this.activeKey === 'downArrow' || this.activeKey === 'upArrow') {\n            this.blzRowIndex = this.activeKey === 'downArrow' ? this.rowIndex + 1 : this.rowIndex - 1;\n            document.activeElement.blur();\n        }\n    };\n    VirtualContentRenderer.prototype.ensureBlocks = function (info) {\n        var _this = this;\n        var index = info.blockIndexes[info.block];\n        var mIdx;\n        var old = index;\n        var max = Math.max;\n        var indexes = info.direction === 'down' ? [max(index, 1), ++index, ++index] : [max(index - 1, 1), index, index + 1];\n        if (this.parent.enableColumnVirtualization && this.parent.getFrozenColumns()) {\n            if (info.sentinelInfo.axis === 'X' || (info.sentinelInfo.axis === 'Y' && (info.page === this.prevInfo.page))) {\n                indexes = this.prevInfo.blockIndexes;\n            }\n        }\n        indexes = indexes.filter(function (val, ind) { return indexes.indexOf(val) === ind; });\n        if (this.prevInfo.blockIndexes.toString() === indexes.toString()) {\n            return indexes;\n        }\n        if (info.loadSelf || (info.direction === 'down' && this.isEndBlock(old))) {\n            indexes = this.vgenerator.getBlockIndexes(info.page);\n        }\n        indexes.some(function (val, ind) {\n            var result = val === (isGroupAdaptive(_this.parent) ? _this.getGroupedTotalBlocks() : _this.getTotalBlocks());\n            if (result) {\n                mIdx = ind;\n            }\n            return result;\n        });\n        if (mIdx !== undefined) {\n            indexes = indexes.slice(0, mIdx + 1);\n            if (info.block === 0 && indexes.length === 1 && this.vgenerator.isBlockAvailable(indexes[0] - 1)) {\n                indexes = [indexes[0] - 1, indexes[0]];\n            }\n        }\n        return indexes;\n    };\n    /**\n     * @hidden\n     */\n    VirtualContentRenderer.prototype.vfTblTransform = function (info, left, top, e, cOffset, translate) {\n        var lastPage = Math.ceil(this.getTotalBlocks() / 2);\n        var isLastPage = lastPage === this.parent.pageSettings.currentPage && this.parent.enableColumnVirtualization;\n        var wrappers = [].slice.call(this.parent.getContent().querySelectorAll('.e-virtualtable'));\n        for (var i = 0; i < wrappers.length; i++) {\n            if (i === 0 && e.requestType === 'virtualscroll' && info.sentinelInfo.axis === 'X') {\n                continue;\n            }\n            if (lastPage !== this.parent.pageSettings.currentPage && this.parent.enableColumnVirtualization\n                && (left > 0 || (top > 0 && left === 0))) {\n                continue;\n            }\n            var cOff = isLastPage && i === 0 ? 0 : cOffset;\n            this.virtualEle.wrapper = wrappers[i];\n            this.virtualEle.adjustTable(cOff, translate);\n        }\n    };\n    // tslint:disable-next-line:max-func-body-length\n    VirtualContentRenderer.prototype.appendContent = function (target, newChild, e) {\n        var _this = this;\n        // currentInfo value will be used if there are multiple dom updates happened due to mousewheel\n        var colVFtable = this.parent.enableColumnVirtualization && this.parent.getFrozenColumns() !== 0;\n        this.checkFirstBlockColIndexes(e);\n        var info = e.virtualInfo.sentinelInfo && e.virtualInfo.sentinelInfo.axis === 'Y' && this.currentInfo.page &&\n            this.currentInfo.page !== e.virtualInfo.page ? this.currentInfo : e.virtualInfo;\n        this.prevInfo = this.prevInfo || e.virtualInfo;\n        var cBlock = (info.columnIndexes[0]) - 1;\n        if (colVFtable && info.columnIndexes[0] === this.parent.getFrozenColumns()) {\n            cBlock = (info.columnIndexes[0] - this.parent.getFrozenColumns()) - 1;\n        }\n        var cOffset = this.getColumnOffset(cBlock);\n        var width;\n        var blocks = info.blockIndexes;\n        if (this.parent.groupSettings.columns.length) {\n            this.refreshOffsets();\n        }\n        if (this.parent.height === '100%') {\n            this.parent.element.style.height = '100%';\n        }\n        var vHeight = this.parent.height.toString().indexOf('%') < 0 ? this.content.getBoundingClientRect().height :\n            this.parent.element.getBoundingClientRect().height;\n        var translate = 0;\n        if (this.parent.getFrozenColumns()) {\n            var mCont = this.parent.getMovableVirtualContent();\n            var left = mCont.scrollLeft;\n            var top_1 = mCont.scrollTop;\n            translate = this.getTranslateY(mCont.scrollTop, vHeight, info);\n            this.vfTblTransform(info, left, top_1, e, cOffset, translate);\n        }\n        else {\n            if (!this.requestTypes.some(function (value) { return value === _this.requestType; })) {\n                translate = this.getTranslateY(this.content.scrollTop, vHeight, info);\n                this.virtualEle.adjustTable(cOffset, translate);\n            }\n        }\n        if (this.parent.enableColumnVirtualization && !this.parent.getFrozenColumns()) {\n            this.header.virtualEle.adjustTable(cOffset, 0);\n        }\n        if (this.parent.enableColumnVirtualization) {\n            var cIndex = info.columnIndexes;\n            width = this.getColumnOffset(cIndex[cIndex.length - 1]) - this.getColumnOffset(cIndex[0] - 1) + '';\n            this.header.virtualEle.setWrapperWidth(width);\n        }\n        this.virtualEle.setWrapperWidth(width, Browser.isIE || Browser.info.name === 'edge');\n        if (!isNullOrUndefined(target.parentNode)) {\n            remove(target);\n        }\n        var tbody;\n        if (this.parent.getFrozenColumns() && !e.renderMovableContent) {\n            tbody = this.parent.getFrozenVirtualContent().querySelector('tbody');\n        }\n        else if (this.parent.getFrozenColumns() && e.renderMovableContent) {\n            tbody = this.parent.getMovableVirtualContent().querySelector('tbody');\n        }\n        else {\n            tbody = this.parent.element.querySelector('.e-content').querySelector('tbody');\n        }\n        if (tbody) {\n            remove(tbody);\n            target = null;\n        }\n        target = this.parent.createElement('tbody');\n        target.appendChild(newChild);\n        if (this.parent.frozenRows && e.requestType === 'virtualscroll' && this.parent.pageSettings.currentPage === 1) {\n            for (var i = 0; i < this.parent.frozenRows; i++) {\n                target.children[0].remove();\n            }\n        }\n        if (this.parent.getFrozenColumns()) {\n            if (!e.renderMovableContent) {\n                this.parent.getFrozenVirtualContent().querySelector('.e-table').appendChild(target);\n            }\n            else {\n                this.parent.getMovableVirtualContent().querySelector('.e-table').appendChild(target);\n                this.requestType = this.requestType === 'virtualscroll' ? this.empty : this.requestType;\n            }\n            if (this.vfColIndex.length) {\n                e.virtualInfo.columnIndexes = info.columnIndexes = extend([], this.vfColIndex);\n                this.vfColIndex = e.renderMovableContent ? [] : this.vfColIndex;\n            }\n        }\n        else {\n            this.getTable().appendChild(target);\n            this.requestType = this.requestType === 'virtualscroll' ? this.empty : this.requestType;\n        }\n        if (this.parent.groupSettings.columns.length) {\n            if (!isGroupAdaptive(this.parent) && info.direction === 'up') {\n                var blk = this.offsets[this.getTotalBlocks()] - this.prevHeight;\n                this.preventEvent = true;\n                var sTop = this.content.scrollTop;\n                this.content.scrollTop = sTop + blk;\n            }\n            this.setVirtualHeight();\n            this.observer.setPageHeight(this.getOffset(blocks[blocks.length - 1]) - this.getOffset(blocks[0] - 1));\n        }\n        this.prevInfo = info;\n        if (this.isFocused && this.activeKey !== 'downArrow' && this.activeKey !== 'upArrow') {\n            this.content.focus();\n        }\n        var lastPage = Math.ceil(this.getTotalBlocks() / 2);\n        if (this.isBottom) {\n            this.isBottom = false;\n            this.parent.getContent().firstElementChild.scrollTop = this.offsets[this.offsetKeys.length - 1];\n        }\n        if ((this.parent.pageSettings.currentPage === lastPage) && blocks.length === 1) {\n            this.isBottom = true;\n            this.parent.getContent().firstElementChild.scrollTop = this.offsets[this.offsetKeys.length - 2];\n        }\n        if (this.parent.enableColumnVirtualization && this.parent.getFrozenColumns()\n            && e.requestType === 'virtualscroll' && e.virtualInfo.sentinelInfo.axis === 'X') {\n            this.refreshMvTbalTransform();\n        }\n        if (e.requestType === 'virtualscroll' && e.virtualInfo.sentinelInfo.axis === 'X') {\n            this.parent.notify(events.autoCol, {});\n        }\n        this.focusCell(e);\n        this.restoreEdit();\n        this.restoreAdd();\n    };\n    VirtualContentRenderer.prototype.checkFirstBlockColIndexes = function (e) {\n        if (this.parent.enableColumnVirtualization && this.parent.getFrozenColumns() && e.virtualInfo.columnIndexes[0] === 0) {\n            var indexes = [];\n            if (!e.renderMovableContent && e.virtualInfo.columnIndexes.length > this.parent.getFrozenColumns()) {\n                this.vfColIndex = e.virtualInfo.columnIndexes;\n                for (var i = 0; i < this.parent.getFrozenColumns(); i++) {\n                    indexes.push(i);\n                }\n                e.virtualInfo.columnIndexes = indexes;\n            }\n            else if (e.renderMovableContent) {\n                if (!this.vfColIndex.length) {\n                    this.vfColIndex = extend([], e.virtualInfo.columnIndexes);\n                }\n                e.virtualInfo.columnIndexes = extend([], this.vfColIndex);\n                e.virtualInfo.columnIndexes.splice(0, this.parent.getFrozenColumns());\n            }\n        }\n    };\n    VirtualContentRenderer.prototype.focusCell = function (e) {\n        if (this.activeKey !== 'upArrow' && this.activeKey !== 'downArrow') {\n            return;\n        }\n        var row = this.parent.getRowByIndex(this.rowIndex);\n        // tslint:disable-next-line:no-any\n        var cell = row.cells[this.cellIndex];\n        cell.focus({ preventScroll: true });\n        this.parent.selectRow(parseInt(row.getAttribute('aria-rowindex'), 10));\n        this.activeKey = this.empty;\n    };\n    VirtualContentRenderer.prototype.restoreEdit = function () {\n        if (this.isNormaledit) {\n            if (this.parent.editSettings.allowEditing && this.parent.editModule && !isNullOrUndefined(this.editedRowIndex)) {\n                var row = this.getRowByIndex(this.editedRowIndex);\n                if (Object.keys(this.virtualData).length && row && !this.content.querySelector('.e-editedrow')) {\n                    var top_2 = row.getBoundingClientRect().top;\n                    if (top_2 < this.content.offsetHeight && top_2 > this.parent.getRowHeight()) {\n                        this.parent.isEdit = false;\n                        this.parent.editModule.startEdit(row);\n                    }\n                }\n                if (row && this.content.querySelector('.e-editedrow') && !Object.keys(this.virtualData).length) {\n                    var rowData = extend({}, this.getRowObjectByIndex(this.editedRowIndex));\n                    this.virtualData = this.getVirtualEditedData(rowData);\n                }\n            }\n            this.restoreAdd();\n        }\n    };\n    VirtualContentRenderer.prototype.getVirtualEditedData = function (rowData) {\n        var editForm = this.content.querySelector('.e-gridform');\n        return this.parent.editModule.getCurrentEditedData(editForm, rowData);\n    };\n    VirtualContentRenderer.prototype.restoreAdd = function () {\n        if (this.isNormaledit && this.isAdd && !this.content.querySelector('.e-addedrow')) {\n            var isTop = this.parent.editSettings.newRowPosition === 'Top' && this.content.scrollTop < this.parent.getRowHeight();\n            var isBottom = this.parent.editSettings.newRowPosition === 'Bottom'\n                && this.parent.pageSettings.currentPage === this.maxPage;\n            if (isTop || isBottom) {\n                this.parent.isEdit = false;\n                this.parent.addRecord();\n            }\n        }\n    };\n    VirtualContentRenderer.prototype.onDataReady = function (e) {\n        if (!isNullOrUndefined(e.count)) {\n            this.count = e.count;\n            this.maxPage = Math.ceil(e.count / this.parent.pageSettings.pageSize);\n        }\n        this.vgenerator.checkAndResetCache(e.requestType);\n        if (['refresh', 'filtering', 'searching', 'grouping', 'ungrouping', 'reorder', undefined]\n            .some(function (value) { return e.requestType === value; })) {\n            this.refreshOffsets();\n        }\n        if (this.parent.getFrozenColumns() && this.parent.enableColumnVirtualization) {\n            var hdrTbls = [].slice.call(this.parent.getHeaderContent().querySelectorAll('.e-table'));\n            this.header.virtualEle.table = hdrTbls[1];\n        }\n        this.setVirtualHeight();\n        this.resetScrollPosition(e.requestType);\n    };\n    /** @hidden */\n    VirtualContentRenderer.prototype.setVirtualHeight = function (height) {\n        var width = this.parent.enableColumnVirtualization ?\n            this.getColumnOffset(this.parent.columns.length + this.parent.groupSettings.columns.length - 1) + 'px' : '100%';\n        if (this.parent.getFrozenColumns()) {\n            var virtualHeightTemp = (this.parent.pageSettings.currentPage === 1 && Object.keys(this.offsets).length <= 2) ?\n                this.offsets[1] : this.offsets[this.getTotalBlocks() - 2];\n            var scrollableElementHeight = this.parent.getMovableVirtualContent().clientHeight;\n            virtualHeightTemp = virtualHeightTemp > scrollableElementHeight ? virtualHeightTemp : 0;\n            var fTblWidth = this.parent.enableColumnVirtualization ? 'auto' : width;\n            this.virtualEle.placeholder = this.parent.getFrozenVirtualContent().querySelector('.e-virtualtrack');\n            // To overcome the white space issue in last page (instead of position absolute)\n            this.virtualEle.setVirtualHeight(virtualHeightTemp, fTblWidth);\n            this.virtualEle.placeholder = this.parent.getMovableVirtualContent().querySelector('.e-virtualtrack');\n            // To overcome the white space issue in last page (instead of position absolute)\n            this.virtualEle.setVirtualHeight(virtualHeightTemp, width);\n        }\n        else {\n            var virtualHeight = (isBlazor() && this.parent.isServerRendered && this.parent.groupSettings.columns.length && height)\n                ? height : (this.offsets[isGroupAdaptive(this.parent) ? this.getGroupedTotalBlocks() : this.getTotalBlocks()]);\n            this.virtualEle.setVirtualHeight(virtualHeight, width);\n        }\n        if (this.parent.enableColumnVirtualization) {\n            this.header.virtualEle.setVirtualHeight(1, width);\n        }\n    };\n    VirtualContentRenderer.prototype.getPageFromTop = function (sTop, info) {\n        var _this = this;\n        var total = (isGroupAdaptive(this.parent)) ? this.getGroupedTotalBlocks() : this.getTotalBlocks();\n        var page = 0;\n        var extra = this.offsets[total] - this.prevHeight;\n        this.offsetKeys.some(function (offset) {\n            var iOffset = Number(offset);\n            var border = sTop <= _this.offsets[offset] || (iOffset === total && sTop > _this.offsets[offset]);\n            if (border) {\n                if (_this.offsetKeys.length % 2 !== 0 && iOffset.toString() === _this.offsetKeys[_this.offsetKeys.length - 2]\n                    && sTop <= _this.offsets[_this.offsetKeys.length - 1]) {\n                    iOffset = iOffset + 1;\n                }\n                info.block = iOffset % 2 === 0 ? 1 : 0;\n                page = Math.max(1, Math.min(_this.vgenerator.getPage(iOffset), _this.maxPage));\n            }\n            return border;\n        });\n        return page;\n    };\n    VirtualContentRenderer.prototype.getTranslateY = function (sTop, cHeight, info, isOnenter) {\n        if (info === undefined) {\n            info = { page: this.getPageFromTop(sTop, {}) };\n            info.blockIndexes = this.vgenerator.getBlockIndexes(info.page);\n        }\n        var block = (info.blockIndexes[0] || 1) - 1;\n        var translate = this.getOffset(block);\n        var endTranslate = this.getOffset(info.blockIndexes[info.blockIndexes.length - 1]);\n        if (isOnenter) {\n            info = this.prevInfo;\n        }\n        var result = translate > sTop ?\n            this.getOffset(block - 1) : endTranslate < (sTop + cHeight) ? this.getOffset(block + 1) : translate;\n        var blockHeight = this.offsets[info.blockIndexes[info.blockIndexes.length - 1]] -\n            this.tmpOffsets[info.blockIndexes[0]];\n        if (result + blockHeight > this.offsets[isGroupAdaptive(this.parent) ? this.getGroupedTotalBlocks() : this.getTotalBlocks()]) {\n            result -= (result + blockHeight) - this.offsets[this.getTotalBlocks()];\n        }\n        return result;\n    };\n    VirtualContentRenderer.prototype.getOffset = function (block) {\n        return Math.min(this.offsets[block] | 0, this.offsets[this.maxBlock] | 0);\n    };\n    VirtualContentRenderer.prototype.onEntered = function () {\n        var _this = this;\n        return function (element, current, direction, e, isWheel, check) {\n            if (Browser.isIE && !isWheel && check && !_this.preventEvent) {\n                _this.parent.showSpinner();\n            }\n            var xAxis = current.axis === 'X';\n            var top = _this.prevInfo.offsets ? _this.prevInfo.offsets.top : null;\n            var height = _this.content.getBoundingClientRect().height;\n            var x = _this.getColumnOffset(xAxis ? _this.vgenerator.getColumnIndexes()[0] - 1 : _this.prevInfo.columnIndexes[0] - 1);\n            var y = _this.getTranslateY(e.top, height, xAxis && top === e.top ? _this.prevInfo : undefined, true);\n            if (isBlazor() && _this.parent.isServerRendered && _this.currentInfo && _this.currentInfo.startIndex && xAxis) {\n                y = _this.currentInfo.startIndex * _this.parent.getRowHeight();\n            }\n            _this.virtualEle.adjustTable(x, Math.min(y, _this.offsets[_this.maxBlock]));\n            if (isBlazor() && _this.parent.isServerRendered && xAxis) {\n                _this.parent.notify('setcolumnstyles', { refresh: true });\n            }\n            if (_this.parent.getFrozenColumns() && !xAxis) {\n                var left = _this.parent.getMovableVirtualContent().scrollLeft;\n                if (_this.parent.enableColumnVirtualization && left > 0) {\n                    var fvTable = _this.parent.getFrozenVirtualContent().querySelector('.e-virtualtable');\n                    fvTable.style.transform = \"translate(\" + 0 + \"px, \" + Math.min(y, _this.offsets[_this.maxBlock]) + \"px)\";\n                }\n                else {\n                    var fvTable = _this.parent.getFrozenVirtualContent().querySelector('.e-virtualtable');\n                    fvTable.style.transform = \"translate(\" + x + \"px, \" + Math.min(y, _this.offsets[_this.maxBlock]) + \"px)\";\n                }\n            }\n            if (_this.parent.enableColumnVirtualization && (!isBlazor() || (isBlazor() && !_this.parent.isServerRendered))) {\n                _this.header.virtualEle.adjustTable(x, 0);\n            }\n        };\n    };\n    VirtualContentRenderer.prototype.dataBound = function () {\n        if (this.isSelection && this.activeKey !== 'upArrow' && this.activeKey !== 'downArrow') {\n            this.parent.selectRow(this.selectedRowIndex);\n        }\n        else if (!isBlazor()) {\n            this.activeKey = this.empty;\n        }\n    };\n    VirtualContentRenderer.prototype.rowSelected = function () {\n        this.isSelection = false;\n    };\n    VirtualContentRenderer.prototype.eventListener = function (action) {\n        var _this = this;\n        this.parent[action](dataReady, this.onDataReady, this);\n        this.parent.addEventListener(events.dataBound, this.dataBound.bind(this));\n        this.parent.addEventListener(events.actionBegin, this.actionBegin.bind(this));\n        this.parent.addEventListener(events.actionComplete, this.actionComplete.bind(this));\n        this.parent.addEventListener(events.rowSelected, this.rowSelected.bind(this));\n        this.parent[action](refreshVirtualBlock, this.refreshContentRows, this);\n        this.parent[action](events.selectVirtualRow, this.selectVirtualRow, this);\n        this.parent[action](events.virtaulCellFocus, this.virtualCellFocus, this);\n        this.parent[action](events.virtualScrollEditActionBegin, this.editActionBegin, this);\n        this.parent[action](events.virtualScrollAddActionBegin, this.addActionBegin, this);\n        this.parent[action](events.virtualScrollEdit, this.restoreEdit, this);\n        this.parent[action](events.virtualScrollEditSuccess, this.editSuccess, this);\n        this.parent[action](events.refreshVirtualCache, this.refreshCache, this);\n        this.parent[action](events.editReset, this.resetIsedit, this);\n        this.parent[action](events.getVirtualData, this.getVirtualData, this);\n        this.parent[action](events.virtualScrollEditCancel, this.editCancel, this);\n        var event = this.actions;\n        for (var i = 0; i < event.length; i++) {\n            this.parent[action](event[i] + \"-begin\", this.onActionBegin, this);\n        }\n        var fn = function () {\n            _this.observer.observe(function (scrollArgs) { return _this.scrollListener(scrollArgs); }, _this.onEntered());\n            var gObj = _this.parent;\n            if (gObj.enablePersistence && gObj.scrollPosition) {\n                _this.content.scrollTop = gObj.scrollPosition.top;\n                var scrollValues = { direction: 'down', sentinel: _this.observer.sentinelInfo.down,\n                    offset: gObj.scrollPosition, focusElement: gObj.element };\n                _this.scrollListener(scrollValues);\n                if (gObj.enableColumnVirtualization) {\n                    _this.content.scrollLeft = gObj.scrollPosition.left;\n                }\n            }\n            _this.parent.off(contentReady, fn);\n        };\n        this.parent.on(contentReady, fn, this);\n    };\n    VirtualContentRenderer.prototype.getVirtualData = function (data) {\n        data.virtualData = this.virtualData;\n        data.isAdd = this.isAdd;\n        data.isCancel = this.isCancel;\n    };\n    VirtualContentRenderer.prototype.editCancel = function (args) {\n        var dataIndex = getEditedDataIndex(this.parent, args.data);\n        if (!isNullOrUndefined(dataIndex)) {\n            args.data = this.parent.getCurrentViewRecords()[dataIndex];\n        }\n    };\n    VirtualContentRenderer.prototype.editSuccess = function (args) {\n        if (this.isNormaledit) {\n            if (!this.isAdd && args.data) {\n                this.updateCurrentViewData(args.data);\n            }\n            this.isAdd = false;\n        }\n    };\n    VirtualContentRenderer.prototype.updateCurrentViewData = function (data) {\n        var dataIndex = getEditedDataIndex(this.parent, data);\n        if (!isNullOrUndefined(dataIndex)) {\n            this.parent.getCurrentViewRecords()[dataIndex] = data;\n        }\n    };\n    VirtualContentRenderer.prototype.actionBegin = function (args) {\n        if (args.requestType !== 'virtualscroll') {\n            this.requestType = args.requestType;\n        }\n    };\n    VirtualContentRenderer.prototype.virtualCellFocus = function (e) {\n        // To decide the action (select or scroll), when using arrow keys for cell focus\n        var ele = document.activeElement;\n        if (ele.classList.contains('e-rowcell')\n            && e && (e.action === 'upArrow' || e.action === 'downArrow')) {\n            var rowIndex = parseInt(ele.parentElement.getAttribute('aria-rowindex'), 10);\n            if (e && (e.action === 'downArrow' || e.action === 'upArrow')) {\n                var scrollEle = this.parent.getContent().firstElementChild;\n                e.action === 'downArrow' ? rowIndex += 1 : rowIndex -= 1;\n                this.rowIndex = rowIndex;\n                this.cellIndex = parseInt(ele.getAttribute('aria-colindex'), 10);\n                var row = this.parent.getRowByIndex(rowIndex);\n                var page = this.parent.pageSettings.currentPage;\n                var visibleRowCount = Math.floor(scrollEle.offsetHeight / this.parent.getRowHeight()) - 1;\n                var emptyRow = false;\n                if (isNullOrUndefined(row)) {\n                    emptyRow = true;\n                    if ((e.action === 'downArrow' && page === this.maxPage - 1) || (e.action === 'upArrow' && page === 1)) {\n                        emptyRow = false;\n                    }\n                }\n                if (emptyRow || (ensureLastRow(row, this.parent) && e.action === 'downArrow')\n                    || (ensureFirstRow(row, this.parent.getRowHeight() * 2) && e.action === 'upArrow')) {\n                    this.activeKey = e.action;\n                    scrollEle.scrollTop = e.action === 'downArrow' ?\n                        (rowIndex - visibleRowCount) * this.parent.getRowHeight() : rowIndex * this.parent.getRowHeight();\n                }\n                else {\n                    this.activeKey = this.empty;\n                }\n                if (!isBlazor() || (isBlazor() && !this.blazorDataLoad)) {\n                    this.parent.selectRow(rowIndex);\n                }\n            }\n        }\n    };\n    VirtualContentRenderer.prototype.editActionBegin = function (e) {\n        this.editedRowIndex = e.index;\n        var rowData = extend({}, this.getRowObjectByIndex(e.index));\n        e.data = Object.keys(this.virtualData).length ? this.virtualData : rowData;\n    };\n    VirtualContentRenderer.prototype.refreshCache = function (data) {\n        var block = Math.ceil((this.editedRowIndex + 1) / this.getBlockSize());\n        var index = this.editedRowIndex - ((block - 1) * this.getBlockSize());\n        this.vgenerator.cache[block][index].data = data;\n    };\n    VirtualContentRenderer.prototype.actionComplete = function (args) {\n        if (args.requestType === 'delete' || args.requestType === 'save' || args.requestType === 'cancel') {\n            this.refreshOffsets();\n            this.refreshVirtualElement();\n            if (this.isNormaledit) {\n                if (args.requestType === 'cancel') {\n                    this.isCancel = true;\n                }\n                this.isAdd = false;\n                this.editedRowIndex = this.empty;\n                this.virtualData = {};\n                this.parent.editModule.previousVirtualData = {};\n            }\n        }\n        if (this.parent.enableColumnVirtualization && args.requestType === 'filterafteropen'\n            && this.currentInfo.columnIndexes && this.currentInfo.columnIndexes[0] > 0) {\n            this.parent.resetFilterDlgPosition(args.columnName);\n        }\n    };\n    VirtualContentRenderer.prototype.resetIsedit = function () {\n        if (this.parent.enableVirtualization && this.isNormaledit) {\n            if ((this.parent.editSettings.allowEditing && Object.keys(this.virtualData).length)\n                || (this.parent.editSettings.allowAdding && this.isAdd)) {\n                this.parent.isEdit = true;\n            }\n        }\n    };\n    VirtualContentRenderer.prototype.scrollAfterEdit = function () {\n        if (this.parent.editModule && this.parent.editSettings.allowEditing && this.isNormaledit) {\n            if (this.content.querySelector('.e-gridform')) {\n                var editForm = this.content.querySelector('.e-editedrow');\n                var addForm = this.content.querySelector('.e-addedrow');\n                if (editForm || addForm) {\n                    var rowData = editForm ? extend({}, this.getRowObjectByIndex(this.editedRowIndex))\n                        : extend({}, this.emptyRowData);\n                    this.virtualData = this.getVirtualEditedData(rowData);\n                }\n            }\n        }\n    };\n    VirtualContentRenderer.prototype.createEmptyRowdata = function () {\n        var _this = this;\n        this.parent.getColumns().filter(function (e) {\n            _this.emptyRowData[e.field] = _this.empty;\n        });\n    };\n    VirtualContentRenderer.prototype.addActionBegin = function (args) {\n        if (this.isNormaledit) {\n            if (!Object.keys(this.emptyRowData).length) {\n                this.createEmptyRowdata();\n            }\n            this.isAdd = true;\n            var page = this.parent.pageSettings.currentPage;\n            if (page > 1 && this.parent.editSettings.newRowPosition === 'Top') {\n                this.isAdd = true;\n                this.onActionBegin();\n                args.startEdit = false;\n                this.content.scrollTop = 0;\n            }\n            if (page < this.maxPage - 1 && this.parent.editSettings.newRowPosition === 'Bottom') {\n                this.isAdd = true;\n                this.parent.setProperties({ pageSettings: { currentPage: this.maxPage - 1 } }, true);\n                args.startEdit = false;\n                this.content.scrollTop = this.offsets[this.offsetKeys.length];\n            }\n        }\n    };\n    /** @hidden */\n    VirtualContentRenderer.prototype.getRowObjectByIndex = function (index) {\n        var data = this.getRowCollection(index, false, true);\n        return data;\n    };\n    VirtualContentRenderer.prototype.getBlockSize = function () {\n        return this.parent.pageSettings.pageSize >> 1;\n    };\n    VirtualContentRenderer.prototype.getBlockHeight = function () {\n        return this.getBlockSize() * this.parent.getRowHeight();\n    };\n    VirtualContentRenderer.prototype.isEndBlock = function (index) {\n        var totalBlocks = this.getTotalBlocks();\n        return index >= totalBlocks || index === totalBlocks - 1;\n    };\n    VirtualContentRenderer.prototype.getGroupedTotalBlocks = function () {\n        var rows = this.parent.vcRows;\n        return Math.floor((rows.length / this.getBlockSize()) < 1 ? 1 : rows.length / this.getBlockSize());\n    };\n    VirtualContentRenderer.prototype.getTotalBlocks = function () {\n        return Math.ceil(this.count / this.getBlockSize());\n    };\n    VirtualContentRenderer.prototype.getColumnOffset = function (block) {\n        return this.vgenerator.cOffsets[block] | 0;\n    };\n    VirtualContentRenderer.prototype.getModelGenerator = function () {\n        return new VirtualRowModelGenerator(this.parent);\n    };\n    VirtualContentRenderer.prototype.resetScrollPosition = function (action) {\n        if (this.actions.some(function (value) { return value === action; })) {\n            var content = this.parent.getFrozenColumns() ? this.parent.getMovableVirtualContent() : this.content;\n            this.preventEvent = content.scrollTop !== 0;\n            content.scrollTop = 0;\n        }\n        if (action !== 'virtualscroll') {\n            this.isAdd = false;\n        }\n    };\n    VirtualContentRenderer.prototype.onActionBegin = function (e) {\n        //Update property silently..\n        this.parent.setProperties({ pageSettings: { currentPage: 1 } }, true);\n    };\n    VirtualContentRenderer.prototype.getRows = function () {\n        return this.vgenerator.getRows();\n    };\n    VirtualContentRenderer.prototype.getRowByIndex = function (index) {\n        if (isGroupAdaptive(this.parent)) {\n            return this.parent.getDataRows()[index];\n        }\n        return this.getRowCollection(index, false);\n    };\n    VirtualContentRenderer.prototype.getMovableVirtualRowByIndex = function (index) {\n        return this.getRowCollection(index, true);\n    };\n    VirtualContentRenderer.prototype.getRowCollection = function (index, isMovable, isRowObject) {\n        var prev = this.prevInfo.blockIndexes;\n        var startIdx = (!isBlazor() || (isBlazor() && !this.parent.isServerRendered)) ?\n            (prev[0] - 1) * this.getBlockSize() : this.startIndex;\n        var rowCollection = isMovable ? this.parent.getMovableDataRows() : this.parent.getDataRows();\n        var collection = isRowObject ? this.parent.getCurrentViewRecords() : rowCollection;\n        var selectedRow = collection[index - startIdx];\n        if (!isRowObject && this.parent.frozenRows && this.parent.pageSettings.currentPage > 1) {\n            selectedRow = index <= this.parent.frozenRows ? rowCollection[index]\n                : rowCollection[(index - startIdx) + this.parent.frozenRows];\n        }\n        return selectedRow;\n    };\n    VirtualContentRenderer.prototype.getVirtualRowIndex = function (index) {\n        var prev = this.prevInfo.blockIndexes;\n        var startIdx = (prev[0] - 1) * this.getBlockSize();\n        return startIdx + index;\n    };\n    /** @hidden */\n    VirtualContentRenderer.prototype.refreshOffsets = function () {\n        var gObj = this.parent;\n        var row = 0;\n        var bSize = this.getBlockSize();\n        var total = isGroupAdaptive(this.parent) ? this.getGroupedTotalBlocks() : this.getTotalBlocks();\n        this.prevHeight = this.offsets[total];\n        this.maxBlock = total % 2 === 0 ? total - 2 : total - 1;\n        this.offsets = {};\n        //Row offset update\n        var blocks = Array.apply(null, Array(total)).map(function () { return ++row; });\n        for (var i = 0; i < blocks.length; i++) {\n            var tmp = (this.vgenerator.cache[blocks[i]] || []).length;\n            var rem = !isGroupAdaptive(this.parent) ? this.count % bSize : (gObj.vcRows.length % bSize);\n            var size = !isGroupAdaptive(this.parent) && blocks[i] in this.vgenerator.cache ?\n                tmp * this.parent.getRowHeight() : rem && blocks[i] === total ? rem * this.parent.getRowHeight() :\n                this.getBlockHeight();\n            // let size: number = this.parent.groupSettings.columns.length && block in this.vgenerator.cache ?\n            // tmp * getRowHeight() : this.getBlockHeight();\n            this.offsets[blocks[i]] = (this.offsets[blocks[i] - 1] | 0) + size;\n            this.tmpOffsets[blocks[i]] = this.offsets[blocks[i] - 1] | 0;\n        }\n        this.offsetKeys = Object.keys(this.offsets);\n        if (isGroupAdaptive(this.parent)) {\n            this.parent.vGroupOffsets = this.offsets;\n        }\n        //Column offset update\n        if (this.parent.enableColumnVirtualization) {\n            this.vgenerator.refreshColOffsets();\n        }\n    };\n    VirtualContentRenderer.prototype.refreshVirtualElement = function () {\n        this.vgenerator.refreshColOffsets();\n        this.setVirtualHeight();\n    };\n    VirtualContentRenderer.prototype.setVisible = function (columns) {\n        var gObj = this.parent;\n        var frozenCols = this.parent.getFrozenColumns();\n        var fcntColGrp;\n        var mcntColGrp;\n        if (frozenCols) {\n            fcntColGrp = [].slice.call(this.parent.getFrozenVirtualContent().querySelectorAll('col'));\n            mcntColGrp = [].slice.call(this.parent.getMovableVirtualContent().querySelectorAll('col'));\n        }\n        if (isBlazor() && gObj.isServerRendered) {\n            this.parent.notify('setvisibility', columns);\n        }\n        var rows = [];\n        rows = this.getRows();\n        var testRow;\n        rows.some(function (r) { if (r.isDataRow) {\n            testRow = r;\n        } return r.isDataRow; });\n        var needFullRefresh = true;\n        if (!gObj.groupSettings.columns.length && testRow) {\n            needFullRefresh = false;\n        }\n        var tr = gObj.getDataRows();\n        for (var c = 0, clen = columns.length; c < clen; c++) {\n            var column = columns[c];\n            var idx = gObj.getNormalizedColumnIndex(column.uid);\n            var displayVal = column.visible === true ? '' : 'none';\n            var colGrp = void 0;\n            if (fcntColGrp && mcntColGrp) {\n                if (idx >= frozenCols) {\n                    colGrp = mcntColGrp;\n                    tr = this.parent.getMovableRows();\n                    idx = idx - frozenCols;\n                }\n                else {\n                    colGrp = fcntColGrp;\n                }\n            }\n            else {\n                colGrp = this.getColGroup().children;\n            }\n            if (idx !== -1 && testRow && idx < testRow.cells.length) {\n                setStyleAttribute(colGrp[idx], { 'display': displayVal });\n            }\n            if (!needFullRefresh) {\n                var width = void 0;\n                if (column.visible) {\n                    width = this.virtualEle.wrapper.offsetWidth + parseInt(column.width.toString(), 10);\n                }\n                else {\n                    width = this.virtualEle.wrapper.offsetWidth - parseInt(column.width.toString(), 10);\n                }\n                if (width > gObj.width) {\n                    this.setDisplayNone(tr, idx, displayVal, rows);\n                    if (this.parent.enableColumnVirtualization) {\n                        this.virtualEle.setWrapperWidth(width + '');\n                    }\n                    this.refreshVirtualElement();\n                }\n                else {\n                    needFullRefresh = true;\n                }\n            }\n            if (!this.parent.invokedFromMedia && column.hideAtMedia) {\n                this.parent.updateMediaColumns(column);\n            }\n            this.parent.invokedFromMedia = false;\n        }\n        if (isBlazor() && this.parent.isServerRendered && needFullRefresh) {\n            var inViewIdx = this.parent.inViewIndexes;\n            var translateX = this.getColumnOffset(inViewIdx[0] - 1);\n            var width = this.getColumnOffset(inViewIdx[inViewIdx.length - 1]) - translateX + '';\n            this.parent.notify('refresh-virtual-indices', { requestType: 'virtualScrollRefresh',\n                startColumnIndex: inViewIdx[0], endColumnIndex: inViewIdx[inViewIdx.length - 1], axis: 'X',\n                VTablewidth: width, translateX: translateX });\n            this.parent.notify('setcolumnstyles', {});\n        }\n        if (needFullRefresh || frozenCols) {\n            this.refreshContentRows({ requestType: 'refresh' });\n        }\n        else {\n            this.parent.notify(events.partialRefresh, { rows: rows, args: { isFrozen: false, rows: rows } });\n        }\n    };\n    VirtualContentRenderer.prototype.selectVirtualRow = function (args) {\n        var _this = this;\n        if (this.activeKey !== 'upArrow' && this.activeKey !== 'downArrow'\n            && !this.requestTypes.some(function (value) { return value === _this.requestType; }) && !this.parent.selectionModule.isInteracted) {\n            var ele = this.parent.getFrozenColumns() ? this.parent.getMovableVirtualContent()\n                : this.parent.getContent().firstElementChild;\n            var selectedRow = this.parent.getRowByIndex(args.selectedIndex);\n            var rowHeight = this.parent.getRowHeight();\n            var eleOffsHeight = ele.offsetHeight;\n            if (!selectedRow || this.isRowInView(args.selectedIndex, selectedRow, ele, eleOffsHeight, rowHeight)) {\n                this.isSelection = true;\n                this.selectedRowIndex = args.selectedIndex;\n                var scrollTop = (args.selectedIndex + 1) * rowHeight;\n                if (!isNullOrUndefined(scrollTop)) {\n                    ele.scrollTop = scrollTop;\n                }\n            }\n        }\n        this.requestType = this.empty;\n    };\n    VirtualContentRenderer.prototype.isRowInView = function (index, selectedRow, ele, eleOffsHeight, rowHeight) {\n        if (isBlazor()) {\n            var exactTopIndex = ele.scrollTop / rowHeight;\n            var exactEndIndex = exactTopIndex + (eleOffsHeight / rowHeight);\n            return (index < exactTopIndex || index > exactEndIndex);\n        }\n        else {\n            if (this.parent.frozenRows && index < this.parent.frozenRows) {\n                return false;\n            }\n            var rectTop = selectedRow ? selectedRow.getBoundingClientRect().top : 0;\n            return (rectTop < rowHeight || rectTop > eleOffsHeight);\n        }\n    };\n    return VirtualContentRenderer;\n}(ContentRender));\nexport { VirtualContentRenderer };\n/**\n * @hidden\n */\nvar VirtualHeaderRenderer = /** @class */ (function (_super) {\n    __extends(VirtualHeaderRenderer, _super);\n    function VirtualHeaderRenderer(parent, locator) {\n        var _this = _super.call(this, parent, locator) || this;\n        _this.virtualEle = new VirtualElementHandler();\n        _this.gen = new VirtualRowModelGenerator(_this.parent);\n        _this.parent.on(events.columnVisibilityChanged, _this.setVisible, _this);\n        _this.parent.on(refreshVirtualBlock, function (e) { return e.virtualInfo.sentinelInfo.axis === 'X' ? _this.refreshUI() : null; }, _this);\n        return _this;\n    }\n    VirtualHeaderRenderer.prototype.renderTable = function () {\n        this.gen.refreshColOffsets();\n        this.parent.setColumnIndexesInView(this.gen.getColumnIndexes(this.getPanel().querySelector('.e-headercontent')));\n        if (isBlazor() && this.parent.isServerRendered) {\n            this.parent.notify('refresh-virtual-indices', {\n                startColumnIndex: this.parent.contentModule.startColIndex,\n                endColumnIndex: this.parent.contentModule.endColIndex, axis: 'X'\n            });\n        }\n        _super.prototype.renderTable.call(this);\n        this.virtualEle.table = this.getTable();\n        this.virtualEle.content = this.getPanel().querySelector('.e-headercontent');\n        if (!this.parent.getFrozenColumns()) {\n            this.virtualEle.content.style.position = 'relative';\n        }\n        this.virtualEle.renderWrapper();\n        this.virtualEle.renderPlaceHolder('absolute');\n    };\n    VirtualHeaderRenderer.prototype.appendContent = function (table) {\n        this.virtualEle.wrapper.appendChild(table);\n    };\n    VirtualHeaderRenderer.prototype.refreshUI = function () {\n        this.setFrozenTable(this.parent.getMovableVirtualContent());\n        this.gen.refreshColOffsets();\n        this.parent.setColumnIndexesInView(this.gen.getColumnIndexes(this.getPanel().querySelector('.e-headercontent')));\n        _super.prototype.refreshUI.call(this);\n        this.setFrozenTable(this.parent.getFrozenVirtualContent());\n    };\n    VirtualHeaderRenderer.prototype.setVisible = function (columns) {\n        var gObj = this.parent;\n        var displayVal;\n        var idx;\n        var needFullRefresh;\n        var frozenCols = this.parent.getFrozenColumns();\n        var fhdrColGrp;\n        var mhdrColGrp;\n        if (frozenCols) {\n            fhdrColGrp = [].slice.call(this.parent.getFrozenVirtualHeader().querySelectorAll('col'));\n            mhdrColGrp = [].slice.call(this.parent.getMovableVirtualHeader().querySelectorAll('col'));\n        }\n        for (var c = 0, clen = columns.length; c < clen; c++) {\n            var column = columns[c];\n            idx = gObj.getNormalizedColumnIndex(column.uid);\n            displayVal = column.visible ? '' : 'none';\n            var colGrp = void 0;\n            if (fhdrColGrp && mhdrColGrp) {\n                if (idx >= frozenCols) {\n                    colGrp = mhdrColGrp;\n                    idx = idx - frozenCols;\n                }\n                else {\n                    colGrp = fhdrColGrp;\n                }\n            }\n            else {\n                colGrp = this.getColGroup().children;\n            }\n            setStyleAttribute(colGrp[idx], { 'display': displayVal });\n            if (gObj.enableColumnVirtualization && !gObj.groupSettings.columns.length) {\n                var tablewidth = void 0;\n                if (column.visible) {\n                    tablewidth = this.virtualEle.wrapper.offsetWidth + parseInt(column.width.toString(), 10);\n                }\n                else {\n                    tablewidth = this.virtualEle.wrapper.offsetWidth - parseInt(column.width.toString(), 10);\n                }\n                if (tablewidth > gObj.width) {\n                    this.setDisplayNone(column, displayVal);\n                    this.virtualEle.setWrapperWidth(tablewidth + '');\n                    this.gen.refreshColOffsets();\n                }\n                else {\n                    needFullRefresh = true;\n                }\n            }\n            else {\n                needFullRefresh = true;\n            }\n            if (needFullRefresh && !frozenCols) {\n                this.refreshUI();\n            }\n        }\n        if (frozenCols) {\n            this.parent.notify(events.columnPositionChanged, {});\n        }\n    };\n    VirtualHeaderRenderer.prototype.setFrozenTable = function (content) {\n        if (this.parent.getFrozenColumns() && this.parent.enableColumnVirtualization\n            && this.parent.contentModule.isXaxis()) {\n            this.parent.contentModule\n                .setTable(content.querySelector('.e-table'));\n        }\n    };\n    VirtualHeaderRenderer.prototype.setDisplayNone = function (col, displayVal) {\n        var frozenCols = this.parent.getFrozenColumns();\n        var table = this.getTable();\n        if (frozenCols && col.index >= frozenCols) {\n            table = this.parent.getMovableVirtualHeader().querySelector('.e-table');\n        }\n        for (var _i = 0, _a = [].slice.apply(table.querySelectorAll('th.e-headercell')); _i < _a.length; _i++) {\n            var ele = _a[_i];\n            if (ele.querySelector('[e-mappinguid]') &&\n                ele.querySelector('[e-mappinguid]').getAttribute('e-mappinguid') === col.uid) {\n                setStyleAttribute(ele, { 'display': displayVal });\n                if (displayVal === '') {\n                    removeClass([ele], 'e-hide');\n                }\n                break;\n            }\n        }\n    };\n    return VirtualHeaderRenderer;\n}(HeaderRender));\nexport { VirtualHeaderRenderer };\n/**\n * @hidden\n */\nvar VirtualElementHandler = /** @class */ (function () {\n    function VirtualElementHandler() {\n    }\n    VirtualElementHandler.prototype.renderWrapper = function (height) {\n        if (isBlazor()) {\n            this.wrapper = this.content.querySelector('.e-virtualtable') ? this.content.querySelector('.e-virtualtable') :\n                createElement('div', { className: 'e-virtualtable' });\n            this.wrapper.setAttribute('styles', \"min-height:\" + formatUnit(height));\n        }\n        else {\n            this.wrapper = createElement('div', { className: 'e-virtualtable', styles: \"min-height:\" + formatUnit(height) });\n        }\n        this.wrapper.appendChild(this.table);\n        this.content.appendChild(this.wrapper);\n    };\n    VirtualElementHandler.prototype.renderPlaceHolder = function (position) {\n        if (position === void 0) { position = 'relative'; }\n        if (isBlazor()) {\n            this.placeholder = this.content.querySelector('.e-virtualtrack') ? this.content.querySelector('.e-virtualtrack') :\n                createElement('div', { className: 'e-virtualtrack' });\n            this.placeholder.setAttribute('styles', \"position:\" + position);\n        }\n        else {\n            this.placeholder = createElement('div', { className: 'e-virtualtrack', styles: \"position:\" + position });\n        }\n        this.content.appendChild(this.placeholder);\n    };\n    VirtualElementHandler.prototype.adjustTable = function (xValue, yValue) {\n        this.wrapper.style.transform = \"translate(\" + xValue + \"px, \" + yValue + \"px)\";\n    };\n    VirtualElementHandler.prototype.setWrapperWidth = function (width, full) {\n        this.wrapper.style.width = width ? width + \"px\" : full ? '100%' : '';\n    };\n    VirtualElementHandler.prototype.setVirtualHeight = function (height, width) {\n        this.placeholder.style.height = height + \"px\";\n        this.placeholder.style.width = width;\n    };\n    VirtualElementHandler.prototype.setFreezeWrapperWidth = function (wrapper, width, full) {\n        wrapper.style.width = width ? width + \"px\" : full ? '100%' : '';\n    };\n    return VirtualElementHandler;\n}());\nexport { VirtualElementHandler };\n"]},"metadata":{},"sourceType":"module"}