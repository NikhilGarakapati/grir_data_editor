{"ast":null,"code":"import { isNullOrUndefined, remove, extend } from '@syncfusion/ej2-base';\nimport { RowModelGenerator } from '../services/row-model-generator';\nimport { FreezeRowModelGenerator } from '../services/freeze-row-model-generator';\nimport { RowRenderer } from '../renderer/row-renderer';\nimport * as events from '../base/constant';\nimport { getScrollBarWidth, ensureLastRow, ensureFirstRow, getEditedDataIndex } from '../base/util';\n/**\n * Infinite Scrolling class\n */\n\nvar InfiniteScroll =\n/** @class */\nfunction () {\n  /**\n   * Constructor for the Grid infinite scrolling.\n   * @hidden\n   */\n  function InfiniteScroll(parent, serviceLocator) {\n    this.infiniteCache = {};\n    this.infiniteFrozenCache = {};\n    this.isDownScroll = false;\n    this.isUpScroll = false;\n    this.isScroll = true;\n    this.enableContinuousScroll = false;\n    this.initialRender = true;\n    this.isRemove = false;\n    this.isInitialCollapse = false;\n    this.prevScrollTop = 0;\n    this.actions = ['filtering', 'searching', 'grouping', 'ungrouping', 'reorder', 'sorting'];\n    this.keys = ['downArrow', 'upArrow', 'PageUp', 'PageDown'];\n    this.rowTop = 0;\n    this.isInitialMovableRender = true;\n    this.virtualInfiniteData = {};\n    this.isCancel = false;\n    this.emptyRowData = {};\n    this.isNormaledit = false;\n    this.isInfiniteScroll = false;\n    this.isLastPage = false;\n    this.parent = parent;\n    this.serviceLocator = serviceLocator;\n    this.isNormaledit = this.parent.editSettings.mode === 'Normal';\n    this.addEventListener();\n    this.rowModelGenerator = this.parent.getFrozenColumns() ? new FreezeRowModelGenerator(this.parent) : new RowModelGenerator(this.parent);\n  }\n\n  InfiniteScroll.prototype.getModuleName = function () {\n    return 'infiniteScroll';\n  };\n  /**\n   * @hidden\n   */\n\n\n  InfiniteScroll.prototype.addEventListener = function () {\n    this.parent.on(events.dataReady, this.onDataReady, this);\n    this.parent.on(events.dataSourceModified, this.dataSourceModified, this);\n    this.parent.on(events.infinitePageQuery, this.infinitePageQuery, this);\n    this.parent.on(events.infiniteScrollHandler, this.infiniteScrollHandler, this);\n    this.parent.on(events.beforeCellFocused, this.infiniteCellFocus, this);\n    this.parent.on(events.appendInfiniteContent, this.appendInfiniteRows, this);\n    this.parent.on(events.removeInfiniteRows, this.removeInfiniteCacheRows, this);\n    this.parent.on(events.resetInfiniteBlocks, this.resetInfiniteBlocks, this);\n    this.parent.on(events.setInfiniteCache, this.setCache, this);\n    this.parent.on(events.initialCollapse, this.ensureIntialCollapse, this);\n    this.parent.on(events.keyPressed, this.infiniteCellFocus, this);\n    this.parent.on(events.infiniteShowHide, this.setDisplayNone, this);\n    this.parent.on(events.virtualScrollEditActionBegin, this.editActionBegin, this);\n    this.parent.on(events.getVirtualData, this.getVirtualInfiniteData, this);\n    this.parent.on(events.editReset, this.resetInfiniteEdit, this);\n    this.parent.on(events.virtualScrollEditSuccess, this.infiniteEditSuccess, this);\n    this.parent.on(events.refreshVirtualCache, this.refreshInfiniteCache, this);\n    this.parent.on(events.infiniteEditHandler, this.infiniteEditHandler, this);\n    this.parent.on(events.virtualScrollAddActionBegin, this.infiniteAddActionBegin, this);\n    this.parent.on(events.modelChanged, this.modelChanged, this);\n    this.parent.addEventListener(events.actionBegin, this.actionBegin.bind(this));\n    this.parent.addEventListener(events.actionComplete, this.actionComplete.bind(this));\n  };\n  /**\n   * @hidden\n   */\n\n\n  InfiniteScroll.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.dataReady, this.onDataReady);\n    this.parent.off(events.dataSourceModified, this.dataSourceModified);\n    this.parent.off(events.infinitePageQuery, this.infinitePageQuery);\n    this.parent.off(events.infiniteScrollHandler, this.infiniteScrollHandler);\n    this.parent.off(events.beforeCellFocused, this.infiniteCellFocus);\n    this.parent.off(events.appendInfiniteContent, this.appendInfiniteRows);\n    this.parent.off(events.removeInfiniteRows, this.removeInfiniteCacheRows);\n    this.parent.off(events.resetInfiniteBlocks, this.resetInfiniteBlocks);\n    this.parent.off(events.setInfiniteCache, this.setCache);\n    this.parent.off(events.initialCollapse, this.ensureIntialCollapse);\n    this.parent.off(events.keyPressed, this.infiniteCellFocus);\n    this.parent.off(events.infiniteShowHide, this.setDisplayNone);\n    this.parent.off(events.virtualScrollEditActionBegin, this.editActionBegin);\n    this.parent.off(events.getVirtualData, this.getVirtualInfiniteData);\n    this.parent.off(events.editReset, this.resetInfiniteEdit);\n    this.parent.off(events.virtualScrollEditSuccess, this.infiniteEditSuccess);\n    this.parent.off(events.refreshVirtualCache, this.refreshInfiniteCache);\n    this.parent.off(events.infiniteEditHandler, this.infiniteEditHandler);\n    this.parent.off(events.virtualScrollAddActionBegin, this.infiniteAddActionBegin);\n    this.parent.off(events.modelChanged, this.modelChanged);\n    this.parent.removeEventListener(events.actionBegin, this.actionBegin.bind(this));\n    this.parent.removeEventListener(events.actionComplete, this.actionComplete.bind(this));\n  };\n\n  InfiniteScroll.prototype.modelChanged = function (args) {\n    if (args.requestType !== 'infiniteScroll' && (args.requestType === 'delete' || this.requestType === 'add')) {\n      var rows = this.parent.getRows();\n      this.firstIndex = parseInt(rows[0].getAttribute('aria-rowindex'), 10);\n      this.firstBlock = Math.ceil((this.firstIndex + 1) / this.parent.pageSettings.pageSize);\n      this.lastIndex = parseInt(rows[rows.length - 1].getAttribute('aria-rowindex'), 10);\n\n      if (args.requestType === 'delete') {\n        var rowObj = this.parent.getRowsObject();\n        args.startIndex = this.parent.infiniteScrollSettings.enableCache ? (this.firstBlock - 1) * this.parent.pageSettings.pageSize : rowObj[rowObj.length - 1].index;\n      } else {\n        args.startIndex = this.firstIndex;\n      }\n\n      if (!this.parent.infiniteScrollSettings.enableCache && this.parent.pageSettings.currentPage === this.maxPage && args.requestType === 'delete') {\n        this.isLastPage = true;\n        this.lastIndex = this.lastIndex - 1;\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.infiniteAddActionBegin = function (args) {\n    if (this.isNormaledit) {\n      this.isAdd = true;\n\n      if (this.parent.infiniteScrollSettings.enableCache) {\n        if (!Object.keys(this.emptyRowData).length) {\n          this.createEmptyRowdata();\n        }\n\n        if (this.parent.pageSettings.currentPage > 1) {\n          args.startEdit = false;\n          this.resetInfiniteBlocks({}, true);\n          this.makeRequest({\n            currentPage: 1\n          });\n        }\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.infiniteEditHandler = function (args) {\n    if (!this.parent.infiniteScrollSettings.enableCache && (args.e.requestType === 'delete' || args.e.requestType === 'save' && this.requestType === 'add')) {\n      var frozenCols = this.parent.getFrozenColumns();\n      var rowElms = this.parent.getRows();\n      var rows = this.parent.getRowsObject();\n\n      if (this.ensureRowAvailability(rows, args.result[0])) {\n        this.resetRowIndex(rows, args.e, rowElms, this.requestType === 'add');\n\n        if (frozenCols) {\n          var rows_1 = this.parent.getMovableRowsObject();\n          this.resetRowIndex(rows_1, args.e, this.parent.getMovableDataRows(), this.requestType === 'add');\n        }\n\n        if (!this.isLastPage) {\n          this.createRow(rows, args);\n        } else {\n          this.isLastPage = false;\n          this.parent.pageSettings.currentPage = this.maxPage;\n\n          if (this.parent.selectionModule.index < this.parent.frozenRows) {\n            remove(rowElms[this.parent.frozenRows - 1]);\n            this.createRow([rows[this.parent.frozenRows - 1]], args, false, true);\n\n            if (frozenCols) {\n              var movableRows = this.parent.getMovableDataRows();\n              remove(movableRows[this.parent.frozenRows]);\n              this.createRow([this.parent.getMovableRowsObject()[this.parent.frozenRows - 1]], args, true, true);\n            }\n\n            this.setRowElements();\n          }\n        }\n      }\n\n      this.parent.hideSpinner();\n      this.requestType === 'delete' ? this.parent.notify(events.deleteComplete, args.e) : this.parent.notify(events.saveComplete, args.e);\n    }\n  };\n\n  InfiniteScroll.prototype.createRow = function (rows, args, isMovable, isFrozenRows) {\n    var row = !isFrozenRows ? this.generateRows(args.result, args.e) : rows;\n    var rowRenderer = new RowRenderer(this.serviceLocator, null, this.parent);\n    var tbody = !this.parent.getFrozenColumns() ? this.parent.getContent().querySelector('tbody') : isMovable ? this.parent.getMovableVirtualContent().querySelector('tbody') : this.parent.getFrozenVirtualContent().querySelector('tbody');\n\n    if (this.parent.frozenRows) {\n      tbody = isFrozenRows && this.requestType !== 'add' || !isFrozenRows && this.requestType === 'add' ? !this.parent.getFrozenColumns() ? this.parent.getHeaderContent().querySelector('tbody') : isMovable ? this.parent.getMovableVirtualHeader().querySelector('tbody') : this.parent.getFrozenVirtualHeader().querySelector('tbody') : tbody;\n    }\n\n    for (var i = row.length - 1; i >= 0; i--) {\n      if (this.requestType === 'delete') {\n        tbody.appendChild(rowRenderer.render(row[i], this.parent.getColumns()));\n      } else {\n        tbody.insertBefore(rowRenderer.render(row[i], this.parent.getColumns()), tbody.firstElementChild);\n      }\n    }\n\n    if (!isFrozenRows && this.parent.frozenRows && (this.parent.selectionModule.index < this.parent.frozenRows || this.requestType === 'add')) {\n      var rowElems = isMovable ? this.parent.getMovableDataRows() : this.parent.getRows();\n      var index = isMovable && this.requestType === 'add' ? this.parent.frozenRows : this.parent.frozenRows - 1;\n      remove(rowElems[index]);\n      this.createRow([rows[this.parent.frozenRows - 1]], args, isMovable, true);\n    }\n\n    if (!this.parent.infiniteScrollSettings.enableCache && !isFrozenRows) {\n      if (!this.parent.getFrozenColumns() || isMovable) {\n        this.setRowElements();\n        this.parent.contentModule.visibleRows = this.requestType === 'add' ? row.concat(rows) : rows.concat(row);\n      } else {\n        this.parent.contentModule.visibleFrozenRows = this.requestType === 'add' ? row.concat(rows) : rows.concat(row);\n        this.createRow(this.parent.getMovableRowsObject(), args, true);\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.ensureRowAvailability = function (rows, data) {\n    var resume = true;\n\n    if (this.parent.frozenRows && !this.parent.infiniteScrollSettings.enableCache && this.parent.sortSettings.columns && this.requestType === 'add') {\n      var key = this.parent.getPrimaryKeyFieldNames()[0];\n\n      for (var i = 0; i < rows.length; i++) {\n        if (rows[i].data[key] === data[key]) {\n          resume = false;\n          break;\n        }\n      }\n    }\n\n    return resume;\n  };\n\n  InfiniteScroll.prototype.generateRows = function (data, args) {\n    return this.rowModelGenerator.generateRows(data, args);\n  };\n\n  InfiniteScroll.prototype.resetRowIndex = function (rows, args, rowElms, isAdd) {\n    var keyField = this.parent.getPrimaryKeyFieldNames()[0];\n    var isRemove = !(rowElms.length % this.parent.pageSettings.pageSize);\n\n    if (isAdd) {\n      if (isRemove) {\n        remove(rowElms[rows.length - 1]);\n        rowElms.splice(rows.length - 1, 1);\n        rows.splice(rows.length - 1, 1);\n      }\n    } else {\n      rows.filter(function (e, index) {\n        if (e.data[keyField] === args.data[0][keyField]) {\n          rows.splice(index, 1);\n          remove(rowElms[index]);\n          rowElms.splice(index, 1);\n        }\n      });\n    }\n\n    var startIndex = isAdd ? 1 : 0;\n\n    for (var i = 0; i < rows.length; i++) {\n      rows[i].index = startIndex;\n      rowElms[i].setAttribute('aria-rowindex', startIndex.toString());\n      this.resetCellIndex(rowElms[i].cells, startIndex);\n      startIndex++;\n    }\n\n    if (!rows.length) {\n      this.renderEmptyRow();\n    }\n  };\n\n  InfiniteScroll.prototype.renderEmptyRow = function () {\n    this.parent.renderModule.emptyRow(true);\n  };\n\n  InfiniteScroll.prototype.resetCellIndex = function (cells, index) {\n    for (var i = 0; i < cells.length; i++) {\n      cells[i].setAttribute('index', index.toString());\n    }\n  };\n\n  InfiniteScroll.prototype.setDisplayNone = function (args) {\n    if (this.parent.infiniteScrollSettings.enableCache) {\n      var frozenCols = this.parent.getFrozenColumns();\n      var keys = frozenCols ? Object.keys(this.infiniteFrozenCache) : Object.keys(this.infiniteCache);\n\n      for (var i = 1; i <= keys.length; i++) {\n        var cache = frozenCols ? args.isFreeze ? this.infiniteFrozenCache[i][0] : this.infiniteFrozenCache[i][1] : this.infiniteCache[i];\n        cache.filter(function (e) {\n          e.cells[args.index].visible = args.visible === '';\n        });\n      }\n\n      this.resetContentModuleCache(frozenCols ? this.infiniteFrozenCache : this.infiniteCache);\n    }\n  };\n\n  InfiniteScroll.prototype.refreshInfiniteCache = function (data) {\n    this.getEditedRowObject().data = data;\n  };\n\n  InfiniteScroll.prototype.getEditedRowObject = function () {\n    var rowObjects = this.parent.getRowsObject();\n    var editedrow;\n\n    for (var i = 0; i < rowObjects.length; i++) {\n      if (rowObjects[i].index === this.editRowIndex) {\n        editedrow = rowObjects[i];\n      }\n    }\n\n    return editedrow;\n  };\n\n  InfiniteScroll.prototype.infiniteEditSuccess = function (args) {\n    if (this.isNormaledit) {\n      if (!this.isAdd && args.data) {\n        this.updateCurrentViewRecords(args.data);\n      }\n\n      this.isAdd = false;\n    }\n  };\n\n  InfiniteScroll.prototype.updateCurrentViewRecords = function (data) {\n    var index = getEditedDataIndex(this.parent, data);\n\n    if (!isNullOrUndefined(index)) {\n      this.parent.getCurrentViewRecords()[index] = data;\n    }\n  };\n\n  InfiniteScroll.prototype.actionBegin = function (args) {\n    if (args.requestType === 'add' || args.requestType === 'delete') {\n      this.requestType = args.requestType;\n    }\n  };\n\n  InfiniteScroll.prototype.actionComplete = function (args) {\n    if (args.requestType === 'delete' || args.requestType === 'save' || args.requestType === 'cancel') {\n      this.requestType = this.empty;\n      this.isCancel = args.requestType === 'cancel' || args.requestType === 'save';\n      this.isAdd = this.isEdit = false;\n\n      if (this.isNormaledit) {\n        this.editRowIndex = this.empty;\n        this.virtualInfiniteData = {};\n        this.parent.editModule.previousVirtualData = {};\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.resetInfiniteEdit = function () {\n    if (this.parent.enableInfiniteScrolling && this.isNormaledit) {\n      if (this.parent.editSettings.allowEditing && this.isEdit || this.parent.editSettings.allowAdding && this.isAdd) {\n        this.parent.isEdit = true;\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.getVirtualInfiniteData = function (data) {\n    data.virtualData = this.virtualInfiniteData;\n    data.isAdd = this.isAdd;\n    data.isCancel = this.isCancel;\n  };\n\n  InfiniteScroll.prototype.editActionBegin = function (e) {\n    this.isEdit = true;\n    this.editRowIndex = e.index;\n    var rowObject = extend({}, this.getEditedRowObject().data);\n    e.data = Object.keys(this.virtualInfiniteData).length ? this.virtualInfiniteData : rowObject;\n  };\n\n  InfiniteScroll.prototype.dataSourceModified = function () {\n    this.resetInfiniteBlocks({\n      requestType: this.empty\n    }, true);\n  };\n\n  InfiniteScroll.prototype.onDataReady = function (e) {\n    if (!isNullOrUndefined(e.count)) {\n      this.maxPage = Math.ceil(e.count / this.parent.pageSettings.pageSize);\n    }\n  };\n\n  InfiniteScroll.prototype.ensureIntialCollapse = function (isExpand) {\n    this.isInitialCollapse = !isExpand;\n  };\n\n  InfiniteScroll.prototype.infiniteScrollHandler = function (e) {\n    var _this = this;\n\n    this.restoreInfiniteEdit();\n    this.restoreInfiniteAdd();\n    var targetEle = e.target;\n    var isInfinite = targetEle.classList.contains('e-content') || targetEle.classList.contains('e-movablecontent');\n\n    if (isInfinite && this.parent.enableInfiniteScrolling) {\n      var scrollEle = this.parent.getFrozenColumns() ? this.parent.getMovableVirtualContent() : this.parent.getContent().firstElementChild;\n      this.prevScrollTop = scrollEle.scrollTop;\n      var rows = this.parent.getRows();\n      var index = parseInt(rows[rows.length - 1].getAttribute('aria-rowindex'), 10) + 1;\n      var prevPage = this.parent.pageSettings.currentPage;\n      var args = void 0;\n      var offset = targetEle.scrollHeight - targetEle.scrollTop;\n      var round = Math.round(targetEle.scrollHeight - targetEle.scrollTop);\n      var floor = offset < targetEle.clientHeight ? Math.ceil(offset) : Math.floor(offset);\n      var isBottom = floor === targetEle.clientHeight || round === targetEle.clientHeight;\n\n      if (this.isScroll && isBottom && (this.parent.pageSettings.currentPage <= this.maxPage - 1 || this.enableContinuousScroll)) {\n        if (this.parent.infiniteScrollSettings.enableCache) {\n          this.isUpScroll = false;\n          this.isDownScroll = true;\n          setTimeout(function () {\n            _this.isScroll = true;\n          }, 600);\n        }\n\n        var rows_2 = [].slice.call(scrollEle.querySelectorAll('.e-row:not(.e-addedrow)'));\n        var row = rows_2[rows_2.length - 1];\n        var rowIndex = parseInt(row.getAttribute('aria-rowindex'), 10);\n        this.parent.pageSettings.currentPage = Math.ceil(rowIndex / this.parent.pageSettings.pageSize) + 1;\n        args = {\n          requestType: 'infiniteScroll',\n          currentPage: this.parent.pageSettings.currentPage,\n          prevPage: prevPage,\n          startIndex: index,\n          direction: 'down'\n        };\n        this.makeRequest(args);\n      }\n\n      if (this.isScroll && this.parent.infiniteScrollSettings.enableCache && targetEle.scrollTop === 0 && this.parent.pageSettings.currentPage !== 1) {\n        if (this.parent.infiniteScrollSettings.enableCache) {\n          this.isDownScroll = false;\n          this.isUpScroll = true;\n          setTimeout(function () {\n            _this.isScroll = true;\n          }, 600);\n        }\n\n        var row = [].slice.call(scrollEle.querySelectorAll('.e-row'));\n        var rowIndex = parseInt(row[this.parent.pageSettings.pageSize - 1].getAttribute('aria-rowindex'), 10);\n        var startIndex = parseInt(row[0].getAttribute('aria-rowindex'), 10) - this.parent.pageSettings.pageSize;\n        this.parent.pageSettings.currentPage = Math.ceil(rowIndex / this.parent.pageSettings.pageSize) - 1;\n\n        if (this.parent.pageSettings.currentPage) {\n          args = {\n            requestType: 'infiniteScroll',\n            currentPage: this.parent.pageSettings.currentPage,\n            prevPage: prevPage,\n            startIndex: startIndex,\n            direction: 'up'\n          };\n          this.makeRequest(args);\n        }\n      }\n\n      if (this.parent.infiniteScrollSettings.enableCache && !this.isScroll && isNullOrUndefined(args)) {\n        if (this.isDownScroll || this.isUpScroll) {\n          scrollEle.scrollTop = this.top;\n        }\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.makeRequest = function (args) {\n    var _this = this;\n\n    if (this.parent.pageSettings.currentPage !== args.prevPage) {\n      if (this.parent.pageSettings.currentPage <= this.maxPage) {\n        this.isInfiniteScroll = true;\n\n        if (isNullOrUndefined(this.infiniteCache[args.currentPage])) {\n          setTimeout(function () {\n            _this.getVirtualInfiniteEditedData();\n\n            _this.parent.notify('model-changed', args);\n          }, 100);\n        } else {\n          setTimeout(function () {\n            _this.getVirtualInfiniteEditedData();\n\n            _this.parent.notify(events.refreshInfiniteModeBlocks, args);\n          }, 100);\n        }\n      } else {\n        this.parent.pageSettings.currentPage = this.maxPage;\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.infinitePageQuery = function (query) {\n    if (this.initialRender) {\n      this.initialRender = false;\n      this.intialPageQuery(query);\n    } else {\n      if (!this.isInfiniteScroll && (this.requestType === 'delete' || this.requestType === 'add')) {\n        this.editPageQuery(query);\n      } else {\n        query.page(this.parent.pageSettings.currentPage, this.parent.pageSettings.pageSize);\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.editPageQuery = function (query) {\n    var initialBlocks = this.parent.infiniteScrollSettings.initialBlocks;\n    var isCache = this.parent.infiniteScrollSettings.enableCache;\n\n    if (isCache) {\n      this.infiniteCache = {};\n      this.infiniteFrozenCache = {};\n      query.skip(this.firstIndex);\n      query.take(initialBlocks * this.parent.pageSettings.pageSize);\n    } else {\n      if (this.parent.editSettings.mode === 'Dialog') {\n        this.parent.clearSelection();\n      }\n\n      var index = this.requestType === 'delete' ? this.lastIndex : this.firstIndex;\n      query.skip(index);\n      query.take(1);\n    }\n  };\n\n  InfiniteScroll.prototype.intialPageQuery = function (query) {\n    if (this.parent.infiniteScrollSettings.enableCache && this.parent.infiniteScrollSettings.initialBlocks > this.parent.infiniteScrollSettings.maxBlocks) {\n      this.parent.infiniteScrollSettings.initialBlocks = this.parent.infiniteScrollSettings.maxBlocks;\n    }\n\n    var pageSize = this.parent.pageSettings.pageSize * this.parent.infiniteScrollSettings.initialBlocks;\n    query.page(1, pageSize);\n  };\n\n  InfiniteScroll.prototype.infiniteCellFocus = function (e) {\n    if (e.byKey && (e.keyArgs.action === 'upArrow' || e.keyArgs.action === 'downArrow')) {\n      this.pressedKey = e.keyArgs.action;\n      var ele = document.activeElement;\n      var rowIndex = parseInt(ele.parentElement.getAttribute('aria-rowindex'), 10);\n      var scrollEle = this.parent.getContent().firstElementChild;\n      this.rowIndex = e.keyArgs.action === 'downArrow' ? rowIndex + 1 : rowIndex - 1;\n      this.cellIndex = parseInt(ele.getAttribute('aria-colindex'), 10);\n      var row = this.parent.getRowByIndex(rowIndex);\n      var visibleRowCount = Math.floor(scrollEle.offsetHeight / this.parent.getRowHeight());\n\n      if (!row || ensureLastRow(row, this.parent) || ensureFirstRow(row, this.rowTop)) {\n        var height = row ? row.getBoundingClientRect().height : this.parent.getRowHeight();\n\n        if (!this.parent.infiniteScrollSettings.enableCache) {\n          if (e.keyArgs.action === 'downArrow' && (ensureLastRow(row, this.parent) || !row)) {\n            var nTop = (this.rowIndex - visibleRowCount) * height;\n            var oTop = scrollEle.scrollTop + this.parent.getRowHeight();\n            scrollEle.scrollTop = nTop < oTop ? oTop : nTop;\n          }\n\n          if (e.keyArgs.action === 'upArrow' && ensureFirstRow(row, this.rowTop)) {\n            scrollEle.scrollTop = this.rowIndex * height;\n          }\n        }\n      } else {\n        this.pressedKey = this.empty;\n      }\n    } else if (e.key === 'PageDown' || e.key === 'PageUp') {\n      this.pressedKey = e.key;\n    }\n  };\n\n  InfiniteScroll.prototype.createEmptyRowdata = function () {\n    var _this = this;\n\n    this.parent.getColumns().filter(function (e) {\n      _this.emptyRowData[e.field] = _this.empty;\n    });\n  };\n\n  InfiniteScroll.prototype.getVirtualInfiniteEditedData = function () {\n    var editForm = this.parent.element.querySelector('.e-editedrow');\n    var addForm = this.parent.element.querySelector('.e-addedrow');\n    var gridForm = this.parent.element.querySelector('.e-gridform');\n\n    if (this.parent.infiniteScrollSettings.enableCache && (editForm || addForm)) {\n      var rowData = editForm ? extend({}, this.getEditedRowObject().data) : extend({}, this.emptyRowData);\n      this.virtualInfiniteData = this.parent.editModule.getCurrentEditedData(gridForm, rowData);\n\n      if (this.parent.getFrozenColumns()) {\n        this.virtualInfiniteData = this.parent.editModule.getCurrentEditedData(this.parent.getMovableVirtualContent().querySelector('.e-gridform'), rowData);\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.restoreInfiniteEdit = function () {\n    var content = this.parent.getFrozenColumns() ? this.parent.getMovableVirtualContent() : this.parent.getContent().firstElementChild;\n    var frozenEdit = this.parent.frozenRows ? this.editRowIndex >= this.parent.frozenRows : true;\n\n    if (this.isNormaledit && this.parent.infiniteScrollSettings.enableCache && frozenEdit) {\n      if (this.parent.editSettings.allowEditing && !isNullOrUndefined(this.editRowIndex)) {\n        var row = this.parent.getRowByIndex(this.editRowIndex);\n\n        if (Object.keys(this.virtualInfiniteData).length && row && !this.parent.getContent().querySelector('.e-editedrow')) {\n          var top_1 = row.getBoundingClientRect().top;\n\n          if (top_1 < content.offsetHeight && top_1 > this.parent.getRowHeight()) {\n            this.parent.isEdit = false;\n            this.parent.editModule.startEdit(row);\n          }\n        }\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.restoreInfiniteAdd = function () {\n    var content = this.parent.getFrozenColumns() ? this.parent.getMovableVirtualContent() : this.parent.getContent().firstElementChild;\n\n    if (this.parent.getRowByIndex(0) && this.isNormaledit && this.parent.infiniteScrollSettings.enableCache && this.isAdd && !content.querySelector('.e-addedrow')) {\n      var isTop = content.scrollTop < this.parent.getRowHeight();\n\n      if (isTop) {\n        this.parent.isEdit = false;\n        this.parent.addRecord();\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.appendInfiniteRows = function (e) {\n    var target = document.activeElement;\n    var frozenCols = this.parent.getFrozenColumns();\n    var scrollEle = frozenCols ? this.parent.getMovableVirtualContent() : this.parent.getContent().firstElementChild;\n    var isInfiniteScroll = this.parent.enableInfiniteScrolling && e.args.requestType === 'infiniteScroll';\n\n    if (isInfiniteScroll && !e.args.isFrozen || !isInfiniteScroll) {\n      if (isInfiniteScroll && e.args.direction === 'up') {\n        e.tbody.insertBefore(e.frag, e.tbody.firstElementChild);\n      } else {\n        e.tbody.appendChild(e.frag);\n      }\n    }\n\n    if (!frozenCols) {\n      this.parent.contentModule.getTable().appendChild(e.tbody);\n    } else {\n      if (isInfiniteScroll) {\n        if (e.args.isFrozen) {\n          this.frozenFrag = e.frag;\n        } else {\n          var tbody = this.parent.getFrozenVirtualContent().querySelector('tbody');\n          e.args.direction === 'up' ? tbody.insertBefore(this.frozenFrag, tbody.firstElementChild) : tbody.appendChild(this.frozenFrag);\n          this.parent.getMovableVirtualContent().querySelector('.e-table').appendChild(e.tbody);\n        }\n      } else {\n        var table = e.args.isFrozen ? this.parent.getFrozenVirtualContent().querySelector('.e-table') : this.parent.getMovableVirtualContent().querySelector('.e-table');\n        table.appendChild(e.tbody);\n      }\n    }\n\n    if (!e.args.isFrozen) {\n      this.rowTop = !this.rowTop ? this.parent.getRows()[0].getBoundingClientRect().top : this.rowTop;\n\n      if (isInfiniteScroll) {\n        if (this.parent.infiniteScrollSettings.enableCache && this.isRemove) {\n          scrollEle.scrollTop = this.top;\n\n          if (frozenCols) {\n            this.parent.getFrozenVirtualContent().scrollTop = this.top;\n          }\n        }\n\n        this.setRowElements();\n        this.selectNewRow(e.tbody, e.args.startIndex);\n        this.pressedKey = undefined;\n      }\n\n      this.restoreInfiniteAdd();\n    }\n\n    this.isInfiniteScroll = false;\n  };\n\n  InfiniteScroll.prototype.setRowElements = function () {\n    if (this.parent.getFrozenColumns()) {\n      this.parent.contentModule.rowElements = [].slice.call(this.parent.element.querySelectorAll('.e-movableheader .e-row, .e-movablecontent .e-row'));\n      this.parent.contentModule.freezeRowElements = [].slice.call(this.parent.element.querySelectorAll('.e-frozenheader .e-row, .e-frozencontent .e-row'));\n    } else {\n      this.parent.contentModule.rowElements = [].slice.call(this.parent.element.querySelectorAll('.e-row:not(.e-addedrow)'));\n    }\n  };\n\n  InfiniteScroll.prototype.selectNewRow = function (tbody, startIndex) {\n    var _this = this;\n\n    var row = this.parent.getRowByIndex(this.rowIndex);\n\n    if (this.keys.some(function (value) {\n      return value === _this.pressedKey;\n    })) {\n      if (this.pressedKey === 'downArrow' || this.parent.infiniteScrollSettings.enableCache && this.pressedKey === 'upArrow') {\n        setTimeout(function () {\n          // tslint:disable-next-line:no-any\n          var target = row.cells[0];\n          target.focus({\n            preventScroll: true\n          });\n\n          _this.parent.selectRow(_this.rowIndex);\n\n          _this.parent.getContent().firstElementChild.scrollTop += _this.parent.getRowHeight();\n        }, 0);\n      }\n\n      if (this.pressedKey === 'PageDown') {\n        var row_1 = this.parent.getRowByIndex(startIndex);\n\n        if (row_1) {\n          row_1.cells[0].focus();\n        }\n      }\n\n      if (this.pressedKey === 'PageUp') {\n        tbody.querySelector('.e-row').cells[0].focus();\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.removeInfiniteCacheRows = function (e) {\n    var isInfiniteScroll = this.parent.enableInfiniteScrolling && e.args.requestType === 'infiniteScroll';\n\n    if (!e.args.isFrozen && isInfiniteScroll && this.parent.infiniteScrollSettings.enableCache && this.isRemove) {\n      var rows = [].slice.call(this.parent.getContentTable().querySelectorAll('.e-row'));\n\n      if (e.args.direction === 'down') {\n        if (this.parent.allowGrouping && this.parent.groupSettings.columns.length) {\n          var captionRows = [].slice.call(this.parent.getContentTable().querySelectorAll('tr'));\n          this.removeCaptionRows(captionRows, e.args);\n        }\n\n        var addRowCount = this.parent.element.querySelector('.e-addedrow') ? 0 : 1;\n        this.removeTopRows(rows, this.parent.pageSettings.pageSize - addRowCount);\n      }\n\n      if (e.args.direction === 'up') {\n        if (this.parent.allowGrouping && this.parent.groupSettings.columns.length) {\n          var captionRows = [].slice.call(this.parent.getContentTable().querySelectorAll('tr'));\n          this.removeCaptionRows(captionRows, e.args);\n        } else {\n          this.removeBottomRows(rows, rows.length - 1, e.args);\n        }\n      }\n\n      this.isScroll = false;\n      this.top = this.calculateScrollTop(e.args);\n    }\n  };\n\n  InfiniteScroll.prototype.calculateScrollTop = function (args) {\n    var top = 0;\n    var scrollCnt = this.parent.getFrozenColumns() ? this.parent.getMovableVirtualContent() : this.parent.getContent().firstElementChild;\n\n    if (args.direction === 'down') {\n      if (this.parent.allowGrouping && this.parent.groupSettings.columns.length && !this.isInitialCollapse) {\n        top = this.captionRowHeight();\n      }\n\n      var captionRows = [].slice.call(this.parent.getContent().firstElementChild.querySelectorAll('tr:not(.e-row)'));\n      var captionCount = 0;\n\n      if (this.isInitialCollapse && !isNullOrUndefined(captionRows)) {\n        captionCount = Math.round((captionRows.length - 1) / this.parent.groupSettings.columns.length);\n      }\n\n      var value = captionCount ? captionCount : this.parent.pageSettings.pageSize * (this.parent.infiniteScrollSettings.maxBlocks - 1);\n      var currentViewRowCount = 0;\n      var i = 0;\n\n      while (currentViewRowCount < scrollCnt.clientHeight) {\n        i++;\n        currentViewRowCount = i * this.parent.getRowHeight();\n      }\n\n      i = i - 1;\n      top += (value - i) * this.parent.getRowHeight();\n    }\n\n    if (args.direction === 'up') {\n      if (this.parent.allowGrouping && this.parent.groupSettings.columns.length && !this.isInitialCollapse) {\n        top = this.infiniteCache[this.parent.pageSettings.currentPage].length * this.parent.getRowHeight();\n      } else if (this.isInitialCollapse) {\n        var groupedData = this.infiniteCache[this.parent.pageSettings.currentPage];\n        var count = 0;\n\n        for (var i = 0; i < groupedData.length; i++) {\n          if (groupedData[i].isCaptionRow) {\n            count++;\n          }\n        }\n\n        top += Math.round(count / this.parent.groupSettings.columns.length) * this.parent.getRowHeight();\n      } else {\n        top += this.parent.pageSettings.pageSize * this.parent.getRowHeight() + getScrollBarWidth();\n      }\n    }\n\n    return top;\n  };\n\n  InfiniteScroll.prototype.captionRowHeight = function () {\n    var rows = [].slice.call(this.parent.getContent().querySelectorAll('tr:not(.e-row)'));\n    return rows.length * this.parent.getRowHeight();\n  };\n\n  InfiniteScroll.prototype.removeTopRows = function (rows, maxIndx) {\n    var frozeCols = this.parent.getFrozenColumns();\n    var movableRows = frozeCols ? [].slice.call(this.parent.getMovableVirtualContent().querySelectorAll('.e-row')) : null;\n\n    for (var i = 0; i <= maxIndx; i++) {\n      if (this.parent.frozenRows && this.parent.pageSettings.currentPage === this.parent.infiniteScrollSettings.maxBlocks + 1 && i > maxIndx - this.parent.frozenRows) {\n        continue;\n      }\n\n      remove(rows[i]);\n\n      if (movableRows) {\n        remove(movableRows[i]);\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.removeBottomRows = function (rows, maxIndx, args) {\n    var cnt = 0;\n    var frozeCols = this.parent.getFrozenColumns();\n    var movableRows = frozeCols ? [].slice.call(this.parent.getMovableVirtualContent().querySelectorAll('.e-row')) : null;\n    var pageSize = this.parent.pageSettings.pageSize;\n\n    if (!frozeCols && this.infiniteCache[args.prevPage].length < pageSize) {\n      cnt = this.parent.pageSettings.pageSize - this.infiniteCache[args.prevPage].length;\n    }\n\n    if (frozeCols && this.infiniteFrozenCache[args.prevPage][1].length < pageSize) {\n      cnt = this.parent.pageSettings.pageSize - this.infiniteFrozenCache[args.prevPage][1].length;\n    }\n\n    for (var i = maxIndx; cnt < pageSize; i--) {\n      cnt++;\n      remove(rows[i]);\n\n      if (movableRows) {\n        remove(movableRows[i]);\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.removeCaptionRows = function (rows, args) {\n    if (args.direction === 'down') {\n      var lastRow = this.parent.getRows()[this.parent.pageSettings.pageSize];\n      var lastRowIndex = parseInt(lastRow.getAttribute('aria-rowindex'), 10) - 1;\n      var k = 0;\n\n      for (var i = 0; k < lastRowIndex; i++) {\n        if (!rows[i].classList.contains('e-row')) {\n          remove(rows[i]);\n        } else {\n          k = parseInt(rows[i].getAttribute('aria-rowindex'), 10);\n        }\n      }\n    }\n\n    if (args.direction === 'up') {\n      var rowElements = [].slice.call(this.parent.getContent().querySelectorAll('.e-row'));\n      var lastIndex = parseInt(rowElements[rowElements.length - 1].getAttribute('aria-rowindex'), 10);\n      var page = Math.ceil(lastIndex / this.parent.pageSettings.pageSize);\n      var startIndex = 0;\n\n      for (var i = this.parent.pageSettings.currentPage + 1; i < page; i++) {\n        startIndex += this.infiniteCache[i].length;\n      }\n\n      for (var i = startIndex; i < rows.length; i++) {\n        remove(rows[i]);\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.resetInfiniteBlocks = function (args, isDataModified) {\n    var isInfiniteScroll = this.parent.enableInfiniteScrolling && args.requestType !== 'infiniteScroll';\n\n    if (!this.initialRender && !isNullOrUndefined(this.parent.infiniteScrollModule) && isInfiniteScroll) {\n      if (this.actions.some(function (value) {\n        return value === args.requestType;\n      }) || isDataModified) {\n        var scrollEle = this.parent.getFrozenColumns() ? this.parent.getMovableVirtualContent() : this.parent.getContent().firstElementChild;\n        this.initialRender = true;\n        scrollEle.scrollTop = 0;\n        this.parent.pageSettings.currentPage = 1;\n        this.infiniteCache = this.infiniteFrozenCache = {};\n        this.resetContentModuleCache({});\n        this.isRemove = false;\n        this.top = 0;\n        this.isInitialMovableRender = true;\n        this.isInitialCollapse = false;\n        this.parent.contentModule.isRemove = this.isRemove;\n        this.parent.contentModule.isAddRows = this.isRemove;\n        this.parent.contentModule.visibleRows = [];\n        this.parent.contentModule.visibleFrozenRows = [];\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.setCache = function (e) {\n    if (this.parent.enableInfiniteScrolling && this.parent.infiniteScrollSettings.enableCache) {\n      var frozeCols = this.parent.getFrozenColumns();\n      var idx = e.args.isFrozen ? 1 : 0;\n      var isEdit = e.args.requestType !== 'infiniteScroll' && (this.requestType === 'delete' || this.requestType === 'add');\n      var currentPage = this.parent.pageSettings.currentPage;\n\n      if (frozeCols && this.isInitialMovableRender || !frozeCols && !Object.keys(this.infiniteCache).length || isEdit) {\n        this.isInitialMovableRender = !e.args.isFrozen;\n        this.setInitialCache(e.modelData, e.args, isEdit);\n      }\n\n      if (!frozeCols && isNullOrUndefined(this.infiniteCache[this.parent.pageSettings.currentPage])) {\n        this.infiniteCache[this.parent.pageSettings.currentPage] = e.modelData;\n        this.resetContentModuleCache(this.infiniteCache);\n      }\n\n      if (frozeCols) {\n        if (idx === 0 && isNullOrUndefined(this.infiniteFrozenCache[currentPage]) || !this.infiniteFrozenCache[currentPage][idx].length) {\n          this.createFrozenCache(currentPage);\n          this.infiniteFrozenCache[currentPage][idx] = e.modelData;\n\n          if (idx === 1) {\n            this.resetContentModuleCache(this.infiniteFrozenCache);\n          }\n        }\n      }\n\n      if (e.isInfiniteScroll && !this.isRemove) {\n        this.isRemove = (currentPage - 1) % this.parent.infiniteScrollSettings.maxBlocks === 0;\n        this.parent.contentModule.isRemove = this.isRemove;\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.setInitialCache = function (data, args, isEdit) {\n    var frozenCols = this.parent.getFrozenColumns();\n    var idx = args.isFrozen ? 1 : 0;\n    var k = !isEdit ? 1 : this.firstBlock;\n\n    for (var i = 1; i <= this.parent.infiniteScrollSettings.initialBlocks; i++) {\n      var startIndex = (i - 1) * this.parent.pageSettings.pageSize;\n      var endIndex = i * this.parent.pageSettings.pageSize;\n\n      if (this.parent.allowGrouping && this.parent.groupSettings.columns.length) {\n        this.setInitialGroupCache(data, k, startIndex, endIndex);\n      } else {\n        if (frozenCols) {\n          this.createFrozenCache(k);\n          this.infiniteFrozenCache[k][idx] = data.slice(startIndex, endIndex);\n          this.resetContentModuleCache(this.infiniteFrozenCache);\n        } else {\n          this.infiniteCache[k] = data.slice(startIndex, endIndex);\n          this.resetContentModuleCache(this.infiniteCache);\n        }\n      }\n\n      k++;\n    }\n  };\n\n  InfiniteScroll.prototype.createFrozenCache = function (index) {\n    if (!this.infiniteFrozenCache[index]) {\n      this.infiniteFrozenCache[index] = [[], []];\n    }\n  };\n\n  InfiniteScroll.prototype.setInitialGroupCache = function (data, index, sIndex, eIndex) {\n    var pageData = [];\n    var startIndex = 0;\n\n    for (var i = 1; i <= Object.keys(this.infiniteCache).length; i++) {\n      startIndex += this.infiniteCache[i].length;\n    }\n\n    var k = sIndex;\n\n    for (var i = startIndex; i < data.length && k < eIndex; i++) {\n      if (data[i].index < eIndex || data[i].isCaptionRow) {\n        k = data[i].isCaptionRow ? k : data[i].index;\n        pageData.push(data[i]);\n      }\n\n      if (data[i].index >= eIndex || data[i].index === eIndex - 1) {\n        break;\n      }\n    }\n\n    this.infiniteCache[index] = pageData;\n    this.resetContentModuleCache(this.infiniteCache);\n  };\n\n  InfiniteScroll.prototype.resetContentModuleCache = function (data) {\n    this.parent.contentModule.infiniteCache = data;\n  };\n  /**\n   * @hidden\n   */\n\n\n  InfiniteScroll.prototype.destroy = function () {\n    this.removeEventListener();\n  };\n\n  return InfiniteScroll;\n}();\n\nexport { InfiniteScroll };","map":{"version":3,"sources":["/home/nikhil/Desktop/data_grid_editor-master/node_modules/@syncfusion/ej2-grids/src/grid/actions/infinite-scroll.js"],"names":["isNullOrUndefined","remove","extend","RowModelGenerator","FreezeRowModelGenerator","RowRenderer","events","getScrollBarWidth","ensureLastRow","ensureFirstRow","getEditedDataIndex","InfiniteScroll","parent","serviceLocator","infiniteCache","infiniteFrozenCache","isDownScroll","isUpScroll","isScroll","enableContinuousScroll","initialRender","isRemove","isInitialCollapse","prevScrollTop","actions","keys","rowTop","isInitialMovableRender","virtualInfiniteData","isCancel","emptyRowData","isNormaledit","isInfiniteScroll","isLastPage","editSettings","mode","addEventListener","rowModelGenerator","getFrozenColumns","prototype","getModuleName","on","dataReady","onDataReady","dataSourceModified","infinitePageQuery","infiniteScrollHandler","beforeCellFocused","infiniteCellFocus","appendInfiniteContent","appendInfiniteRows","removeInfiniteRows","removeInfiniteCacheRows","resetInfiniteBlocks","setInfiniteCache","setCache","initialCollapse","ensureIntialCollapse","keyPressed","infiniteShowHide","setDisplayNone","virtualScrollEditActionBegin","editActionBegin","getVirtualData","getVirtualInfiniteData","editReset","resetInfiniteEdit","virtualScrollEditSuccess","infiniteEditSuccess","refreshVirtualCache","refreshInfiniteCache","infiniteEditHandler","virtualScrollAddActionBegin","infiniteAddActionBegin","modelChanged","actionBegin","bind","actionComplete","removeEventListener","isDestroyed","off","args","requestType","rows","getRows","firstIndex","parseInt","getAttribute","firstBlock","Math","ceil","pageSettings","pageSize","lastIndex","length","rowObj","getRowsObject","startIndex","infiniteScrollSettings","enableCache","index","currentPage","maxPage","isAdd","Object","createEmptyRowdata","startEdit","makeRequest","e","frozenCols","rowElms","ensureRowAvailability","result","resetRowIndex","rows_1","getMovableRowsObject","getMovableDataRows","createRow","selectionModule","frozenRows","movableRows","setRowElements","hideSpinner","notify","deleteComplete","saveComplete","isMovable","isFrozenRows","row","generateRows","rowRenderer","tbody","getContent","querySelector","getMovableVirtualContent","getFrozenVirtualContent","getHeaderContent","getMovableVirtualHeader","getFrozenVirtualHeader","i","appendChild","render","getColumns","insertBefore","firstElementChild","rowElems","contentModule","visibleRows","concat","visibleFrozenRows","data","resume","sortSettings","columns","key","getPrimaryKeyFieldNames","keyField","splice","filter","setAttribute","toString","resetCellIndex","cells","renderEmptyRow","renderModule","emptyRow","cache","isFreeze","visible","resetContentModuleCache","getEditedRowObject","rowObjects","editedrow","editRowIndex","updateCurrentViewRecords","getCurrentViewRecords","empty","isEdit","editModule","previousVirtualData","enableInfiniteScrolling","allowEditing","allowAdding","virtualData","rowObject","count","isExpand","_this","restoreInfiniteEdit","restoreInfiniteAdd","targetEle","target","isInfinite","classList","contains","scrollEle","scrollTop","prevPage","offset","scrollHeight","round","floor","clientHeight","isBottom","setTimeout","rows_2","slice","call","querySelectorAll","rowIndex","direction","top","getVirtualInfiniteEditedData","refreshInfiniteModeBlocks","query","intialPageQuery","editPageQuery","page","initialBlocks","isCache","skip","take","clearSelection","maxBlocks","byKey","keyArgs","action","pressedKey","ele","document","activeElement","parentElement","cellIndex","getRowByIndex","visibleRowCount","offsetHeight","getRowHeight","height","getBoundingClientRect","nTop","oTop","field","editForm","element","addForm","gridForm","rowData","getCurrentEditedData","content","frozenEdit","top_1","isTop","addRecord","isFrozen","frag","getTable","frozenFrag","table","selectNewRow","undefined","rowElements","freezeRowElements","some","value","focus","preventScroll","selectRow","row_1","getContentTable","allowGrouping","groupSettings","captionRows","removeCaptionRows","addRowCount","removeTopRows","removeBottomRows","calculateScrollTop","scrollCnt","captionRowHeight","captionCount","currentViewRowCount","groupedData","isCaptionRow","maxIndx","frozeCols","cnt","lastRow","lastRowIndex","k","isDataModified","infiniteScrollModule","isAddRows","idx","setInitialCache","modelData","createFrozenCache","endIndex","setInitialGroupCache","sIndex","eIndex","pageData","push","destroy"],"mappings":"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","sourcesContent":["import { isNullOrUndefined, remove, extend } from '@syncfusion/ej2-base';\nimport { RowModelGenerator } from '../services/row-model-generator';\nimport { FreezeRowModelGenerator } from '../services/freeze-row-model-generator';\nimport { RowRenderer } from '../renderer/row-renderer';\nimport * as events from '../base/constant';\nimport { getScrollBarWidth, ensureLastRow, ensureFirstRow, getEditedDataIndex } from '../base/util';\n/**\n * Infinite Scrolling class\n */\nvar InfiniteScroll = /** @class */ (function () {\n    /**\n     * Constructor for the Grid infinite scrolling.\n     * @hidden\n     */\n    function InfiniteScroll(parent, serviceLocator) {\n        this.infiniteCache = {};\n        this.infiniteFrozenCache = {};\n        this.isDownScroll = false;\n        this.isUpScroll = false;\n        this.isScroll = true;\n        this.enableContinuousScroll = false;\n        this.initialRender = true;\n        this.isRemove = false;\n        this.isInitialCollapse = false;\n        this.prevScrollTop = 0;\n        this.actions = ['filtering', 'searching', 'grouping', 'ungrouping', 'reorder', 'sorting'];\n        this.keys = ['downArrow', 'upArrow', 'PageUp', 'PageDown'];\n        this.rowTop = 0;\n        this.isInitialMovableRender = true;\n        this.virtualInfiniteData = {};\n        this.isCancel = false;\n        this.emptyRowData = {};\n        this.isNormaledit = false;\n        this.isInfiniteScroll = false;\n        this.isLastPage = false;\n        this.parent = parent;\n        this.serviceLocator = serviceLocator;\n        this.isNormaledit = this.parent.editSettings.mode === 'Normal';\n        this.addEventListener();\n        this.rowModelGenerator = this.parent.getFrozenColumns() ? new FreezeRowModelGenerator(this.parent)\n            : new RowModelGenerator(this.parent);\n    }\n    InfiniteScroll.prototype.getModuleName = function () {\n        return 'infiniteScroll';\n    };\n    /**\n     * @hidden\n     */\n    InfiniteScroll.prototype.addEventListener = function () {\n        this.parent.on(events.dataReady, this.onDataReady, this);\n        this.parent.on(events.dataSourceModified, this.dataSourceModified, this);\n        this.parent.on(events.infinitePageQuery, this.infinitePageQuery, this);\n        this.parent.on(events.infiniteScrollHandler, this.infiniteScrollHandler, this);\n        this.parent.on(events.beforeCellFocused, this.infiniteCellFocus, this);\n        this.parent.on(events.appendInfiniteContent, this.appendInfiniteRows, this);\n        this.parent.on(events.removeInfiniteRows, this.removeInfiniteCacheRows, this);\n        this.parent.on(events.resetInfiniteBlocks, this.resetInfiniteBlocks, this);\n        this.parent.on(events.setInfiniteCache, this.setCache, this);\n        this.parent.on(events.initialCollapse, this.ensureIntialCollapse, this);\n        this.parent.on(events.keyPressed, this.infiniteCellFocus, this);\n        this.parent.on(events.infiniteShowHide, this.setDisplayNone, this);\n        this.parent.on(events.virtualScrollEditActionBegin, this.editActionBegin, this);\n        this.parent.on(events.getVirtualData, this.getVirtualInfiniteData, this);\n        this.parent.on(events.editReset, this.resetInfiniteEdit, this);\n        this.parent.on(events.virtualScrollEditSuccess, this.infiniteEditSuccess, this);\n        this.parent.on(events.refreshVirtualCache, this.refreshInfiniteCache, this);\n        this.parent.on(events.infiniteEditHandler, this.infiniteEditHandler, this);\n        this.parent.on(events.virtualScrollAddActionBegin, this.infiniteAddActionBegin, this);\n        this.parent.on(events.modelChanged, this.modelChanged, this);\n        this.parent.addEventListener(events.actionBegin, this.actionBegin.bind(this));\n        this.parent.addEventListener(events.actionComplete, this.actionComplete.bind(this));\n    };\n    /**\n     * @hidden\n     */\n    InfiniteScroll.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.dataReady, this.onDataReady);\n        this.parent.off(events.dataSourceModified, this.dataSourceModified);\n        this.parent.off(events.infinitePageQuery, this.infinitePageQuery);\n        this.parent.off(events.infiniteScrollHandler, this.infiniteScrollHandler);\n        this.parent.off(events.beforeCellFocused, this.infiniteCellFocus);\n        this.parent.off(events.appendInfiniteContent, this.appendInfiniteRows);\n        this.parent.off(events.removeInfiniteRows, this.removeInfiniteCacheRows);\n        this.parent.off(events.resetInfiniteBlocks, this.resetInfiniteBlocks);\n        this.parent.off(events.setInfiniteCache, this.setCache);\n        this.parent.off(events.initialCollapse, this.ensureIntialCollapse);\n        this.parent.off(events.keyPressed, this.infiniteCellFocus);\n        this.parent.off(events.infiniteShowHide, this.setDisplayNone);\n        this.parent.off(events.virtualScrollEditActionBegin, this.editActionBegin);\n        this.parent.off(events.getVirtualData, this.getVirtualInfiniteData);\n        this.parent.off(events.editReset, this.resetInfiniteEdit);\n        this.parent.off(events.virtualScrollEditSuccess, this.infiniteEditSuccess);\n        this.parent.off(events.refreshVirtualCache, this.refreshInfiniteCache);\n        this.parent.off(events.infiniteEditHandler, this.infiniteEditHandler);\n        this.parent.off(events.virtualScrollAddActionBegin, this.infiniteAddActionBegin);\n        this.parent.off(events.modelChanged, this.modelChanged);\n        this.parent.removeEventListener(events.actionBegin, this.actionBegin.bind(this));\n        this.parent.removeEventListener(events.actionComplete, this.actionComplete.bind(this));\n    };\n    InfiniteScroll.prototype.modelChanged = function (args) {\n        if (args.requestType !== 'infiniteScroll' && (args.requestType === 'delete' || this.requestType === 'add')) {\n            var rows = this.parent.getRows();\n            this.firstIndex = parseInt(rows[0].getAttribute('aria-rowindex'), 10);\n            this.firstBlock = Math.ceil((this.firstIndex + 1) / this.parent.pageSettings.pageSize);\n            this.lastIndex = parseInt(rows[rows.length - 1].getAttribute('aria-rowindex'), 10);\n            if (args.requestType === 'delete') {\n                var rowObj = this.parent.getRowsObject();\n                args.startIndex = this.parent.infiniteScrollSettings.enableCache\n                    ? (this.firstBlock - 1) * this.parent.pageSettings.pageSize : rowObj[rowObj.length - 1].index;\n            }\n            else {\n                args.startIndex = this.firstIndex;\n            }\n            if (!this.parent.infiniteScrollSettings.enableCache\n                && this.parent.pageSettings.currentPage === this.maxPage && args.requestType === 'delete') {\n                this.isLastPage = true;\n                this.lastIndex = this.lastIndex - 1;\n            }\n        }\n    };\n    InfiniteScroll.prototype.infiniteAddActionBegin = function (args) {\n        if (this.isNormaledit) {\n            this.isAdd = true;\n            if (this.parent.infiniteScrollSettings.enableCache) {\n                if (!Object.keys(this.emptyRowData).length) {\n                    this.createEmptyRowdata();\n                }\n                if (this.parent.pageSettings.currentPage > 1) {\n                    args.startEdit = false;\n                    this.resetInfiniteBlocks({}, true);\n                    this.makeRequest({ currentPage: 1 });\n                }\n            }\n        }\n    };\n    InfiniteScroll.prototype.infiniteEditHandler = function (args) {\n        if (!this.parent.infiniteScrollSettings.enableCache && (args.e.requestType === 'delete'\n            || (args.e.requestType === 'save' && this.requestType === 'add'))) {\n            var frozenCols = this.parent.getFrozenColumns();\n            var rowElms = this.parent.getRows();\n            var rows = this.parent.getRowsObject();\n            if (this.ensureRowAvailability(rows, args.result[0])) {\n                this.resetRowIndex(rows, args.e, rowElms, this.requestType === 'add');\n                if (frozenCols) {\n                    var rows_1 = this.parent.getMovableRowsObject();\n                    this.resetRowIndex(rows_1, args.e, this.parent.getMovableDataRows(), this.requestType === 'add');\n                }\n                if (!this.isLastPage) {\n                    this.createRow(rows, args);\n                }\n                else {\n                    this.isLastPage = false;\n                    this.parent.pageSettings.currentPage = this.maxPage;\n                    if (this.parent.selectionModule.index < this.parent.frozenRows) {\n                        remove(rowElms[this.parent.frozenRows - 1]);\n                        this.createRow([rows[this.parent.frozenRows - 1]], args, false, true);\n                        if (frozenCols) {\n                            var movableRows = this.parent.getMovableDataRows();\n                            remove(movableRows[this.parent.frozenRows]);\n                            this.createRow([this.parent.getMovableRowsObject()[this.parent.frozenRows - 1]], args, true, true);\n                        }\n                        this.setRowElements();\n                    }\n                }\n            }\n            this.parent.hideSpinner();\n            this.requestType === 'delete' ? this.parent.notify(events.deleteComplete, args.e)\n                : this.parent.notify(events.saveComplete, args.e);\n        }\n    };\n    InfiniteScroll.prototype.createRow = function (rows, args, isMovable, isFrozenRows) {\n        var row = !isFrozenRows ? this.generateRows(args.result, args.e) : rows;\n        var rowRenderer = new RowRenderer(this.serviceLocator, null, this.parent);\n        var tbody = !this.parent.getFrozenColumns() ? this.parent.getContent().querySelector('tbody') : isMovable\n            ? this.parent.getMovableVirtualContent().querySelector('tbody') : this.parent.getFrozenVirtualContent().querySelector('tbody');\n        if (this.parent.frozenRows) {\n            tbody = isFrozenRows && this.requestType !== 'add' || !isFrozenRows && this.requestType === 'add'\n                ? !this.parent.getFrozenColumns() ? this.parent.getHeaderContent().querySelector('tbody')\n                    : isMovable ? this.parent.getMovableVirtualHeader().querySelector('tbody')\n                        : this.parent.getFrozenVirtualHeader().querySelector('tbody') : tbody;\n        }\n        for (var i = row.length - 1; i >= 0; i--) {\n            if (this.requestType === 'delete') {\n                tbody.appendChild(rowRenderer.render(row[i], this.parent.getColumns()));\n            }\n            else {\n                tbody.insertBefore(rowRenderer.render(row[i], this.parent.getColumns()), tbody.firstElementChild);\n            }\n        }\n        if (!isFrozenRows && this.parent.frozenRows\n            && (this.parent.selectionModule.index < this.parent.frozenRows || this.requestType === 'add')) {\n            var rowElems = isMovable ? this.parent.getMovableDataRows() : this.parent.getRows();\n            var index = isMovable && this.requestType === 'add' ? this.parent.frozenRows : this.parent.frozenRows - 1;\n            remove(rowElems[index]);\n            this.createRow([rows[this.parent.frozenRows - 1]], args, isMovable, true);\n        }\n        if (!this.parent.infiniteScrollSettings.enableCache && !isFrozenRows) {\n            if (!this.parent.getFrozenColumns() || isMovable) {\n                this.setRowElements();\n                this.parent.contentModule.visibleRows = this.requestType === 'add'\n                    ? row.concat(rows) : rows.concat(row);\n            }\n            else {\n                this.parent.contentModule.visibleFrozenRows = this.requestType === 'add'\n                    ? row.concat(rows) : rows.concat(row);\n                this.createRow(this.parent.getMovableRowsObject(), args, true);\n            }\n        }\n    };\n    InfiniteScroll.prototype.ensureRowAvailability = function (rows, data) {\n        var resume = true;\n        if (this.parent.frozenRows && !this.parent.infiniteScrollSettings.enableCache\n            && this.parent.sortSettings.columns && this.requestType === 'add') {\n            var key = this.parent.getPrimaryKeyFieldNames()[0];\n            for (var i = 0; i < rows.length; i++) {\n                if (rows[i].data[key] === data[key]) {\n                    resume = false;\n                    break;\n                }\n            }\n        }\n        return resume;\n    };\n    InfiniteScroll.prototype.generateRows = function (data, args) {\n        return this.rowModelGenerator.generateRows(data, args);\n    };\n    InfiniteScroll.prototype.resetRowIndex = function (rows, args, rowElms, isAdd) {\n        var keyField = this.parent.getPrimaryKeyFieldNames()[0];\n        var isRemove = !(rowElms.length % this.parent.pageSettings.pageSize);\n        if (isAdd) {\n            if (isRemove) {\n                remove(rowElms[rows.length - 1]);\n                rowElms.splice(rows.length - 1, 1);\n                rows.splice(rows.length - 1, 1);\n            }\n        }\n        else {\n            rows.filter(function (e, index) {\n                if (e.data[keyField] === args.data[0][keyField]) {\n                    rows.splice(index, 1);\n                    remove(rowElms[index]);\n                    rowElms.splice(index, 1);\n                }\n            });\n        }\n        var startIndex = isAdd ? 1 : 0;\n        for (var i = 0; i < rows.length; i++) {\n            rows[i].index = startIndex;\n            rowElms[i].setAttribute('aria-rowindex', startIndex.toString());\n            this.resetCellIndex(rowElms[i].cells, startIndex);\n            startIndex++;\n        }\n        if (!rows.length) {\n            this.renderEmptyRow();\n        }\n    };\n    InfiniteScroll.prototype.renderEmptyRow = function () {\n        this.parent.renderModule.emptyRow(true);\n    };\n    InfiniteScroll.prototype.resetCellIndex = function (cells, index) {\n        for (var i = 0; i < cells.length; i++) {\n            cells[i].setAttribute('index', index.toString());\n        }\n    };\n    InfiniteScroll.prototype.setDisplayNone = function (args) {\n        if (this.parent.infiniteScrollSettings.enableCache) {\n            var frozenCols = this.parent.getFrozenColumns();\n            var keys = frozenCols ? Object.keys(this.infiniteFrozenCache) : Object.keys(this.infiniteCache);\n            for (var i = 1; i <= keys.length; i++) {\n                var cache = frozenCols ? args.isFreeze ? this.infiniteFrozenCache[i][0]\n                    : this.infiniteFrozenCache[i][1] : this.infiniteCache[i];\n                cache.filter(function (e) {\n                    e.cells[args.index].visible = args.visible === '';\n                });\n            }\n            this.resetContentModuleCache(frozenCols ? this.infiniteFrozenCache : this.infiniteCache);\n        }\n    };\n    InfiniteScroll.prototype.refreshInfiniteCache = function (data) {\n        this.getEditedRowObject().data = data;\n    };\n    InfiniteScroll.prototype.getEditedRowObject = function () {\n        var rowObjects = this.parent.getRowsObject();\n        var editedrow;\n        for (var i = 0; i < rowObjects.length; i++) {\n            if (rowObjects[i].index === this.editRowIndex) {\n                editedrow = rowObjects[i];\n            }\n        }\n        return editedrow;\n    };\n    InfiniteScroll.prototype.infiniteEditSuccess = function (args) {\n        if (this.isNormaledit) {\n            if (!this.isAdd && args.data) {\n                this.updateCurrentViewRecords(args.data);\n            }\n            this.isAdd = false;\n        }\n    };\n    InfiniteScroll.prototype.updateCurrentViewRecords = function (data) {\n        var index = getEditedDataIndex(this.parent, data);\n        if (!isNullOrUndefined(index)) {\n            this.parent.getCurrentViewRecords()[index] = data;\n        }\n    };\n    InfiniteScroll.prototype.actionBegin = function (args) {\n        if (args.requestType === 'add' || args.requestType === 'delete') {\n            this.requestType = args.requestType;\n        }\n    };\n    InfiniteScroll.prototype.actionComplete = function (args) {\n        if (args.requestType === 'delete' || args.requestType === 'save' || args.requestType === 'cancel') {\n            this.requestType = this.empty;\n            this.isCancel = args.requestType === 'cancel' || args.requestType === 'save';\n            this.isAdd = this.isEdit = false;\n            if (this.isNormaledit) {\n                this.editRowIndex = this.empty;\n                this.virtualInfiniteData = {};\n                this.parent.editModule.previousVirtualData = {};\n            }\n        }\n    };\n    InfiniteScroll.prototype.resetInfiniteEdit = function () {\n        if (this.parent.enableInfiniteScrolling && this.isNormaledit) {\n            if ((this.parent.editSettings.allowEditing && this.isEdit) || (this.parent.editSettings.allowAdding && this.isAdd)) {\n                this.parent.isEdit = true;\n            }\n        }\n    };\n    InfiniteScroll.prototype.getVirtualInfiniteData = function (data) {\n        data.virtualData = this.virtualInfiniteData;\n        data.isAdd = this.isAdd;\n        data.isCancel = this.isCancel;\n    };\n    InfiniteScroll.prototype.editActionBegin = function (e) {\n        this.isEdit = true;\n        this.editRowIndex = e.index;\n        var rowObject = extend({}, this.getEditedRowObject().data);\n        e.data = Object.keys(this.virtualInfiniteData).length ? this.virtualInfiniteData : rowObject;\n    };\n    InfiniteScroll.prototype.dataSourceModified = function () {\n        this.resetInfiniteBlocks({ requestType: this.empty }, true);\n    };\n    InfiniteScroll.prototype.onDataReady = function (e) {\n        if (!isNullOrUndefined(e.count)) {\n            this.maxPage = Math.ceil(e.count / this.parent.pageSettings.pageSize);\n        }\n    };\n    InfiniteScroll.prototype.ensureIntialCollapse = function (isExpand) {\n        this.isInitialCollapse = !isExpand;\n    };\n    InfiniteScroll.prototype.infiniteScrollHandler = function (e) {\n        var _this = this;\n        this.restoreInfiniteEdit();\n        this.restoreInfiniteAdd();\n        var targetEle = e.target;\n        var isInfinite = targetEle.classList.contains('e-content')\n            || targetEle.classList.contains('e-movablecontent');\n        if (isInfinite && this.parent.enableInfiniteScrolling) {\n            var scrollEle = this.parent.getFrozenColumns() ? this.parent.getMovableVirtualContent()\n                : this.parent.getContent().firstElementChild;\n            this.prevScrollTop = scrollEle.scrollTop;\n            var rows = this.parent.getRows();\n            var index = parseInt(rows[rows.length - 1].getAttribute('aria-rowindex'), 10) + 1;\n            var prevPage = this.parent.pageSettings.currentPage;\n            var args = void 0;\n            var offset = targetEle.scrollHeight - targetEle.scrollTop;\n            var round = Math.round(targetEle.scrollHeight - targetEle.scrollTop);\n            var floor = offset < targetEle.clientHeight ? Math.ceil(offset) : Math.floor(offset);\n            var isBottom = (floor === targetEle.clientHeight || round === targetEle.clientHeight);\n            if (this.isScroll && isBottom && (this.parent.pageSettings.currentPage <= this.maxPage - 1 || this.enableContinuousScroll)) {\n                if (this.parent.infiniteScrollSettings.enableCache) {\n                    this.isUpScroll = false;\n                    this.isDownScroll = true;\n                    setTimeout(function () {\n                        _this.isScroll = true;\n                    }, 600);\n                }\n                var rows_2 = [].slice.call(scrollEle.querySelectorAll('.e-row:not(.e-addedrow)'));\n                var row = rows_2[rows_2.length - 1];\n                var rowIndex = parseInt(row.getAttribute('aria-rowindex'), 10);\n                this.parent.pageSettings.currentPage = Math.ceil(rowIndex / this.parent.pageSettings.pageSize) + 1;\n                args = {\n                    requestType: 'infiniteScroll',\n                    currentPage: this.parent.pageSettings.currentPage,\n                    prevPage: prevPage,\n                    startIndex: index,\n                    direction: 'down'\n                };\n                this.makeRequest(args);\n            }\n            if (this.isScroll && this.parent.infiniteScrollSettings.enableCache && targetEle.scrollTop === 0\n                && this.parent.pageSettings.currentPage !== 1) {\n                if (this.parent.infiniteScrollSettings.enableCache) {\n                    this.isDownScroll = false;\n                    this.isUpScroll = true;\n                    setTimeout(function () {\n                        _this.isScroll = true;\n                    }, 600);\n                }\n                var row = [].slice.call(scrollEle.querySelectorAll('.e-row'));\n                var rowIndex = parseInt(row[this.parent.pageSettings.pageSize - 1].getAttribute('aria-rowindex'), 10);\n                var startIndex = parseInt(row[0].getAttribute('aria-rowindex'), 10) - this.parent.pageSettings.pageSize;\n                this.parent.pageSettings.currentPage = Math.ceil(rowIndex / this.parent.pageSettings.pageSize) - 1;\n                if (this.parent.pageSettings.currentPage) {\n                    args = {\n                        requestType: 'infiniteScroll',\n                        currentPage: this.parent.pageSettings.currentPage,\n                        prevPage: prevPage,\n                        startIndex: startIndex,\n                        direction: 'up'\n                    };\n                    this.makeRequest(args);\n                }\n            }\n            if (this.parent.infiniteScrollSettings.enableCache && !this.isScroll && isNullOrUndefined(args)) {\n                if (this.isDownScroll || this.isUpScroll) {\n                    scrollEle.scrollTop = this.top;\n                }\n            }\n        }\n    };\n    InfiniteScroll.prototype.makeRequest = function (args) {\n        var _this = this;\n        if (this.parent.pageSettings.currentPage !== args.prevPage) {\n            if (this.parent.pageSettings.currentPage <= this.maxPage) {\n                this.isInfiniteScroll = true;\n                if (isNullOrUndefined(this.infiniteCache[args.currentPage])) {\n                    setTimeout(function () {\n                        _this.getVirtualInfiniteEditedData();\n                        _this.parent.notify('model-changed', args);\n                    }, 100);\n                }\n                else {\n                    setTimeout(function () {\n                        _this.getVirtualInfiniteEditedData();\n                        _this.parent.notify(events.refreshInfiniteModeBlocks, args);\n                    }, 100);\n                }\n            }\n            else {\n                this.parent.pageSettings.currentPage = this.maxPage;\n            }\n        }\n    };\n    InfiniteScroll.prototype.infinitePageQuery = function (query) {\n        if (this.initialRender) {\n            this.initialRender = false;\n            this.intialPageQuery(query);\n        }\n        else {\n            if (!this.isInfiniteScroll && (this.requestType === 'delete' || this.requestType === 'add')) {\n                this.editPageQuery(query);\n            }\n            else {\n                query.page(this.parent.pageSettings.currentPage, this.parent.pageSettings.pageSize);\n            }\n        }\n    };\n    InfiniteScroll.prototype.editPageQuery = function (query) {\n        var initialBlocks = this.parent.infiniteScrollSettings.initialBlocks;\n        var isCache = this.parent.infiniteScrollSettings.enableCache;\n        if (isCache) {\n            this.infiniteCache = {};\n            this.infiniteFrozenCache = {};\n            query.skip(this.firstIndex);\n            query.take(initialBlocks * this.parent.pageSettings.pageSize);\n        }\n        else {\n            if (this.parent.editSettings.mode === 'Dialog') {\n                this.parent.clearSelection();\n            }\n            var index = this.requestType === 'delete' ? this.lastIndex : this.firstIndex;\n            query.skip(index);\n            query.take(1);\n        }\n    };\n    InfiniteScroll.prototype.intialPageQuery = function (query) {\n        if (this.parent.infiniteScrollSettings.enableCache\n            && this.parent.infiniteScrollSettings.initialBlocks > this.parent.infiniteScrollSettings.maxBlocks) {\n            this.parent.infiniteScrollSettings.initialBlocks = this.parent.infiniteScrollSettings.maxBlocks;\n        }\n        var pageSize = this.parent.pageSettings.pageSize * this.parent.infiniteScrollSettings.initialBlocks;\n        query.page(1, pageSize);\n    };\n    InfiniteScroll.prototype.infiniteCellFocus = function (e) {\n        if (e.byKey && (e.keyArgs.action === 'upArrow' || e.keyArgs.action === 'downArrow')) {\n            this.pressedKey = e.keyArgs.action;\n            var ele = document.activeElement;\n            var rowIndex = parseInt(ele.parentElement.getAttribute('aria-rowindex'), 10);\n            var scrollEle = this.parent.getContent().firstElementChild;\n            this.rowIndex = e.keyArgs.action === 'downArrow' ? rowIndex + 1 : rowIndex - 1;\n            this.cellIndex = parseInt(ele.getAttribute('aria-colindex'), 10);\n            var row = this.parent.getRowByIndex(rowIndex);\n            var visibleRowCount = Math.floor(scrollEle.offsetHeight / this.parent.getRowHeight());\n            if (!row || ensureLastRow(row, this.parent) || ensureFirstRow(row, this.rowTop)) {\n                var height = row ? row.getBoundingClientRect().height : this.parent.getRowHeight();\n                if (!this.parent.infiniteScrollSettings.enableCache) {\n                    if (e.keyArgs.action === 'downArrow' && (ensureLastRow(row, this.parent) || !row)) {\n                        var nTop = (this.rowIndex - visibleRowCount) * height;\n                        var oTop = scrollEle.scrollTop + this.parent.getRowHeight();\n                        scrollEle.scrollTop = nTop < oTop ? oTop : nTop;\n                    }\n                    if (e.keyArgs.action === 'upArrow' && ensureFirstRow(row, this.rowTop)) {\n                        scrollEle.scrollTop = this.rowIndex * height;\n                    }\n                }\n            }\n            else {\n                this.pressedKey = this.empty;\n            }\n        }\n        else if (e.key === 'PageDown' || e.key === 'PageUp') {\n            this.pressedKey = e.key;\n        }\n    };\n    InfiniteScroll.prototype.createEmptyRowdata = function () {\n        var _this = this;\n        this.parent.getColumns().filter(function (e) {\n            _this.emptyRowData[e.field] = _this.empty;\n        });\n    };\n    InfiniteScroll.prototype.getVirtualInfiniteEditedData = function () {\n        var editForm = this.parent.element.querySelector('.e-editedrow');\n        var addForm = this.parent.element.querySelector('.e-addedrow');\n        var gridForm = this.parent.element.querySelector('.e-gridform');\n        if (this.parent.infiniteScrollSettings.enableCache && (editForm || addForm)) {\n            var rowData = editForm ? extend({}, this.getEditedRowObject().data)\n                : extend({}, this.emptyRowData);\n            this.virtualInfiniteData = this.parent.editModule.getCurrentEditedData(gridForm, rowData);\n            if (this.parent.getFrozenColumns()) {\n                this.virtualInfiniteData = this.parent.editModule\n                    .getCurrentEditedData(this.parent.getMovableVirtualContent().querySelector('.e-gridform'), rowData);\n            }\n        }\n    };\n    InfiniteScroll.prototype.restoreInfiniteEdit = function () {\n        var content = this.parent.getFrozenColumns() ? this.parent.getMovableVirtualContent()\n            : this.parent.getContent().firstElementChild;\n        var frozenEdit = this.parent.frozenRows ? this.editRowIndex >= this.parent.frozenRows : true;\n        if (this.isNormaledit && this.parent.infiniteScrollSettings.enableCache && frozenEdit) {\n            if (this.parent.editSettings.allowEditing && !isNullOrUndefined(this.editRowIndex)) {\n                var row = this.parent.getRowByIndex(this.editRowIndex);\n                if (Object.keys(this.virtualInfiniteData).length && row && !this.parent.getContent().querySelector('.e-editedrow')) {\n                    var top_1 = row.getBoundingClientRect().top;\n                    if (top_1 < content.offsetHeight && top_1 > this.parent.getRowHeight()) {\n                        this.parent.isEdit = false;\n                        this.parent.editModule.startEdit(row);\n                    }\n                }\n            }\n        }\n    };\n    InfiniteScroll.prototype.restoreInfiniteAdd = function () {\n        var content = this.parent.getFrozenColumns() ? this.parent.getMovableVirtualContent()\n            : this.parent.getContent().firstElementChild;\n        if (this.parent.getRowByIndex(0) && this.isNormaledit && this.parent.infiniteScrollSettings.enableCache\n            && this.isAdd && !content.querySelector('.e-addedrow')) {\n            var isTop = content.scrollTop < this.parent.getRowHeight();\n            if (isTop) {\n                this.parent.isEdit = false;\n                this.parent.addRecord();\n            }\n        }\n    };\n    InfiniteScroll.prototype.appendInfiniteRows = function (e) {\n        var target = document.activeElement;\n        var frozenCols = this.parent.getFrozenColumns();\n        var scrollEle = frozenCols ? this.parent.getMovableVirtualContent()\n            : this.parent.getContent().firstElementChild;\n        var isInfiniteScroll = this.parent.enableInfiniteScrolling && e.args.requestType === 'infiniteScroll';\n        if ((isInfiniteScroll && !e.args.isFrozen) || !isInfiniteScroll) {\n            if (isInfiniteScroll && e.args.direction === 'up') {\n                e.tbody.insertBefore(e.frag, e.tbody.firstElementChild);\n            }\n            else {\n                e.tbody.appendChild(e.frag);\n            }\n        }\n        if (!frozenCols) {\n            this.parent.contentModule.getTable().appendChild(e.tbody);\n        }\n        else {\n            if (isInfiniteScroll) {\n                if (e.args.isFrozen) {\n                    this.frozenFrag = e.frag;\n                }\n                else {\n                    var tbody = this.parent.getFrozenVirtualContent().querySelector('tbody');\n                    e.args.direction === 'up' ? tbody.insertBefore(this.frozenFrag, tbody.firstElementChild)\n                        : tbody.appendChild(this.frozenFrag);\n                    this.parent.getMovableVirtualContent().querySelector('.e-table').appendChild(e.tbody);\n                }\n            }\n            else {\n                var table = e.args.isFrozen ? this.parent.getFrozenVirtualContent().querySelector('.e-table')\n                    : this.parent.getMovableVirtualContent().querySelector('.e-table');\n                table.appendChild(e.tbody);\n            }\n        }\n        if (!e.args.isFrozen) {\n            this.rowTop = !this.rowTop ? this.parent.getRows()[0].getBoundingClientRect().top : this.rowTop;\n            if (isInfiniteScroll) {\n                if (this.parent.infiniteScrollSettings.enableCache && this.isRemove) {\n                    scrollEle.scrollTop = this.top;\n                    if (frozenCols) {\n                        this.parent.getFrozenVirtualContent().scrollTop = this.top;\n                    }\n                }\n                this.setRowElements();\n                this.selectNewRow(e.tbody, e.args.startIndex);\n                this.pressedKey = undefined;\n            }\n            this.restoreInfiniteAdd();\n        }\n        this.isInfiniteScroll = false;\n    };\n    InfiniteScroll.prototype.setRowElements = function () {\n        if (this.parent.getFrozenColumns()) {\n            this.parent.contentModule.rowElements =\n                [].slice.call(this.parent.element.querySelectorAll('.e-movableheader .e-row, .e-movablecontent .e-row'));\n            this.parent.contentModule.freezeRowElements =\n                [].slice.call(this.parent.element.querySelectorAll('.e-frozenheader .e-row, .e-frozencontent .e-row'));\n        }\n        else {\n            this.parent.contentModule.rowElements =\n                [].slice.call(this.parent.element.querySelectorAll('.e-row:not(.e-addedrow)'));\n        }\n    };\n    InfiniteScroll.prototype.selectNewRow = function (tbody, startIndex) {\n        var _this = this;\n        var row = this.parent.getRowByIndex(this.rowIndex);\n        if (this.keys.some(function (value) { return value === _this.pressedKey; })) {\n            if (this.pressedKey === 'downArrow' || (this.parent.infiniteScrollSettings.enableCache && this.pressedKey === 'upArrow')) {\n                setTimeout(function () {\n                    // tslint:disable-next-line:no-any\n                    var target = row.cells[0];\n                    target.focus({ preventScroll: true });\n                    _this.parent.selectRow(_this.rowIndex);\n                    _this.parent.getContent().firstElementChild.scrollTop += _this.parent.getRowHeight();\n                }, 0);\n            }\n            if (this.pressedKey === 'PageDown') {\n                var row_1 = this.parent.getRowByIndex(startIndex);\n                if (row_1) {\n                    row_1.cells[0].focus();\n                }\n            }\n            if (this.pressedKey === 'PageUp') {\n                tbody.querySelector('.e-row').cells[0].focus();\n            }\n        }\n    };\n    InfiniteScroll.prototype.removeInfiniteCacheRows = function (e) {\n        var isInfiniteScroll = this.parent.enableInfiniteScrolling && e.args.requestType === 'infiniteScroll';\n        if (!e.args.isFrozen && isInfiniteScroll && this.parent.infiniteScrollSettings.enableCache && this.isRemove) {\n            var rows = [].slice.call(this.parent.getContentTable().querySelectorAll('.e-row'));\n            if (e.args.direction === 'down') {\n                if (this.parent.allowGrouping && this.parent.groupSettings.columns.length) {\n                    var captionRows = [].slice.call(this.parent.getContentTable().querySelectorAll('tr'));\n                    this.removeCaptionRows(captionRows, e.args);\n                }\n                var addRowCount = this.parent.element.querySelector('.e-addedrow') ? 0 : 1;\n                this.removeTopRows(rows, this.parent.pageSettings.pageSize - addRowCount);\n            }\n            if (e.args.direction === 'up') {\n                if (this.parent.allowGrouping && this.parent.groupSettings.columns.length) {\n                    var captionRows = [].slice.call(this.parent.getContentTable().querySelectorAll('tr'));\n                    this.removeCaptionRows(captionRows, e.args);\n                }\n                else {\n                    this.removeBottomRows(rows, rows.length - 1, e.args);\n                }\n            }\n            this.isScroll = false;\n            this.top = this.calculateScrollTop(e.args);\n        }\n    };\n    InfiniteScroll.prototype.calculateScrollTop = function (args) {\n        var top = 0;\n        var scrollCnt = this.parent.getFrozenColumns() ? this.parent.getMovableVirtualContent()\n            : this.parent.getContent().firstElementChild;\n        if (args.direction === 'down') {\n            if (this.parent.allowGrouping && this.parent.groupSettings.columns.length && !this.isInitialCollapse) {\n                top = this.captionRowHeight();\n            }\n            var captionRows = [].slice.call(this.parent.getContent().firstElementChild.querySelectorAll('tr:not(.e-row)'));\n            var captionCount = 0;\n            if (this.isInitialCollapse && !isNullOrUndefined(captionRows)) {\n                captionCount = Math.round((captionRows.length - 1) / this.parent.groupSettings.columns.length);\n            }\n            var value = captionCount ? captionCount\n                : this.parent.pageSettings.pageSize * (this.parent.infiniteScrollSettings.maxBlocks - 1);\n            var currentViewRowCount = 0;\n            var i = 0;\n            while (currentViewRowCount < scrollCnt.clientHeight) {\n                i++;\n                currentViewRowCount = i * this.parent.getRowHeight();\n            }\n            i = i - 1;\n            top += (value - i) * this.parent.getRowHeight();\n        }\n        if (args.direction === 'up') {\n            if (this.parent.allowGrouping && this.parent.groupSettings.columns.length && !this.isInitialCollapse) {\n                top = this.infiniteCache[this.parent.pageSettings.currentPage].length * this.parent.getRowHeight();\n            }\n            else if (this.isInitialCollapse) {\n                var groupedData = this.infiniteCache[this.parent.pageSettings.currentPage];\n                var count = 0;\n                for (var i = 0; i < groupedData.length; i++) {\n                    if (groupedData[i].isCaptionRow) {\n                        count++;\n                    }\n                }\n                top += Math.round(count / this.parent.groupSettings.columns.length) * this.parent.getRowHeight();\n            }\n            else {\n                top += (this.parent.pageSettings.pageSize * this.parent.getRowHeight() + getScrollBarWidth());\n            }\n        }\n        return top;\n    };\n    InfiniteScroll.prototype.captionRowHeight = function () {\n        var rows = [].slice.call(this.parent.getContent().querySelectorAll('tr:not(.e-row)'));\n        return rows.length * this.parent.getRowHeight();\n    };\n    InfiniteScroll.prototype.removeTopRows = function (rows, maxIndx) {\n        var frozeCols = this.parent.getFrozenColumns();\n        var movableRows = frozeCols ?\n            [].slice.call(this.parent.getMovableVirtualContent().querySelectorAll('.e-row')) : null;\n        for (var i = 0; i <= maxIndx; i++) {\n            if (this.parent.frozenRows && this.parent.pageSettings.currentPage === this.parent.infiniteScrollSettings.maxBlocks + 1\n                && i > (maxIndx - this.parent.frozenRows)) {\n                continue;\n            }\n            remove(rows[i]);\n            if (movableRows) {\n                remove(movableRows[i]);\n            }\n        }\n    };\n    InfiniteScroll.prototype.removeBottomRows = function (rows, maxIndx, args) {\n        var cnt = 0;\n        var frozeCols = this.parent.getFrozenColumns();\n        var movableRows = frozeCols ?\n            [].slice.call(this.parent.getMovableVirtualContent().querySelectorAll('.e-row')) : null;\n        var pageSize = this.parent.pageSettings.pageSize;\n        if (!frozeCols && this.infiniteCache[args.prevPage].length < pageSize) {\n            cnt = this.parent.pageSettings.pageSize - this.infiniteCache[args.prevPage].length;\n        }\n        if (frozeCols && this.infiniteFrozenCache[args.prevPage][1].length < pageSize) {\n            cnt = this.parent.pageSettings.pageSize - this.infiniteFrozenCache[args.prevPage][1].length;\n        }\n        for (var i = maxIndx; cnt < pageSize; i--) {\n            cnt++;\n            remove(rows[i]);\n            if (movableRows) {\n                remove(movableRows[i]);\n            }\n        }\n    };\n    InfiniteScroll.prototype.removeCaptionRows = function (rows, args) {\n        if (args.direction === 'down') {\n            var lastRow = this.parent.getRows()[this.parent.pageSettings.pageSize];\n            var lastRowIndex = parseInt(lastRow.getAttribute('aria-rowindex'), 10) - 1;\n            var k = 0;\n            for (var i = 0; k < lastRowIndex; i++) {\n                if (!rows[i].classList.contains('e-row')) {\n                    remove(rows[i]);\n                }\n                else {\n                    k = parseInt(rows[i].getAttribute('aria-rowindex'), 10);\n                }\n            }\n        }\n        if (args.direction === 'up') {\n            var rowElements = [].slice.call(this.parent.getContent().querySelectorAll('.e-row'));\n            var lastIndex = parseInt(rowElements[rowElements.length - 1].getAttribute('aria-rowindex'), 10);\n            var page = Math.ceil(lastIndex / this.parent.pageSettings.pageSize);\n            var startIndex = 0;\n            for (var i = this.parent.pageSettings.currentPage + 1; i < page; i++) {\n                startIndex += this.infiniteCache[i].length;\n            }\n            for (var i = startIndex; i < rows.length; i++) {\n                remove(rows[i]);\n            }\n        }\n    };\n    InfiniteScroll.prototype.resetInfiniteBlocks = function (args, isDataModified) {\n        var isInfiniteScroll = this.parent.enableInfiniteScrolling && args.requestType !== 'infiniteScroll';\n        if (!this.initialRender && !isNullOrUndefined(this.parent.infiniteScrollModule) && isInfiniteScroll) {\n            if (this.actions.some(function (value) { return value === args.requestType; }) || isDataModified) {\n                var scrollEle = this.parent.getFrozenColumns() ? this.parent.getMovableVirtualContent()\n                    : this.parent.getContent().firstElementChild;\n                this.initialRender = true;\n                scrollEle.scrollTop = 0;\n                this.parent.pageSettings.currentPage = 1;\n                this.infiniteCache = this.infiniteFrozenCache = {};\n                this.resetContentModuleCache({});\n                this.isRemove = false;\n                this.top = 0;\n                this.isInitialMovableRender = true;\n                this.isInitialCollapse = false;\n                this.parent.contentModule.isRemove = this.isRemove;\n                this.parent.contentModule.isAddRows = this.isRemove;\n                this.parent.contentModule.visibleRows = [];\n                this.parent.contentModule.visibleFrozenRows = [];\n            }\n        }\n    };\n    InfiniteScroll.prototype.setCache = function (e) {\n        if (this.parent.enableInfiniteScrolling && this.parent.infiniteScrollSettings.enableCache) {\n            var frozeCols = this.parent.getFrozenColumns();\n            var idx = e.args.isFrozen ? 1 : 0;\n            var isEdit = e.args.requestType !== 'infiniteScroll'\n                && (this.requestType === 'delete' || this.requestType === 'add');\n            var currentPage = this.parent.pageSettings.currentPage;\n            if ((frozeCols && this.isInitialMovableRender) || (!frozeCols && !Object.keys(this.infiniteCache).length) || isEdit) {\n                this.isInitialMovableRender = !e.args.isFrozen;\n                this.setInitialCache(e.modelData, e.args, isEdit);\n            }\n            if (!frozeCols && isNullOrUndefined(this.infiniteCache[this.parent.pageSettings.currentPage])) {\n                this.infiniteCache[this.parent.pageSettings.currentPage] = e.modelData;\n                this.resetContentModuleCache(this.infiniteCache);\n            }\n            if (frozeCols) {\n                if ((idx === 0 && isNullOrUndefined(this.infiniteFrozenCache[currentPage]))\n                    || !this.infiniteFrozenCache[currentPage][idx].length) {\n                    this.createFrozenCache(currentPage);\n                    this.infiniteFrozenCache[currentPage][idx] = e.modelData;\n                    if (idx === 1) {\n                        this.resetContentModuleCache(this.infiniteFrozenCache);\n                    }\n                }\n            }\n            if (e.isInfiniteScroll && !this.isRemove) {\n                this.isRemove = (currentPage - 1) % this.parent.infiniteScrollSettings.maxBlocks === 0;\n                this.parent.contentModule.isRemove = this.isRemove;\n            }\n        }\n    };\n    InfiniteScroll.prototype.setInitialCache = function (data, args, isEdit) {\n        var frozenCols = this.parent.getFrozenColumns();\n        var idx = args.isFrozen ? 1 : 0;\n        var k = !isEdit ? 1 : this.firstBlock;\n        for (var i = 1; i <= this.parent.infiniteScrollSettings.initialBlocks; i++) {\n            var startIndex = (i - 1) * this.parent.pageSettings.pageSize;\n            var endIndex = i * this.parent.pageSettings.pageSize;\n            if (this.parent.allowGrouping && this.parent.groupSettings.columns.length) {\n                this.setInitialGroupCache(data, k, startIndex, endIndex);\n            }\n            else {\n                if (frozenCols) {\n                    this.createFrozenCache(k);\n                    this.infiniteFrozenCache[k][idx] = data.slice(startIndex, endIndex);\n                    this.resetContentModuleCache(this.infiniteFrozenCache);\n                }\n                else {\n                    this.infiniteCache[k] = data.slice(startIndex, endIndex);\n                    this.resetContentModuleCache(this.infiniteCache);\n                }\n            }\n            k++;\n        }\n    };\n    InfiniteScroll.prototype.createFrozenCache = function (index) {\n        if (!this.infiniteFrozenCache[index]) {\n            this.infiniteFrozenCache[index] = [[], []];\n        }\n    };\n    InfiniteScroll.prototype.setInitialGroupCache = function (data, index, sIndex, eIndex) {\n        var pageData = [];\n        var startIndex = 0;\n        for (var i = 1; i <= Object.keys(this.infiniteCache).length; i++) {\n            startIndex += this.infiniteCache[i].length;\n        }\n        var k = sIndex;\n        for (var i = startIndex; i < data.length && k < eIndex; i++) {\n            if (data[i].index < eIndex || data[i].isCaptionRow) {\n                k = data[i].isCaptionRow ? k : data[i].index;\n                pageData.push(data[i]);\n            }\n            if (data[i].index >= eIndex || data[i].index === eIndex - 1) {\n                break;\n            }\n        }\n        this.infiniteCache[index] = pageData;\n        this.resetContentModuleCache(this.infiniteCache);\n    };\n    InfiniteScroll.prototype.resetContentModuleCache = function (data) {\n        this.parent.contentModule\n            .infiniteCache = data;\n    };\n    /**\n     * @hidden\n     */\n    InfiniteScroll.prototype.destroy = function () {\n        this.removeEventListener();\n    };\n    return InfiniteScroll;\n}());\nexport { InfiniteScroll };\n"]},"metadata":{},"sourceType":"module"}