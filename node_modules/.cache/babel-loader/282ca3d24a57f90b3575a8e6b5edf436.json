{"ast":null,"code":"import { extend, addClass, removeClass, setValue, isBlazor } from '@syncfusion/ej2-base';\nimport { remove, classList, updateBlazorTemplate, blazorTemplates, resetBlazorTemplate } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, isUndefined } from '@syncfusion/ej2-base';\nimport { CellType } from '../base/enum';\nimport { parentsUntil, inArray, refreshForeignData, getObject, alignFrozenEditForm, getScrollBarWidth } from '../base/util';\nimport * as events from '../base/constant';\nimport { RowRenderer } from '../renderer/row-renderer';\nimport { CellRenderer } from '../renderer/cell-renderer';\nimport { Row } from '../models/row';\nimport { Cell } from '../models/cell';\nimport { RowModelGenerator } from '../services/row-model-generator';\nimport { DataUtil } from '@syncfusion/ej2-data';\n/**\n * `BatchEdit` module is used to handle batch editing actions.\n * @hidden\n */\n\nvar BatchEdit =\n/** @class */\nfunction () {\n  function BatchEdit(parent, serviceLocator, renderer) {\n    this.cellDetails = {};\n    this.originalCell = {};\n    this.cloneCell = {};\n    this.editNext = false;\n    this.preventSaveCell = false;\n    this.parent = parent;\n    this.serviceLocator = serviceLocator;\n    this.renderer = renderer;\n    this.focus = serviceLocator.getService('focus');\n    this.addEventListener();\n  }\n  /**\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.click, this.clickHandler, this);\n    this.parent.on(events.dblclick, this.dblClickHandler, this);\n    this.parent.on(events.beforeCellFocused, this.onBeforeCellFocused, this);\n    this.parent.on(events.cellFocused, this.onCellFocused, this);\n    this.dataBoundFunction = this.dataBound.bind(this);\n    this.batchCancelFunction = this.batchCancel.bind(this);\n    this.parent.addEventListener(events.dataBound, this.dataBoundFunction);\n    this.parent.addEventListener(events.batchCancel, this.batchCancelFunction);\n    this.parent.on(events.doubleTap, this.dblClickHandler, this);\n    this.parent.on(events.keyPressed, this.keyDownHandler, this);\n    this.parent.on(events.editNextValCell, this.editNextValCell, this);\n    this.parent.on('closebatch', this.closeForm, this);\n  };\n  /**\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.click, this.clickHandler);\n    this.parent.off(events.dblclick, this.dblClickHandler);\n    this.parent.off(events.beforeCellFocused, this.onBeforeCellFocused);\n    this.parent.off(events.cellFocused, this.onCellFocused);\n    this.parent.removeEventListener(events.dataBound, this.dataBoundFunction);\n    this.parent.removeEventListener(events.batchCancel, this.batchCancelFunction);\n    this.parent.off(events.doubleTap, this.dblClickHandler);\n    this.parent.off(events.keyPressed, this.keyDownHandler);\n    this.parent.off(events.editNextValCell, this.editNextValCell);\n    this.parent.off('closebatch', this.closeForm);\n  };\n\n  BatchEdit.prototype.batchCancel = function (args) {\n    this.parent.focusModule.restoreFocus();\n  };\n\n  BatchEdit.prototype.dataBound = function () {\n    this.parent.notify(events.toolbarRefresh, {});\n  };\n  /**\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.destroy = function () {\n    this.removeEventListener();\n  };\n\n  BatchEdit.prototype.clickHandler = function (e) {\n    if (!parentsUntil(e.target, this.parent.element.id + '_add', true)) {\n      if (this.parent.isEdit) {\n        this.saveCell();\n        this.editNextValCell();\n      }\n\n      if (parentsUntil(e.target, 'e-rowcell') && !this.parent.isEdit) {\n        this.setCellIdx(e.target);\n      }\n    }\n  };\n\n  BatchEdit.prototype.dblClickHandler = function (e) {\n    var target = parentsUntil(e.target, 'e-rowcell');\n    var tr = parentsUntil(e.target, 'e-row');\n\n    if (target && tr && !isNaN(parseInt(target.getAttribute('aria-colindex'), 10)) && !target.parentElement.classList.contains('e-editedrow')) {\n      this.editCell(parseInt(tr.getAttribute('aria-rowindex'), 10), this.parent.getColumns()[parseInt(target.getAttribute('aria-colindex'), 10)].field, this.isAddRow(parseInt(tr.getAttribute('aria-rowindex'), 10)));\n    }\n  };\n\n  BatchEdit.prototype.onBeforeCellFocused = function (e) {\n    if (this.parent.isEdit && this.validateFormObj() && (e.byClick || ['tab', 'shiftTab', 'enter', 'shiftEnter'].indexOf(e.keyArgs.action) > -1)) {\n      e.cancel = true;\n\n      if (e.byClick) {\n        e.clickArgs.preventDefault();\n      } else {\n        e.keyArgs.preventDefault();\n      }\n    }\n  };\n\n  BatchEdit.prototype.onCellFocused = function (e) {\n    var frzCols = this.parent.getFrozenColumns();\n    var mCont = this.parent.getContent().querySelector('.e-movablecontent');\n    var mHdr = this.parent.getHeaderContent().querySelector('.e-movableheader');\n    var clear = (!e.container.isContent || !e.container.isDataCell) && !(this.parent.frozenRows && e.container.isHeader);\n\n    if (!e.byKey || clear) {\n      if (this.parent.isEdit && clear) {\n        this.saveCell();\n      }\n\n      return;\n    }\n\n    var _a = e.container.indexes,\n        rowIndex = _a[0],\n        cellIndex = _a[1];\n\n    if (frzCols && (mCont.contains(e.element) || this.parent.frozenRows && mHdr.contains(e.element))) {\n      cellIndex += frzCols;\n    }\n\n    if (this.parent.frozenRows && e.container.isContent) {\n      rowIndex += this.parent.frozenRows;\n    }\n\n    var isEdit = this.parent.isEdit;\n\n    if (!this.parent.element.querySelectorAll('.e-popup-open').length) {\n      isEdit = isEdit && !this.validateFormObj();\n\n      switch (e.keyArgs.action) {\n        case 'tab':\n        case 'shiftTab':\n          var col = this.parent.getColumns()[e.indexes[1]];\n\n          if (col && !this.parent.isEdit) {\n            this.editCell(e.indexes[0], col.field);\n          }\n\n          if (isEdit || this.parent.isLastCellPrimaryKey) {\n            this.editCellFromIndex(rowIndex, cellIndex);\n          }\n\n          break;\n\n        case 'enter':\n        case 'shiftEnter':\n          e.keyArgs.preventDefault();\n\n          if (isEdit) {\n            this.editCell(rowIndex, this.cellDetails.column.field);\n          }\n\n          break;\n\n        case 'f2':\n          this.editCellFromIndex(rowIndex, cellIndex);\n          this.focus.focus();\n          break;\n      }\n    }\n  };\n\n  BatchEdit.prototype.isAddRow = function (index) {\n    return this.parent.getDataRows()[index].classList.contains('e-insertedrow');\n  };\n\n  BatchEdit.prototype.editCellFromIndex = function (rowIdx, cellIdx) {\n    this.cellDetails.rowIndex = rowIdx;\n    this.cellDetails.cellIndex = cellIdx;\n    this.editCell(rowIdx, this.parent.getColumns()[cellIdx].field, this.isAddRow(rowIdx));\n  }; // tslint:disable-next-line:max-func-body-length\n\n\n  BatchEdit.prototype.closeEdit = function () {\n    var gObj = this.parent;\n    var rows = this.parent.getRowsObject();\n    var argument = {\n      cancel: false,\n      batchChanges: this.getBatchChanges()\n    };\n    gObj.notify(events.beforeBatchCancel, argument);\n\n    if (argument.cancel) {\n      return;\n    }\n\n    if (gObj.frozenColumns && rows.length < this.parent.currentViewData.length * 2 && !(isBlazor() && gObj.isServerRendered)) {\n      rows.push.apply(rows, this.parent.getMovableRowsObject());\n    }\n\n    var cols = this.parent.getColumns();\n\n    if (isBlazor()) {\n      for (var i = 0; i < cols.length; i++) {\n        var col = cols[i];\n\n        if (col.template) {\n          updateBlazorTemplate(this.parent.element.id + col.uid, 'Template', col, false);\n        }\n      }\n    }\n\n    var rowRenderer = new RowRenderer(this.serviceLocator, null, this.parent);\n    var tr;\n    var mTr;\n    var movObj;\n\n    if (gObj.isEdit) {\n      this.saveCell(true);\n    }\n\n    this.isAdded = false;\n    gObj.clearSelection();\n\n    for (var i = 0; i < rows.length; i++) {\n      if (rows[i].isDirty) {\n        if (gObj.frozenColumns) {\n          movObj = gObj.getMovableRowsObject()[rows[i].index];\n          movObj.isDirty = true;\n        }\n\n        tr = gObj.getContentTable().querySelector('[data-uid=' + rows[i].uid + ']');\n\n        if (gObj.frozenRows && !tr) {\n          tr = gObj.getHeaderContent().querySelector('[data-uid=' + rows[i].uid + ']');\n        }\n\n        if (gObj.frozenColumns) {\n          if (gObj.frozenRows) {\n            mTr = gObj.getHeaderContent().querySelector('.e-movableheader').querySelector('[data-uid=' + rows[i].uid + ']');\n\n            if (!mTr) {\n              mTr = gObj.getContent().querySelector('.e-movablecontent').querySelector('[data-uid=' + rows[i].uid + ']');\n            }\n          } else {\n            mTr = gObj.getContent().querySelector('.e-movablecontent').querySelector('[data-uid=' + rows[i].uid + ']');\n          }\n        }\n\n        if (tr || mTr) {\n          if (tr && tr.classList.contains('e-insertedrow') || mTr && mTr.classList.contains('e-insertedrow')) {\n            if (tr) {\n              remove(tr);\n            }\n\n            if (mTr && (gObj.frozenColumns || gObj.frozenRows)) {\n              remove(mTr);\n            }\n\n            this.removeRowObjectFromUID(rows[i].uid);\n            i--;\n          } else {\n            refreshForeignData(rows[i], this.parent.getForeignKeyColumns(), rows[i].data);\n            delete rows[i].changes;\n            delete rows[i].edit;\n            rows[i].isDirty = false;\n            var ftr = mTr ? mTr : tr;\n\n            if (isBlazor() && gObj.isServerRendered) {\n              if (gObj.getFrozenColumns()) {\n                this.removeHideAndSelection(mTr);\n              }\n\n              this.removeHideAndSelection(tr);\n              this.closeForm();\n            } else {\n              classList(ftr, [], ['e-hiddenrow', 'e-updatedtd']);\n              rowRenderer.refresh(rows[i], gObj.getColumns(), false);\n            }\n          }\n\n          if (this.parent.aggregates.length > 0) {\n            var type = 'type';\n            var editType = [];\n            editType[type] = 'cancel';\n            this.parent.notify(events.refreshFooterRenderer, editType);\n\n            if (this.parent.groupSettings.columns.length > 0) {\n              this.parent.notify(events.groupAggregates, editType);\n            }\n          }\n        }\n      }\n    }\n\n    if (isBlazor() && gObj.isServerRendered) {\n      gObj.selectRow(gObj.selectionModule.prevRowIndex);\n    }\n\n    if (!gObj.getContentTable().querySelector('tr.e-row')) {\n      gObj.renderModule.renderEmptyRow();\n    }\n\n    var args = {\n      requestType: 'batchCancel',\n      rows: this.parent.getRowsObject()\n    };\n    gObj.notify(events.batchCancel, {\n      rows: this.parent.getRowsObject().length ? this.parent.getRowsObject() : [new Row({\n        isDataRow: true,\n        cells: [new Cell({\n          isDataCell: true,\n          visible: true\n        })]\n      })]\n    });\n    gObj.selectRow(this.cellDetails.rowIndex);\n    this.refreshRowIdx();\n    gObj.notify(events.toolbarRefresh, {});\n    this.parent.notify(events.tooltipDestroy, {});\n    args = {\n      requestType: 'batchCancel',\n      rows: this.parent.getRowsObject()\n    };\n    gObj.trigger(events.batchCancel, args);\n\n    if (gObj.frozenColumns) {\n      rows.splice(this.parent.getMovableRowsObject().length, rows.length);\n    }\n  };\n\n  BatchEdit.prototype.removeHideAndSelection = function (tr) {\n    if (tr.classList.contains('e-hiddenrow')) {\n      tr.removeAttribute('aria-selected');\n      var tdElements = [].slice.call(tr.querySelectorAll('.e-selectionbackground'));\n\n      for (var i = 0; i < tdElements.length; i++) {\n        removeClass([tdElements[i]], ['e-selectionbackground', 'e-active']);\n      }\n    }\n\n    classList(tr, [], ['e-hiddenrow', 'e-updatedtd']);\n  };\n\n  BatchEdit.prototype.deleteRecord = function (fieldname, data) {\n    this.saveCell();\n\n    if (this.validateFormObj()) {\n      this.saveCell(true);\n    }\n\n    this.isAdded = false;\n    this.bulkDelete(fieldname, data);\n\n    if (this.parent.aggregates.length > 0) {\n      this.parent.notify(events.refreshFooterRenderer, {});\n\n      if (this.parent.groupSettings.columns.length > 0) {\n        this.parent.notify(events.groupAggregates, {});\n      }\n    }\n  };\n\n  BatchEdit.prototype.addRecord = function (data) {\n    this.bulkAddRow(data);\n  };\n\n  BatchEdit.prototype.endEdit = function (data) {\n    if (this.parent.isEdit && this.validateFormObj()) {\n      return;\n    }\n\n    this.batchSave();\n  };\n\n  BatchEdit.prototype.closeForm = function () {\n    for (var i = 0; i < Object.keys(this.originalCell).length; i++) {\n      for (var j = 0; j < Object.keys(this.cloneCell).length; j++) {\n        if (Object.keys(this.originalCell)[i] === Object.keys(this.cloneCell)[j]) {\n          this.cloneCell[Object.keys(this.cloneCell)[j]].replaceWith(this.originalCell[Object.keys(this.originalCell)[i]]);\n\n          if (this.originalCell[Object.keys(this.originalCell)[i]].classList.contains('e-selectionbackground')) {\n            this.originalCell[Object.keys(this.originalCell)[i]].classList.remove('e-selectionbackground', 'e-cellselectionbackground', 'e-active');\n          }\n        }\n      }\n    }\n\n    this.cloneCell = {};\n    this.originalCell = {};\n  };\n\n  BatchEdit.prototype.validateFormObj = function () {\n    return this.parent.editModule.formObj && !this.parent.editModule.formObj.validate();\n  };\n\n  BatchEdit.prototype.batchSave = function () {\n    var _this = this;\n\n    var gObj = this.parent;\n    var deletedRecords = 'deletedRecords';\n\n    if (gObj.isCheckBoxSelection) {\n      var checkAllBox = gObj.element.querySelector('.e-checkselectall').parentElement;\n\n      if (checkAllBox.classList.contains('e-checkbox-disabled') && gObj.pageSettings.totalRecordsCount > gObj.currentViewData.length) {\n        removeClass([checkAllBox], ['e-checkbox-disabled']);\n      }\n    }\n\n    var cols = this.parent.getColumns();\n\n    if (isBlazor()) {\n      for (var i = 0; i < cols.length; i++) {\n        var col = cols[i];\n\n        if (col.template) {\n          blazorTemplates[this.parent.element.id + col.uid] = [];\n          resetBlazorTemplate(this.parent.element.id + col.uid, 'Template');\n        }\n      }\n    }\n\n    this.saveCell();\n\n    if (gObj.isEdit || this.editNextValCell() || gObj.isEdit) {\n      return;\n    }\n\n    var changes = this.getBatchChanges();\n\n    if (this.parent.selectionSettings.type === 'Multiple' && changes[deletedRecords].length && this.parent.selectionSettings.persistSelection) {\n      changes[deletedRecords] = this.removeSelectedData;\n      this.removeSelectedData = [];\n    }\n\n    var original = {\n      changedRecords: this.parent.getRowsObject().filter(function (row) {\n        return row.isDirty && ['add', 'delete'].indexOf(row.edit) === -1;\n      }).map(function (row) {\n        return row.data;\n      })\n    };\n    var args = {\n      batchChanges: changes,\n      cancel: false\n    };\n    gObj.trigger(events.beforeBatchSave, args, function (beforeBatchSaveArgs) {\n      if (beforeBatchSaveArgs.cancel) {\n        return;\n      }\n\n      if (isBlazor() && _this.parent.isServerRendered) {\n        var content = _this.parent.getContent();\n\n        _this.closeForm();\n\n        removeClass(content.querySelectorAll('.e-updatedtd'), ['e-updatedtd']);\n\n        if (content.querySelector('.e-insertedrow, .e-hiddenrow')) {\n          removeClass(content.querySelectorAll('.e-hiddenrow'), ['e-hiddenrow']);\n          var insertedRow = [].slice.call(content.querySelectorAll('.e-insertedrow'));\n\n          for (var i = 0; i < insertedRow.length; i++) {\n            insertedRow[i].remove();\n          }\n        }\n\n        _this.refreshRowIdx();\n      }\n\n      gObj.showSpinner();\n      gObj.notify(events.bulkSave, {\n        changes: changes,\n        original: original\n      });\n    });\n  };\n\n  BatchEdit.prototype.getBatchChanges = function () {\n    var changes = {\n      addedRecords: [],\n      deletedRecords: [],\n      changedRecords: []\n    };\n    var rows = this.parent.getRowsObject();\n\n    for (var _i = 0, rows_1 = rows; _i < rows_1.length; _i++) {\n      var row = rows_1[_i];\n\n      if (row.isDirty) {\n        switch (row.edit) {\n          case 'add':\n            changes.addedRecords.push(row.changes);\n            break;\n\n          case 'delete':\n            changes.deletedRecords.push(row.data);\n            break;\n\n          default:\n            changes.changedRecords.push(row.changes);\n        }\n      }\n    }\n\n    return changes;\n  };\n  /**\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.removeRowObjectFromUID = function (uid) {\n    var rows = this.parent.getRowsObject();\n    var i = 0;\n\n    for (var len = rows.length; i < len; i++) {\n      if (rows[i].uid === uid) {\n        break;\n      }\n    }\n\n    rows.splice(i, 1);\n  };\n  /**\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.addRowObject = function (row) {\n    var isTop = this.parent.editSettings.newRowPosition === 'Top';\n    var frozenColumnsCount = this.parent.getFrozenColumns();\n\n    if (frozenColumnsCount) {\n      var mRow = this.parent.getMovableRowsObject();\n      var mEle = row.clone();\n      mEle.cells = mEle.cells.slice(frozenColumnsCount);\n      row.cells = row.cells.slice(0, frozenColumnsCount);\n      isTop ? mRow.unshift(mEle) : mRow.push(mEle);\n    }\n\n    isTop ? this.parent.getRowsObject().unshift(row) : this.parent.getRowsObject().push(row);\n  }; // tslint:disable-next-line:max-func-body-length\n\n\n  BatchEdit.prototype.bulkDelete = function (fieldname, data) {\n    var _this = this;\n\n    this.removeSelectedData = [];\n    var gObj = this.parent;\n    var index = gObj.selectedRowIndex;\n    var selectedRows = gObj.getSelectedRows();\n    var args = {\n      primaryKey: this.parent.getPrimaryKeyFieldNames(),\n      rowIndex: index,\n      rowData: data ? data : gObj.getSelectedRecords()[0],\n      cancel: false\n    };\n\n    if (!isBlazor() || this.parent.isJsComponent) {\n      if (data) {\n        args.row = gObj.editModule.deleteRowUid ? gObj.getRowElementByUID(gObj.editModule.deleteRowUid) : gObj.getRows()[gObj.getCurrentViewRecords().indexOf(data)];\n      } else {\n        args.row = data ? gObj.getRows()[index] : selectedRows[0];\n      }\n\n      if (!args.row) {\n        return;\n      }\n    }\n\n    gObj.trigger(events.beforeBatchDelete, args, function (beforeBatchDeleteArgs) {\n      if (beforeBatchDeleteArgs.cancel) {\n        return;\n      }\n\n      _this.removeSelectedData = gObj.getSelectedRecords();\n      gObj.clearSelection();\n      beforeBatchDeleteArgs.row = beforeBatchDeleteArgs.row ? beforeBatchDeleteArgs.row : data ? gObj.getRows()[index] : selectedRows[0];\n\n      if (_this.parent.getFrozenColumns()) {\n        if (data) {\n          index = parseInt(beforeBatchDeleteArgs.row.getAttribute('aria-rowindex'), 10);\n          selectedRows = [beforeBatchDeleteArgs.row];\n\n          if (parentsUntil(beforeBatchDeleteArgs.row, 'e-frozencontent') || parentsUntil(beforeBatchDeleteArgs.row, 'e-frozenheader')) {\n            selectedRows = selectedRows.concat(gObj.getMovableRowByIndex(index));\n          } else if (parentsUntil(beforeBatchDeleteArgs.row, 'e-movablecontent') || parentsUntil(beforeBatchDeleteArgs.row, 'e-movableheader')) {\n            selectedRows = selectedRows.concat(gObj.getFrozenRowByIndex(index));\n          }\n        }\n\n        for (var i = 0; i < selectedRows.length; i++) {\n          var uid = selectedRows[i].getAttribute('data-uid');\n\n          if (selectedRows[i].classList.contains('e-insertedrow')) {\n            _this.removeRowObjectFromUID(uid);\n\n            remove(selectedRows[i]);\n          } else {\n            var rowObj = gObj.getRowObjectFromUID(uid);\n            rowObj.isDirty = true;\n            rowObj.edit = 'delete';\n            classList(selectedRows[i], ['e-hiddenrow', 'e-updatedtd'], []);\n\n            if (gObj.frozenRows && index < gObj.frozenRows && gObj.getMovableDataRows().length >= gObj.frozenRows) {\n              gObj.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody').appendChild(gObj.getMovableRowByIndex(gObj.frozenRows - 1));\n              gObj.getHeaderContent().querySelector('.e-frozenheader').querySelector('tbody').appendChild(gObj.getRowByIndex(gObj.frozenRows - 1));\n            }\n\n            if (gObj.frozenRows && index < gObj.frozenRows && gObj.getDataRows().length >= gObj.frozenRows) {\n              gObj.getHeaderContent().querySelector('tbody').appendChild(gObj.getRowByIndex(gObj.frozenRows - 1));\n            }\n          }\n\n          delete selectedRows[i];\n        }\n\n        var fCont = gObj.getContent().querySelector('.e-frozencontent');\n        var mCont = gObj.getContent().querySelector('.e-movablecontent');\n        fCont.style.height = mCont.offsetHeight - getScrollBarWidth() + 'px';\n      } else if (!_this.parent.getFrozenColumns() && (selectedRows.length === 1 || data)) {\n        var uid = beforeBatchDeleteArgs.row.getAttribute('data-uid');\n        uid = data && _this.parent.editModule.deleteRowUid ? uid = _this.parent.editModule.deleteRowUid : uid;\n\n        if (beforeBatchDeleteArgs.row.classList.contains('e-insertedrow')) {\n          _this.removeRowObjectFromUID(uid);\n\n          remove(beforeBatchDeleteArgs.row);\n        } else {\n          var rowObj = gObj.getRowObjectFromUID(uid);\n          rowObj.isDirty = true;\n          rowObj.edit = 'delete';\n          classList(beforeBatchDeleteArgs.row, ['e-hiddenrow', 'e-updatedtd'], []);\n        }\n\n        delete beforeBatchDeleteArgs.row;\n      } else {\n        for (var i = 0; i < selectedRows.length; i++) {\n          var uniqueid = selectedRows[i].getAttribute('data-uid');\n\n          if (selectedRows[i].classList.contains('e-insertedrow')) {\n            _this.removeRowObjectFromUID(uniqueid);\n\n            remove(selectedRows[i]);\n          } else {\n            classList(selectedRows[i], ['e-hiddenrow', 'e-updatedtd'], []);\n            var selectedRow = gObj.getRowObjectFromUID(uniqueid);\n            selectedRow.isDirty = true;\n            selectedRow.edit = 'delete';\n            delete selectedRows[i];\n          }\n        }\n      }\n\n      _this.refreshRowIdx();\n\n      if (data) {\n        gObj.editModule.deleteRowUid = undefined;\n\n        if (gObj.getSelectedRows().length) {\n          index = parseInt(gObj.getSelectedRows()[0].getAttribute('aria-rowindex'), 10);\n        }\n      }\n\n      gObj.selectRow(index);\n      gObj.trigger(events.batchDelete, beforeBatchDeleteArgs);\n      gObj.notify(events.batchDelete, {\n        rows: _this.parent.getRowsObject()\n      });\n      gObj.notify(events.toolbarRefresh, {});\n    });\n  };\n\n  BatchEdit.prototype.refreshRowIdx = function () {\n    var rows = [];\n    var mRows = [];\n    var nonMovableRows = [];\n    var frzCols = this.parent.getFrozenColumns();\n\n    if (this.parent.frozenRows) {\n      rows = [].slice.call(this.parent.getHeaderTable().querySelector('tbody').children);\n\n      if (frzCols) {\n        mRows = [].slice.call(this.parent.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody').children);\n\n        for (var i = 0; i < mRows.length; i++) {\n          nonMovableRows[i] = this.parent.createElement('tr', {\n            className: 'emptynonmv'\n          });\n        }\n      }\n    }\n\n    if (frzCols) {\n      mRows = mRows.concat([].slice.call(this.parent.getContentTable().querySelector('tbody').children));\n      nonMovableRows = nonMovableRows.concat([].slice.call(this.parent.element.querySelector('.e-movablecontent').querySelector('tbody').children));\n    }\n\n    rows = rows.concat([].slice.call(this.parent.getContentTable().querySelector('tbody').children));\n\n    for (var i = 0, j = 0, len = rows.length; i < len; i++) {\n      if (rows[i].classList.contains('e-row') && !rows[i].classList.contains('e-hiddenrow')) {\n        rows[i].setAttribute('aria-rowindex', j.toString());\n\n        if (frzCols) {\n          mRows[i].setAttribute('aria-rowindex', j.toString());\n\n          if (nonMovableRows[i].classList.contains('e-row')) {\n            nonMovableRows[i].setAttribute('aria-rowindex', j.toString());\n          }\n        }\n\n        j++;\n      } else {\n        rows[i].removeAttribute('aria-rowindex');\n\n        if (frzCols) {\n          mRows[i].removeAttribute('aria-rowindex');\n        }\n      }\n    }\n  };\n\n  BatchEdit.prototype.getIndexFromData = function (data) {\n    return inArray(data, this.parent.getCurrentViewRecords());\n  };\n\n  BatchEdit.prototype.bulkAddRow = function (data) {\n    var _this = this;\n\n    var gObj = this.parent;\n\n    if (!gObj.editSettings.allowAdding) {\n      return;\n    }\n\n    if (gObj.isEdit) {\n      this.saveCell();\n      this.parent.notify(events.editNextValCell, {});\n    }\n\n    if (gObj.isEdit) {\n      return;\n    }\n\n    this.parent.element.classList.add('e-editing');\n    var defaultData = data ? data : this.getDefaultData();\n    var args = {\n      defaultData: defaultData,\n      primaryKey: gObj.getPrimaryKeyFieldNames(),\n      cancel: false\n    };\n    gObj.trigger(events.beforeBatchAdd, args, function (beforeBatchAddArgs) {\n      if (beforeBatchAddArgs.cancel) {\n        return;\n      }\n\n      _this.isAdded = true;\n      gObj.clearSelection();\n      var mTr;\n      var mTbody;\n      var row = new RowRenderer(_this.serviceLocator, null, _this.parent);\n      var model = new RowModelGenerator(_this.parent);\n      var modelData = model.generateRows([beforeBatchAddArgs.defaultData]);\n      var tr = row.render(modelData[0], gObj.getColumns());\n      var col;\n      var index;\n\n      for (var i = 0; i < _this.parent.groupSettings.columns.length; i++) {\n        tr.insertBefore(_this.parent.createElement('td', {\n          className: 'e-indentcell'\n        }), tr.firstChild);\n        modelData[0].cells.unshift(new Cell({\n          cellType: CellType.Indent\n        }));\n      }\n\n      var tbody = gObj.getContentTable().querySelector('tbody');\n      tr.classList.add('e-insertedrow');\n\n      if (tbody.querySelector('.e-emptyrow')) {\n        tbody.querySelector('.e-emptyrow').remove();\n\n        if (_this.parent.getFrozenColumns()) {\n          var moveTbody = _this.parent.getContent().querySelector('.e-movablecontent').querySelector('tbody');\n\n          moveTbody.firstElementChild.remove();\n        }\n      }\n\n      if (gObj.getFrozenColumns()) {\n        mTr = _this.renderMovable(tr);\n\n        if (gObj.frozenRows && gObj.editSettings.newRowPosition === 'Top') {\n          mTbody = gObj.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody');\n        } else {\n          mTbody = gObj.getContent().querySelector('.e-movablecontent').querySelector('tbody');\n        }\n\n        _this.parent.editSettings.newRowPosition === 'Top' ? mTbody.insertBefore(mTr, mTbody.firstChild) : mTbody.appendChild(mTr);\n        addClass(mTr.querySelectorAll('.e-rowcell'), ['e-updatedtd']);\n\n        if (_this.parent.height === 'auto') {\n          _this.parent.notify(events.frozenHeight, {});\n        }\n      }\n\n      if (gObj.frozenRows && gObj.editSettings.newRowPosition === 'Top') {\n        tbody = gObj.getHeaderContent().querySelector('tbody');\n      } else {\n        tbody = gObj.getContent().querySelector('tbody');\n      }\n\n      _this.parent.editSettings.newRowPosition === 'Top' ? tbody.insertBefore(tr, tbody.firstChild) : tbody.appendChild(tr);\n      addClass(tr.querySelectorAll('.e-rowcell'), ['e-updatedtd']);\n      modelData[0].isDirty = true;\n      modelData[0].changes = extend({}, {}, modelData[0].data, true);\n      modelData[0].edit = 'add';\n\n      _this.addRowObject(modelData[0]);\n\n      _this.refreshRowIdx();\n\n      _this.focus.forgetPrevious();\n\n      gObj.notify(events.batchAdd, {\n        rows: _this.parent.getRowsObject(),\n        args: {\n          isFrozen: _this.parent.getFrozenColumns()\n        }\n      });\n\n      var changes = _this.getBatchChanges();\n\n      var addedRecords = 'addedRecords';\n      var dRecords = 'deletedRecords';\n      var btmIdx = _this.parent.getCurrentViewRecords().length + changes[addedRecords].length - changes[dRecords].length - 1;\n      _this.parent.editSettings.newRowPosition === 'Top' ? gObj.selectRow(0) : gObj.selectRow(btmIdx);\n\n      if (!data) {\n        index = _this.findNextEditableCell(0, true);\n        col = gObj.getColumns()[index];\n        _this.parent.editSettings.newRowPosition === 'Top' ? _this.editCell(0, col.field, true) : _this.editCell(btmIdx, col.field, true);\n      }\n\n      if (_this.parent.aggregates.length > 0 && (data || changes[addedRecords].length)) {\n        _this.parent.notify(events.refreshFooterRenderer, {});\n      }\n\n      var args1 = {\n        defaultData: beforeBatchAddArgs.defaultData,\n        row: tr,\n        columnObject: col,\n        columnIndex: index,\n        primaryKey: beforeBatchAddArgs.primaryKey,\n        cell: tr.cells[index]\n      };\n      gObj.trigger(events.batchAdd, args1);\n\n      if (gObj.getFrozenColumns()) {\n        alignFrozenEditForm(mTr.querySelector('td:not(.e-hide)'), tr.querySelector('td:not(.e-hide)'));\n      }\n\n      if (isBlazor()) {\n        _this.parent.notify(events.toolbarRefresh, {});\n\n        _this.parent.notify('start-add', {});\n      }\n    });\n  };\n\n  BatchEdit.prototype.renderMovable = function (ele) {\n    var mEle = ele.cloneNode(true);\n\n    for (var i = 0; i < this.parent.getFrozenColumns(); i++) {\n      mEle.removeChild(mEle.children[0]);\n    }\n\n    for (var i = this.parent.getFrozenColumns(), len = ele.childElementCount; i < len; i++) {\n      ele.removeChild(ele.children[ele.childElementCount - 1]);\n    }\n\n    return mEle;\n  };\n\n  BatchEdit.prototype.findNextEditableCell = function (columnIndex, isAdd, isValOnly) {\n    var cols = this.parent.getColumns();\n    var endIndex = cols.length;\n    var validation;\n\n    for (var i = columnIndex; i < endIndex; i++) {\n      validation = isValOnly ? isNullOrUndefined(cols[i].validationRules) : false;\n\n      if (!isAdd && this.checkNPCell(cols[i])) {\n        return i;\n      } else if (isAdd && !cols[i].template && cols[i].visible && cols[i].allowEditing && !(cols[i].isIdentity && cols[i].isPrimaryKey) && !validation) {\n        return i;\n      }\n    }\n\n    return -1;\n  };\n\n  BatchEdit.prototype.checkNPCell = function (col) {\n    return !col.template && col.visible && !col.isPrimaryKey && !col.isIdentity && col.allowEditing;\n  };\n\n  BatchEdit.prototype.getDefaultData = function () {\n    var gObj = this.parent;\n    var data = {};\n    var dValues = {\n      'number': 0,\n      'string': null,\n      'boolean': false,\n      'date': null,\n      'datetime': null\n    };\n\n    for (var _i = 0, _a = gObj.columnModel; _i < _a.length; _i++) {\n      var col = _a[_i];\n\n      if (col.field) {\n        setValue(col.field, col.defaultValue ? col.defaultValue : dValues[col.type], data);\n      }\n    }\n\n    return data;\n  };\n\n  BatchEdit.prototype.setCellIdx = function (target) {\n    var gLen = 0;\n\n    if (this.parent.allowGrouping) {\n      gLen = this.parent.groupSettings.columns.length;\n    }\n\n    this.cellDetails.cellIndex = target.cellIndex - gLen;\n    this.cellDetails.rowIndex = parseInt(target.getAttribute('index'), 10);\n  };\n\n  BatchEdit.prototype.editCell = function (index, field, isAdd) {\n    var gObj = this.parent;\n    var col = gObj.getColumnByField(field);\n    this.index = index;\n    this.field = field;\n    this.isAdd = isAdd;\n    var checkEdit = gObj.isEdit && !(this.cellDetails.column.field === field && this.cellDetails.rowIndex === index && this.parent.getDataRows().length - 1 !== index);\n\n    if (isBlazor() && col.template && !isAdd) {\n      resetBlazorTemplate(this.parent.element.id + col.uid, 'Template', index);\n    }\n\n    if (gObj.editSettings.allowEditing) {\n      if (!checkEdit && col.allowEditing) {\n        this.editCellExtend(index, field, isAdd);\n      } else if (checkEdit) {\n        this.editNext = true;\n        this.saveCell();\n      }\n    }\n  };\n\n  BatchEdit.prototype.editCellExtend = function (index, field, isAdd) {\n    var _this = this;\n\n    var gObj = this.parent;\n    var col = gObj.getColumnByField(field);\n    var keys = gObj.getPrimaryKeyFieldNames();\n\n    if (gObj.isEdit) {\n      return;\n    }\n\n    var row;\n    var rowData;\n    var mRowData;\n    var colIdx = gObj.getColumnIndexByField(field);\n    var frzCols = gObj.getFrozenColumns();\n\n    if (frzCols && colIdx >= frzCols) {\n      row = gObj.getMovableDataRows()[index];\n      mRowData = this.parent.getRowObjectFromUID(this.parent.getMovableDataRows()[index].getAttribute('data-uid'));\n      rowData = mRowData.changes ? extend({}, {}, mRowData.changes, true) : extend({}, {}, this.getDataByIndex(index), true);\n    } else {\n      row = gObj.getDataRows()[index];\n      rowData = extend({}, {}, this.getDataByIndex(index), true);\n    }\n\n    if (keys[0] === col.field && !row.classList.contains('e-insertedrow') || col.columns || col.isPrimaryKey && col.isIdentity) {\n      this.parent.isLastCellPrimaryKey = true;\n      return;\n    }\n\n    this.parent.isLastCellPrimaryKey = false;\n    this.parent.element.classList.add('e-editing');\n    var rowObj = gObj.getRowObjectFromUID(row.getAttribute('data-uid'));\n    var cells = [].slice.apply(row.cells);\n    var args = {\n      columnName: col.field,\n      isForeignKey: !isNullOrUndefined(col.foreignKeyValue),\n      primaryKey: keys,\n      rowData: rowData,\n      validationRules: extend({}, col.validationRules ? col.validationRules : {}),\n      value: getObject(col.field, rowData),\n      type: !isAdd ? 'edit' : 'add',\n      cancel: false,\n      foreignKeyData: rowObj && rowObj.foreignKeyData\n    };\n\n    if (!isBlazor() || this.parent.isJsComponent) {\n      args.cell = cells[this.getColIndex(cells, this.getCellIdx(col.uid))];\n      args.row = row;\n      args.columnObject = col;\n\n      if (!args.cell) {\n        return;\n      }\n    }\n\n    gObj.trigger(events.cellEdit, args, function (cellEditArgs) {\n      if (cellEditArgs.cancel) {\n        return;\n      }\n\n      cellEditArgs.cell = cellEditArgs.cell ? cellEditArgs.cell : cells[_this.getColIndex(cells, _this.getCellIdx(col.uid))];\n      cellEditArgs.row = cellEditArgs.row ? cellEditArgs.row : row;\n      cellEditArgs.columnObject = cellEditArgs.columnObject ? cellEditArgs.columnObject : col;\n      cellEditArgs.columnObject.index = isNullOrUndefined(cellEditArgs.columnObject.index) ? 0 : cellEditArgs.columnObject.index;\n      _this.cellDetails = {\n        rowData: rowData,\n        column: col,\n        value: cellEditArgs.value,\n        isForeignKey: cellEditArgs.isForeignKey,\n        rowIndex: index,\n        cellIndex: parseInt(cellEditArgs.cell.getAttribute('aria-colindex'), 10),\n        foreignKeyData: cellEditArgs.foreignKeyData\n      };\n\n      if (cellEditArgs.cell.classList.contains('e-updatedtd')) {\n        _this.isColored = true;\n        cellEditArgs.cell.classList.remove('e-updatedtd');\n      }\n\n      if (isBlazor() && gObj.isServerRendered) {\n        var cell = 'cells';\n        var cloneCell = 'cloneCell';\n        var indent = cellEditArgs.row.querySelectorAll('.e-indentcell, .e-detailrowcollapse, .e-detailrowexpand, .e-rowdragdrop').length;\n        _this.cloneCell[\"\" + _this.cellDetails.rowIndex + cellEditArgs.columnObject.index] = cellEditArgs[cloneCell] = cellEditArgs.cell.cloneNode(true);\n\n        if (parentsUntil(cellEditArgs.cell, 'e-movableheader') || parentsUntil(cellEditArgs.cell, 'e-movablecontent')) {\n          cellEditArgs.row.insertCell(cellEditArgs.columnObject.index - gObj.getFrozenColumns());\n          cellEditArgs.row.replaceChild(cellEditArgs[cloneCell], cellEditArgs.row[cell][cellEditArgs.columnObject.index - gObj.getFrozenColumns()]);\n        } else {\n          cellEditArgs.row.insertCell(cellEditArgs.columnObject.index + indent);\n          cellEditArgs.row.replaceChild(cellEditArgs[cloneCell], cellEditArgs.row[cell][cellEditArgs.columnObject.index + indent]);\n        }\n\n        _this.originalCell[\"\" + _this.cellDetails.rowIndex + cellEditArgs.columnObject.index] = cellEditArgs.cell.parentElement.removeChild(cellEditArgs.cell);\n        removeClass([_this.cloneCell[\"\" + _this.cellDetails.rowIndex + cellEditArgs.columnObject.index]], ['e-focus', 'e-focused']);\n      }\n\n      gObj.isEdit = true;\n      gObj.clearSelection();\n\n      if (!gObj.isCheckBoxSelection || !gObj.isPersistSelection) {\n        gObj.selectRow(_this.cellDetails.rowIndex, true);\n      }\n\n      _this.renderer.update(cellEditArgs);\n\n      _this.parent.notify(events.batchEditFormRendered, cellEditArgs);\n\n      _this.form = gObj.element.querySelector('#' + gObj.element.id + 'EditForm');\n      gObj.editModule.applyFormValidation([col]);\n      _this.parent.element.querySelector('.e-gridpopup').style.display = 'none';\n    });\n  };\n\n  BatchEdit.prototype.updateCell = function (rowIndex, field, value) {\n    var col = this.parent.getColumnByField(field);\n    var index = this.parent.getColumnIndexByField(field);\n\n    if (col && !col.isPrimaryKey) {\n      var td = this.parent.getDataRows()[rowIndex].querySelectorAll('.e-rowcell')[index];\n\n      if (this.parent.getFrozenColumns()) {\n        var cells = [].slice.call(this.parent.getDataRows()[rowIndex].querySelectorAll('.e-rowcell')).concat([].slice.call(this.parent.getMovableDataRows()[rowIndex].querySelectorAll('.e-rowcell')));\n        td = cells[index];\n      }\n\n      var rowObj = this.parent.getRowObjectFromUID(td.parentElement.getAttribute('data-uid'));\n      this.refreshTD(td, col, rowObj, value);\n      this.parent.trigger(events.queryCellInfo, {\n        cell: td,\n        column: col,\n        data: rowObj.changes\n      });\n    }\n  };\n\n  BatchEdit.prototype.setChanges = function (rowObj, field, value, td) {\n    var currentRowObj;\n\n    if (!this.parent.getFrozenColumns()) {\n      if (!rowObj.changes) {\n        rowObj.changes = extend({}, {}, rowObj.data, true);\n      }\n\n      if (!isNullOrUndefined(field)) {\n        DataUtil.setValue(field, value, rowObj.changes);\n      }\n\n      if (rowObj.data[field] !== value) {\n        rowObj.isDirty = true;\n      }\n    } else {\n      var rowEle = this.parent.getRowElementByUID(rowObj.uid);\n      var rowIndex = parseInt(rowEle.getAttribute('aria-rowindex'), 10);\n      currentRowObj = this.parent.getRowsObject()[rowIndex];\n\n      if (!currentRowObj.changes) {\n        currentRowObj.changes = extend({}, {}, rowObj.data, true);\n      }\n\n      if (!isNullOrUndefined(field)) {\n        setValue(field, value, currentRowObj.changes);\n      }\n\n      var movableRowObject = void 0;\n\n      if (isBlazor() && this.parent.isServerRendered && (parentsUntil(td, 'e-movableheader') || parentsUntil(td, 'e-movablecontent'))) {\n        var movRowEle = this.parent.getMovableRowByIndex(this.cellDetails.rowIndex);\n        var movRowIndex = parseInt(movRowEle.getAttribute('aria-rowindex'), 10);\n        movableRowObject = this.parent.getMovableRowsObject()[movRowIndex];\n      } else {\n        movableRowObject = this.parent.getMovableRowsObject()[rowIndex];\n      }\n\n      movableRowObject.changes = extend({}, {}, currentRowObj.changes, true);\n\n      if (rowObj.data[field] !== value) {\n        movableRowObject.isDirty = true;\n        currentRowObj.isDirty = true;\n      }\n    }\n  };\n\n  BatchEdit.prototype.updateRow = function (index, data) {\n    var keys = Object.keys(data);\n\n    for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n      var col = keys_1[_i];\n      this.updateCell(index, col, data[col]);\n    }\n  };\n\n  BatchEdit.prototype.getCellIdx = function (uid) {\n    var cIdx = this.parent.getColumnIndexByUid(uid) + this.parent.groupSettings.columns.length;\n\n    if (!isNullOrUndefined(this.parent.detailTemplate) || !isNullOrUndefined(this.parent.childGrid)) {\n      cIdx++;\n    }\n\n    if (this.parent.isRowDragable()) {\n      cIdx++;\n    }\n\n    return cIdx;\n  };\n\n  BatchEdit.prototype.refreshTD = function (td, column, rowObj, value) {\n    var cell = new CellRenderer(this.parent, this.serviceLocator);\n    var rowcell;\n    value = column.type === 'number' && !isNullOrUndefined(value) ? parseFloat(value) : value;\n    this.setChanges(rowObj, column.field, value, td);\n    var frzCols = this.parent.getFrozenColumns();\n    refreshForeignData(rowObj, this.parent.getForeignKeyColumns(), rowObj.changes);\n\n    if (frzCols && this.getCellIdx(column.uid) >= frzCols && this.parent.getColumns().length === rowObj.cells.length) {\n      rowcell = rowObj.cells.slice(frzCols, rowObj.cells.length);\n    } else {\n      rowcell = rowObj.cells;\n    }\n\n    cell.refreshTD(td, rowcell[this.getCellIdx(column.uid) - (this.getCellIdx(column.uid) >= frzCols ? frzCols : 0)], rowObj.changes, {\n      'index': this.getCellIdx(column.uid)\n    });\n    td.classList.add('e-updatedtd');\n    this.parent.notify(events.toolbarRefresh, {});\n  };\n\n  BatchEdit.prototype.getColIndex = function (cells, index) {\n    var cIdx = 0;\n\n    if (this.parent.allowGrouping && this.parent.groupSettings.columns) {\n      cIdx = this.parent.groupSettings.columns.length;\n    }\n\n    if (!isNullOrUndefined(this.parent.detailTemplate) || !isNullOrUndefined(this.parent.childGrid)) {\n      cIdx++;\n    }\n\n    if (this.parent.isRowDragable()) {\n      cIdx++;\n    }\n\n    for (var m = 0; m < cells.length; m++) {\n      var colIndex = parseInt(cells[m].getAttribute('aria-colindex'), 10);\n\n      if (colIndex === index - cIdx) {\n        return m;\n      }\n    }\n\n    return -1;\n  };\n\n  BatchEdit.prototype.editNextValCell = function () {\n    var gObj = this.parent;\n    var changes = this.getBatchChanges();\n    var addedRecords = 'addedRecords';\n    var dRecords = 'deletedRecords';\n    var btmIdx = this.parent.getCurrentViewRecords().length + changes[addedRecords].length - changes[dRecords].length - 1;\n\n    if (this.isAdded && !gObj.isEdit) {\n      for (var i = this.cellDetails.cellIndex; i < gObj.getColumns().length; i++) {\n        if (gObj.isEdit) {\n          return;\n        }\n\n        var index = this.findNextEditableCell(this.cellDetails.cellIndex + 1, true, true);\n        var col = gObj.getColumns()[index];\n\n        if (col) {\n          this.parent.editSettings.newRowPosition === 'Bottom' ? this.editCell(btmIdx, col.field, true) : this.editCell(0, col.field, true);\n          this.saveCell();\n        }\n      }\n\n      if (!gObj.isEdit) {\n        this.isAdded = false;\n      }\n    }\n  };\n\n  BatchEdit.prototype.escapeCellEdit = function () {\n    var args = this.generateCellArgs();\n    args.value = args.previousValue;\n    this.successCallBack(args, args.cell.parentElement, args.column, true)(args);\n  };\n\n  BatchEdit.prototype.generateCellArgs = function () {\n    var gObj = this.parent;\n    this.parent.element.classList.remove('e-editing');\n    var column = this.cellDetails.column;\n    var obj = {};\n    obj[column.field] = getObject(column.field, this.cellDetails.rowData);\n    var editedData = gObj.editModule.getCurrentEditedData(this.form, obj);\n    var cloneEditedData = extend({}, editedData);\n    editedData = extend({}, editedData, this.cellDetails.rowData);\n    var value = getObject(column.field, cloneEditedData);\n\n    if (!isNullOrUndefined(column.field) && !isUndefined(value)) {\n      setValue(column.field, value, editedData);\n    }\n\n    var args = {\n      columnName: column.field,\n      value: getObject(column.field, editedData),\n      rowData: this.cellDetails.rowData,\n      column: column,\n      previousValue: this.cellDetails.value,\n      isForeignKey: this.cellDetails.isForeignKey,\n      cancel: false\n    };\n\n    if (!isBlazor() || this.parent.isJsComponent) {\n      args.cell = this.form.parentElement;\n      args.columnObject = column;\n    }\n\n    return args;\n  };\n\n  BatchEdit.prototype.saveCell = function (isForceSave) {\n    if (this.preventSaveCell) {\n      return;\n    }\n\n    var gObj = this.parent;\n\n    if (!isForceSave && (!gObj.isEdit || this.validateFormObj())) {\n      return;\n    }\n\n    this.preventSaveCell = true;\n    var args = this.generateCellArgs();\n    var tr = isBlazor() ? parentsUntil(this.form, 'e-row') : args.cell.parentElement;\n    var col = isBlazor() ? this.cellDetails.column : args.column;\n\n    if (isBlazor()) {\n      delete args.column;\n    }\n\n    if (!isForceSave) {\n      gObj.trigger(events.cellSave, args, this.successCallBack(args, tr, col));\n      gObj.notify(events.batchForm, {\n        formObj: this.form\n      });\n    } else {\n      this.successCallBack(args, tr, col)(args);\n    }\n  };\n\n  BatchEdit.prototype.successCallBack = function (cellSaveArgs, tr, column, isEscapeCellEdit) {\n    var _this = this;\n\n    return function (cellSaveArgs) {\n      var gObj = _this.parent;\n      cellSaveArgs.cell = cellSaveArgs.cell ? cellSaveArgs.cell : _this.form.parentElement;\n      cellSaveArgs.columnObject = cellSaveArgs.columnObject ? cellSaveArgs.columnObject : column;\n      cellSaveArgs.columnObject.index = isNullOrUndefined(cellSaveArgs.columnObject.index) ? 0 : cellSaveArgs.columnObject.index;\n\n      if (cellSaveArgs.cancel) {\n        _this.preventSaveCell = false;\n\n        if (_this.editNext) {\n          _this.editNext = false;\n\n          if (_this.cellDetails.rowIndex === _this.index && _this.cellDetails.column.field === _this.field) {\n            return;\n          }\n\n          _this.editCellExtend(_this.index, _this.field, _this.isAdd);\n        }\n\n        return;\n      }\n\n      gObj.editModule.destroyWidgets([column]);\n      gObj.isEdit = false;\n      gObj.editModule.destroyForm();\n\n      if (isBlazor() && column.template && !cellSaveArgs.cell.parentElement.classList.contains('e-insertedrow')) {\n        updateBlazorTemplate(gObj.element.id + column.uid, 'Template', column, false);\n      }\n\n      _this.parent.notify(events.tooltipDestroy, {});\n\n      if (isBlazor() && gObj.isServerRendered && (parentsUntil(cellSaveArgs.cell, 'e-movableheader') || parentsUntil(cellSaveArgs.cell, 'e-movablecontent'))) {\n        _this.refreshTD(cellSaveArgs.cell, column, gObj.getMovableRowsObject()[_this.cellDetails.rowIndex], cellSaveArgs.value);\n      } else {\n        var rowObj = parentsUntil(cellSaveArgs.cell, 'e-movablecontent') ? gObj.getMovableRowsObject()[_this.cellDetails.rowIndex] : gObj.getRowObjectFromUID(tr.getAttribute('data-uid'));\n\n        _this.refreshTD(cellSaveArgs.cell, column, rowObj, cellSaveArgs.value);\n      }\n\n      removeClass([tr], ['e-editedrow', 'e-batchrow']);\n      removeClass([cellSaveArgs.cell], ['e-editedbatchcell', 'e-boolcell']);\n\n      if (!isNullOrUndefined(cellSaveArgs.value) && cellSaveArgs.value.toString() === (!isNullOrUndefined(_this.cellDetails.value) ? _this.cellDetails.value : '').toString() && !_this.isColored || isNullOrUndefined(cellSaveArgs.value) && isNullOrUndefined(_this.cellDetails.value) && !cellSaveArgs.cell.parentElement.classList.contains('e-insertedrow')) {\n        cellSaveArgs.cell.classList.remove('e-updatedtd');\n\n        if (isBlazor() && gObj.isServerRendered && (!isNullOrUndefined(cellSaveArgs.value) ? cellSaveArgs.value : '').toString() === (!isNullOrUndefined(_this.cellDetails.value) ? _this.cellDetails.value : '').toString()) {\n          if (_this.cloneCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index].classList.contains('e-selectionbackground')) {\n            _this.originalCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index].classList.add('e-selectionbackground', 'e-active');\n          } else {\n            _this.originalCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index].classList.remove('e-selectionbackground', 'e-active');\n          }\n\n          _this.cloneCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index].replaceWith(_this.originalCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index]);\n        }\n      }\n\n      if (isNullOrUndefined(isEscapeCellEdit)) {\n        gObj.trigger(events.cellSaved, cellSaveArgs);\n      }\n\n      gObj.notify(events.toolbarRefresh, {});\n      _this.isColored = false;\n\n      if (_this.parent.aggregates.length > 0) {\n        _this.parent.notify(events.refreshFooterRenderer, {});\n\n        if (_this.parent.groupSettings.columns.length > 0 && !_this.isAddRow(_this.cellDetails.rowIndex)) {\n          _this.parent.notify(events.groupAggregates, {});\n        }\n      }\n\n      _this.preventSaveCell = false;\n\n      if (_this.editNext) {\n        _this.editNext = false;\n\n        if (_this.cellDetails.rowIndex === _this.index && _this.cellDetails.column.field === _this.field) {\n          return;\n        }\n\n        var col = gObj.getColumnByField(_this.field);\n\n        if (col && col.allowEditing) {\n          _this.editCellExtend(_this.index, _this.field, _this.isAdd);\n        }\n      }\n\n      if (isEscapeCellEdit) {\n        gObj.notify(events.restoreFocus, {});\n      }\n    };\n  };\n\n  BatchEdit.prototype.getDataByIndex = function (index) {\n    var row = this.parent.getRowObjectFromUID(this.parent.getDataRows()[index].getAttribute('data-uid'));\n    return row.changes ? row.changes : row.data;\n  };\n\n  BatchEdit.prototype.keyDownHandler = function (e) {\n    if ((e.action === 'tab' || e.action === 'shiftTab') && this.parent.isEdit) {\n      var gObj = this.parent;\n      var changes = this.getBatchChanges();\n      var addedRecords = 'addedRecords';\n      var dRecords = 'deletedRecords';\n      var btmIdx = this.parent.getCurrentViewRecords().length + changes[addedRecords].length - changes[dRecords].length - 1;\n      var rowcell = parentsUntil(e.target, 'e-rowcell');\n\n      if (rowcell) {\n        var cell = rowcell.querySelector('.e-field');\n\n        if (cell) {\n          var visibleColumns = this.parent.getVisibleColumns();\n          var columnIndex = e.action === 'tab' ? visibleColumns.length - 1 : 0;\n\n          if (visibleColumns[columnIndex].field === cell.getAttribute('id').slice(this.parent.element.id.length)) {\n            if (this.cellDetails.rowIndex === btmIdx && e.action === 'tab') {\n              if (gObj.editSettings.newRowPosition === 'Top') {\n                gObj.editSettings.newRowPosition = 'Bottom';\n                this.addRecord();\n                gObj.editSettings.newRowPosition = 'Top';\n              } else {\n                this.addRecord();\n              }\n            } else {\n              this.saveCell();\n            }\n          }\n        }\n      }\n    }\n  };\n  /**\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.addCancelWhilePaging = function () {\n    if (this.validateFormObj()) {\n      this.parent.notify(events.destroyForm, {});\n      this.parent.isEdit = false;\n      this.isColored = false;\n    }\n  };\n\n  return BatchEdit;\n}();\n\nexport { BatchEdit };","map":{"version":3,"sources":["/home/nikhil/Desktop/data_grid_editor-master/node_modules/@syncfusion/ej2-grids/src/grid/actions/batch-edit.js"],"names":["extend","addClass","removeClass","setValue","isBlazor","remove","classList","updateBlazorTemplate","blazorTemplates","resetBlazorTemplate","isNullOrUndefined","isUndefined","CellType","parentsUntil","inArray","refreshForeignData","getObject","alignFrozenEditForm","getScrollBarWidth","events","RowRenderer","CellRenderer","Row","Cell","RowModelGenerator","DataUtil","BatchEdit","parent","serviceLocator","renderer","cellDetails","originalCell","cloneCell","editNext","preventSaveCell","focus","getService","addEventListener","prototype","isDestroyed","on","click","clickHandler","dblclick","dblClickHandler","beforeCellFocused","onBeforeCellFocused","cellFocused","onCellFocused","dataBoundFunction","dataBound","bind","batchCancelFunction","batchCancel","doubleTap","keyPressed","keyDownHandler","editNextValCell","closeForm","removeEventListener","off","args","focusModule","restoreFocus","notify","toolbarRefresh","destroy","e","target","element","id","isEdit","saveCell","setCellIdx","tr","isNaN","parseInt","getAttribute","parentElement","contains","editCell","getColumns","field","isAddRow","validateFormObj","byClick","indexOf","keyArgs","action","cancel","clickArgs","preventDefault","frzCols","getFrozenColumns","mCont","getContent","querySelector","mHdr","getHeaderContent","clear","container","isContent","isDataCell","frozenRows","isHeader","byKey","_a","indexes","rowIndex","cellIndex","querySelectorAll","length","col","isLastCellPrimaryKey","editCellFromIndex","column","index","getDataRows","rowIdx","cellIdx","closeEdit","gObj","rows","getRowsObject","argument","batchChanges","getBatchChanges","beforeBatchCancel","frozenColumns","currentViewData","isServerRendered","push","apply","getMovableRowsObject","cols","i","template","uid","rowRenderer","mTr","movObj","isAdded","clearSelection","isDirty","getContentTable","removeRowObjectFromUID","getForeignKeyColumns","data","changes","edit","ftr","removeHideAndSelection","refresh","aggregates","type","editType","refreshFooterRenderer","groupSettings","columns","groupAggregates","selectRow","selectionModule","prevRowIndex","renderModule","renderEmptyRow","requestType","isDataRow","cells","visible","refreshRowIdx","tooltipDestroy","trigger","splice","removeAttribute","tdElements","slice","call","deleteRecord","fieldname","bulkDelete","addRecord","bulkAddRow","endEdit","batchSave","Object","keys","j","replaceWith","editModule","formObj","validate","_this","deletedRecords","isCheckBoxSelection","checkAllBox","pageSettings","totalRecordsCount","selectionSettings","persistSelection","removeSelectedData","original","changedRecords","filter","row","map","beforeBatchSave","beforeBatchSaveArgs","content","insertedRow","showSpinner","bulkSave","addedRecords","_i","rows_1","len","addRowObject","isTop","editSettings","newRowPosition","frozenColumnsCount","mRow","mEle","clone","unshift","selectedRowIndex","selectedRows","getSelectedRows","primaryKey","getPrimaryKeyFieldNames","rowData","getSelectedRecords","isJsComponent","deleteRowUid","getRowElementByUID","getRows","getCurrentViewRecords","beforeBatchDelete","beforeBatchDeleteArgs","concat","getMovableRowByIndex","getFrozenRowByIndex","rowObj","getRowObjectFromUID","getMovableDataRows","appendChild","getRowByIndex","fCont","style","height","offsetHeight","uniqueid","selectedRow","undefined","batchDelete","mRows","nonMovableRows","getHeaderTable","children","createElement","className","setAttribute","toString","getIndexFromData","allowAdding","add","defaultData","getDefaultData","beforeBatchAdd","beforeBatchAddArgs","mTbody","model","modelData","generateRows","render","insertBefore","firstChild","cellType","Indent","tbody","moveTbody","firstElementChild","renderMovable","frozenHeight","forgetPrevious","batchAdd","isFrozen","dRecords","btmIdx","findNextEditableCell","args1","columnObject","columnIndex","cell","ele","cloneNode","removeChild","childElementCount","isAdd","isValOnly","endIndex","validation","validationRules","checkNPCell","allowEditing","isIdentity","isPrimaryKey","dValues","columnModel","defaultValue","gLen","allowGrouping","getColumnByField","checkEdit","editCellExtend","mRowData","colIdx","getColumnIndexByField","getDataByIndex","columnName","isForeignKey","foreignKeyValue","value","foreignKeyData","getColIndex","getCellIdx","cellEdit","cellEditArgs","isColored","indent","insertCell","replaceChild","isPersistSelection","update","batchEditFormRendered","form","applyFormValidation","display","updateCell","td","refreshTD","queryCellInfo","setChanges","currentRowObj","rowEle","movableRowObject","movRowEle","movRowIndex","updateRow","keys_1","cIdx","getColumnIndexByUid","detailTemplate","childGrid","isRowDragable","rowcell","parseFloat","m","colIndex","escapeCellEdit","generateCellArgs","previousValue","successCallBack","obj","editedData","getCurrentEditedData","cloneEditedData","isForceSave","cellSave","batchForm","cellSaveArgs","isEscapeCellEdit","destroyWidgets","destroyForm","cellSaved","visibleColumns","getVisibleColumns","addCancelWhilePaging"],"mappings":"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","sourcesContent":["import { extend, addClass, removeClass, setValue, isBlazor } from '@syncfusion/ej2-base';\nimport { remove, classList, updateBlazorTemplate, blazorTemplates, resetBlazorTemplate } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, isUndefined } from '@syncfusion/ej2-base';\nimport { CellType } from '../base/enum';\nimport { parentsUntil, inArray, refreshForeignData, getObject, alignFrozenEditForm, getScrollBarWidth } from '../base/util';\nimport * as events from '../base/constant';\nimport { RowRenderer } from '../renderer/row-renderer';\nimport { CellRenderer } from '../renderer/cell-renderer';\nimport { Row } from '../models/row';\nimport { Cell } from '../models/cell';\nimport { RowModelGenerator } from '../services/row-model-generator';\nimport { DataUtil } from '@syncfusion/ej2-data';\n/**\n * `BatchEdit` module is used to handle batch editing actions.\n * @hidden\n */\nvar BatchEdit = /** @class */ (function () {\n    function BatchEdit(parent, serviceLocator, renderer) {\n        this.cellDetails = {};\n        this.originalCell = {};\n        this.cloneCell = {};\n        this.editNext = false;\n        this.preventSaveCell = false;\n        this.parent = parent;\n        this.serviceLocator = serviceLocator;\n        this.renderer = renderer;\n        this.focus = serviceLocator.getService('focus');\n        this.addEventListener();\n    }\n    /**\n     * @hidden\n     */\n    BatchEdit.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.click, this.clickHandler, this);\n        this.parent.on(events.dblclick, this.dblClickHandler, this);\n        this.parent.on(events.beforeCellFocused, this.onBeforeCellFocused, this);\n        this.parent.on(events.cellFocused, this.onCellFocused, this);\n        this.dataBoundFunction = this.dataBound.bind(this);\n        this.batchCancelFunction = this.batchCancel.bind(this);\n        this.parent.addEventListener(events.dataBound, this.dataBoundFunction);\n        this.parent.addEventListener(events.batchCancel, this.batchCancelFunction);\n        this.parent.on(events.doubleTap, this.dblClickHandler, this);\n        this.parent.on(events.keyPressed, this.keyDownHandler, this);\n        this.parent.on(events.editNextValCell, this.editNextValCell, this);\n        this.parent.on('closebatch', this.closeForm, this);\n    };\n    /**\n     * @hidden\n     */\n    BatchEdit.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.click, this.clickHandler);\n        this.parent.off(events.dblclick, this.dblClickHandler);\n        this.parent.off(events.beforeCellFocused, this.onBeforeCellFocused);\n        this.parent.off(events.cellFocused, this.onCellFocused);\n        this.parent.removeEventListener(events.dataBound, this.dataBoundFunction);\n        this.parent.removeEventListener(events.batchCancel, this.batchCancelFunction);\n        this.parent.off(events.doubleTap, this.dblClickHandler);\n        this.parent.off(events.keyPressed, this.keyDownHandler);\n        this.parent.off(events.editNextValCell, this.editNextValCell);\n        this.parent.off('closebatch', this.closeForm);\n    };\n    BatchEdit.prototype.batchCancel = function (args) {\n        this.parent.focusModule.restoreFocus();\n    };\n    BatchEdit.prototype.dataBound = function () {\n        this.parent.notify(events.toolbarRefresh, {});\n    };\n    /**\n     * @hidden\n     */\n    BatchEdit.prototype.destroy = function () {\n        this.removeEventListener();\n    };\n    BatchEdit.prototype.clickHandler = function (e) {\n        if (!parentsUntil(e.target, this.parent.element.id + '_add', true)) {\n            if (this.parent.isEdit) {\n                this.saveCell();\n                this.editNextValCell();\n            }\n            if (parentsUntil(e.target, 'e-rowcell') && !this.parent.isEdit) {\n                this.setCellIdx(e.target);\n            }\n        }\n    };\n    BatchEdit.prototype.dblClickHandler = function (e) {\n        var target = parentsUntil(e.target, 'e-rowcell');\n        var tr = parentsUntil(e.target, 'e-row');\n        if (target && tr && !isNaN(parseInt(target.getAttribute('aria-colindex'), 10))\n            && !target.parentElement.classList.contains('e-editedrow')) {\n            this.editCell(parseInt(tr.getAttribute('aria-rowindex'), 10), this.parent.getColumns()[parseInt(target.getAttribute('aria-colindex'), 10)].field, this.isAddRow(parseInt(tr.getAttribute('aria-rowindex'), 10)));\n        }\n    };\n    BatchEdit.prototype.onBeforeCellFocused = function (e) {\n        if (this.parent.isEdit && this.validateFormObj() &&\n            (e.byClick || (['tab', 'shiftTab', 'enter', 'shiftEnter'].indexOf(e.keyArgs.action) > -1))) {\n            e.cancel = true;\n            if (e.byClick) {\n                e.clickArgs.preventDefault();\n            }\n            else {\n                e.keyArgs.preventDefault();\n            }\n        }\n    };\n    BatchEdit.prototype.onCellFocused = function (e) {\n        var frzCols = this.parent.getFrozenColumns();\n        var mCont = this.parent.getContent().querySelector('.e-movablecontent');\n        var mHdr = this.parent.getHeaderContent().querySelector('.e-movableheader');\n        var clear = (!e.container.isContent || !e.container.isDataCell) && !(this.parent.frozenRows && e.container.isHeader);\n        if (!e.byKey || clear) {\n            if (this.parent.isEdit && clear) {\n                this.saveCell();\n            }\n            return;\n        }\n        var _a = e.container.indexes, rowIndex = _a[0], cellIndex = _a[1];\n        if (frzCols && (mCont.contains(e.element) || (this.parent.frozenRows && mHdr.contains(e.element)))) {\n            cellIndex += frzCols;\n        }\n        if (this.parent.frozenRows && e.container.isContent) {\n            rowIndex += this.parent.frozenRows;\n        }\n        var isEdit = this.parent.isEdit;\n        if (!this.parent.element.querySelectorAll('.e-popup-open').length) {\n            isEdit = isEdit && !this.validateFormObj();\n            switch (e.keyArgs.action) {\n                case 'tab':\n                case 'shiftTab':\n                    var col = this.parent.getColumns()[e.indexes[1]];\n                    if (col && !this.parent.isEdit) {\n                        this.editCell(e.indexes[0], col.field);\n                    }\n                    if (isEdit || this.parent.isLastCellPrimaryKey) {\n                        this.editCellFromIndex(rowIndex, cellIndex);\n                    }\n                    break;\n                case 'enter':\n                case 'shiftEnter':\n                    e.keyArgs.preventDefault();\n                    if (isEdit) {\n                        this.editCell(rowIndex, this.cellDetails.column.field);\n                    }\n                    break;\n                case 'f2':\n                    this.editCellFromIndex(rowIndex, cellIndex);\n                    this.focus.focus();\n                    break;\n            }\n        }\n    };\n    BatchEdit.prototype.isAddRow = function (index) {\n        return this.parent.getDataRows()[index].classList.contains('e-insertedrow');\n    };\n    BatchEdit.prototype.editCellFromIndex = function (rowIdx, cellIdx) {\n        this.cellDetails.rowIndex = rowIdx;\n        this.cellDetails.cellIndex = cellIdx;\n        this.editCell(rowIdx, this.parent.getColumns()[cellIdx].field, this.isAddRow(rowIdx));\n    };\n    // tslint:disable-next-line:max-func-body-length\n    BatchEdit.prototype.closeEdit = function () {\n        var gObj = this.parent;\n        var rows = this.parent.getRowsObject();\n        var argument = { cancel: false, batchChanges: this.getBatchChanges() };\n        gObj.notify(events.beforeBatchCancel, argument);\n        if (argument.cancel) {\n            return;\n        }\n        if (gObj.frozenColumns && rows.length < this.parent.currentViewData.length * 2 && !(isBlazor() && gObj.isServerRendered)) {\n            rows.push.apply(rows, this.parent.getMovableRowsObject());\n        }\n        var cols = this.parent.getColumns();\n        if (isBlazor()) {\n            for (var i = 0; i < cols.length; i++) {\n                var col = cols[i];\n                if (col.template) {\n                    updateBlazorTemplate(this.parent.element.id + col.uid, 'Template', col, false);\n                }\n            }\n        }\n        var rowRenderer = new RowRenderer(this.serviceLocator, null, this.parent);\n        var tr;\n        var mTr;\n        var movObj;\n        if (gObj.isEdit) {\n            this.saveCell(true);\n        }\n        this.isAdded = false;\n        gObj.clearSelection();\n        for (var i = 0; i < rows.length; i++) {\n            if (rows[i].isDirty) {\n                if (gObj.frozenColumns) {\n                    movObj = gObj.getMovableRowsObject()[rows[i].index];\n                    movObj.isDirty = true;\n                }\n                tr = gObj.getContentTable().querySelector('[data-uid=' + rows[i].uid + ']');\n                if (gObj.frozenRows && !tr) {\n                    tr = gObj.getHeaderContent().querySelector('[data-uid=' + rows[i].uid + ']');\n                }\n                if (gObj.frozenColumns) {\n                    if (gObj.frozenRows) {\n                        mTr = gObj.getHeaderContent().querySelector('.e-movableheader')\n                            .querySelector('[data-uid=' + rows[i].uid + ']');\n                        if (!mTr) {\n                            mTr = gObj.getContent().querySelector('.e-movablecontent')\n                                .querySelector('[data-uid=' + rows[i].uid + ']');\n                        }\n                    }\n                    else {\n                        mTr = gObj.getContent().querySelector('.e-movablecontent')\n                            .querySelector('[data-uid=' + rows[i].uid + ']');\n                    }\n                }\n                if (tr || mTr) {\n                    if (tr && tr.classList.contains('e-insertedrow') || mTr && mTr.classList.contains('e-insertedrow')) {\n                        if (tr) {\n                            remove(tr);\n                        }\n                        if (mTr && (gObj.frozenColumns || gObj.frozenRows)) {\n                            remove(mTr);\n                        }\n                        this.removeRowObjectFromUID(rows[i].uid);\n                        i--;\n                    }\n                    else {\n                        refreshForeignData(rows[i], this.parent.getForeignKeyColumns(), rows[i].data);\n                        delete rows[i].changes;\n                        delete rows[i].edit;\n                        rows[i].isDirty = false;\n                        var ftr = mTr ? mTr : tr;\n                        if (isBlazor() && gObj.isServerRendered) {\n                            if (gObj.getFrozenColumns()) {\n                                this.removeHideAndSelection(mTr);\n                            }\n                            this.removeHideAndSelection(tr);\n                            this.closeForm();\n                        }\n                        else {\n                            classList(ftr, [], ['e-hiddenrow', 'e-updatedtd']);\n                            rowRenderer.refresh(rows[i], gObj.getColumns(), false);\n                        }\n                    }\n                    if (this.parent.aggregates.length > 0) {\n                        var type = 'type';\n                        var editType = [];\n                        editType[type] = 'cancel';\n                        this.parent.notify(events.refreshFooterRenderer, editType);\n                        if (this.parent.groupSettings.columns.length > 0) {\n                            this.parent.notify(events.groupAggregates, editType);\n                        }\n                    }\n                }\n            }\n        }\n        if (isBlazor() && gObj.isServerRendered) {\n            gObj.selectRow(gObj.selectionModule.prevRowIndex);\n        }\n        if (!gObj.getContentTable().querySelector('tr.e-row')) {\n            gObj.renderModule.renderEmptyRow();\n        }\n        var args = {\n            requestType: 'batchCancel', rows: this.parent.getRowsObject()\n        };\n        gObj.notify(events.batchCancel, {\n            rows: this.parent.getRowsObject().length ? this.parent.getRowsObject() :\n                [new Row({ isDataRow: true, cells: [new Cell({ isDataCell: true, visible: true })] })]\n        });\n        gObj.selectRow(this.cellDetails.rowIndex);\n        this.refreshRowIdx();\n        gObj.notify(events.toolbarRefresh, {});\n        this.parent.notify(events.tooltipDestroy, {});\n        args = { requestType: 'batchCancel', rows: this.parent.getRowsObject() };\n        gObj.trigger(events.batchCancel, args);\n        if (gObj.frozenColumns) {\n            rows.splice(this.parent.getMovableRowsObject().length, rows.length);\n        }\n    };\n    BatchEdit.prototype.removeHideAndSelection = function (tr) {\n        if (tr.classList.contains('e-hiddenrow')) {\n            tr.removeAttribute('aria-selected');\n            var tdElements = [].slice.call(tr.querySelectorAll('.e-selectionbackground'));\n            for (var i = 0; i < tdElements.length; i++) {\n                removeClass([tdElements[i]], ['e-selectionbackground', 'e-active']);\n            }\n        }\n        classList(tr, [], ['e-hiddenrow', 'e-updatedtd']);\n    };\n    BatchEdit.prototype.deleteRecord = function (fieldname, data) {\n        this.saveCell();\n        if (this.validateFormObj()) {\n            this.saveCell(true);\n        }\n        this.isAdded = false;\n        this.bulkDelete(fieldname, data);\n        if (this.parent.aggregates.length > 0) {\n            this.parent.notify(events.refreshFooterRenderer, {});\n            if (this.parent.groupSettings.columns.length > 0) {\n                this.parent.notify(events.groupAggregates, {});\n            }\n        }\n    };\n    BatchEdit.prototype.addRecord = function (data) {\n        this.bulkAddRow(data);\n    };\n    BatchEdit.prototype.endEdit = function (data) {\n        if (this.parent.isEdit && this.validateFormObj()) {\n            return;\n        }\n        this.batchSave();\n    };\n    BatchEdit.prototype.closeForm = function () {\n        for (var i = 0; i < Object.keys(this.originalCell).length; i++) {\n            for (var j = 0; j < Object.keys(this.cloneCell).length; j++) {\n                if (Object.keys(this.originalCell)[i] === Object.keys(this.cloneCell)[j]) {\n                    this.cloneCell[Object.keys(this.cloneCell)[j]].replaceWith(this.originalCell[Object.keys(this.originalCell)[i]]);\n                    if (this.originalCell[Object.keys(this.originalCell)[i]].classList.contains('e-selectionbackground')) {\n                        this.originalCell[Object.keys(this.originalCell)[i]]\n                            .classList.remove('e-selectionbackground', 'e-cellselectionbackground', 'e-active');\n                    }\n                }\n            }\n        }\n        this.cloneCell = {};\n        this.originalCell = {};\n    };\n    BatchEdit.prototype.validateFormObj = function () {\n        return this.parent.editModule.formObj && !this.parent.editModule.formObj.validate();\n    };\n    BatchEdit.prototype.batchSave = function () {\n        var _this = this;\n        var gObj = this.parent;\n        var deletedRecords = 'deletedRecords';\n        if (gObj.isCheckBoxSelection) {\n            var checkAllBox = gObj.element.querySelector('.e-checkselectall').parentElement;\n            if (checkAllBox.classList.contains('e-checkbox-disabled') &&\n                gObj.pageSettings.totalRecordsCount > gObj.currentViewData.length) {\n                removeClass([checkAllBox], ['e-checkbox-disabled']);\n            }\n        }\n        var cols = this.parent.getColumns();\n        if (isBlazor()) {\n            for (var i = 0; i < cols.length; i++) {\n                var col = cols[i];\n                if (col.template) {\n                    blazorTemplates[this.parent.element.id + col.uid] = [];\n                    resetBlazorTemplate(this.parent.element.id + col.uid, 'Template');\n                }\n            }\n        }\n        this.saveCell();\n        if (gObj.isEdit || this.editNextValCell() || gObj.isEdit) {\n            return;\n        }\n        var changes = this.getBatchChanges();\n        if (this.parent.selectionSettings.type === 'Multiple' && changes[deletedRecords].length &&\n            this.parent.selectionSettings.persistSelection) {\n            changes[deletedRecords] = this.removeSelectedData;\n            this.removeSelectedData = [];\n        }\n        var original = {\n            changedRecords: this.parent.getRowsObject()\n                .filter(function (row) { return row.isDirty && ['add', 'delete'].indexOf(row.edit) === -1; })\n                .map(function (row) { return row.data; })\n        };\n        var args = { batchChanges: changes, cancel: false };\n        gObj.trigger(events.beforeBatchSave, args, function (beforeBatchSaveArgs) {\n            if (beforeBatchSaveArgs.cancel) {\n                return;\n            }\n            if (isBlazor() && _this.parent.isServerRendered) {\n                var content = _this.parent.getContent();\n                _this.closeForm();\n                removeClass(content.querySelectorAll('.e-updatedtd'), ['e-updatedtd']);\n                if (content.querySelector('.e-insertedrow, .e-hiddenrow')) {\n                    removeClass(content.querySelectorAll('.e-hiddenrow'), ['e-hiddenrow']);\n                    var insertedRow = [].slice.call(content.querySelectorAll('.e-insertedrow'));\n                    for (var i = 0; i < insertedRow.length; i++) {\n                        insertedRow[i].remove();\n                    }\n                }\n                _this.refreshRowIdx();\n            }\n            gObj.showSpinner();\n            gObj.notify(events.bulkSave, { changes: changes, original: original });\n        });\n    };\n    BatchEdit.prototype.getBatchChanges = function () {\n        var changes = {\n            addedRecords: [],\n            deletedRecords: [],\n            changedRecords: []\n        };\n        var rows = this.parent.getRowsObject();\n        for (var _i = 0, rows_1 = rows; _i < rows_1.length; _i++) {\n            var row = rows_1[_i];\n            if (row.isDirty) {\n                switch (row.edit) {\n                    case 'add':\n                        changes.addedRecords.push(row.changes);\n                        break;\n                    case 'delete':\n                        changes.deletedRecords.push(row.data);\n                        break;\n                    default:\n                        changes.changedRecords.push(row.changes);\n                }\n            }\n        }\n        return changes;\n    };\n    /**\n     * @hidden\n     */\n    BatchEdit.prototype.removeRowObjectFromUID = function (uid) {\n        var rows = this.parent.getRowsObject();\n        var i = 0;\n        for (var len = rows.length; i < len; i++) {\n            if (rows[i].uid === uid) {\n                break;\n            }\n        }\n        rows.splice(i, 1);\n    };\n    /**\n     * @hidden\n     */\n    BatchEdit.prototype.addRowObject = function (row) {\n        var isTop = this.parent.editSettings.newRowPosition === 'Top';\n        var frozenColumnsCount = this.parent.getFrozenColumns();\n        if (frozenColumnsCount) {\n            var mRow = this.parent.getMovableRowsObject();\n            var mEle = row.clone();\n            mEle.cells = mEle.cells.slice(frozenColumnsCount);\n            row.cells = row.cells.slice(0, frozenColumnsCount);\n            isTop ? mRow.unshift(mEle) : mRow.push(mEle);\n        }\n        isTop ? this.parent.getRowsObject().unshift(row) :\n            this.parent.getRowsObject().push(row);\n    };\n    // tslint:disable-next-line:max-func-body-length\n    BatchEdit.prototype.bulkDelete = function (fieldname, data) {\n        var _this = this;\n        this.removeSelectedData = [];\n        var gObj = this.parent;\n        var index = gObj.selectedRowIndex;\n        var selectedRows = gObj.getSelectedRows();\n        var args = {\n            primaryKey: this.parent.getPrimaryKeyFieldNames(),\n            rowIndex: index,\n            rowData: data ? data : gObj.getSelectedRecords()[0],\n            cancel: false\n        };\n        if (!isBlazor() || this.parent.isJsComponent) {\n            if (data) {\n                args.row = gObj.editModule.deleteRowUid ? gObj.getRowElementByUID(gObj.editModule.deleteRowUid)\n                    : gObj.getRows()[gObj.getCurrentViewRecords().indexOf(data)];\n            }\n            else {\n                args.row = data ? gObj.getRows()[index] : selectedRows[0];\n            }\n            if (!args.row) {\n                return;\n            }\n        }\n        gObj.trigger(events.beforeBatchDelete, args, function (beforeBatchDeleteArgs) {\n            if (beforeBatchDeleteArgs.cancel) {\n                return;\n            }\n            _this.removeSelectedData = gObj.getSelectedRecords();\n            gObj.clearSelection();\n            beforeBatchDeleteArgs.row = beforeBatchDeleteArgs.row ?\n                beforeBatchDeleteArgs.row : data ? gObj.getRows()[index] : selectedRows[0];\n            if (_this.parent.getFrozenColumns()) {\n                if (data) {\n                    index = parseInt(beforeBatchDeleteArgs.row.getAttribute('aria-rowindex'), 10);\n                    selectedRows = [beforeBatchDeleteArgs.row];\n                    if (parentsUntil(beforeBatchDeleteArgs.row, 'e-frozencontent')\n                        || parentsUntil(beforeBatchDeleteArgs.row, 'e-frozenheader')) {\n                        selectedRows = selectedRows.concat(gObj.getMovableRowByIndex(index));\n                    }\n                    else if (parentsUntil(beforeBatchDeleteArgs.row, 'e-movablecontent')\n                        || (parentsUntil(beforeBatchDeleteArgs.row, 'e-movableheader'))) {\n                        selectedRows = selectedRows.concat(gObj.getFrozenRowByIndex(index));\n                    }\n                }\n                for (var i = 0; i < selectedRows.length; i++) {\n                    var uid = selectedRows[i].getAttribute('data-uid');\n                    if (selectedRows[i].classList.contains('e-insertedrow')) {\n                        _this.removeRowObjectFromUID(uid);\n                        remove(selectedRows[i]);\n                    }\n                    else {\n                        var rowObj = gObj.getRowObjectFromUID(uid);\n                        rowObj.isDirty = true;\n                        rowObj.edit = 'delete';\n                        classList(selectedRows[i], ['e-hiddenrow', 'e-updatedtd'], []);\n                        if (gObj.frozenRows && index < gObj.frozenRows && gObj.getMovableDataRows().length >= gObj.frozenRows) {\n                            gObj.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody')\n                                .appendChild(gObj.getMovableRowByIndex(gObj.frozenRows - 1));\n                            gObj.getHeaderContent().querySelector('.e-frozenheader').querySelector('tbody')\n                                .appendChild(gObj.getRowByIndex(gObj.frozenRows - 1));\n                        }\n                        if (gObj.frozenRows && index < gObj.frozenRows && gObj.getDataRows().length >= gObj.frozenRows) {\n                            gObj.getHeaderContent().querySelector('tbody').appendChild(gObj.getRowByIndex(gObj.frozenRows - 1));\n                        }\n                    }\n                    delete selectedRows[i];\n                }\n                var fCont = gObj.getContent().querySelector('.e-frozencontent');\n                var mCont = gObj.getContent().querySelector('.e-movablecontent');\n                fCont.style.height = mCont.offsetHeight - getScrollBarWidth() + 'px';\n            }\n            else if (!_this.parent.getFrozenColumns() && (selectedRows.length === 1 || data)) {\n                var uid = beforeBatchDeleteArgs.row.getAttribute('data-uid');\n                uid = data && _this.parent.editModule.deleteRowUid ? uid = _this.parent.editModule.deleteRowUid : uid;\n                if (beforeBatchDeleteArgs.row.classList.contains('e-insertedrow')) {\n                    _this.removeRowObjectFromUID(uid);\n                    remove(beforeBatchDeleteArgs.row);\n                }\n                else {\n                    var rowObj = gObj.getRowObjectFromUID(uid);\n                    rowObj.isDirty = true;\n                    rowObj.edit = 'delete';\n                    classList(beforeBatchDeleteArgs.row, ['e-hiddenrow', 'e-updatedtd'], []);\n                }\n                delete beforeBatchDeleteArgs.row;\n            }\n            else {\n                for (var i = 0; i < selectedRows.length; i++) {\n                    var uniqueid = selectedRows[i].getAttribute('data-uid');\n                    if (selectedRows[i].classList.contains('e-insertedrow')) {\n                        _this.removeRowObjectFromUID(uniqueid);\n                        remove(selectedRows[i]);\n                    }\n                    else {\n                        classList(selectedRows[i], ['e-hiddenrow', 'e-updatedtd'], []);\n                        var selectedRow = gObj.getRowObjectFromUID(uniqueid);\n                        selectedRow.isDirty = true;\n                        selectedRow.edit = 'delete';\n                        delete selectedRows[i];\n                    }\n                }\n            }\n            _this.refreshRowIdx();\n            if (data) {\n                gObj.editModule.deleteRowUid = undefined;\n                if (gObj.getSelectedRows().length) {\n                    index = parseInt(gObj.getSelectedRows()[0].getAttribute('aria-rowindex'), 10);\n                }\n            }\n            gObj.selectRow(index);\n            gObj.trigger(events.batchDelete, beforeBatchDeleteArgs);\n            gObj.notify(events.batchDelete, { rows: _this.parent.getRowsObject() });\n            gObj.notify(events.toolbarRefresh, {});\n        });\n    };\n    BatchEdit.prototype.refreshRowIdx = function () {\n        var rows = [];\n        var mRows = [];\n        var nonMovableRows = [];\n        var frzCols = this.parent.getFrozenColumns();\n        if (this.parent.frozenRows) {\n            rows = [].slice.call(this.parent.getHeaderTable().querySelector('tbody').children);\n            if (frzCols) {\n                mRows = [].slice.call(this.parent.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody').children);\n                for (var i = 0; i < mRows.length; i++) {\n                    nonMovableRows[i] = this.parent.createElement('tr', { className: 'emptynonmv' });\n                }\n            }\n        }\n        if (frzCols) {\n            mRows = mRows.concat([].slice.call(this.parent.getContentTable().querySelector('tbody').children));\n            nonMovableRows = nonMovableRows.concat([].slice.call(this.parent.element.querySelector('.e-movablecontent').querySelector('tbody').children));\n        }\n        rows = rows.concat([].slice.call(this.parent.getContentTable().querySelector('tbody').children));\n        for (var i = 0, j = 0, len = rows.length; i < len; i++) {\n            if (rows[i].classList.contains('e-row') && !rows[i].classList.contains('e-hiddenrow')) {\n                rows[i].setAttribute('aria-rowindex', j.toString());\n                if (frzCols) {\n                    mRows[i].setAttribute('aria-rowindex', j.toString());\n                    if (nonMovableRows[i].classList.contains('e-row')) {\n                        nonMovableRows[i].setAttribute('aria-rowindex', j.toString());\n                    }\n                }\n                j++;\n            }\n            else {\n                rows[i].removeAttribute('aria-rowindex');\n                if (frzCols) {\n                    mRows[i].removeAttribute('aria-rowindex');\n                }\n            }\n        }\n    };\n    BatchEdit.prototype.getIndexFromData = function (data) {\n        return inArray(data, this.parent.getCurrentViewRecords());\n    };\n    BatchEdit.prototype.bulkAddRow = function (data) {\n        var _this = this;\n        var gObj = this.parent;\n        if (!gObj.editSettings.allowAdding) {\n            return;\n        }\n        if (gObj.isEdit) {\n            this.saveCell();\n            this.parent.notify(events.editNextValCell, {});\n        }\n        if (gObj.isEdit) {\n            return;\n        }\n        this.parent.element.classList.add('e-editing');\n        var defaultData = data ? data : this.getDefaultData();\n        var args = {\n            defaultData: defaultData,\n            primaryKey: gObj.getPrimaryKeyFieldNames(),\n            cancel: false\n        };\n        gObj.trigger(events.beforeBatchAdd, args, function (beforeBatchAddArgs) {\n            if (beforeBatchAddArgs.cancel) {\n                return;\n            }\n            _this.isAdded = true;\n            gObj.clearSelection();\n            var mTr;\n            var mTbody;\n            var row = new RowRenderer(_this.serviceLocator, null, _this.parent);\n            var model = new RowModelGenerator(_this.parent);\n            var modelData = model.generateRows([beforeBatchAddArgs.defaultData]);\n            var tr = row.render(modelData[0], gObj.getColumns());\n            var col;\n            var index;\n            for (var i = 0; i < _this.parent.groupSettings.columns.length; i++) {\n                tr.insertBefore(_this.parent.createElement('td', { className: 'e-indentcell' }), tr.firstChild);\n                modelData[0].cells.unshift(new Cell({ cellType: CellType.Indent }));\n            }\n            var tbody = gObj.getContentTable().querySelector('tbody');\n            tr.classList.add('e-insertedrow');\n            if (tbody.querySelector('.e-emptyrow')) {\n                tbody.querySelector('.e-emptyrow').remove();\n                if (_this.parent.getFrozenColumns()) {\n                    var moveTbody = _this.parent.getContent().querySelector('.e-movablecontent').querySelector('tbody');\n                    moveTbody.firstElementChild.remove();\n                }\n            }\n            if (gObj.getFrozenColumns()) {\n                mTr = _this.renderMovable(tr);\n                if (gObj.frozenRows && gObj.editSettings.newRowPosition === 'Top') {\n                    mTbody = gObj.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody');\n                }\n                else {\n                    mTbody = gObj.getContent().querySelector('.e-movablecontent').querySelector('tbody');\n                }\n                _this.parent.editSettings.newRowPosition === 'Top' ? mTbody.insertBefore(mTr, mTbody.firstChild) : mTbody.appendChild(mTr);\n                addClass(mTr.querySelectorAll('.e-rowcell'), ['e-updatedtd']);\n                if (_this.parent.height === 'auto') {\n                    _this.parent.notify(events.frozenHeight, {});\n                }\n            }\n            if (gObj.frozenRows && gObj.editSettings.newRowPosition === 'Top') {\n                tbody = gObj.getHeaderContent().querySelector('tbody');\n            }\n            else {\n                tbody = gObj.getContent().querySelector('tbody');\n            }\n            _this.parent.editSettings.newRowPosition === 'Top' ? tbody.insertBefore(tr, tbody.firstChild) : tbody.appendChild(tr);\n            addClass(tr.querySelectorAll('.e-rowcell'), ['e-updatedtd']);\n            modelData[0].isDirty = true;\n            modelData[0].changes = extend({}, {}, modelData[0].data, true);\n            modelData[0].edit = 'add';\n            _this.addRowObject(modelData[0]);\n            _this.refreshRowIdx();\n            _this.focus.forgetPrevious();\n            gObj.notify(events.batchAdd, { rows: _this.parent.getRowsObject(), args: { isFrozen: _this.parent.getFrozenColumns() } });\n            var changes = _this.getBatchChanges();\n            var addedRecords = 'addedRecords';\n            var dRecords = 'deletedRecords';\n            var btmIdx = _this.parent.getCurrentViewRecords().length + changes[addedRecords].length - changes[dRecords].length - 1;\n            _this.parent.editSettings.newRowPosition === 'Top' ? gObj.selectRow(0) : gObj.selectRow(btmIdx);\n            if (!data) {\n                index = _this.findNextEditableCell(0, true);\n                col = gObj.getColumns()[index];\n                _this.parent.editSettings.newRowPosition === 'Top' ? _this.editCell(0, col.field, true) :\n                    _this.editCell(btmIdx, col.field, true);\n            }\n            if (_this.parent.aggregates.length > 0 && (data || changes[addedRecords].length)) {\n                _this.parent.notify(events.refreshFooterRenderer, {});\n            }\n            var args1 = {\n                defaultData: beforeBatchAddArgs.defaultData, row: tr,\n                columnObject: col, columnIndex: index, primaryKey: beforeBatchAddArgs.primaryKey, cell: tr.cells[index]\n            };\n            gObj.trigger(events.batchAdd, args1);\n            if (gObj.getFrozenColumns()) {\n                alignFrozenEditForm(mTr.querySelector('td:not(.e-hide)'), tr.querySelector('td:not(.e-hide)'));\n            }\n            if (isBlazor()) {\n                _this.parent.notify(events.toolbarRefresh, {});\n                _this.parent.notify('start-add', {});\n            }\n        });\n    };\n    BatchEdit.prototype.renderMovable = function (ele) {\n        var mEle = ele.cloneNode(true);\n        for (var i = 0; i < this.parent.getFrozenColumns(); i++) {\n            mEle.removeChild(mEle.children[0]);\n        }\n        for (var i = this.parent.getFrozenColumns(), len = ele.childElementCount; i < len; i++) {\n            ele.removeChild(ele.children[ele.childElementCount - 1]);\n        }\n        return mEle;\n    };\n    BatchEdit.prototype.findNextEditableCell = function (columnIndex, isAdd, isValOnly) {\n        var cols = this.parent.getColumns();\n        var endIndex = cols.length;\n        var validation;\n        for (var i = columnIndex; i < endIndex; i++) {\n            validation = isValOnly ? isNullOrUndefined(cols[i].validationRules) : false;\n            if (!isAdd && this.checkNPCell(cols[i])) {\n                return i;\n            }\n            else if (isAdd && !cols[i].template && cols[i].visible && cols[i].allowEditing &&\n                !(cols[i].isIdentity && cols[i].isPrimaryKey) && !validation) {\n                return i;\n            }\n        }\n        return -1;\n    };\n    BatchEdit.prototype.checkNPCell = function (col) {\n        return !col.template && col.visible && !col.isPrimaryKey && !col.isIdentity && col.allowEditing;\n    };\n    BatchEdit.prototype.getDefaultData = function () {\n        var gObj = this.parent;\n        var data = {};\n        var dValues = { 'number': 0, 'string': null, 'boolean': false, 'date': null, 'datetime': null };\n        for (var _i = 0, _a = (gObj.columnModel); _i < _a.length; _i++) {\n            var col = _a[_i];\n            if (col.field) {\n                setValue(col.field, col.defaultValue ? col.defaultValue : dValues[col.type], data);\n            }\n        }\n        return data;\n    };\n    BatchEdit.prototype.setCellIdx = function (target) {\n        var gLen = 0;\n        if (this.parent.allowGrouping) {\n            gLen = this.parent.groupSettings.columns.length;\n        }\n        this.cellDetails.cellIndex = target.cellIndex - gLen;\n        this.cellDetails.rowIndex = parseInt(target.getAttribute('index'), 10);\n    };\n    BatchEdit.prototype.editCell = function (index, field, isAdd) {\n        var gObj = this.parent;\n        var col = gObj.getColumnByField(field);\n        this.index = index;\n        this.field = field;\n        this.isAdd = isAdd;\n        var checkEdit = gObj.isEdit && !(this.cellDetails.column.field === field\n            && (this.cellDetails.rowIndex === index && this.parent.getDataRows().length - 1 !== index));\n        if (isBlazor() && col.template && !isAdd) {\n            resetBlazorTemplate(this.parent.element.id + col.uid, 'Template', index);\n        }\n        if (gObj.editSettings.allowEditing) {\n            if (!checkEdit && col.allowEditing) {\n                this.editCellExtend(index, field, isAdd);\n            }\n            else if (checkEdit) {\n                this.editNext = true;\n                this.saveCell();\n            }\n        }\n    };\n    BatchEdit.prototype.editCellExtend = function (index, field, isAdd) {\n        var _this = this;\n        var gObj = this.parent;\n        var col = gObj.getColumnByField(field);\n        var keys = gObj.getPrimaryKeyFieldNames();\n        if (gObj.isEdit) {\n            return;\n        }\n        var row;\n        var rowData;\n        var mRowData;\n        var colIdx = gObj.getColumnIndexByField(field);\n        var frzCols = gObj.getFrozenColumns();\n        if (frzCols && colIdx >= frzCols) {\n            row = gObj.getMovableDataRows()[index];\n            mRowData = this.parent.getRowObjectFromUID(this.parent.getMovableDataRows()[index].getAttribute('data-uid'));\n            rowData = mRowData.changes ? extend({}, {}, mRowData.changes, true) : extend({}, {}, this.getDataByIndex(index), true);\n        }\n        else {\n            row = gObj.getDataRows()[index];\n            rowData = extend({}, {}, this.getDataByIndex(index), true);\n        }\n        if ((keys[0] === col.field && !row.classList.contains('e-insertedrow')) || col.columns ||\n            (col.isPrimaryKey && col.isIdentity)) {\n            this.parent.isLastCellPrimaryKey = true;\n            return;\n        }\n        this.parent.isLastCellPrimaryKey = false;\n        this.parent.element.classList.add('e-editing');\n        var rowObj = gObj.getRowObjectFromUID(row.getAttribute('data-uid'));\n        var cells = [].slice.apply(row.cells);\n        var args = {\n            columnName: col.field, isForeignKey: !isNullOrUndefined(col.foreignKeyValue),\n            primaryKey: keys, rowData: rowData,\n            validationRules: extend({}, col.validationRules ? col.validationRules : {}),\n            value: getObject(col.field, rowData),\n            type: !isAdd ? 'edit' : 'add', cancel: false,\n            foreignKeyData: rowObj && rowObj.foreignKeyData\n        };\n        if (!isBlazor() || this.parent.isJsComponent) {\n            args.cell = cells[this.getColIndex(cells, this.getCellIdx(col.uid))];\n            args.row = row;\n            args.columnObject = col;\n            if (!args.cell) {\n                return;\n            }\n        }\n        gObj.trigger(events.cellEdit, args, function (cellEditArgs) {\n            if (cellEditArgs.cancel) {\n                return;\n            }\n            cellEditArgs.cell = cellEditArgs.cell ? cellEditArgs.cell : cells[_this.getColIndex(cells, _this.getCellIdx(col.uid))];\n            cellEditArgs.row = cellEditArgs.row ? cellEditArgs.row : row;\n            cellEditArgs.columnObject = cellEditArgs.columnObject ? cellEditArgs.columnObject : col;\n            cellEditArgs.columnObject.index = isNullOrUndefined(cellEditArgs.columnObject.index) ? 0 : cellEditArgs.columnObject.index;\n            _this.cellDetails = {\n                rowData: rowData, column: col, value: cellEditArgs.value, isForeignKey: cellEditArgs.isForeignKey, rowIndex: index,\n                cellIndex: parseInt(cellEditArgs.cell.getAttribute('aria-colindex'), 10),\n                foreignKeyData: cellEditArgs.foreignKeyData\n            };\n            if (cellEditArgs.cell.classList.contains('e-updatedtd')) {\n                _this.isColored = true;\n                cellEditArgs.cell.classList.remove('e-updatedtd');\n            }\n            if (isBlazor() && gObj.isServerRendered) {\n                var cell = 'cells';\n                var cloneCell = 'cloneCell';\n                var indent = cellEditArgs.row.querySelectorAll('.e-indentcell, .e-detailrowcollapse, .e-detailrowexpand, .e-rowdragdrop').length;\n                _this.cloneCell[\"\" + _this.cellDetails.rowIndex + cellEditArgs.columnObject.index] =\n                    cellEditArgs[cloneCell] = cellEditArgs.cell.cloneNode(true);\n                if ((parentsUntil(cellEditArgs.cell, 'e-movableheader') || parentsUntil(cellEditArgs.cell, 'e-movablecontent'))) {\n                    cellEditArgs.row.insertCell(cellEditArgs.columnObject.index - gObj.getFrozenColumns());\n                    cellEditArgs.row.replaceChild(cellEditArgs[cloneCell], cellEditArgs.row[cell][cellEditArgs.columnObject.index - gObj.getFrozenColumns()]);\n                }\n                else {\n                    cellEditArgs.row.insertCell(cellEditArgs.columnObject.index + indent);\n                    cellEditArgs.row.replaceChild(cellEditArgs[cloneCell], cellEditArgs.row[cell][cellEditArgs.columnObject.index + indent]);\n                }\n                _this.originalCell[\"\" + _this.cellDetails.rowIndex + cellEditArgs.columnObject.index] =\n                    cellEditArgs.cell.parentElement.removeChild(cellEditArgs.cell);\n                removeClass([_this.cloneCell[\"\" + _this.cellDetails.rowIndex + cellEditArgs.columnObject.index]], ['e-focus', 'e-focused']);\n            }\n            gObj.isEdit = true;\n            gObj.clearSelection();\n            if (!gObj.isCheckBoxSelection || !gObj.isPersistSelection) {\n                gObj.selectRow(_this.cellDetails.rowIndex, true);\n            }\n            _this.renderer.update(cellEditArgs);\n            _this.parent.notify(events.batchEditFormRendered, cellEditArgs);\n            _this.form = gObj.element.querySelector('#' + gObj.element.id + 'EditForm');\n            gObj.editModule.applyFormValidation([col]);\n            _this.parent.element.querySelector('.e-gridpopup').style.display = 'none';\n        });\n    };\n    BatchEdit.prototype.updateCell = function (rowIndex, field, value) {\n        var col = this.parent.getColumnByField(field);\n        var index = this.parent.getColumnIndexByField(field);\n        if (col && !col.isPrimaryKey) {\n            var td = this.parent.getDataRows()[rowIndex].querySelectorAll('.e-rowcell')[index];\n            if (this.parent.getFrozenColumns()) {\n                var cells = [].slice.call(this.parent.getDataRows()[rowIndex].querySelectorAll('.e-rowcell')).concat([].slice.call(this.parent.getMovableDataRows()[rowIndex].querySelectorAll('.e-rowcell')));\n                td = cells[index];\n            }\n            var rowObj = this.parent.getRowObjectFromUID(td.parentElement.getAttribute('data-uid'));\n            this.refreshTD(td, col, rowObj, value);\n            this.parent.trigger(events.queryCellInfo, {\n                cell: td, column: col, data: rowObj.changes\n            });\n        }\n    };\n    BatchEdit.prototype.setChanges = function (rowObj, field, value, td) {\n        var currentRowObj;\n        if (!this.parent.getFrozenColumns()) {\n            if (!rowObj.changes) {\n                rowObj.changes = extend({}, {}, rowObj.data, true);\n            }\n            if (!isNullOrUndefined(field)) {\n                DataUtil.setValue(field, value, rowObj.changes);\n            }\n            if (rowObj.data[field] !== value) {\n                rowObj.isDirty = true;\n            }\n        }\n        else {\n            var rowEle = this.parent.getRowElementByUID(rowObj.uid);\n            var rowIndex = parseInt(rowEle.getAttribute('aria-rowindex'), 10);\n            currentRowObj = this.parent.getRowsObject()[rowIndex];\n            if (!currentRowObj.changes) {\n                currentRowObj.changes = extend({}, {}, rowObj.data, true);\n            }\n            if (!isNullOrUndefined(field)) {\n                setValue(field, value, currentRowObj.changes);\n            }\n            var movableRowObject = void 0;\n            if (isBlazor() && this.parent.isServerRendered && (parentsUntil(td, 'e-movableheader') ||\n                parentsUntil(td, 'e-movablecontent'))) {\n                var movRowEle = this.parent.getMovableRowByIndex(this.cellDetails.rowIndex);\n                var movRowIndex = parseInt(movRowEle.getAttribute('aria-rowindex'), 10);\n                movableRowObject = this.parent.getMovableRowsObject()[movRowIndex];\n            }\n            else {\n                movableRowObject = this.parent.getMovableRowsObject()[rowIndex];\n            }\n            movableRowObject.changes = extend({}, {}, currentRowObj.changes, true);\n            if (rowObj.data[field] !== value) {\n                movableRowObject.isDirty = true;\n                currentRowObj.isDirty = true;\n            }\n        }\n    };\n    BatchEdit.prototype.updateRow = function (index, data) {\n        var keys = Object.keys(data);\n        for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n            var col = keys_1[_i];\n            this.updateCell(index, col, data[col]);\n        }\n    };\n    BatchEdit.prototype.getCellIdx = function (uid) {\n        var cIdx = this.parent.getColumnIndexByUid(uid) + this.parent.groupSettings.columns.length;\n        if (!isNullOrUndefined(this.parent.detailTemplate) || !isNullOrUndefined(this.parent.childGrid)) {\n            cIdx++;\n        }\n        if (this.parent.isRowDragable()) {\n            cIdx++;\n        }\n        return cIdx;\n    };\n    BatchEdit.prototype.refreshTD = function (td, column, rowObj, value) {\n        var cell = new CellRenderer(this.parent, this.serviceLocator);\n        var rowcell;\n        value = column.type === 'number' && !isNullOrUndefined(value) ? parseFloat(value) : value;\n        this.setChanges(rowObj, column.field, value, td);\n        var frzCols = this.parent.getFrozenColumns();\n        refreshForeignData(rowObj, this.parent.getForeignKeyColumns(), rowObj.changes);\n        if (frzCols && this.getCellIdx(column.uid) >= frzCols && this.parent.getColumns().length === rowObj.cells.length) {\n            rowcell = rowObj.cells.slice(frzCols, rowObj.cells.length);\n        }\n        else {\n            rowcell = rowObj.cells;\n        }\n        cell.refreshTD(td, rowcell[this.getCellIdx(column.uid) - (this.getCellIdx(column.uid) >= frzCols ? frzCols : 0)], rowObj.changes, { 'index': this.getCellIdx(column.uid) });\n        td.classList.add('e-updatedtd');\n        this.parent.notify(events.toolbarRefresh, {});\n    };\n    BatchEdit.prototype.getColIndex = function (cells, index) {\n        var cIdx = 0;\n        if (this.parent.allowGrouping && this.parent.groupSettings.columns) {\n            cIdx = this.parent.groupSettings.columns.length;\n        }\n        if (!isNullOrUndefined(this.parent.detailTemplate) || !isNullOrUndefined(this.parent.childGrid)) {\n            cIdx++;\n        }\n        if (this.parent.isRowDragable()) {\n            cIdx++;\n        }\n        for (var m = 0; m < cells.length; m++) {\n            var colIndex = parseInt(cells[m].getAttribute('aria-colindex'), 10);\n            if (colIndex === index - cIdx) {\n                return m;\n            }\n        }\n        return -1;\n    };\n    BatchEdit.prototype.editNextValCell = function () {\n        var gObj = this.parent;\n        var changes = this.getBatchChanges();\n        var addedRecords = 'addedRecords';\n        var dRecords = 'deletedRecords';\n        var btmIdx = (this.parent.getCurrentViewRecords().length + changes[addedRecords].length - changes[dRecords].length) - 1;\n        if (this.isAdded && !gObj.isEdit) {\n            for (var i = this.cellDetails.cellIndex; i < gObj.getColumns().length; i++) {\n                if (gObj.isEdit) {\n                    return;\n                }\n                var index = this.findNextEditableCell(this.cellDetails.cellIndex + 1, true, true);\n                var col = gObj.getColumns()[index];\n                if (col) {\n                    this.parent.editSettings.newRowPosition === 'Bottom' ? this.editCell(btmIdx, col.field, true) :\n                        this.editCell(0, col.field, true);\n                    this.saveCell();\n                }\n            }\n            if (!gObj.isEdit) {\n                this.isAdded = false;\n            }\n        }\n    };\n    BatchEdit.prototype.escapeCellEdit = function () {\n        var args = this.generateCellArgs();\n        args.value = args.previousValue;\n        this.successCallBack(args, args.cell.parentElement, args.column, true)(args);\n    };\n    BatchEdit.prototype.generateCellArgs = function () {\n        var gObj = this.parent;\n        this.parent.element.classList.remove('e-editing');\n        var column = this.cellDetails.column;\n        var obj = {};\n        obj[column.field] = getObject(column.field, this.cellDetails.rowData);\n        var editedData = gObj.editModule.getCurrentEditedData(this.form, obj);\n        var cloneEditedData = extend({}, editedData);\n        editedData = extend({}, editedData, this.cellDetails.rowData);\n        var value = getObject(column.field, cloneEditedData);\n        if (!isNullOrUndefined(column.field) && !isUndefined(value)) {\n            setValue(column.field, value, editedData);\n        }\n        var args = {\n            columnName: column.field,\n            value: getObject(column.field, editedData),\n            rowData: this.cellDetails.rowData,\n            column: column,\n            previousValue: this.cellDetails.value,\n            isForeignKey: this.cellDetails.isForeignKey,\n            cancel: false\n        };\n        if (!isBlazor() || this.parent.isJsComponent) {\n            args.cell = this.form.parentElement;\n            args.columnObject = column;\n        }\n        return args;\n    };\n    BatchEdit.prototype.saveCell = function (isForceSave) {\n        if (this.preventSaveCell) {\n            return;\n        }\n        var gObj = this.parent;\n        if (!isForceSave && (!gObj.isEdit || this.validateFormObj())) {\n            return;\n        }\n        this.preventSaveCell = true;\n        var args = this.generateCellArgs();\n        var tr = isBlazor() ? parentsUntil(this.form, 'e-row') : args.cell.parentElement;\n        var col = isBlazor() ? this.cellDetails.column : args.column;\n        if (isBlazor()) {\n            delete args.column;\n        }\n        if (!isForceSave) {\n            gObj.trigger(events.cellSave, args, this.successCallBack(args, tr, col));\n            gObj.notify(events.batchForm, { formObj: this.form });\n        }\n        else {\n            this.successCallBack(args, tr, col)(args);\n        }\n    };\n    BatchEdit.prototype.successCallBack = function (cellSaveArgs, tr, column, isEscapeCellEdit) {\n        var _this = this;\n        return function (cellSaveArgs) {\n            var gObj = _this.parent;\n            cellSaveArgs.cell = cellSaveArgs.cell ? cellSaveArgs.cell : _this.form.parentElement;\n            cellSaveArgs.columnObject = cellSaveArgs.columnObject ? cellSaveArgs.columnObject : column;\n            cellSaveArgs.columnObject.index = isNullOrUndefined(cellSaveArgs.columnObject.index) ? 0 : cellSaveArgs.columnObject.index;\n            if (cellSaveArgs.cancel) {\n                _this.preventSaveCell = false;\n                if (_this.editNext) {\n                    _this.editNext = false;\n                    if (_this.cellDetails.rowIndex === _this.index && _this.cellDetails.column.field === _this.field) {\n                        return;\n                    }\n                    _this.editCellExtend(_this.index, _this.field, _this.isAdd);\n                }\n                return;\n            }\n            gObj.editModule.destroyWidgets([column]);\n            gObj.isEdit = false;\n            gObj.editModule.destroyForm();\n            if (isBlazor() && column.template && !cellSaveArgs.cell.parentElement.classList.contains('e-insertedrow')) {\n                updateBlazorTemplate(gObj.element.id + column.uid, 'Template', column, false);\n            }\n            _this.parent.notify(events.tooltipDestroy, {});\n            if (isBlazor() && gObj.isServerRendered && (parentsUntil(cellSaveArgs.cell, 'e-movableheader') ||\n                parentsUntil(cellSaveArgs.cell, 'e-movablecontent'))) {\n                _this.refreshTD(cellSaveArgs.cell, column, gObj.getMovableRowsObject()[_this.cellDetails.rowIndex], cellSaveArgs.value);\n            }\n            else {\n                var rowObj = parentsUntil(cellSaveArgs.cell, 'e-movablecontent') ?\n                    gObj.getMovableRowsObject()[_this.cellDetails.rowIndex] : gObj.getRowObjectFromUID(tr.getAttribute('data-uid'));\n                _this.refreshTD(cellSaveArgs.cell, column, rowObj, cellSaveArgs.value);\n            }\n            removeClass([tr], ['e-editedrow', 'e-batchrow']);\n            removeClass([cellSaveArgs.cell], ['e-editedbatchcell', 'e-boolcell']);\n            if (!isNullOrUndefined(cellSaveArgs.value) && cellSaveArgs.value.toString() ===\n                (!isNullOrUndefined(_this.cellDetails.value) ? _this.cellDetails.value : '').toString() && !_this.isColored\n                || (isNullOrUndefined(cellSaveArgs.value) && isNullOrUndefined(_this.cellDetails.value) &&\n                    !cellSaveArgs.cell.parentElement.classList.contains('e-insertedrow'))) {\n                cellSaveArgs.cell.classList.remove('e-updatedtd');\n                if (isBlazor() && gObj.isServerRendered && (!isNullOrUndefined(cellSaveArgs.value) ? cellSaveArgs.value : '').toString() ===\n                    (!isNullOrUndefined(_this.cellDetails.value) ? _this.cellDetails.value : '').toString()) {\n                    if (_this.cloneCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index].\n                        classList.contains('e-selectionbackground')) {\n                        _this.originalCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index].\n                            classList.add('e-selectionbackground', 'e-active');\n                    }\n                    else {\n                        _this.originalCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index].\n                            classList.remove('e-selectionbackground', 'e-active');\n                    }\n                    _this.cloneCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index]\n                        .replaceWith(_this.originalCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index]);\n                }\n            }\n            if (isNullOrUndefined(isEscapeCellEdit)) {\n                gObj.trigger(events.cellSaved, cellSaveArgs);\n            }\n            gObj.notify(events.toolbarRefresh, {});\n            _this.isColored = false;\n            if (_this.parent.aggregates.length > 0) {\n                _this.parent.notify(events.refreshFooterRenderer, {});\n                if (_this.parent.groupSettings.columns.length > 0 && !_this.isAddRow(_this.cellDetails.rowIndex)) {\n                    _this.parent.notify(events.groupAggregates, {});\n                }\n            }\n            _this.preventSaveCell = false;\n            if (_this.editNext) {\n                _this.editNext = false;\n                if (_this.cellDetails.rowIndex === _this.index && _this.cellDetails.column.field === _this.field) {\n                    return;\n                }\n                var col = gObj.getColumnByField(_this.field);\n                if (col && col.allowEditing) {\n                    _this.editCellExtend(_this.index, _this.field, _this.isAdd);\n                }\n            }\n            if (isEscapeCellEdit) {\n                gObj.notify(events.restoreFocus, {});\n            }\n        };\n    };\n    BatchEdit.prototype.getDataByIndex = function (index) {\n        var row = this.parent.getRowObjectFromUID(this.parent.getDataRows()[index].getAttribute('data-uid'));\n        return row.changes ? row.changes : row.data;\n    };\n    BatchEdit.prototype.keyDownHandler = function (e) {\n        if ((e.action === 'tab' || e.action === 'shiftTab') && this.parent.isEdit) {\n            var gObj = this.parent;\n            var changes = this.getBatchChanges();\n            var addedRecords = 'addedRecords';\n            var dRecords = 'deletedRecords';\n            var btmIdx = (this.parent.getCurrentViewRecords().length + changes[addedRecords].length - changes[dRecords].length) - 1;\n            var rowcell = parentsUntil(e.target, 'e-rowcell');\n            if (rowcell) {\n                var cell = rowcell.querySelector('.e-field');\n                if (cell) {\n                    var visibleColumns = this.parent.getVisibleColumns();\n                    var columnIndex = e.action === 'tab' ? visibleColumns.length - 1 : 0;\n                    if (visibleColumns[columnIndex].field === cell.getAttribute('id').slice(this.parent.element.id.length)) {\n                        if (this.cellDetails.rowIndex === btmIdx && e.action === 'tab') {\n                            if (gObj.editSettings.newRowPosition === 'Top') {\n                                gObj.editSettings.newRowPosition = 'Bottom';\n                                this.addRecord();\n                                gObj.editSettings.newRowPosition = 'Top';\n                            }\n                            else {\n                                this.addRecord();\n                            }\n                        }\n                        else {\n                            this.saveCell();\n                        }\n                    }\n                }\n            }\n        }\n    };\n    /**\n     * @hidden\n     */\n    BatchEdit.prototype.addCancelWhilePaging = function () {\n        if (this.validateFormObj()) {\n            this.parent.notify(events.destroyForm, {});\n            this.parent.isEdit = false;\n            this.isColored = false;\n        }\n    };\n    return BatchEdit;\n}());\nexport { BatchEdit };\n"]},"metadata":{},"sourceType":"module"}